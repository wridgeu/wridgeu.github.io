{"version":3,"file":"Wiki.controller.js","names":["getSelectedContent","___util_githubService","getWikiIndex","getContentEditLink","markdownService","___util_markdownService","BaseController","_interopRequireDefault","__BaseController","WikiController","extend","onInit","_onInit","this","getView","addStyleClass","getOwnerComponent","getContentDensityClass","_wikiContentModel","JSONModel","markdown","title","edit","setModel","getRouter","getRoute","attachMatched","_onRouteMatched","bind","onThemeSwap","_onThemeSwap","toggleTheme","_this","Promise","resolve","_initializeSidebar","then","e","reject","_this2","wikiIndex","parsedMarkdown","parse","matches","matchAll","forEach","element","byId","addItem","ActionListItem","text","press","onSidebarSelection","Device","system","phone","_onSidebarSelection","sMarkdownFileName","jsonModel","isOpenedOnPhone","_this3","markdownPage","editLink","setData","setTimeout","_activatePage","scrollTo"],"sources":["Wiki.controller.ts"],"sourcesContent":["import Page from \"sap/m/Page\";\nimport Component from \"../Component\";\nimport {\n\tgetSelectedContent,\n\tgetWikiIndex,\n\tgetContentEditLink\n} from \"../util/githubService\";\nimport { markdownService } from \"../util/markdownService\";\nimport BaseController from \"./Base.controller\";\nimport List from \"sap/m/List\";\nimport ActionListItem from \"sap/m/ActionListItem\";\nimport JSONModel from \"sap/ui/model/json/JSONModel\";\nimport ResponsiveSplitter from \"sap/ui/layout/ResponsiveSplitter\";\nimport Device from \"sap/ui/Device\";\n\n/**\n * @namespace sapmarco.projectpages.controller\n */\nexport default class WikiController extends BaseController {\n\tprivate _wikiContentModel: JSONModel;\n\n\tpublic onInit(): void {\n\t\tthis.getView().addStyleClass(\n\t\t\t(this.getOwnerComponent() as Component).getContentDensityClass()\n\t\t);\n\n\t\tthis._wikiContentModel = new JSONModel({\n\t\t\tmarkdown: \"\",\n\t\t\ttitle: \"\",\n\t\t\tedit: \"\"\n\t\t});\n\n\t\tthis.getView().setModel(this._wikiContentModel, \"convertedmarkdown\");\n\n\t\tthis.getRouter()\n\t\t\t.getRoute(\"RouteWiki\")\n\t\t\t.attachMatched(this._onRouteMatched.bind(this), this);\n\t}\n\n\t/**\n\t * Event-handler for theme toggle\n\t */\n\tpublic onThemeSwap(): void {\n\t\tthis.toggleTheme();\n\t}\n\n\t/**\n\t * Event-handler for route matched\n\t */\n\tprivate async _onRouteMatched(): Promise<void> {\n\t\tawait this._initializeSidebar();\n\t}\n\n\t/**\n\t * Initialization of sidebar\n\t */\n\tprivate async _initializeSidebar(): Promise<void> {\n\t\t//get sidebar from actual github-wiki\n\t\tconst wikiIndex = await getWikiIndex();\n\t\t//parse markdown to html\n\t\tconst parsedMarkdown = markdownService.parse(wikiIndex);\n\t\tconst matches = [...parsedMarkdown.matchAll(/\\wiki\\/(.*?)\\\"/g)];\n\t\tmatches.forEach(element => {\n\t\t\t(this.byId(\"sidebar\") as List).addItem(\n\t\t\t\tnew ActionListItem({\n\t\t\t\t\ttext: `${element[1]}`,\n\t\t\t\t\tpress: this.onSidebarSelection.bind(\n\t\t\t\t\t\tthis,\n\t\t\t\t\t\telement[1],\n\t\t\t\t\t\tthis._wikiContentModel,\n\t\t\t\t\t\tDevice.system.phone\n\t\t\t\t\t)\n\t\t\t\t})\n\t\t\t);\n\t\t});\n\t}\n\n\t/**\n\t * @param  {string} sMarkdownFileName name of markdown file\n\t */\n\tprivate onSidebarSelection(\n\t\tsMarkdownFileName: string,\n\t\tjsonModel: JSONModel,\n\t\tisOpenedOnPhone: boolean\n\t): void {\n\t\t// fix eslint issue in press event handler of ActionListItem:\n\t\t// see: https://stackoverflow.com/a/63488201\n\t\t// also: https://typescript-eslint.io/rules/no-floating-promises/\n\t\tvoid (async () => {\n\t\t\t//get markdown page and encode - to %20\n\t\t\tconst markdownPage = await getSelectedContent(sMarkdownFileName);\n\t\t\tconst editLink = getContentEditLink(sMarkdownFileName);\n\n\t\t\tjsonModel.setData({\n\t\t\t\tmarkdown: `<div class=\"container\">${markdownService.parse(\n\t\t\t\t\tmarkdownPage\n\t\t\t\t)}</div>`,\n\t\t\t\ttitle: sMarkdownFileName,\n\t\t\t\tedit: editLink\n\t\t\t});\n\n\t\t\t//improve UX by always starting at the top when opening up new content & jumping to new pane\n\t\t\tif (isOpenedOnPhone)\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t(this.byId(\"responsiveSplitter\") as ResponsiveSplitter)._activatePage(\n\t\t\t\t\t\t1\n\t\t\t\t\t);\n\t\t\t\t}, 0);\n\t\t\tif (this.byId(\"markdownSection\"))\n\t\t\t\t(this.byId(\"markdownSection\") as Page).scrollTo(0, 0);\n\t\t})();\n\t}\n}\n"],"mappings":"kSAGCA,EAAkBC,EAAA,4BAClBC,EAAYD,EAAA,sBACZE,EAAkBF,EAAA,4BAEVG,EAAeC,EAAA,yBACjBC,EAAcC,EAAAC,GAOrB,MAGqBC,EAAuBH,EAAcI,OAAA,mDAGlDC,OAAM,SAAAC,IACZC,KAAKC,UAAUC,cACbF,KAAKG,oBAAkCC,0BAGzCJ,KAAKK,kBAAoB,IAAIC,EAAU,CACtCC,SAAU,GACVC,MAAO,GACPC,KAAM,KAGPT,KAAKC,UAAUS,SAASV,KAAKK,kBAAmB,qBAEhDL,KAAKW,YACHC,SAAS,aACTC,cAAcb,KAAKc,gBAAgBC,KAAKf,MAAOA,KAClD,EAKOgB,YAAW,SAAAC,IACjBjB,KAAKkB,aACN,EAKcJ,gBAAe,SAAAA,IAAA,IAAkB,MAAAK,EACxCnB,KAAI,OAAAoB,QAAAC,QAAJF,EAAKG,sBAAoBC,KAAA,aAChC,CAAC,MAAAC,GAAA,OAAAJ,QAAAK,OAAAD,EAAA,GAKaF,mBAAkB,SAAAA,IAAA,IAAkB,MAAAI,EAO/C1B,KANF,OAAAoB,QAAAC,QACwBhC,KAAckC,KAAA,SAAhCI,GAEN,MAAMC,EAAiBrC,EAAgBsC,MAAMF,GAC7C,MAAMG,EAAU,IAAIF,EAAeG,SAAS,oBAC5CD,EAAQE,QAAQC,IACdP,EAAKQ,KAAK,WAAoBC,QAC9B,IAAIC,EAAe,CAClBC,KAAO,GAAEJ,EAAQ,KACjBK,MAAOZ,EAAKa,mBAAmBxB,KAAIW,EAElCO,EAAQ,GACRP,EAAKrB,kBACLmC,EAAOC,OAAOC,SAGhB,EACC,EACJ,CAAC,MAAAlB,GAAA,OAAAJ,QAAAK,OAAAD,EAAA,GAKOe,mBAAkB,SAAAI,EACzBC,EACAC,EACAC,GACO,MAAAC,EAoBH/C,UAhBC,eACJ,OAAAoB,QAAAC,QAC2BlC,EAAmByD,IAAkBrB,KAAA,SAA1DyB,GACN,MAAMC,EAAW3D,EAAmBsD,GAEpCC,EAAUK,QAAQ,CACjB3C,SAAW,0BAAyBhB,EAAgBsC,MACnDmB,WAEDxC,MAAOoC,EACPnC,KAAMwC,IAIP,GAAIH,EACHK,WAAW,KACTJ,EAAKb,KAAK,sBAA6CkB,cACvD,EACA,EACC,GACJ,GAAIL,EAAKb,KAAK,mBACZa,EAAKb,KAAK,mBAA4BmB,SAAS,EAAG,EAAG,EACxD,CAAC,MAAA7B,GAAA,OAAAJ,QAAAK,OAAAD,EAAA,EAtBI,EAuBN,IAAC,OA7FmB5B,CAAc"}