{"version":3,"file":"Wiki.controller.js","names":["getSelectedContent","getWikiIndex","getContentEditLink","markdownService","BaseController","WikiController","onInit","getView","addStyleClass","getOwnerComponent","getContentDensityClass","_wikiContentModel","JSONModel","markdown","title","edit","setModel","getRouter","getRoute","attachMatched","_onRouteMatched","bind","onThemeSwap","toggleTheme","_initializeSidebar","wikiIndex","parsedMarkdown","parse","matches","matchAll","forEach","element","byId","addItem","ActionListItem","text","press","onSidebarSelection","Device","system","phone","sMarkdownFileName","jsonModel","isOpenedOnPhone","markdownPage","editLink","setData","setTimeout","_activatePage","scrollTo"],"sources":["Wiki.controller.ts"],"sourcesContent":["import Page from \"sap/m/Page\";\nimport Component from \"../Component\";\nimport {\n\tgetSelectedContent,\n\tgetWikiIndex,\n\tgetContentEditLink\n} from \"../util/githubService\";\nimport { markdownService } from \"../util/markdownService\";\nimport BaseController from \"./Base.controller\";\nimport List from \"sap/m/List\";\nimport ActionListItem from \"sap/m/ActionListItem\";\nimport JSONModel from \"sap/ui/model/json/JSONModel\";\nimport ResponsiveSplitter from \"sap/ui/layout/ResponsiveSplitter\";\nimport Device from \"sap/ui/Device\";\n\n/**\n * @namespace sapmarco.projectpages.controller\n */\nexport default class WikiController extends BaseController {\n\tprivate _wikiContentModel: JSONModel;\n\n\tpublic onInit(): void {\n\t\tthis.getView().addStyleClass(\n\t\t\t(this.getOwnerComponent() as Component).getContentDensityClass()\n\t\t);\n\n\t\tthis._wikiContentModel = new JSONModel({\n\t\t\tmarkdown: \"\",\n\t\t\ttitle: \"\",\n\t\t\tedit: \"\"\n\t\t});\n\n\t\tthis.getView().setModel(this._wikiContentModel, \"convertedmarkdown\");\n\n\t\tthis.getRouter()\n\t\t\t.getRoute(\"RouteWiki\")\n\t\t\t.attachMatched(this._onRouteMatched.bind(this), this);\n\t}\n\n\t/**\n\t * Event-handler for theme toggle\n\t */\n\tpublic onThemeSwap(): void {\n\t\tthis.toggleTheme();\n\t}\n\n\t/**\n\t * Event-handler for route matched\n\t */\n\tprivate async _onRouteMatched(): Promise<void> {\n\t\tawait this._initializeSidebar();\n\t}\n\n\t/**\n\t * Initialization of sidebar\n\t */\n\tprivate async _initializeSidebar(): Promise<void> {\n\t\t//get sidebar from actual github-wiki\n\t\tconst wikiIndex = await getWikiIndex();\n\t\t//parse markdown to html\n\t\tconst parsedMarkdown = markdownService.parse(wikiIndex);\n\t\tconst matches = [...parsedMarkdown.matchAll(/\\wiki\\/(.*?)\\\"/g)];\n\t\tmatches.forEach(element => {\n\t\t\t(this.byId(\"sidebar\") as List).addItem(\n\t\t\t\tnew ActionListItem({\n\t\t\t\t\ttext: `${element[1]}`,\n\t\t\t\t\tpress: this.onSidebarSelection.bind(\n\t\t\t\t\t\tthis,\n\t\t\t\t\t\telement[1],\n\t\t\t\t\t\tthis._wikiContentModel,\n\t\t\t\t\t\tDevice.system.phone\n\t\t\t\t\t)\n\t\t\t\t})\n\t\t\t);\n\t\t});\n\t}\n\n\t/**\n\t * @param  {string} sMarkdownFileName name of markdown file\n\t */\n\tprivate onSidebarSelection(\n\t\tsMarkdownFileName: string,\n\t\tjsonModel: JSONModel,\n\t\tisOpenedOnPhone: boolean\n\t): void {\n\t\t// fix eslint issue in press event handler of ActionListItem:\n\t\t// see: https://stackoverflow.com/a/63488201\n\t\t// also: https://typescript-eslint.io/rules/no-floating-promises/\n\t\tvoid (async () => {\n\t\t\t//get markdown page and encode - to %20\n\t\t\tconst markdownPage = await getSelectedContent(sMarkdownFileName);\n\t\t\tconst editLink = getContentEditLink(sMarkdownFileName);\n\n\t\t\tjsonModel.setData({\n\t\t\t\tmarkdown: `<div class=\"container\">${markdownService.parse(\n\t\t\t\t\tmarkdownPage\n\t\t\t\t)}</div>`,\n\t\t\t\ttitle: sMarkdownFileName,\n\t\t\t\tedit: editLink\n\t\t\t});\n\n\t\t\t//improve UX by always starting at the top when opening up new content & jumping to new pane\n\t\t\tif (isOpenedOnPhone)\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t(this.byId(\"responsiveSplitter\") as ResponsiveSplitter)._activatePage(\n\t\t\t\t\t\t1\n\t\t\t\t\t);\n\t\t\t\t}, 0);\n\t\t\tif (this.byId(\"markdownSection\"))\n\t\t\t\t(this.byId(\"markdownSection\") as Page).scrollTo(0, 0);\n\t\t})();\n\t}\n}\n"],"mappings":";;;;QAGCA,kBAAkB;EAAA,MAClBC,YAAY;EAAA,MACZC,kBAAkB;EAAA,MAEVC,eAAe;EAAA,MACjBC,cAAc;EAOrB;AACA;AACA;EAFA,MAGqBC,cAAc,GAASD,cAAc;IAGlDE,MAAM,qBAAS;MACrB,IAAI,CAACC,OAAO,EAAE,CAACC,aAAa,CAC1B,IAAI,CAACC,iBAAiB,EAAE,CAAeC,sBAAsB,EAAE,CAChE;MAED,IAAI,CAACC,iBAAiB,GAAG,IAAIC,SAAS,CAAC;QACtCC,QAAQ,EAAE,EAAE;QACZC,KAAK,EAAE,EAAE;QACTC,IAAI,EAAE;MACP,CAAC,CAAC;MAEF,IAAI,CAACR,OAAO,EAAE,CAACS,QAAQ,CAAC,IAAI,CAACL,iBAAiB,EAAE,mBAAmB,CAAC;MAEpE,IAAI,CAACM,SAAS,EAAE,CACdC,QAAQ,CAAC,WAAW,CAAC,CACrBC,aAAa,CAAC,IAAI,CAACC,eAAe,CAACC,IAAI,CAAC,IAAI,CAAC,EAAE,IAAI,CAAC;IACvD,CAAC;IAKMC,WAAW,0BAAS;MAC1B,IAAI,CAACC,WAAW,EAAE;IACnB,CAAC;IAKaH,eAAe,mCAAkB;MAC9C,MAAM,IAAI,CAACI,kBAAkB,EAAE;IAChC,CAAC;IAKaA,kBAAkB,sCAAkB;MACjD;MACA,MAAMC,SAAS,GAAG,MAAMxB,YAAY,EAAE;MACtC;MACA,MAAMyB,cAAc,GAAGvB,eAAe,CAACwB,KAAK,CAACF,SAAS,CAAC;MACvD,MAAMG,OAAO,GAAG,CAAC,GAAGF,cAAc,CAACG,QAAQ,CAAC,iBAAiB,CAAC,CAAC;MAC/DD,OAAO,CAACE,OAAO,CAACC,OAAO,IAAI;QACzB,IAAI,CAACC,IAAI,CAAC,SAAS,CAAC,CAAUC,OAAO,CACrC,IAAIC,cAAc,CAAC;UAClBC,IAAI,EAAG,GAAEJ,OAAO,CAAC,CAAC,CAAE,EAAC;UACrBK,KAAK,EAAE,IAAI,CAACC,kBAAkB,CAAChB,IAAI,CAClC,IAAI,EACJU,OAAO,CAAC,CAAC,CAAC,EACV,IAAI,CAACpB,iBAAiB,EACtB2B,MAAM,CAACC,MAAM,CAACC,KAAK;QAErB,CAAC,CAAC,CACF;MACF,CAAC,CAAC;IACH,CAAC;IAKOH,kBAAkB,+BACzBI,iBAAyB,EACzBC,SAAoB,EACpBC,eAAwB,EACjB;MACP;MACA;MACA;MACA,KAAK,CAAC,YAAY;QACjB;QACA,MAAMC,YAAY,GAAG,MAAM5C,kBAAkB,CAACyC,iBAAiB,CAAC;QAChE,MAAMI,QAAQ,GAAG3C,kBAAkB,CAACuC,iBAAiB,CAAC;QAEtDC,SAAS,CAACI,OAAO,CAAC;UACjBjC,QAAQ,EAAG,0BAAyBV,eAAe,CAACwB,KAAK,CACxDiB,YAAY,CACX,QAAO;UACT9B,KAAK,EAAE2B,iBAAiB;UACxB1B,IAAI,EAAE8B;QACP,CAAC,CAAC;;QAEF;QACA,IAAIF,eAAe,EAClBI,UAAU,CAAC,MAAM;UACf,IAAI,CAACf,IAAI,CAAC,oBAAoB,CAAC,CAAwBgB,aAAa,CACpE,CAAC,CACD;QACF,CAAC,EAAE,CAAC,CAAC;QACN,IAAI,IAAI,CAAChB,IAAI,CAAC,iBAAiB,CAAC,EAC9B,IAAI,CAACA,IAAI,CAAC,iBAAiB,CAAC,CAAUiB,QAAQ,CAAC,CAAC,EAAE,CAAC,CAAC;MACvD,CAAC,GAAG;IACL;EAAC;EAAA,OA7FmB5C,cAAc;AAAA"}