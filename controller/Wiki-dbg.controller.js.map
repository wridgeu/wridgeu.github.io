{"version":3,"file":"Wiki-dbg.controller.js","names":["getSelectedContent","___util_githubService","getWikiIndex","getContentEditLink","markdownService","___util_markdownService","BaseController","_interopRequireDefault","__BaseController","WikiController","extend","onInit","_onInit","getView","addStyleClass","getOwnerComponent","getContentDensityClass","_wikiContentModel","JSONModel","markdown","title","edit","setModel","getRouter","getRoute","attachMatched","_onRouteMatched","bind","onThemeSwap","_onThemeSwap","toggleTheme","_this","Promise","resolve","_initializeSidebar","then","e","reject","_this2","wikiIndex","parsedMarkdown","parse","matches","matchAll","forEach","element","byId","addItem","ActionListItem","text","press","onSidebarSelection","Device","system","phone","_onSidebarSelection","sMarkdownFileName","jsonModel","isOpenedOnPhone","_this3","markdownPage","editLink","setData","setTimeout","_activatePage","scrollTo"],"sources":["Wiki.controller.ts"],"sourcesContent":["import Page from \"sap/m/Page\";\nimport Component from \"../Component\";\nimport {\n\tgetSelectedContent,\n\tgetWikiIndex,\n\tgetContentEditLink\n} from \"../util/githubService\";\nimport { markdownService } from \"../util/markdownService\";\nimport BaseController from \"./Base.controller\";\nimport List from \"sap/m/List\";\nimport ActionListItem from \"sap/m/ActionListItem\";\nimport JSONModel from \"sap/ui/model/json/JSONModel\";\nimport ResponsiveSplitter from \"sap/ui/layout/ResponsiveSplitter\";\nimport Device from \"sap/ui/Device\";\n\n/**\n * @namespace sapmarco.projectpages.controller\n */\nexport default class WikiController extends BaseController {\n\tprivate _wikiContentModel: JSONModel;\n\n\tpublic onInit(): void {\n\t\tthis.getView().addStyleClass(\n\t\t\t(this.getOwnerComponent() as Component).getContentDensityClass()\n\t\t);\n\n\t\tthis._wikiContentModel = new JSONModel({\n\t\t\tmarkdown: \"\",\n\t\t\ttitle: \"\",\n\t\t\tedit: \"\"\n\t\t});\n\n\t\tthis.getView().setModel(this._wikiContentModel, \"convertedmarkdown\");\n\n\t\tthis.getRouter()\n\t\t\t.getRoute(\"RouteWiki\")\n\t\t\t.attachMatched(this._onRouteMatched.bind(this), this);\n\t}\n\n\t/**\n\t * Event-handler for theme toggle\n\t */\n\tpublic onThemeSwap(): void {\n\t\tthis.toggleTheme();\n\t}\n\n\t/**\n\t * Event-handler for route matched\n\t */\n\tprivate async _onRouteMatched(): Promise<void> {\n\t\tawait this._initializeSidebar();\n\t}\n\n\t/**\n\t * Initialization of sidebar\n\t */\n\tprivate async _initializeSidebar(): Promise<void> {\n\t\t//get sidebar from actual github-wiki\n\t\tconst wikiIndex = await getWikiIndex();\n\t\t//parse markdown to html\n\t\tconst parsedMarkdown = markdownService.parse(wikiIndex);\n\t\tconst matches = [...parsedMarkdown.matchAll(/\\wiki\\/(.*?)\\\"/g)];\n\t\tmatches.forEach(element => {\n\t\t\t(this.byId(\"sidebar\") as List).addItem(\n\t\t\t\tnew ActionListItem({\n\t\t\t\t\ttext: `${element[1]}`,\n\t\t\t\t\tpress: this.onSidebarSelection.bind(\n\t\t\t\t\t\tthis,\n\t\t\t\t\t\telement[1],\n\t\t\t\t\t\tthis._wikiContentModel,\n\t\t\t\t\t\tDevice.system.phone\n\t\t\t\t\t)\n\t\t\t\t})\n\t\t\t);\n\t\t});\n\t}\n\n\t/**\n\t * @param  {string} sMarkdownFileName name of markdown file\n\t */\n\tprivate onSidebarSelection(\n\t\tsMarkdownFileName: string,\n\t\tjsonModel: JSONModel,\n\t\tisOpenedOnPhone: boolean\n\t): void {\n\t\t// fix eslint issue in press event handler of ActionListItem:\n\t\t// see: https://stackoverflow.com/a/63488201\n\t\t// also: https://typescript-eslint.io/rules/no-floating-promises/\n\t\tvoid (async () => {\n\t\t\t//get markdown page and encode - to %20\n\t\t\tconst markdownPage = await getSelectedContent(sMarkdownFileName);\n\t\t\tconst editLink = getContentEditLink(sMarkdownFileName);\n\n\t\t\tjsonModel.setData({\n\t\t\t\tmarkdown: `<div class=\"container\">${markdownService.parse(\n\t\t\t\t\tmarkdownPage\n\t\t\t\t)}</div>`,\n\t\t\t\ttitle: sMarkdownFileName,\n\t\t\t\tedit: editLink\n\t\t\t});\n\n\t\t\t//improve UX by always starting at the top when opening up new content & jumping to new pane\n\t\t\tif (isOpenedOnPhone)\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t(this.byId(\"responsiveSplitter\") as ResponsiveSplitter)._activatePage(\n\t\t\t\t\t\t1\n\t\t\t\t\t);\n\t\t\t\t}, 0);\n\t\t\tif (this.byId(\"markdownSection\"))\n\t\t\t\t(this.byId(\"markdownSection\") as Page).scrollTo(0, 0);\n\t\t})();\n\t}\n}\n"],"mappings":"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"}