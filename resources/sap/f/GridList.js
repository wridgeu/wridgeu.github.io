/*!
 * OpenUI5
 * (c) Copyright 2009-2021 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["./delegate/GridItemNavigation","./GridListRenderer","./GridNavigationMatrix","./library","sap/m/ListBase","sap/ui/base/ManagedObjectObserver","sap/ui/core/Core","sap/ui/core/delegate/ItemNavigation","sap/ui/Device","sap/ui/layout/cssgrid/GridLayoutDelegate","sap/ui/layout/cssgrid/GridLayoutBase"],function(t,e,i,o,a,r,s,n,p,u,d){"use strict";var g=o.NavigationDirection;var l=a.extend("sap.f.GridList",{metadata:{library:"sap.f",interfaces:["sap.ui.layout.cssgrid.IGridConfigurable","sap.f.dnd.IGridDroppable"],aggregations:{customLayout:{type:"sap.ui.layout.cssgrid.GridLayoutBase",multiple:false}},events:{borderReached:{parameters:{event:{type:"jQuery.Event"},direction:{type:"sap.f.NavigationDirection"},row:{type:"int"},column:{type:"int"}}}}}});l.prototype.init=function(){a.prototype.init.apply(this,arguments);this._oItemDelegate={onAfterRendering:this._onAfterItemRendering};this._addGridLayoutDelegate();this._oGridObserver=new r(l.prototype._onGridChange.bind(this));this._oGridObserver.observe(this,{aggregations:["items"]})};l.prototype.exit=function(){this._removeGridLayoutDelegate();if(this._oGridObserver){this._oGridObserver.disconnect();this._oGridObserver=null}a.prototype.exit.apply(this,arguments)};l.prototype.onAfterPageLoaded=function(){a.prototype.onAfterPageLoaded.apply(this,arguments);if(this._oItemNavigation){this._oItemNavigation.resetFocusPosition()}};l.prototype.onItemNavigationBorderReached=function(t){var e=this.getGrowingInfo();if(t.direction===g.Down&&e&&e.actual!==e.total){return}this.fireEvent("borderReached",t)};l.prototype.getGridDomRefs=function(){return[this.getItemsContainerDomRef()]};l.prototype.focusItemByDirection=function(t,e,i){this._oItemNavigation.focusItemByDirection(this,t,e,i)};l.prototype.getNavigationMatrix=function(){if(!s.isThemeApplied()){return null}var t=this.getItems().reduce(function(t,e){if(e.getVisible()){t.push(e.getDomRef())}return t},[]);return i.create(this.getItemsContainerDomRef(),t,this._getActiveLayoutSizes())};l.prototype.getGridLayoutConfiguration=l.prototype.getCustomLayout;l.prototype._startItemNavigation=function(e){if(!p.system.desktop){return}if(!this._oItemNavigation){if(p.browser.msie&&(!this.getCustomLayout()||!this.getCustomLayout().hasGridPolyfill())){this._oItemNavigation=new n}else{this._oItemNavigation=new t}this._oItemNavigation.setCycling(false).setDisabledModifiers({sapnext:["alt"],sapprevious:["alt"]}).setFocusedIndex(0);this.addDelegate(this._oItemNavigation);this._setItemNavigationTabIndex(0)}a.prototype._startItemNavigation.apply(this,arguments)};l.prototype._addGridLayoutDelegate=function(){if(!this.oGridLayoutDelegate){this.oGridLayoutDelegate=new u;this.addEventDelegate(this.oGridLayoutDelegate,this)}};l.prototype._removeGridLayoutDelegate=function(){if(this.oGridLayoutDelegate){this.removeEventDelegate(this.oGridLayoutDelegate);this.oGridLayoutDelegate.destroy();this.oGridLayoutDelegate=null}};l.prototype._onGridChange=function(t){var e;if(t.name!=="items"||!t.child){return}if(t.mutation==="insert"){e=!t.child.isA("sap.ui.core.HTML");t.child.addDelegate(this._oItemDelegate,e,t.child)}else if(t.mutation==="remove"){t.child.removeEventDelegate(this._oItemDelegate,t.child)}};l.prototype._onAfterItemRendering=function(){d.setItemStyles(this)};l.prototype.updateItems=function(){a.prototype.updateItems.apply(this,arguments);this.invalidate()};l.prototype.onLayoutDataChange=function(t){d.setItemStyles(t.srcControl)};l.prototype._getActiveLayoutSizes=function(){var t=this.getItemsContainerDomRef(),e=window.getComputedStyle(t),i=this.getCustomLayout();if(p.browser.msie&&i){return i.getPolyfillSizes(this)}else{return{gap:parseFloat(e.rowGap),rows:e.gridTemplateRows.split(/\s+/),columns:e.gridTemplateColumns.split(/\s+/)}}};return l});