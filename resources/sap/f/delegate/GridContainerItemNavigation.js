/*!
 * OpenUI5
 * (c) Copyright 2009-2022 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/core/Element","sap/ui/core/delegate/ItemNavigation","./GridItemNavigation","sap/ui/dom/containsOrEquals","sap/ui/thirdparty/jquery","sap/ui/dom/jquery/Selectors"],function(t,e,o,s,i){"use strict";function n(t){if(t.onfocusin){t.onfocusin()}}var r=o.extend("sap.f.delegate.GridContainerItemNavigation",{constructor:function(){o.apply(this,arguments);this.attachEvent(e.Events.FocusLeave,this._onFocusLeave,this)}});r.prototype._onFocusLeave=function(t){var e=this.getFocusedDomRef();this.getItemDomRefs().forEach(function(t,o){if(e===t){var s=o++;this.setFocusedIndex(s)}}.bind(this))};r.prototype.forwardTab=function(t){var e=this._getRootDomRefId()+"-"+(t?"after":"before");document.getElementById(e).focus()};r.prototype._getRootDomRefId=function(t){return this.getRootDomRef().getAttribute("id")};r.prototype.onsaptabnext=function(e){var o=this.getItemDomRefs(),s=this.getFocusedIndex(),n=i(o[s]),r=[];var a=n.find(":sapTabbable");a.map(function(t,e){if(e.className.indexOf("DummyArea")===-1){r.push(e)}});var u=r.length-1;if(u===-1||t.closestTo(r[u])&&t.closestTo(r[u]).getId()===e.target.id){this._lastFocusedElement=e.target;this.forwardTab(true)}};r.prototype.onsaptabprevious=function(t){if(!t.target.classList.contains("sapFGridContainerItemWrapper")){this._lastFocusedElement=t.target;return}var e=t.target.id;if(e===this._getRootDomRefId()+"-nodata"){this.forwardTab(false)}this._lastFocusedElement=null;this.forwardTab(false)};r.prototype.onmousedown=function(t){this._bIsMouseDown=true;e.prototype.onmousedown.call(this,t)};r.prototype.onmouseup=function(e){var o=i(e.target).closest(".sapFGridContainerItemWrapperNoVisualFocus"),s;if(o.length){s=t.closestTo(o.children()[0]);if(s&&s.getFocusDomRef()===document.activeElement){this._lastFocusedElement=null;o.trigger("focus");n(s)}}this._bIsMouseDown=false};r.prototype.ondragend=function(){this._bIsMouseDown=false};r.prototype.ondrop=function(){this._bIsMouseDown=false};r.prototype.onfocusin=function(e){o.prototype.onfocusin.call(this,e);if(e.target===this._getGridInstance().getDomRef("before")&&!this.getRootDomRef().contains(e.relatedTarget)){var s=this._lastFocusedElement||this.getItemDomRefs()[this.getFocusedIndex()];if(s){s.focus()}return}if(e.target===this._getGridInstance().getDomRef("after")&&!this.getRootDomRef().contains(e.relatedTarget)){this._focusPrevious(e);return}var r=i(e.target).closest(".sapFGridContainerItemWrapperNoVisualFocus"),a;if(r.length){a=t.closestTo(r.children()[0]);if(a){n(a);if(!this._bIsMouseDown&&a.getFocusDomRef()===e.target){this._lastFocusedElement=null;r.trigger("focus");return}}}};r.prototype._focusPrevious=function(t){var e=this.getItemDomRefs();var o=this.getFocusedIndex();if(!e.length){return}var s;if(o<0){s=e[0];this.setFocusedIndex(0)}else{s=e[o]}var n=i(s);var r=n.find(":sapTabbable");n.add(r).eq(-1).focus()};r.prototype.focusItem=function(o,s){var n,r,a;if(o===this.iFocusedIndex&&this.aItemDomRefs[this.iFocusedIndex]===document.activeElement){this.fireEvent(e.Events.FocusAgain,{index:o,event:s});return}this.fireEvent(e.Events.BeforeFocus,{index:o,event:s});this.setFocusedIndex(o);this.bISetFocus=true;if(s&&i(this.aItemDomRefs[this.iFocusedIndex]).data("sap.INRoot")){n=i(this.aItemDomRefs[this.iFocusedIndex]).data("sap.INRoot");n._sFocusEvent=s.type}if(!this._bIsMouseDown&&this.aItemDomRefs.length){this.aItemDomRefs[this.iFocusedIndex].focus();r=t.closestTo(this.aItemDomRefs[this.iFocusedIndex].firstChild);if(r){a=r.getFocusDomRef();if(a){this.scrollIntoViewIfNeeded(a)}}}this.fireEvent(e.Events.AfterFocus,{index:o,event:s})};r.prototype.scrollIntoViewIfNeeded=function(t){var e=t.parentElement,o,s;while(e&&e.offsetWidth>=e.scrollWidth&&e.offsetHeight>=e.scrollHeight){e=e.parentElement}if(!e){return}e=e.parentElement;if(!e){return}o=e.getBoundingClientRect();s=t.getBoundingClientRect();if(s.top<o.top||s.bottom>o.bottom||s.right>o.right||s.left<o.left){t.scrollIntoView()}};return r});