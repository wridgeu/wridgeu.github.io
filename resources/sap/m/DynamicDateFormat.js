/*!
 * OpenUI5
 * (c) Copyright 2009-2022 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/core/format/DateFormat","sap/ui/core/format/NumberFormat","sap/ui/core/Locale","sap/ui/core/LocaleData","sap/base/Log","sap/base/util/deepExtend","sap/base/util/isEmptyObject","sap/ui/core/date/UniversalDateUtils","./library"],function(t,e,a,r,n,i,o,s,m){"use strict";var c=function(){throw new Error};var u=sap.ui.getCore().getLibraryResourceBundle("sap.m");var T={};var f={};var l={DATE:["date"],DATETIME:["datetime"],DATERANGE:["date","date"],DATETIMERANGE:["datetime","datetime"],LASTDAYS:["int"],LASTWEEKS:["int"],LASTMONTHS:["int"],LASTQUARTERS:["int"],LASTYEARS:["int"],NEXTDAYS:["int"],NEXTWEEKS:["int"],NEXTMONTHS:["int"],NEXTQUARTERS:["int"],NEXTYEARS:["int"],FROM:["date"],TO:["date"],FROMDATETIME:["datetime"],TODATETIME:["datetime"],SPECIFICMONTH:["month"],SPECIFICMONTHINYEAR:["month","int"],TODAYFROMTO:["int","int"]};var E=Object.keys(m.StandardDynamicDateRangeKeys);for(var p=0;p<E.length;p++){var F=E[p];var d=u.getText("DYNAMIC_DATE_"+F.toUpperCase()+"_FORMAT");var O=d.split("{").map(function(t){var e=t.indexOf("}");if(e!==-1){return t.slice(e+1)}return t});T[F]=O;var A=[];var v=d.indexOf("{");var D=-1;var h=-1;while(v!==-1){D=d.indexOf("}");h=parseInt(d.slice(v+1,D-D-1));A.push(h);d=d.slice(D+1);v=d.indexOf("{")}f[F]=A}c.getInstance=function(t,e){return this.createInstance(t,e)};c.oDefaultDynamicDateFormat={date:{},datetime:{},month:{pattern:"MMMM"},year:{pattern:"yyyy"},int:{}};c.createInstance=function(n,o){var s=Object.create(this.prototype);if(n instanceof a){o=n;n=undefined}if(!o){o=sap.ui.getCore().getConfiguration().getFormatSettings().getFormatLocale()}s.oLocale=o;s.oLocaleData=r.getInstance(o);s.oOriginalFormatOptions=i({},c.oDefaultDynamicDateFormat,n);s._dateFormatter=t.getInstance(s.oOriginalFormatOptions["date"]);s._dateTimeFormatter=t.getDateTimeInstance(s.oOriginalFormatOptions["datetime"]);[s._dateFormatter].concat(s._dateFormatter.aFallbackFormats).forEach(function(t){t.parseRelative=function(){return null}});[s._dateTimeFormatter].concat(s._dateTimeFormatter.aFallbackFormats).forEach(function(t){t.parseRelative=function(){return null}});s._monthFormatter=t.getInstance(s.oOriginalFormatOptions["month"]);s._yearFormatter=t.getInstance(s.oOriginalFormatOptions["year"]);s._numberFormatter=e.getInstance(s.oOriginalFormatOptions["int"]);s._resourceBundle=sap.ui.getCore().getLibraryResourceBundle("sap.m");return s};c.prototype.format=function(t){var e=t.operator;var a=t.values.slice(0);if(e==="SPECIFICMONTH"){var r=new Date;r.setMonth(a[0]);a[0]=this._monthFormatter.format(r)}else if(e==="SPECIFICMONTHINYEAR"){var r=new Date;r.setMonth(a[0]);r.setYear(a[1]);a[0]=this._monthFormatter.format(r);a[1]=this._yearFormatter.format(r)}else if(e==="LASTDAYS"&&a[0]===1){e="YESTERDAY";a=[]}else if(e==="NEXTDAYS"&&a[0]===1){e="TOMORROW";a=[]}else if((e==="LASTDAYS"||e==="NEXTDAYS")&&a[0]===0){e="TODAY";a=[]}else if(e==="DATETIME"){a[0]=this._dateTimeFormatter.format(t.values[0])}var n=a.map(function(t){if(t instanceof Date){if(e==="DATETIMERANGE"||e==="FROMDATETIME"||e==="TODATETIME"){return this._dateTimeFormatter.format(t)}return this._dateFormatter.format(t)}if(typeof t==="number"){return this._numberFormatter.format(t)}else{return t.toString()}},this);return this._resourceBundle.getText("DYNAMIC_DATE_"+e.toUpperCase()+"_FORMAT",n)};c.prototype.parse=function(t,e){var a;var r=T[e];var n="^"+r.join("(.*)")+"$";if(e==="TODAYFROMTO"){n=n.replace("+","\\+")}var i=new RegExp(n,"i");var o=t.match(i);if(o){a={};a.values=[];for(var s=0;s<f[e].length;s++){var m=f[e][s];var c=l[e][m];var u;var E=o[s+1];switch(c){case"date":u=this._dateFormatter.parse(E);break;case"datetime":u=this._dateTimeFormatter.parse(E);break;case"month":var p=[0,1,2,3,4,5,6,7,8,9,10,11].map(function(t){var e=new Date;e.setMonth(t);return this._monthFormatter.format(e)},this);var F=p.indexOf(E);u=F!==-1?F:null;break;case"int":u=this._numberFormatter.parse(E);break;case"string":u=E;break;default:break}if(!u){a=null;break}a.values[m]=u}if(a){a.operator=e;return a}}};return c});