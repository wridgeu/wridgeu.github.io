/*!
 * OpenUI5
 * (c) Copyright 2009-2022 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/base/Log","sap/ui/thirdparty/jquery"],function(e,n){"use strict";var t={};var r="source";var o="target";var i="movedElements";var a="columns";var u="cells";var g="items";function s(n,t,r,o,i){return Promise.resolve().then(n.getAggregation.bind(n,r,u)).then(function(a){if(!a){e.warning("Aggregation cells to move not found");return Promise.reject()}if(o<0||o>=a.length){e.warning("Move cells in table item called with invalid index: "+o);return Promise.reject()}var g=a[o];return Promise.resolve().then(n.removeAggregation.bind(n,r,u,g)).then(n.insertAggregation.bind(n,r,u,g,i,t))})}function c(e,n,t,r,o){return Promise.resolve().then(e.getAggregation.bind(e,t,g)).then(function(t){return t.reduce(function(t,i){return t.then(function(){if(e.getControlType(i)!=="sap.m.GroupHeaderListItem"){return s(e,n,i,r,o)}return undefined})},Promise.resolve())})}function d(n,t,i,u){var d=i.modifier;var v=i.view;var l=i.appComponent;var f=n.getContent();var m=n.getDependentControl(r,i);var p=n.getDependentControl(o,i);var h;var b;return Promise.resolve().then(function(){return d.getAggregation(p,a)}).then(function(n){h=n;if(m!==p){e.warning("Moving columns between different tables is not yet supported.");return Promise.reject(false)}return f.movedElements.reduce(function(n,t){var r;var o;var i;var f;var m;return n.then(function(){b=d.bySelector(t.selector,l,v);if(!b){m=t.selector&&t.selector.id;e.warning("The table column with id: '"+m+"' stored in the change is not found and the move operation cannot be applied");return Promise.reject()}i=h.indexOf(b);f=t.sourceIndex;o=typeof u==="function"&&u(f);o=typeof o==="number"?o:t.targetIndex;if(i!==o){r=i}else{r=f}return d.removeAggregation(p,a,b)}).then(function(){return d.insertAggregation(p,a,b,o,v)}).then(function(){return d.getBindingTemplate(p,g)}).then(function(e){if(e){return s(d,v,e,r,o).then(d.updateAggregation.bind(d,p,g))}else{return c(d,v,p,r,o)}})},Promise.resolve())})}t.applyChange=function(e,n,t){var r=[];return Promise.resolve().then(function(){return d(e,n,t,function(e){r.unshift({index:e})})}).then(function(){e.setRevertData(r)})};t.revertChange=function(e,n,t){var r=e.getRevertData();return Promise.resolve().then(function(){return d(e,n,t,function(){var e=r.shift();return e&&e.index})}).then(function(){e.resetRevertData()})};t.completeChangeContent=function(e,n,t){var a=t.modifier;var u=t.appComponent;var g=e.getDefinition();var s=a.bySelector(n.source.id,u);var c=a.bySelector(n.target.id,u);var d={aggregation:n.source.aggregation,type:a.getControlType(s)};var v={aggregation:n.target.aggregation,type:a.getControlType(c)};g.content={movedElements:[]};n.movedElements.forEach(function(e){var n=e.element||a.bySelector(e.id,u);g.content.movedElements.push({selector:a.getSelector(n,u),sourceIndex:e.sourceIndex,targetIndex:e.targetIndex})});e.addDependentControl(n.source.id,r,t,d);e.addDependentControl(n.target.id,o,t,v);e.addDependentControl(n.movedElements.map(function(e){return e.id}),i,t)};return t},true);