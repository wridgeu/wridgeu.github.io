/*!
 * OpenUI5
 * (c) Copyright 2009-2023 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/m/p13n/Engine"],function(e){"use strict";var t={};var n=function(t){if(!t._bWaitForModificationChanges&&t.isA){t._bWaitForModificationChanges=true;e.getInstance().waitForChanges(t).then(function(){delete t._bWaitForModificationChanges;e.getInstance().fireStateChange(t)})}};var a=function(e,t){var n=function(t){if(e._pQueue===t){delete e._pQueue}};e._pQueue=e._pQueue instanceof Promise?e._pQueue.then(t):t();e._pQueue.then(n.bind(null,e._pQueue));return e._pQueue};t.createHandler=function(t){if(!t||!t.hasOwnProperty("property")){throw new Error("Please provide a map containing the affected aggregation and property name!")}var r=t.property;var g;return{changeHandler:{applyChange:function(o,i,u){return a(i,function(){return e.getInstance().readXConfig(i,{propertyBag:u}).then(function(n){var a=o.getChangeType().indexOf("add")>-1?"add":"remove";a=o.getChangeType().indexOf("move")===0?"move":a;g=o.getContent().targetAggregation;var p=a!=="add";if(n&&n.aggregations&&n.aggregations[g]&&n.aggregations[g][o.getContent().key]&&n.aggregations[g][o.getContent().key][r]){p=n.aggregations[g][o.getContent().key][r]}o.setRevertData({key:o.getContent().key,value:p});var f={property:r,key:o.getContent().key,value:o.getContent(),operation:a,propertyBag:u};if(t.aggregationBased){f.controlMeta={aggregation:g}}return e.getInstance().enhanceXConfig(i,f)}).then(function(){n(i)})})},completeChangeContent:function(e,t,n){},revertChange:function(a,o,i){var u=a.getChangeType().indexOf("add")>-1?"remove":"add";u=a.getChangeType().indexOf("move")===0?"move":u;g=a.getContent().targetAggregation;var p={controlMeta:{aggregation:g,property:r},property:r,operation:u,key:a.getRevertData().key,value:a.getRevertData(),propertyBag:i};if(t.aggregationBased){p.controlMeta={aggregation:g}}return e.getInstance().enhanceXConfig(o,p).then(function(){a.resetRevertData();n(o)})}},layers:{USER:true}}};return t});
//# sourceMappingURL=xConfigHandler.js.map