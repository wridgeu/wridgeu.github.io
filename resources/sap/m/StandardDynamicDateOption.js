/*!
 * OpenUI5
 * (c) Copyright 2009-2021 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/core/Element","./DynamicDateOption","./Label","./StepInput","./RadioButton","./RadioButtonGroup","sap/ui/unified/Calendar","sap/ui/unified/calendar/MonthPicker","sap/ui/core/format/DateFormat","sap/ui/core/date/UniversalDateUtils","sap/ui/core/date/UniversalDate","sap/m/DynamicDateValueHelpUIType","./library"],function(e,t,a,r,s,T,n,E,A,R,i,c,u){"use strict";var o=t.extend("sap.m.StandardDynamicDateOption",{metadata:{library:"sap.m"}});var S=1;var g=6e3;var l={DATE:"DATE",DATERANGE:"DATERANGE",TODAY:"TODAY",YESTERDAY:"YESTERDAY",TOMORROW:"TOMORROW",SPECIFICMONTH:"SPECIFICMONTH",THISWEEK:"THISWEEK",THISMONTH:"THISMONTH",THISQUARTER:"THISQUARTER",THISYEAR:"THISYEAR",LASTWEEK:"LASTWEEK",LASTMONTH:"LASTMONTH",LASTQUARTER:"LASTQUARTER",LASTYEAR:"LASTYEAR",NEXTWEEK:"NEXTWEEK",NEXTMONTH:"NEXTMONTH",NEXTQUARTER:"NEXTQUARTER",NEXTYEAR:"NEXTYEAR",LASTDAYS:"LASTDAYS",LASTWEEKS:"LASTWEEKS",LASTMONTHS:"LASTMONTHS",LASTQUARTERS:"LASTQUARTERS",LASTYEARS:"LASTYEARS",NEXTDAYS:"NEXTDAYS",NEXTWEEKS:"NEXTWEEKS",NEXTMONTHS:"NEXTMONTHS",NEXTQUARTERS:"NEXTQUARTERS",NEXTYEARS:"NEXTYEARS",FROM:"FROM",TO:"TO",YEARTODATE:"YEARTODATE",DATETOYEAR:"DATETOYEAR",TODAYFROMTO:"TODAYFROMTO",QUARTER1:"QUARTER1",QUARTER2:"QUARTER2",QUARTER3:"QUARTER3",QUARTER4:"QUARTER4"};var p={SingleDates:1,DateRanges:2,Weeks:3,Months:4,Quarters:5,Years:6};var O={DATE:p.SingleDates,DATERANGE:p.DateRanges,TODAY:p.SingleDates,YESTERDAY:p.SingleDates,TOMORROW:p.SingleDates,SPECIFICMONTH:p.Months,THISWEEK:p.Weeks,THISMONTH:p.Months,THISQUARTER:p.Quarters,THISYEAR:p.Years,LASTWEEK:p.Weeks,LASTMONTH:p.Months,LASTQUARTER:p.Quarters,LASTYEAR:p.Years,NEXTWEEK:p.Weeks,NEXTMONTH:p.Months,NEXTQUARTER:p.Quarters,NEXTYEAR:p.Years,LASTDAYS:p.DateRanges,LASTWEEKS:p.DateRanges,LASTMONTHS:p.DateRanges,LASTQUARTERS:p.DateRanges,LASTYEARS:p.DateRanges,NEXTDAYS:p.DateRanges,NEXTWEEKS:p.DateRanges,NEXTMONTHS:p.DateRanges,NEXTQUARTERS:p.DateRanges,NEXTYEARS:p.DateRanges,FROM:p.DateRanges,TO:p.DateRanges,YEARTODATE:p.DateRanges,DATETOYEAR:p.DateRanges,TODAYFROMTO:p.DateRanges,QUARTER1:p.Quarters,QUARTER2:p.Quarters,QUARTER3:p.Quarters,QUARTER4:p.Quarters};var D=["LASTDAYS","LASTWEEKS","LASTMONTHS","LASTQUARTERS","LASTYEARS"];var N=["NEXTDAYS","NEXTWEEKS","NEXTMONTHS","NEXTQUARTERS","NEXTYEARS"];o.LastXKeys=D;o.NextXKeys=N;var y=sap.ui.getCore().getLibraryResourceBundle("sap.m");o.Keys=l;o.prototype.exit=function(){if(this.aValueHelpUITypes){while(this.aValueHelpUITypes.length){this.aValueHelpUITypes.pop().destroy()}delete this.aValueHelpUITypes}};o.prototype.getText=function(e){var t=this.getKey();var a=e._getOptions();var r=this.getValueHelpUITypes(e);var s=this._getOptionParams(D,a);var T=this._getOptionParams(N,a);if(s){r.push(s)}if(T){r.push(T)}switch(t){case l.LASTDAYS:case l.LASTWEEKS:case l.LASTMONTHS:case l.LASTQUARTERS:case l.LASTYEARS:return y.getText("DYNAMIC_DATE_LASTX_TITLE",r[1].getOptions().join(" / "));case l.NEXTDAYS:case l.NEXTWEEKS:case l.NEXTMONTHS:case l.NEXTQUARTERS:case l.NEXTYEARS:return y.getText("DYNAMIC_DATE_NEXTX_TITLE",r[1].getOptions().join(" / "));default:return y.getText("DYNAMIC_DATE_"+t+"_TITLE")}};o.prototype.getValueHelpUITypes=function(e){var t=this.getKey();if(!this.aValueHelpUITypes){switch(t){case l.TODAY:case l.YESTERDAY:case l.TOMORROW:case l.THISWEEK:case l.THISMONTH:case l.THISQUARTER:case l.THISYEAR:case l.LASTWEEK:case l.LASTMONTH:case l.LASTQUARTER:case l.LASTYEAR:case l.NEXTWEEK:case l.NEXTMONTH:case l.NEXTQUARTER:case l.NEXTYEAR:case l.YEARTODATE:case l.DATETOYEAR:case l.QUARTER1:case l.QUARTER2:case l.QUARTER3:case l.QUARTER4:this.aValueHelpUITypes=[];break;case l.DATE:case l.FROM:case l.TO:this.aValueHelpUITypes=[new c({type:"date"})];break;case l.DATERANGE:this.aValueHelpUITypes=[new c({type:"daterange"})];break;case l.SPECIFICMONTH:this.aValueHelpUITypes=[new c({type:"month"})];break;case l.LASTDAYS:case l.LASTWEEKS:case l.LASTMONTHS:case l.LASTQUARTERS:case l.LASTYEARS:case l.NEXTDAYS:case l.NEXTWEEKS:case l.NEXTMONTHS:case l.NEXTQUARTERS:case l.NEXTYEARS:this.aValueHelpUITypes=[new c({text:y.getText("DDR_LASTNEXTX_LABEL"),type:"int"})];break;case l.TODAYFROMTO:this.aValueHelpUITypes=[new c({text:y.getText("DDR_TODAYFROMTO_FROM_LABEL"),type:"int"}),new c({text:y.getText("DDR_TODAYFROMTO_TO_LABEL"),type:"int"})];break}}return this.aValueHelpUITypes.slice(0)};o.prototype.createValueHelpUI=function(e,t){var r=e._getOptions();var s=e.getValue();var T=this.getValueHelpUITypes(e);var n=[];if(!e.aControlsByParameters){e.aControlsByParameters={}}e.aControlsByParameters[this.getKey()]=[];var E=this._getOptionParams(D,r);var A=this._getOptionParams(N,r);if(E){T.push(E)}if(A){T.push(A)}for(var R=0;R<T.length;R++){if(T[R].getOptions()&&T[R].getOptions().length<=1){break}else if(T[R].getText()){n.push(new a({text:T[R].getText(),width:"100%"}))}var i;switch(T[R].getType()){case"int":i=this._createIntegerControl(s,R,t);if(s&&T[1]&&T[1].getOptions()&&T[1].getOptions().indexOf(s.operator.slice(4).toLowerCase())!==-1){i.setValue(s.values[R])}break;case"date":i=this._createDateControl(s,R,t);break;case"daterange":i=this._createDateRangeControl(s,R,t);break;case"month":i=this._createMonthControl(s,R,t);break;case"options":i=this._createOptionsControl(s,R,t,T);break}n.push(i);e.aControlsByParameters[this.getKey()].push(i)}return n};o.prototype._createIntegerControl=function(e,a,r){var s=t.prototype._createIntegerControl.call(this,e,a,r);var T=this.getKey()==="TODAYFROMTO"?-g:S;var n=!e||this.getKey()!==e.operator;if(this.getKey()==="TODAYFROMTO"&&n){s.setValue(1)}s.setMin(T);s.setMax(g);return s};o.prototype._createOptionsControl=function(e,t,a,r){var s=new T({buttons:[r[t].getOptions().map(h)]});if(e){var n=r[t].getOptions().indexOf(e.operator.slice(4).toLowerCase());if(n!==-1){s.setSelectedIndex(n)}}if(a instanceof Function){s.attachSelect(function(){a(this)},this)}return s};o.prototype._getOptionParams=function(e,t){if(e.indexOf(this.getKey())!==-1){return new c({text:"Time Periods:",type:"options",options:t?t.filter(function(t){return e.indexOf(t.getKey())!==-1}).map(function(e){return e.getKey().slice(4).toLowerCase()}):[]})}return undefined};o.prototype.validateValueHelpUI=function(e){var t=this.getValueHelpUITypes();for(var a=0;a<t.length;a++){var r=e.aControlsByParameters[this.getKey()][a];switch(t[a].getType()){case"int":if(r._isLessThanMin(r.getValue())||r._isMoreThanMax(r.getValue())){return false}break;case"month":case"date":case"daterange":if(!r.getSelectedDates()||r.getSelectedDates().length==0){return false}break;case"options":if(r.getSelectedIndex()<0){return false}break}}return true};o.prototype.getValueHelpOutput=function(e){var t=e._getOptions();var a=this.getValueHelpUITypes(e),r={},s;if(D.indexOf(this.getKey())!==-1&&e.aControlsByParameters[this.getKey()].length>1){r.operator=t.filter(function(e){return D.indexOf(e.getKey())!==-1})[e.aControlsByParameters[this.getKey()][1].getSelectedIndex()].getKey()}else if(N.indexOf(this.getKey())!==-1&&e.aControlsByParameters[this.getKey()].length>1){r.operator=t.filter(function(e){return N.indexOf(e.getKey())!==-1})[e.aControlsByParameters[this.getKey()][1].getSelectedIndex()].getKey()}else{r.operator=this.getKey()}r.values=[];for(var T=0;T<a.length;T++){var n=e.aControlsByParameters[this.getKey()][T];switch(a[T].getType()){case"int":s=n.getValue();break;case"month":if(!n.getSelectedDates()||!n.getSelectedDates().length){return null}s=n.getSelectedDates()[0].getStartDate().getMonth();break;case"date":if(!n.getSelectedDates().length){return null}s=n.getSelectedDates()[0].getStartDate();break;case"daterange":if(!n.getSelectedDates().length){return null}var E=n.getSelectedDates()[0].getEndDate()||n.getSelectedDates()[0].getStartDate();s=[n.getSelectedDates()[0].getStartDate(),E];break}if(Array.isArray(s)){r.values=Array.prototype.concat.apply(r.values,s)}else{s!==null&&s!==undefined&&r.values.push(s)}}return r};o.prototype.getGroup=function(){return O[this.getKey()]};o.prototype.getGroupHeader=function(){return y.getText("DDR_OPTIONS_GROUP_"+O[this.getKey()])};o.prototype.format=function(e,t){return t.format(e)};o.prototype.parse=function(e,t){return t.parse(e,this.getKey())};o.prototype.toDates=function(e){if(!e){return null}var t=e.operator;var a=e.values[0]||0;switch(t){case"SPECIFICMONTH":var r=new i;r.setMonth(e.values[0]);r=R.getMonthStartDate(r);return R.getRange(0,"MONTH",r);case"DATE":return R.getRange(0,"DAY",i.getInstance(e.values[0]));case"DATERANGE":var s=i.getInstance(e.values[0]);var T=i.getInstance(e.values[1]);return[R.resetStartTime(s),R.resetEndTime(T)];case"TODAY":return R.ranges.today();case"YESTERDAY":return R.ranges.yesterday();case"TOMORROW":return R.ranges.tomorrow();case"THISWEEK":return R.ranges.currentWeek();case"THISMONTH":return R.ranges.currentMonth();case"THISQUARTER":return R.ranges.currentQuarter();case"THISYEAR":return R.ranges.currentYear();case"LASTWEEK":return R.ranges.lastWeek();case"LASTMONTH":return R.ranges.lastMonth();case"LASTQUARTER":return R.ranges.lastQuarter();case"LASTYEAR":return R.ranges.lastYear();case"NEXTWEEK":return R.ranges.nextWeek();case"NEXTMONTH":return R.ranges.nextMonth();case"NEXTQUARTER":return R.ranges.nextQuarter();case"NEXTYEAR":return R.ranges.nextYear();case"LASTDAYS":return R.ranges.lastDays(a);case"LASTWEEKS":return R.ranges.lastWeeks(a);case"LASTMONTHS":return R.ranges.lastMonths(a);case"LASTQUARTERS":return R.ranges.lastQuarters(a);case"LASTYEARS":return R.ranges.lastYears(a);case"NEXTDAYS":return R.ranges.nextDays(a);case"NEXTWEEKS":return R.ranges.nextWeeks(a);case"NEXTMONTHS":return R.ranges.nextMonths(a);case"NEXTQUARTERS":return R.ranges.nextQuarters(a);case"NEXTYEARS":return R.ranges.nextYears(a);case"FROM":return[e.values[0],e.values[0]];case"TO":return[e.values[0],e.values[0]];case"YEARTODATE":return R.ranges.yearToDate();case"DATETOYEAR":return R.ranges.dateToYear();case"TODAYFROMTO":if(e.values.length!==2){return[]}var n=e.values[0];var E=e.values[1];var s=n>=0?R.ranges.lastDays(n)[0]:R.ranges.nextDays(-n)[1];var T=E>=0?R.ranges.nextDays(E)[1]:R.ranges.lastDays(-E)[0];if(s.oDate.getTime()>T.oDate.getTime()){T=[s,s=T][0]}return[R.resetStartTime(s),R.resetEndTime(T)];case"QUARTER1":return R.ranges.quarter(1);case"QUARTER2":return R.ranges.quarter(2);case"QUARTER3":return R.ranges.quarter(3);case"QUARTER4":return R.ranges.quarter(4);default:return[]}};o.prototype.enhanceFormattedValue=function(){switch(this.getKey()){case"TODAY":case"YESTERDAY":case"TOMORROW":case"THISWEEK":case"THISMONTH":case"THISQUARTER":case"THISYEAR":case"LASTWEEK":case"LASTMONTH":case"LASTQUARTER":case"LASTYEAR":case"NEXTWEEK":case"NEXTMONTH":case"NEXTQUARTER":case"NEXTYEAR":case"YEARTODATE":case"DATETOYEAR":case"QUARTER1":case"QUARTER2":case"QUARTER3":case"QUARTER4":return true;default:return false}};function h(e){return new s({text:e})}return o});