/*!
 * OpenUI5
 * (c) Copyright 2009-2021 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/support/library","sap/ui/fl/Utils","sap/ui/dt/DesignTime","sap/ui/rta/util/validateStableIds","sap/base/util/ObjectPath","sap/m/InstanceManager"],function(e,t,n,r,o,i){"use strict";var a=e.Categories;var s=e.Audiences;var l=e.Severity;function c(e){var n;e.some(function(e){n=t.getAppComponentForControl(e);return!!n});return n}function u(e){return(!e.isPopupAdaptationAllowed||e.isPopupAdaptationAllowed())&&t.getAppComponentForControl(e)&&(e.isA("sap.m.Dialog")||e.isA("sap.m.Popover"))}var p={id:"stableId",audiences:[s.Application],categories:[a.Functionality],enabled:true,minversion:"1.28",title:"Stable control IDs are required for SAPUI5 flexibility services",description:"Checks whether the IDs of controls support SAPUI5 flexibility services",resolution:"Replace the generated control ID with a stable ID. We strongly recommend that you use stable IDs for all controls in your app.",resolutionurls:[{text:"Documentation: Stable IDs: All You Need to Know",href:"https://sapui5.hana.ondemand.com/#topic/f51dbb78e7d5448e838cdc04bdf65403"}],async:true,check:function(e,a,s,p){var d=o.get("sap.ushell.Container");Promise.resolve().then(function(){if(d){return t.getUShellService("AppLifeCycle").then(function(e){var t=e.getCurrentApplication();if(!t.homePage){return t.componentInstance}return undefined}).catch(function(e){throw new Error("Error getting current application from Unified Shell AppLifeCycle service: "+e)})}return c(s.getElements())}).then(function(t){if(!t){return}var o=i.getOpenPopovers();var a=i.getOpenDialogs();var s=o.concat(a).filter(u);var c=new n({rootElements:[t].concat(s)});function d(){var n=r(c.getElementOverlays(),t);n.forEach(function(t){var n=t.getElement();var r=n.getId();var o=r.includes("--");if(!o){e.addIssue({severity:l.High,details:"The ID '"+r+"' for the control was generated and flexibility features "+"cannot support controls with generated IDs.",context:{id:r}})}else{e.addIssue({severity:l.Low,details:"The ID '"+r+"' for the control was concatenated and has a generated onset.\n"+"To enable the control for flexibility features, you must specify an ID for the control providing the onset, which is marked as high issue.",context:{id:r}})}});c.destroy();p()}c.attachEventOnce("synced",d)})}};return{name:"sap.ui.fl",niceName:"UI5 Flexibility Library",ruleset:[p]}},true);