/*
 * ! OpenUI5
 * (c) Copyright 2009-2021 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/base/security/encodeURLParameters"],function(e){"use strict";var s=0;var t=function(e,s){var t=new Error(e.statusText);t.status=e.status;t.userMessage=s;return t};var r=function(e){return sap.ui.getCore().getLibraryResourceBundle("sap.ui.fl").getText(e)};return{addLanguageInfo:function(e){if(!e){e={}}e["sap-language"]=sap.ui.getCore().getConfiguration().getLanguage()},getUrl:function(s,t,r){if(!s||!t.url){throw new Error("Not all necessary parameters were passed")}var n=t.url+s;if(t.cacheKey){n+="~"+t.cacheKey+"~/"}if(t.reference){n+=t.reference}else if(t.fileName){n+=t.fileName}if(r){Object.keys(r).forEach(function(e){if(r[e]===undefined){delete r[e]}});var a=e(r);if(a.length>0){n+="?"+a}}return n},sendRequest:function(e,n,a){n=n||"GET";n=n.toUpperCase();return new Promise(function(o,i){var u=new XMLHttpRequest;u.open(n,e);u.timeout=s;if((n==="GET"||n==="HEAD")&&(!a||!a.xsrfToken)){u.setRequestHeader("X-CSRF-Token","fetch")}if((n==="POST"||n==="PUT"||n==="DELETE")&&a&&a.xsrfToken){u.setRequestHeader("X-CSRF-Token",a.xsrfToken)}if(a&&a.contentType){u.setRequestHeader("Content-Type",a.contentType)}if(a&&a.siteId){u.setRequestHeader("X-LRep-Site-Id",a.siteId)}if(a&&a.sAppDescriptorId){u.setRequestHeader("X-LRep-AppDescriptor-Id",a.sAppDescriptorId)}if(a&&a.dataType){u.responseType=a.dataType}u.onload=function(){if(u.status>=200&&u.status<400){try{var e={};if(u.status!==204&&u.status!==205){if(!u.response&&u.responseText){u.response=u.responseText}if(u.response){e.response=typeof u.response==="string"?JSON.parse(u.response):u.response}}e.status=u.status;if(u.getResponseHeader("X-CSRF-Token")){e.xsrfToken=u.getResponseHeader("X-CSRF-Token")}if(u.getResponseHeader("Etag")){e.etag=u.getResponseHeader("Etag")}o(e)}catch(e){e.userMessage=r("MSG_LOADING_SERVER_RESPONSE_ERROR");i(e)}}else{var s="";try{var n=JSON.parse(u.response);if(Array.isArray(n.messages)&&n.messages.length){s=n.messages.reduce(function(e,s){return e.concat(s.severity==="Error"?s.text+"\n":"")},s)}}catch(e){}i(t(u,s))}};u.ontimeout=function(){i(t(u,r("MSG_CONNECTION_TIMEOUT_ERROR")))};u.onerror=function(){i(t(u,r("MSG_NETWORK_ERROR")))};if(a&&a.payload){u.send(a.payload)}else{u.send()}})}}});