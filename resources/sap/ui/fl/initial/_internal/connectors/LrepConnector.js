/*
 * ! OpenUI5
 * (c) Copyright 2009-2021 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/fl/initial/_internal/connectors/Utils","sap/ui/fl/Utils","sap/ui/dom/includeScript"],function(e,t,n){"use strict";var i={DATA:"/flex/data/",MODULES:"/flex/modules/"};return{layers:["ALL"],xsrfToken:undefined,settings:undefined,_loadModules:function(e){return new Promise(function(t,i){n(e,undefined,t,i)})},_addClientInfo:function(e){var n=t.getUrlParameter("sap-client");if(!e&&n){e={}}if(n){e["sap-client"]=n}},loadFlexData:function(t){if(t.cacheKey==="<NO CHANGES>"){return Promise.resolve()}var n={};if(t.allContexts){n["allContexts"]=t.allContexts}this._addClientInfo(n);e.addLanguageInfo(n);var s;if(t.appDescriptor&&t.appDescriptor["sap.app"]){s=t.appDescriptor["sap.app"].id}var a=e.getUrl(i.DATA,t,n);return e.sendRequest(a,"GET",{xsrfToken:this.xsrfToken,siteId:t.siteId,sAppDescriptorId:s}).then(function(s){var a=s.response;if(s.xsrfToken){this.xsrfToken=s.xsrfToken}if(s.etag){a.cacheKey=s.etag}else if(t.cacheKey){a.cacheKey=t.cacheKey}a.changes=a.changes.concat(a.compVariants||[]);if(a.settings){this.settings=a.settings;this.settings.isVariantAdaptationEnabled=!!this.settings.isPublicLayerAvailable}if(!a.loadModules){return a}var r=e.getUrl(i.MODULES,t,n);return this._loadModules(r).then(function(){return a})}.bind(this))}}});