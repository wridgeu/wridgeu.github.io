/*!
 * OpenUI5
 * (c) Copyright 2009-2022 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/core/util/File","sap/ui/core/util/reflection/JsControlTreeModifier","sap/m/MessageBox","sap/ui/fl/apply/_internal/flexState/ManifestUtils","sap/ui/thirdparty/jquery"],function(e,a,n,t,i){"use strict";var s={};s.VERSION="v1.0";s.extractData=function(e){var a={sVersion:s.VERSION,bIsInvestigationExport:true,mControlData:{},aAppliedChanges:[],aFailedChanges:[],aNotApplicableChanges:[],mChangesEntries:{},mVariantsChanges:{},sComponentName:e._mComponent.name};this._enhanceExportWithChangeData(e,a);this._enhanceExportWithVariantChangeData(e,a);this._enhanceExportWithControlData(e,a);return a};s.getAppComponentInstance=function(e){var a;var n=i.find(".sapUiComponentContainer");n.some(function(n){var i=sap.ui.getCore().byId(n.id);var s=i&&i.getComponentInstance();if(s&&t.getFlexReferenceForControl(s)===e){a=s;return true}});return a};s._enhanceExportWithChangeData=function(e,n){var t=s.getAppComponentInstance(n.sComponentName);i.each(e._mChangesEntries,function(e,i){n.mChangesEntries[e]={mDefinition:i._oDefinition,aControlsDependencies:[],aDependencies:[]};if(i._aDependentSelectorList){i._aDependentSelectorList.forEach(function(e){var i={bPresent:!!a.bySelector(e,t),aAppliedChanges:[],aFailedChangesJs:[],aFailedChangesXml:[],aNotApplicableChanges:[]};n.mControlData[e.id]=i})}});this._enhanceExportWithDependencyData(e,n)};s._enhanceExportWithDependencyData=function(e,a){i.each(e._mChangesInitial.mDependencies,function(e,n){a.mChangesEntries[e].aControlsDependencies=n.controlsDependencies;a.mChangesEntries[e].aDependencies=n.dependencies})};s._enhanceExportWithVariantChangeData=function(e,a){i.each(e._mVariantsChanges,function(e,n){a.mVariantsChanges[e]={mDefinition:n._oDefinition}})};s._enhanceWithChangetypeSpecificData=function(e,a,n,t,i){if(i){n[t]=i;n[t].map(function(n){if(!(n in e[a])){e[a].push(n)}})}};s._getChangesForControlFromCustomData=function(e,a){var n=e.getCustomData();var t=[];n.forEach(function(e){var n=e.getKey();if(n.startsWith(a)){t.push(n.replace(a,""))}});return t};s._enhanceExportWithControlData=function(e,a){i.each(e._mChanges.mChanges,function(e){var n={bPresent:false,aAppliedChanges:[],aFailedChangesJs:[],aFailedChangesXml:[],aNotApplicableChanges:[]};var t=sap.ui.getCore().byId(e);if(t){n.bPresent=true;this._enhanceWithChangetypeSpecificData(a,"aAppliedChanges",n,"aAppliedChanges",this._getChangesForControlFromCustomData(t,"sap.ui.fl.appliedChanges."));this._enhanceWithChangetypeSpecificData(a,"aFailedChanges",n,"aFailedChangesJs",this._getChangesForControlFromCustomData(t,"sap.ui.fl.failedChanges.js."));this._enhanceWithChangetypeSpecificData(a,"aFailedChanges",n,"aFailedChangesXml",this._getChangesForControlFromCustomData(t,"sap.ui.fl.failedChanges.xml."));this._enhanceWithChangetypeSpecificData(a,"aNotApplicableChanges",n,"aNotApplicableChanges",this._getChangesForControlFromCustomData(t,"sap.ui.fl.notApplicableChanges."))}a.mControlData[e]=n}.bind(this))};return s});