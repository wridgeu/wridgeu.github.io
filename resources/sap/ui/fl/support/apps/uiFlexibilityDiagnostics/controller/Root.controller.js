/*!
 * OpenUI5
 * (c) Copyright 2009-2022 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/model/json/JSONModel","sap/ui/thirdparty/jquery"],function(e,n,t){"use strict";return e.extend("sap.ui.fl.support.apps.uiFlexibilityDiagnostics.controller.Root",{onInit:function(){this._oView=this.getView();this._oDataSelectedModel=new n;this._oDataSelectedModel.setSizeLimit(1e4);this._oView.setModel(this._oDataSelectedModel,"selectedData")},formatStatus:function(e,n,t,i){if(!e||!n||!t){return undefined}i=i||[];var a=n.indexOf(e)!==-1;var r=t.indexOf(e)!==-1;var o=i.indexOf(e)!==-1;if(a){if(!r){return"Success"}return"Warning"}if(o){if(!r){return"CustomNotApplicable"}return"Warning"}if(r){return"Error"}},loadFile:function(e){var n=e.getParameter("files")&&e.getParameter("files")[0];if(n&&window.FileReader){var t=new FileReader;t.onload=function(e){var n=e.target.result;var t=JSON.parse(n);var i=this._createGraphData(t);this._oDataSelectedModel.setData(i)}.bind(this);t.readAsText(n)}},_generateAttributes:function(e){function n(e,n){return{label:"dependency ("+e+")",value:n.id?n.id:n}}var i=[{label:"Filename",value:e.fileName},{label:"Layer",value:e.layer},{label:"created at",value:e.creation},{label:"created by",value:e.support.user},{label:"Variant Reference",value:e.variantReference},{label:"selector",value:e.selector.id?e.selector.id:e.selector}];if(e.dependentSelector){t.each(e.dependentSelector,function(e,t){if(Array.isArray(t)){i=i.concat(t.map(n.bind(this,e)))}else{i.push(n(e,t))}})}if(e.oDataInformation&&e.oDataInformation.propertyName){i=i.concat([{label:"OData Property",value:e.oDataInformation.propertyName},{label:"OData EntityType",value:e.oDataInformation.entityType},{label:"OData URI",value:e.oDataInformation.oDataServiceUri}])}i=i.concat([{label:"Change content",value:"{= '"+JSON.stringify(e.content)+"'}"}]);return i},_defineIcon:function(e){if(e.indexOf("move")!==-1){return"sap-icon://move"}else if(e.indexOf("add")!==-1){return"sap-icon://add"}else if(e.indexOf("unhide")!==-1){return"sap-icon://show"}else if(e.indexOf("hide")!==-1){return"sap-icon://hide"}else if(e.indexOf("unstash")!==-1){return"sap-icon://show"}else if(e.indexOf("stash")!==-1){return"sap-icon://hide"}else if(e.indexOf("split")!==-1){return"sap-icon://split"}else if(e.indexOf("combine")!==-1){return"sap-icon://combine"}else if(e.indexOf("rename")!==-1){return"sap-icon://text"}return"sap-icon://verify-api"},_generateDependencies:function(e,n){var i=e.mChangesEntries;t.each(i,function(e,t){t.aDependencies.forEach(function(t){n.lines.push({from:t,to:e})})});n.lines.forEach(function(e){var t=e.from;var i=e.to;var a=n.lines.filter(function(e){return e.from===t&&e.to!==i});var r=[];n.lines.filter(function(e){if(e.from!==t&&e.to===i){r.push(e.from)}});e.obsolete=a.some(function(e){return r.indexOf(e.to)!==-1})});n.lines=n.lines.filter(function(e){return!e.obsolete})},_createGraphData:function(e){if(!e.bIsInvestigationExport){throw Error("Flex server response not supported yet!")}var n={nodes:[],groups:[],lines:[],nodeBoxWidth:100,appliedChanges:e.aAppliedChanges,failedChanges:e.aFailedChanges,notApplicableChanges:e.aNotApplicableChanges};var i=e.mChangesEntries;t.each(i,function(e,t){var i=t.mDefinition;var a=i.changeType;var r={title:a,key:i.fileName,icon:this._defineIcon(a),group:i.layer,descriptionLineSize:0,variantIcon:i.variantReference?"sap-icon://tree":undefined,attributes:this._generateAttributes(i)};var o=n.groups.some(function(e){return e.key===r.group});if(!o){n.groups.push({key:r.group,title:r.group})}n.nodes.push(r)}.bind(this));this._generateDependencies(e,n);return n}})});