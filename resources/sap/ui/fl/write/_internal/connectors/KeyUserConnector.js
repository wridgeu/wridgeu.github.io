/*
 * ! OpenUI5
 * (c) Copyright 2009-2022 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/base/util/merge","sap/ui/fl/write/_internal/connectors/BackendConnector","sap/ui/fl/initial/_internal/connectors/KeyUserConnector","sap/ui/fl/initial/_internal/connectors/Utils","sap/ui/fl/write/_internal/connectors/Utils","sap/base/util/restricted/_pick"],function(e,n,t,r,a,s){"use strict";var i="/flex/keyuser";var o="/v1";var u=e({},n,{layers:t.layers,ROUTES:{CHANGES:i+o+"/changes/",SETTINGS:i+o+"/settings",TOKEN:i+o+"/settings",VERSIONS:{GET:i+o+"/versions/",ACTIVATE:i+o+"/versions/activate/",DISCARD:i+o+"/versions/draft/"},TRANSLATION:{UPLOAD:i+o+"/translation/texts",DOWNLOAD:i+o+"/translation/texts/",GET_SOURCELANGUAGE:i+o+"/translation/sourcelanguages/"},CONTEXTS:i+o+"/contexts/"},isLanguageInfoRequired:true,loadFeatures:function(e){return n.loadFeatures.call(u,e).then(function(e){e.isPublicLayerAvailable=e.isPublicLayerAvailable&&!e.isVariantAdaptationEnabled;return e})},getContexts:function(e){var n=["type","$skip","$filter"];var t=s(e,n);var a=r.getUrl(u.ROUTES.CONTEXTS,e,t);return r.sendRequest(a).then(function(e){return e.response})},loadContextDescriptions:function(e){var n={};r.addLanguageInfo(n);l(e);var t=r.getUrl(u.ROUTES.CONTEXTS,e,n);e.payload=JSON.stringify(e.flexObjects);e.dataType="json";e.contentType="application/json; charset=utf-8";return a.sendRequest(t,"POST",e)}});function l(e){e.initialConnector=t;e.xsrfToken=t.xsrfToken;e.tokenUrl=u.ROUTES.TOKEN}function c(e){var n={title:e.title};e.payload=JSON.stringify(n);e.dataType="json";e.contentType="application/json; charset=utf-8"}function T(e){e.version=e.versionNumber.toString();delete e.versionNumber;return e}u.versions={load:function(e){l(e);var n={};r.addLanguageInfo(n);n.limit=e.limit;var t=r.getUrl(u.ROUTES.VERSIONS.GET,e,n);return r.sendRequest(t,"GET",e).then(function(e){return e.response.map(function(e){return T(e)})})},activate:function(e){l(e);c(e);var n={version:e.version};r.addLanguageInfo(n);var t=r.getUrl(u.ROUTES.VERSIONS.ACTIVATE,e,n);return a.sendRequest(t,"POST",e).then(function(e){var n=e.response;return T(n)})},discardDraft:function(e){l(e);var n=r.getUrl(u.ROUTES.VERSIONS.DISCARD,e);return a.sendRequest(n,"DELETE",e)}};u.translation={getTexts:function(e){var n=s(e,["sourceLanguage","targetLanguage"]);var t=r.getUrl(u.ROUTES.TRANSLATION.DOWNLOAD,e,n);return r.sendRequest(t,"GET",e).then(function(e){return e.response})},getSourceLanguages:function(e){var n={};var t=r.getUrl(u.ROUTES.TRANSLATION.GET_SOURCELANGUAGE,e,n);return r.sendRequest(t,"GET",e).then(function(e){return e.response})},postTranslationTexts:function(e){l(e);var n=r.getUrl(u.ROUTES.TRANSLATION.UPLOAD,e,{});return r.sendRequest(n,"POST",e)}};u.initialConnector=t;return u});