/*!
 * OpenUI5
 * (c) Copyright 2009-2021 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/base/Log","sap/base/security/encodeURL","sap/ui/core/Core","sap/ui/thirdparty/jquery"],function(e,r,t,n){"use strict";var a={v2:"v2",v4:"v4"};function i(e){var r=[];try{var t=JSON.parse(e.responseText);if(t&&t.error&&t.error.message&&t.error.message.value){r.push({severity:"error",text:t.error.message.value})}else{r.push({severity:"error",text:e.responseText})}}catch(e){}return r}function o(r){var t=null;var n=r.getBindingContext?r.getBindingContext():null;if(n&&n.getPath){t=n.getPath()}if(!t){e.warning("Control not bound to a path")}return t}function u(e,r){return e.metadataLoaded().then(function(){var t=e.oMetadata._getEntitySetByPath(r);return t?t.name:null})}function s(e,r){var t=e.getMetaModel();var n=t.getMetaPath(r);return t.requestObject(n).then(function(e){var r=t.fetchEntityContainer().getResult();var n=r[r.$EntityContainer];var a=Object.keys(n).filter(function(r){return n[r]===e});return a.length>0&&a[0]})}function l(e,r){return e.metadataLoaded().then(function(){var t=e.oMetadata._getEntityTypeByPath(r);return t?t.name:null})}function v(e,r){var t=e.getMetaModel();var n=t.getMetaPath(r);return t.requestObject(n).then(function(e){var r=e.$Type.split(".");return r[r.length-1]})}function c(r){var t=null;if(r&&r.sServiceUrl){t=r.sServiceUrl}if(!t){e.warning("Model has no Service Uri")}return t}function f(e){if(e){if(e.isA("sap.ui.model.odata.v2.ODataModel")){return a.v2}else if(e.isA("sap.ui.model.odata.v4.ODataModel")){return a.v4}}return null}function g(r){if(r){var t=r.getModel?r.getModel():null;if(f(t)){return t}e.warning("Unsupported model type or protocol");return null}e.warning("No Control passed");return null}var p={};p.checkControlPrerequisites=function(r){if(r){var t=g(r);var n=c(t);var a=o(r);return Boolean(n&&a)}e.warning("No Control passed");return false};p.executeRequest=function(e,r){var t=e+this.getUriParameters(r);return new Promise(function(e){var r={type:"GET",async:true,dataType:"json"};n.ajax(t,r).done(function(r){var t=r&&r.d;e({errorOccurred:false,result:t})}).fail(function(r){e({errorOccurred:true,errorMessages:i(r),statusCode:r.status})})})};p.getBoundEntitySet=function(e){var r=g(e);var t=f(r);if(t===a.v2){return u(r,o(e))}else if(t===a.v4){return s(r,o(e))}return Promise.resolve(null)};p.getBoundEntityType=function(e){var r=g(e);var t=f(r);if(t===a.v2){return l(r,o(e))}else if(t===a.v4){return v(r,o(e))}return Promise.resolve(null)};p.getCrossAppNavigationService=function(){if(sap.ushell&&sap.ushell.Container){return sap.ushell.Container.getServiceAsync("CrossApplicationNavigation")}return Promise.resolve(null)};p.getNavigationUriForIntent=function(e){return p.getCrossAppNavigationService().then(function(r){if(r&&r.hrefForExternal){return r.hrefForExternal(e)}return Promise.resolve(null)})};p.getServiceUri=function(e){var r=g(e);return c(r)};p.getText=function(e){return t.getLibraryResourceBundle("sap.ui.fl").getText(e)};p.getUriParameters=function(e){if(!e){return""}var t=[];Object.keys(e).forEach(function(n){if(n){var a="'"+r(e[n]||"")+"'";t.push(r(n)+"="+a)}});return t.length===0?"":"?"+t.join("&")};p.isNavigationSupportedForIntents=function(e){return p.getCrossAppNavigationService().then(function(r){if(r&&r.isNavigationSupported){return r.isNavigationSupported(e).then(function(e){return e.map(function(e){return e&&e.supported===true})})}return Promise.resolve(e.map(function(){return false}))})};return p});