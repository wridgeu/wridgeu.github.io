/*!
 * OpenUI5
 * (c) Copyright 2009-2022 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/base/Log","sap/base/security/encodeURL","sap/ui/core/Core","sap/ui/fl/Utils","sap/ui/thirdparty/jquery"],function(e,r,t,n,a){"use strict";var i={v2:"v2",v4:"v4"};function u(e){var r=[];try{var t=JSON.parse(e.responseText);if(t&&t.error&&t.error.message&&t.error.message.value){r.push({severity:"error",text:t.error.message.value})}else{r.push({severity:"error",text:e.responseText})}}catch(e){}return r}function o(r){var t=null;var n=r.getBindingContext?r.getBindingContext():null;if(n&&n.getPath){t=n.getPath()}if(!t){e.warning("Control not bound to a path")}return t}function s(e,r){return e.metadataLoaded().then(function(){var t=e.oMetadata._getEntitySetByPath(r);return t?t.name:null})}function l(e,r){var t=e.getMetaModel();var n=t.getMetaPath(r);return t.requestObject(n).then(function(e){var r=t.fetchEntityContainer().getResult();var n=r[r.$EntityContainer];var a=Object.keys(n).filter(function(r){return n[r]===e});return a.length>0&&a[0]})}function f(e,r){return e.metadataLoaded().then(function(){var t=e.oMetadata._getEntityTypeByPath(r);return t?t.name:null})}function c(e,r){var t=e.getMetaModel();var n=t.getMetaPath(r);return t.requestObject(n).then(function(e){var r=e.$Type.split(".");return r[r.length-1]})}function v(r){var t=null;if(r&&r.sServiceUrl){t=r.sServiceUrl}if(!t){e.warning("Model has no Service Uri")}return t}function g(e){if(e){if(e.isA("sap.ui.model.odata.v2.ODataModel")){return i.v2}else if(e.isA("sap.ui.model.odata.v4.ODataModel")){return i.v4}}return null}function p(r){if(r){var t=r.getModel?r.getModel():null;if(g(t)){return t}e.warning("Unsupported model type or protocol");return null}e.warning("No Control passed");return null}var d={};d.checkControlPrerequisites=function(r){if(r){var t=p(r);var n=v(t);var a=o(r);return Boolean(n&&a)}e.warning("No Control passed");return false};d.executeRequest=function(e,r){var t=e+this.getUriParameters(r);return new Promise(function(e){var r={type:"GET",async:true,dataType:"json"};a.ajax(t,r).done(function(r){var t=r&&r.d;e({errorOccurred:false,result:t})}).fail(function(r){e({errorOccurred:true,errorMessages:u(r),statusCode:r.status})})})};d.getBoundEntitySet=function(e){var r=p(e);var t=g(r);if(t===i.v2){return s(r,o(e))}else if(t===i.v4){return l(r,o(e))}return Promise.resolve(null)};d.getBoundEntityType=function(e){var r=p(e);var t=g(r);if(t===i.v2){return f(r,o(e))}else if(t===i.v4){return c(r,o(e))}return Promise.resolve(null)};d.getNavigationUriForIntent=function(e){return n.getUShellService("CrossApplicationNavigation").then(function(r){if(r&&r.hrefForExternal){return r.hrefForExternal(e)}return Promise.resolve(null)})};d.getServiceUri=function(e){var r=p(e);return v(r)};d.getText=function(e){return t.getLibraryResourceBundle("sap.ui.fl").getText(e)};d.getUriParameters=function(e){if(!e){return""}var t=[];Object.keys(e).forEach(function(n){if(n){var a="'"+r(e[n]||"")+"'";t.push(r(n)+"="+a)}});return t.length===0?"":"?"+t.join("&")};d.isNavigationSupportedForIntents=function(e){return n.getUShellService("CrossApplicationNavigation").then(function(r){if(r&&r.isNavigationSupported){return r.isNavigationSupported(e).then(function(e){return e.map(function(e){return e&&e.supported===true})})}return Promise.resolve(e.map(function(){return false}))})};return d});