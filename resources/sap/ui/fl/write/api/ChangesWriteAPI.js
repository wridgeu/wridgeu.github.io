/*
 * ! OpenUI5
 * (c) Copyright 2009-2022 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/fl/apply/_internal/changes/Applier","sap/ui/fl/apply/_internal/changes/Reverter","sap/ui/fl/apply/_internal/ChangesController","sap/ui/fl/apply/_internal/appVariant/DescriptorChangeTypes","sap/ui/fl/descriptorRelated/api/DescriptorChangeFactory","sap/ui/fl/initial/_internal/changeHandlers/ChangeHandlerStorage","sap/ui/fl/write/_internal/appVariant/AppVariantInlineChangeFactory","sap/base/Log","sap/ui/core/Component","sap/ui/core/Element","sap/ui/core/util/reflection/JsControlTreeModifier","sap/base/util/includes","sap/base/util/restricted/_omit"],function(e,n,t,a,r,c,i,o,l,p,s,g,h){"use strict";var f={create:function(e){var n;if(g(a.getChangeTypes(),e.changeSpecificData.changeType)){n=t.getDescriptorFlexControllerInstance(e.selector);var c=n.getComponentName();var p;if(e.changeSpecificData.layer){p=e.changeSpecificData.layer;delete e.changeSpecificData.layer}var s={changeType:e.changeSpecificData.changeType,content:e.changeSpecificData.content};if(e.changeSpecificData.texts){s.texts=e.changeSpecificData.texts}return i.createDescriptorInlineChange(s).then(function(n){return(new r).createNew(c,n,p,e.selector)}).catch(function(e){o.error("the change could not be created.",e.message);throw e})}if(e.selector.name&&e.selector.view){n=t.getFlexControllerInstance(e.selector.view)}else{n=t.getFlexControllerInstance(e.selector)}if(e.selector instanceof l){return n.createBaseChange(e.changeSpecificData,e.selector)}if(e.selector.name&&e.selector.view){return n.createChangeWithExtensionPointSelector(e.changeSpecificData,e.selector)}return n.createChangeWithControlSelector(e.changeSpecificData,e.selector)},apply:function(n){if(!(n.element instanceof p)){return Promise.reject("Please provide an Element")}var a=t.getFlexControllerInstance(n.element);n.appComponent=t.getAppComponentForSelector(n.element);if(!n.modifier){n.modifier=s}return e.applyChangeOnControl(n.change,n.element,h(n,["element","change"])).then(function(e){var t=a.checkForOpenDependenciesForControl(n.change.getSelector(),n.appComponent);if(t){return f.revert({change:n.change,element:n.element}).then(function(){throw Error("The following Change cannot be applied because of a dependency: "+n.change.getId())})}return e})},revert:function(e){var a;if(e.element instanceof p){a=t.getAppComponentForSelector(e.element)}var r={modifier:s,appComponent:a};return n.revertChangeOnControl(e.change,e.element,r)},getChangeHandler:function(e){var n=e.controlType||e.modifier.getControlType(e.element);return c.getChangeHandler(e.changeType,n,e.element,e.modifier,e.layer)}};return f});