/*
 * ! OpenUI5
 * (c) Copyright 2009-2022 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/fl/apply/_internal/changes/FlexCustomData","sap/ui/fl/initial/_internal/changeHandlers/ChangeHandlerStorage","sap/ui/fl/Utils"],function(e,n,t){"use strict";function r(e,n){if(n||e.hasApplyProcessStarted()){return false}return true}var a={getControlIfTemplateAffected:function(e,n,t){var r=t.modifier;var a=e.getDefinition();var i={originalControl:n};var o=a.dependentSelector&&a.dependentSelector.originalSelector;if(e.getContent().boundAggregation&&o){i.control=r.bySelector(o,t.appComponent,t.view);i.controlType=r.getControlType(i.control);i.bTemplateAffected=true}else{i.control=n;i.controlType=r.getControlType(n);i.bTemplateAffected=false}return i},getChangeHandler:function(e,r,a){var i=a.modifier.getLibraryName(r.control);return t.requireAsync("sap/ui/fl/initial/_internal/changeHandlers/ChangeHandlerRegistration").then(function(e){return e.waitForChangeHandlerRegistration(i)}).then(function(){var t=e.getChangeType();var i=e.getLayer();return n.getChangeHandler(t,r.controlType,r.control,a.modifier,i)})},checkIfDependencyIsStillValidSync:function(n,a,i,o){var l=t.getChangeFromChangesMap(i.mChanges,o);var c=a.bySelector(l.getSelector(),n);var g=e.sync.hasChangeApplyFinishedCustomData(c,l);return r(l,g)},checkIfDependencyIsStillValid:function(n,a,i,o){var l=t.getChangeFromChangesMap(i.mChanges,o);var c=a.bySelector(l.getSelector(),n);return e.hasChangeApplyFinishedCustomData(c,l,a).then(r.bind(null,l))},filterChangeByView:function(e,n){var t=e.modifier;var r=e.appComponent;var a=n.getSelector();if(!a){return false}if(a.viewSelector){var i=t.getControlIdBySelector(a.viewSelector,r);return i===e.viewId}var o=a.id;if(o){var l;if(n.getSelector().idIsLocal){if(r){l=r.getLocalId(e.viewId)}}else{l=e.viewId}var c=0;var g;do{c=o.indexOf("--",c);g=o.slice(0,c);c++}while(g!==l&&c>0);return g===l}return false}};return a});