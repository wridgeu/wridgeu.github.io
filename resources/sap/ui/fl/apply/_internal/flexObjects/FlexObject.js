/*!
 * OpenUI5
 * (c) Copyright 2009-2022 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/base/Log","sap/base/util/deepClone","sap/base/util/isEmptyObject","sap/base/util/isPlainObject","sap/base/util/ObjectPath","sap/base/util/restricted/_omit","sap/ui/base/ManagedObject","sap/ui/fl/apply/_internal/flexObjects/States","sap/ui/fl/Layer","sap/ui/fl/registry/Settings","sap/ui/fl/Utils"],function(t,e,r,a,n,i,o,s,p,u,c){"use strict";var f=o.extend("sap.ui.fl.apply._internal.flexObjects.FlexObject",{metadata:{properties:{state:{type:"string",defaultValue:s.NEW},fileType:{type:"string",defaultValue:"change"},layer:{type:"string"},flexObjectMetadata:{type:"object",defaultValue:{}},supportInformation:{type:"object",defaultValue:{}},content:{type:"any"},texts:{type:"object",defaultValue:{}}}},constructor:function(){o.apply(this,arguments);var t=this.getFlexObjectMetadata();if(t.reference){t.namespace=t.namespace||c.createNamespace({reference:t.reference},this.getFileType());if(!t.projectId){t.projectId=t.reference.replace(".Component","")}}this.setFlexObjectMetadata(t);var e=this.getSupportInformation();if(!e.originalLanguage){e.originalLanguage=c.getCurrentLanguage()}this.setSupportInformation(e)}});f.getMappingInfo=function(){return Object.assign({},{"flexObjectMetadata.reference":"reference","flexObjectMetadata.namespace":"namespace","flexObjectMetadata.creation":"creation","flexObjectMetadata.projectId":"projectId","flexObjectMetadata.packageName":"packageName","flexObjectMetadata.moduleName":"moduleName","supportInformation.generator":"support.generator","supportInformation.service":"support.service","supportInformation.sourceSystem":"sourceSystem","supportInformation.sourceClient":"sourceClient","supportInformation.user":"support.user","supportInformation.sapui5Version":"support.sapui5Version","supportInformation.sourceChangeFileName":"support.sourceChangeFileName","supportInformation.compositeCommand":"support.compositeCommand","supportInformation.command":"support.command","supportInformation.oDataInformation":"oDataInformation","supportInformation.originalLanguage":"originalLanguage",layer:"layer",fileType:"fileType",content:"content",id:"fileName",texts:"texts"})};f.prototype.getMappingInfo=function(){return f.getMappingInfo()};f.prototype.setContent=function(t){this.setProperty("content",t);this.setState(s.DIRTY);return this};f.prototype.getFlexObjectMetadata=function(){return Object.assign({},this.getProperty("flexObjectMetadata"))};f.prototype.getSupportInformation=function(){return Object.assign({},this.getProperty("supportInformation"))};function l(t,e){if(!Object.values(s).includes(t)){return false}if(e===s.NEW&&t===s.DIRTY){return false}return true}f.prototype.setState=function(t){var e=this.getState();if(e!==t&&l(t,e)){this._sPreviousState=e;this.setProperty("state",t)}return this};f.prototype.markForDeletion=function(){this.setState(s.DELETED)};f.prototype.restorePreviousState=function(){if(this._sPreviousState){this.setState(this._sPreviousState);delete this._sPreviousState}};f.prototype.isChangeFromOtherSystem=function(){var t=this.getSupportInformation().sourceSystem;var e=this.getSupportInformation().sourceClient;if(!t||!e){return false}var r=u.getInstanceOrUndef();if(!r){return true}var a=r.getSystem();var n=r.getClient();if(!a||!n){return false}return t!==a||e!==n};f.prototype.isUserDependent=function(){return this.getLayer()===p.USER};f.prototype.getText=function(t){var e=this.getTexts()[t]||{};return e.value||""};f.prototype.setText=function(t,e){var r=Object.assign({},this.getTexts());if(r[t]){r[t]=Object.assign({},r[t],{value:e});this.setTexts(r);this.setState(s.DIRTY)}return this};function g(t){return t.length?t.charAt(0).toUpperCase()+t.slice(1):t}function h(t){return typeof this[t]==="function"?this[t].bind(this):function(){throw new Error(t+" is not a valid mutator")}}function m(t){var r=t.split(".");r[0]=g(r[0]);var a=r.shift();var i=h.call(this,"get"+a);var o=h.call(this,"set"+a);return{getValue:function(){var t=e(i());if(r.length>0){return n.get(r,t)}return t},setValue:function(t){var a=e(i());if(r.length>0){n.set(r,t,a)}else{a=t}o(a);return this}.bind(this)}}f.prototype.convertToFileContent=function(){var t={};Object.entries(this.getMappingInfo()).forEach(function(e){var r=m.call(this,e[0]).getValue();if(r!==undefined){n.set(e[1],r,t)}}.bind(this));return t};function y(t,e){var r=m.call(this,t);var a=r.getValue();if(a!==e){r.setValue(e)}}f.mapFileContent=function(r,n){var i=Object.values(n);var o={};var s=function(e,r,p){var u=p?p+"."+e:e;var c=i.indexOf(u);if(c>=0){var f=Object.keys(n)[c];o[f]=r}else if(a(r)){Object.entries(r).forEach(function(t){s(t[0],t[1],u)})}else{t.error("Missing mapping info for property "+u)}};Object.entries(e(r)).forEach(function(t){s(t[0],t[1])});return o};f.prototype.update=function(t){var e=i(t,["fileName"]);var r=f.mapFileContent(e,this.getMappingInfo());Object.entries(r).forEach(function(t){y.call(this,t[0],t[1])}.bind(this))};f.prototype.setResponse=function(t){if(!t||r(t)){return}this.update(t);this.setState(s.PERSISTED)};return f});