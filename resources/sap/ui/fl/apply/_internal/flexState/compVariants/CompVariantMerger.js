/*
 * ! OpenUI5
 * (c) Copyright 2009-2022 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/fl/apply/_internal/flexObjects/CompVariant","sap/base/Log"],function(e,t){"use strict";var n={addFavorite:function(e){e.setFavorite(true)},removeFavorite:function(e){e.setFavorite(false)},updateVariant:function(e,t){var n=t.getContent();if(n.executeOnSelection!==undefined){e.setExecuteOnSelection(n.executeOnSelection)}if(n.favorite!==undefined){e.setFavorite(n.favorite)}if(n.contexts){e.setContexts(n.contexts)}if(n.variantContent){e.setContent(n.variantContent)}var a=t.getText("variantName");if(a){e.setName(a)}},standardVariant:function(e,t){e.setExecuteOnSelection(t.getContent().executeOnSelect)}};function a(e){var t={};e.changes.forEach(function(e){var n=e.getSelector().variantId||e.getContent().key;if(!t[n]){t[n]=[]}t[n].push(e)});return t}function i(e,n){t.error("No change handler for change with the ID '"+n.getId()+"' and type '"+n.getChangeType()+"' defined.\n"+"The variant '"+e.getId()+"'was not modified'")}function r(t,n){var a={fileName:n.id||e.STANDARD_VARIANT_ID,persisted:n.persisted,content:n.content||{},texts:{variantName:{value:n.name||""}},selector:{persistencyKey:t}};if(n.favorite!==undefined){a.favorite=n.favorite}if(n.executeOnSelection!==undefined){a.executeOnSelection=n.executeOnSelection}return new e(a)}function o(e,t){var a=n[t.getChangeType()]||i;a(e,t);e.addChange(t)}function f(e,t){var n=t.getId();if(e[n]){e[n].forEach(function(e){o(t,e)})}}return{merge:function(e,t,n){var i=t.nonPersistedVariants.concat(t.variants);var o=a(t);var c;i.forEach(function(e){if(e.getContent()&&e.getContent().standardvariant){c=e}});if(!c){c=r(e,n)}else{i=i.filter(function(e){return!e.getContent()||!e.getContent().standardvariant})}i.forEach(f.bind(undefined,o));c.setFavorite(true);c.setStandardVariant(true);t.byId[c.getId()]=c;var d=t.standardVariantChange;if(d){o[c.getId()]=o[c.getId()]||[];o[c.getId()].push(d);o[c.getId()].sort(function(e,t){if(e.getDefinition().creation<t.getDefinition().creation){return-1}if(e.getDefinition().creation>t.getDefinition().creation){return 1}return 0})}f(o,c);t.standardVariant=c;return{standardVariant:c,variants:i}},createVariant:function(e,t){return r(e,t)},applyChangeOnVariant:o}});