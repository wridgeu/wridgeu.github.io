/*
 * ! OpenUI5
 * (c) Copyright 2009-2021 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/base/util/includes","sap/base/Log","sap/ui/core/util/reflection/JsControlTreeModifier","sap/ui/fl/apply/_internal/controlVariants/Utils","sap/ui/fl/apply/_internal/ChangesController","sap/ui/fl/FlexControllerFactory","sap/ui/fl/Layer","sap/ui/fl/Utils"],function(e,t,r,n,o,l,s,a){"use strict";var i={isPersonalized:function(n){function o(e){t.error(e);return Promise.reject(e)}function i(e){return e.getFileType()==="change"}function c(t,n,o){var l=n.map(function(e){return e.id||e.getId()});var s=o.getSelector();var a=r.getControlIdBySelector(s,t);return e(l,a)}function u(t,r){return Array.isArray(t)&&t.length>0?e(t,r.getChangeType()):true}if(!n.selectors||n.selectors.length===0){return o("At least one control ID has to be provided as a parameter")}var p=n.selectors[0].appComponent||a.getAppComponentForControl(n.selectors[0]);if(!p){return o("App Component could not be determined")}var f=l.createForControl(p);return f.getComponentChanges({currentLayer:s.USER,includeCtrlVariants:true}).then(function(e){return e.filter(c.bind(this,p,n.selectors)).filter(u.bind(this,n.changeTypes)).some(i)}.bind(this))},waitForChanges:function(e){var t;var r;if(e.element){t=[{selector:e.element}];r=e.element}else if(e.selectors){t=e.selectors.map(function(e){return{selector:e}});r=e.selectors[0]}else if(e.complexSelectors){t=e.complexSelectors;r=e.complexSelectors[0].selector}return o.getFlexControllerInstance(r).waitForChangesToBeApplied(t)},isFlexSupported:function(e){return!!a.getAppComponentForControl(e.element)},hasVariantManagement:function(e){return n.belongsToVariantManagement(e.element)}};return i});