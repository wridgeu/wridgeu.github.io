/*!
 * OpenUI5
 * (c) Copyright 2009-2021 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/thirdparty/jquery","sap/ui/base/ManagedObject","sap/ui/fl/Layer","sap/ui/fl/Utils","sap/ui/fl/LayerUtils","sap/ui/fl/registry/Settings","sap/base/util/merge","sap/base/Log"],function(t,e,n,i,o,r,a,s){"use strict";var f=e.extend("sap.ui.fl.Variant",{constructor:function(i){e.apply(this);if(!t.isPlainObject(i)){s.error("Constructor : sap.ui.fl.Variant : oFile is not defined")}this._oDefinition=i;this._oOriginDefinition=a({},i);this._sRequest="";this._bUserDependent=i.content.layer===n.USER;this._vRevertData=null;this.setState(f.states.NEW)},metadata:{properties:{state:{type:"string"}}}});f.states={NEW:"NEW",PERSISTED:"NONE",DELETED:"DELETE",DIRTY:"UPDATE"};f.events={markForDeletion:"markForDeletion"};f.prototype.setState=function(t){if(this._isValidState(t)){this.setProperty("state",t)}return this};f.prototype._isValidState=function(t){var e=false;Object.keys(f.states).some(function(n){if(f.states[n]===t){e=true}return e});if(!e){return false}if(this.getState()===f.states.NEW&&t===f.states.DIRTY){return false}return true};f.prototype.isValid=function(){var t=true;if(typeof this._oDefinition!=="object"){t=false}if(!this._oDefinition.content.fileType||this._oDefinition.content.fileType!=="ctrl_variant"){t=false}if(!this._oDefinition.content.fileName){t=false}if(!this._oDefinition.content.content.title){t=false}if(!this._oDefinition.content.variantManagementReference){t=false}if(!this._oDefinition.content.layer){t=false}if(!this._oDefinition.content.originalLanguage){t=false}return t};f.prototype.isVariant=function(){return true};f.prototype.getDefinitionWithChanges=function(){return this._oDefinition};f.prototype.getTitle=function(){if(this._oDefinition){return this._oDefinition.content.content.title}};f.prototype.getFileType=function(){if(this._oDefinition){return this._oDefinition.content.fileType}};f.prototype.getControlChanges=function(){return this._oDefinition.controlChanges};f.prototype.getOriginalLanguage=function(){if(this._oDefinition&&this._oDefinition.content.originalLanguage){return this._oDefinition.content.originalLanguage}return""};f.prototype.getPackage=function(){return this._oDefinition.content.packageName};f.prototype.getNamespace=function(){return this._oDefinition.content.namespace};f.prototype.setNamespace=function(t){this._oDefinition.content.namespace=t};f.prototype.getId=function(){return this._oDefinition.content.fileName};f.prototype.getContent=function(){return this._oDefinition.content.content};f.prototype.setContent=function(t){this._oDefinition.content.content=t;this.setState(f.states.DIRTY)};f.prototype.getVariantManagementReference=function(){return this._oDefinition.content.variantManagementReference};f.prototype.getVariantReference=function(){return this._oDefinition.content.variantReference};f.prototype.getOwnerId=function(){return this._oDefinition.content.support?this._oDefinition.content.support.user:""};f.prototype.getText=function(t){if(typeof t!=="string"){s.error("sap.ui.fl.Variant.getTexts : sTextId is not defined")}if(this._oDefinition.content.texts){if(this._oDefinition.content.texts[t]){return this._oDefinition.content.texts[t].value}}return""};f.prototype.setText=function(t,e){if(typeof t!=="string"){s.error("sap.ui.fl.Variant.setTexts : sTextId is not defined");return}if(this._oDefinition.content.texts){if(this._oDefinition.content.texts[t]){this._oDefinition.content.texts[t].value=e;this.setState(f.states.DIRTY)}}};f.prototype.isReadOnly=function(){return this._isReadOnlyDueToLayer()||this._isReadOnlyWhenNotKeyUser()};f.prototype._isReadOnlyWhenNotKeyUser=function(){if(this.isUserDependent()){return false}var t=this.getDefinition().reference;if(!t){return true}var e=r.getInstanceOrUndef();if(!e){return true}return!e.isKeyUser()};f.prototype._isReadOnlyDueToLayer=function(){var t;t=this._bUserDependent?n.USER:o.getCurrentLayer();return this._oDefinition.content.layer!==t};f.prototype._isReadOnlyDueToOriginalLanguage=function(){var t;var e;e=this.getOriginalLanguage();if(!e){return false}t=i.getCurrentLanguage();return t!==e};f.prototype.markForDeletion=function(){this.setState(f.states.DELETED)};f.prototype.setRequest=function(t){if(typeof t!=="string"){s.error("sap.ui.fl.Variant.setRequest : sRequest is not defined")}this._sRequest=t};f.prototype.getRequest=function(){return this._sRequest};f.prototype.getLayer=function(){return this._oDefinition.content.layer};f.prototype.getComponent=function(){return this._oDefinition.content.reference};f.prototype.setComponent=function(t){this._oDefinition.content.reference=t};f.prototype.getCreation=function(){return this._oDefinition.content.creation};f.prototype.isUserDependent=function(){return this._bUserDependent};f.prototype.getPendingAction=function(){return this.getState()};f.prototype.getDefinition=function(){return this._oDefinition.content};f.prototype.setResponse=function(t){var e=JSON.stringify(t);if(e){this._oDefinition=JSON.parse(e);this._oOriginDefinition=JSON.parse(e);this.setState(f.states.PERSISTED)}};f.prototype.getFullFileIdentifier=function(){var t=this.getLayer();var e=this.getNamespace();var n=this.getDefinition().content.fileName;var i=this.getDefinition().content.fileType;return t+"/"+e+"/"+n+"."+i};f.prototype.getRevertData=function(){return this._vRevertData};f.prototype.setRevertData=function(t){this._vRevertData=t};f.prototype.resetRevertData=function(){this.setRevertData(null)};f.createInitialFileContent=function(t){if(!t){t={}}var e=t.content.fileName||i.createDefaultFileName();var r=t.content.namespace||i.createNamespace(t.content,"ctrl_variant");var a={content:{fileName:e,fileType:"ctrl_variant",variantManagementReference:t.content.variantManagementReference,variantReference:t.content.variantReference||"",reference:t.content.reference||"",packageName:t.content.packageName||"",content:{title:t.content.content.title||""},self:r+e+"."+"ctrl_variant",layer:t.content.layer||(t.isUserDependent?n.USER:o.getCurrentLayer()),texts:t.content.texts||{},namespace:r,creation:"",originalLanguage:i.getCurrentLanguage(),conditions:{},support:{generator:t.generator||"Change.createInitialFileContent",service:t.service||"",user:"",sapui5Version:sap.ui.version}},controlChanges:t.controlChanges||[],variantChanges:{}};return a};return f},true);