/*!
 * OpenUI5
 * (c) Copyright 2009-2022 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["./CardRenderer","../cards/Footer","../controls/ActionsToolbar","sap/ui/base/Interface","sap/ui/thirdparty/jquery","sap/ui/core/Core","sap/ui/integration/util/Manifest","sap/ui/integration/util/ServiceManager","sap/base/Log","sap/base/util/merge","sap/base/util/deepEqual","sap/base/util/each","sap/ui/integration/util/DataProviderFactory","sap/ui/model/json/JSONModel","sap/ui/integration/model/ObservableModel","sap/ui/model/resource/ResourceModel","sap/ui/integration/model/ContextModel","sap/base/util/LoaderExtensions","sap/f/CardBase","sap/f/library","sap/ui/integration/library","sap/ui/integration/util/Destinations","sap/ui/integration/util/LoadingProvider","sap/ui/integration/util/HeaderFactory","sap/ui/integration/util/ContentFactory","sap/ui/integration/util/BindingResolver","sap/ui/integration/formatters/IconFormatter","sap/ui/integration/cards/filters/FilterBarFactory","sap/ui/integration/cards/actions/CardActions","sap/ui/integration/util/CardObserver","sap/m/IllustratedMessage","sap/m/IllustratedMessageType","sap/m/IllustratedMessageSize","sap/ui/integration/util/Utils","sap/m/HBox","sap/m/library"],function(t,e,i,r,a,n,s,o,h,d,f,g,p,l,c,u,_,y,C,m,v,M,P,b,A,R,D,E,T,w,F,S,I,x,O,H){"use strict";var L={TYPE:"/sap.card/type",DATA:"/sap.card/data",HEADER:"/sap.card/header",HEADER_POSITION:"/sap.card/headerPosition",CONTENT:"/sap.card/content",FOOTER:"/sap.card/footer",SERVICES:"/sap.ui5/services",APP_TYPE:"/sap.app/type",PARAMS:"/sap.card/configuration/parameters",DESTINATIONS:"/sap.card/configuration/destinations",CSRF_TOKENS:"/sap.card/configuration/csrfTokens",FILTERS:"/sap.card/configuration/filters",ERROR_MESSAGES:"/sap.card/configuration/messages"};var B=["parameters","filters","paginator","form","context","i18n"];var N=["visibleItems","allItems"];var U=m.cards.HeaderPosition;var k=v.CardArea;var j=v.CardDataMode;var q="Card is destroyed!";var V=H.FlexRendertype;var W=H.FlexJustifyContent;var z=H.FlexAlignItems;var J="module:";var Y=C.extend("sap.ui.integration.widgets.Card",{metadata:{library:"sap.ui.integration",properties:{referenceId:{type:"string",defaultValue:""},manifest:{type:"any",defaultValue:""},parameters:{type:"object",defaultValue:null},dataMode:{type:"sap.ui.integration.CardDataMode",group:"Behavior",defaultValue:j.Active},baseUrl:{type:"sap.ui.core.URI",defaultValue:null},manifestChanges:{type:"object[]"}},aggregations:{actionDefinitions:{type:"sap.ui.integration.ActionDefinition",multiple:true,forwarding:{getter:"_getActionsToolbar",aggregation:"actionDefinitions"}},_header:{type:"sap.f.cards.IHeader",multiple:false,visibility:"hidden"},_filterBar:{type:"sap.ui.integration.cards.filters.FilterBar",multiple:false,visibility:"hidden"},_content:{type:"sap.ui.core.Control",multiple:false,visibility:"hidden"},_footer:{type:"sap.ui.core.Control",multiple:false,visibility:"hidden"},_extension:{type:"sap.ui.integration.Extension",multiple:false,visibility:"hidden"},_loadingProvider:{type:"sap.ui.core.Element",multiple:false,visibility:"hidden"}},events:{action:{allowPreventDefault:true,parameters:{actionSource:{type:"sap.ui.core.Control"},manifestParameters:{type:"object"},parameters:{type:"object"},type:{type:"sap.ui.integration.CardActionType"}}},configurationChange:{parameters:{changes:{type:"object"}}},manifestReady:{},manifestApplied:{}},associations:{host:{},openerReference:{visibility:"hidden"}}},renderer:t});Y.prototype.init=function(){C.prototype.init.call(this);this.setAggregation("_loadingProvider",new P);this._oIntegrationRb=n.getLibraryResourceBundle("sap.ui.integration");this._initModels();this._oContentFactory=new A(this);this._oCardObserver=new w(this);this._bFirstRendering=true;this._aFundamentalErrors=[];if(this.getProperty("dataMode")===j.Auto){this._oCardObserver.createObserver(this)}this._oLimitedInterface=new r(this,["getDomRef","setVisible","getParameters","getCombinedParameters","getManifestEntry","resolveDestination","request","refresh","refreshData","showMessage","getBaseUrl","getRuntimeUrl","getTranslatedText","getModel","triggerAction","addActionDefinition","removeActionDefinition","insertActionDefinition","getActionDefinition","indexOfActionDefinition","destroyActionDefinition","showLoadingPlaceholders","hideLoadingPlaceholders","showCard","hide","getOpener"])};Y.prototype._initModels=function(){this.setModel(new l);B.forEach(function(t){var e;switch(t){case"context":e=new _;break;case"i18n":e=new u({bundle:this._oIntegrationRb});break;default:e=new l;break}this.setModel(e,t)}.bind(this))};Y.prototype.clone=function(){var t=C.prototype.clone.apply(this,arguments);t._initModels();return t};Y.prototype._initReadyState=function(){this._aReadyPromises=[];this._awaitEvent("_headerReady");this._awaitEvent("_filterBarReady");this._awaitEvent("_contentReady");this._awaitEvent("_cardReady");Promise.all(this._aReadyPromises).then(function(){this._bReady=true;this.fireEvent("_ready")}.bind(this))};Y.prototype._clearReadyState=function(){this._bReady=false;this._aReadyPromises=[]};Y.prototype.onBeforeRendering=function(){if(this.getDataMode()!==j.Active){return}this.startManifestProcessing()};Y.prototype.onAfterRendering=function(){var t=this.getDomRef();if(this.getDataMode()===j.Auto&&this._bFirstRendering){this._oCardObserver.oObserver.observe(t)}this._bFirstRendering=false};Y.prototype.startManifestProcessing=function(){if(!x.isBindingSyntaxComplex()){this._logFundamentalError("Cannot parse manifest. Complex binding syntax is not enabled - "+"To enable it, set the 'compatVersion' configuration option to 'edge', e.g.: data-sap-ui-compatVersion='edge' - "+"sap.ui.integration.widgets.Card")}if(this._bApplyManifest||this._bApplyParameters){this._clearReadyState();this._initReadyState()}var t=this.getManifest();if(t&&this._bApplyManifest){this._cleanupOldManifest();this.createManifest(t,this.getBaseUrl())}if(!this._bApplyManifest&&this._bApplyParameters){this._oCardManifest.processParameters(this._getContextAndRuntimeParams());this._applyManifestSettings()}this._bApplyManifest=false;this._bApplyParameters=false;this._refreshActionsMenu()};Y.prototype.setManifest=function(t){if(!f(this.getProperty("manifest"),t)){this.destroyActionDefinitions()}if(!t){this._destroyManifest()}this._bApplyManifest=true;this.setProperty("manifest",t);return this};Y.prototype.setManifestChanges=function(t){this.setProperty("manifestChanges",t);this._bApplyManifest=true;return this};Y.prototype.setParameters=function(t){this.setProperty("parameters",t);this._bApplyParameters=true;return this};Y.prototype.setParameter=function(t,e){var i=this.getParameters()||{};i[t]=e;this.setParameters(i);return this};Y.prototype.setHost=function(t){this.setAssociation("host",t);var e=this.getHostInstance();if(t&&!e){h.error("Host with id '"+t+"' is not available during card initialization. It must be available for host specific features to work.","Make sure that the host already exists, before assigning it to the card.","sap.ui.integration.widgets.Card");return this}this.getModel("context").setHost(e);if(this._oDestinations){this._oDestinations.setHost(e)}if(this._oDataProviderFactory){this._oDataProviderFactory.setHost(e)}if(e&&e.bUseExperimentalCaching){this.addStyleClass("sapFCardExperimentalCaching")}else{this.removeStyleClass("sapFCardExperimentalCaching")}return this};Y.prototype.createManifest=function(t,e){var i={};this._isManifestReady=false;if(typeof t==="string"){i.manifestUrl=t;t=null}if(this._oCardManifest){this._oCardManifest.destroy()}this._oCardManifest=new s("sap.card",t,e,this.getManifestChanges());this._oCardManifest.load(i).then(function(){if(this.bIsDestroyed){throw new Error(q)}this._registerManifestModulePath();this._isManifestReady=true;this.fireManifestReady();return this._loadExtension()}.bind(this)).then(this._applyManifest.bind(this)).catch(function(t){if(t.message!==q){this._applyManifest();return}this._logFundamentalError(t.message)}.bind(this))};Y.prototype._loadExtension=function(){var t=this._oCardManifest.get("/sap.card/extension"),e;if(!t){return null}if(t.startsWith(J)){e=t.replace(J,"")}else{e=this._oCardManifest.get("/sap.app/id").replace(/\./g,"/")+"/"+t}return new Promise(function(t,i){sap.ui.require([e],function(e){var i=new e;i._setCard(this,this._oLimitedInterface);this.setAggregation("_extension",i);t()}.bind(this),function(t){this._logFundamentalError("Failed to load "+e+". Check if the path is correct. Reason: "+t);i(t)}.bind(this))}.bind(this))};Y.prototype._logFundamentalError=function(t){h.error(t);this._aFundamentalErrors.push(t)};Y.prototype.getFundamentalErrors=function(){return this._aFundamentalErrors};Y.prototype._applyManifest=function(){var t=this._oCardManifest;if(!t.get("/sap.card")){this._logFundamentalError("There must be a 'sap.card' section in the manifest.")}if(t&&t.getResourceBundle()){this._enhanceI18nModel(t.getResourceBundle())}this.getModel("context").resetHostProperties();if(this._hasContextParams()){this._resolveContextParams().then(function(t){this._oContextParameters=t;this._applyManifestWithParams()}.bind(this));return}this._applyManifestWithParams()};Y.prototype._applyManifestWithParams=function(){var t=this._oCardManifest,e=this._getContextAndRuntimeParams();t.processParameters(e);this._prepareToApplyManifestSettings().then(function(){this._applyManifestSettings()}.bind(this))};Y.prototype._enhanceI18nModel=function(t){var e=this.getModel("i18n"),i;i=new u({bundle:t,enhanceWith:[this._oIntegrationRb]});this.setModel(i,"i18n");e.destroy()};Y.prototype._hasContextParams=function(){var t=this._oCardManifest.get(L.PARAMS),e,i;for(e in t){i=t[e].value;if(typeof i==="string"&&i.indexOf("{context>")!==-1){return true}}return false};Y.prototype._resolveContextParams=function(){var t=this.getModel("context"),e=this._oCardManifest.get(L.PARAMS),i={},r,a;for(r in e){a=e[r].value;if(typeof a==="string"&&a.indexOf("{context>")!==-1){i[r]=a}}R.resolveValue(i,this,"/");return t.waitForPendingProperties().then(function(){return R.resolveValue(i,this,"/")}.bind(this))};Y.prototype._getContextAndRuntimeParams=function(){var t=this._oContextParameters||{},e=this.getParameters()||{};return d(t,e)};Y.prototype._awaitEvent=function(t){this._aReadyPromises.push(new Promise(function(e){this.attachEventOnce(t,function(){e()})}.bind(this)))};Y.prototype.isReady=function(){return this._bReady};Y.prototype.refresh=function(){if(this.getDataMode()===j.Active){this._bApplyManifest=true;this.invalidate()}};Y.prototype.refreshData=function(){if(!this.isReady()){return}var t=this.getCardHeader(),e=this.getCardContent(),i=this.getAggregation("_filterBar");if(this._oDataProvider){this._oDataProvider.triggerDataUpdate()}if(t){t.refreshData()}if(e&&e.isA("sap.ui.integration.cards.BaseContent")){e.refreshData()}else{this.destroyAggregation("_content");this._destroyTemporaryContent();this._applyContentManifestSettings()}if(i){i.refreshData()}};Y.prototype._refreshActionsMenu=function(){var t=this.getCardHeader(),e=this.getHostInstance(),i=this.getAggregation("_extension"),r=[];if(!t){return}if(e){r=r.concat(e.getActions()||[])}if(i){r=r.concat(i.getActions()||[])}if(f(r,this._getActionsToolbar()._aActions)){return}this._getActionsToolbar().initializeContent(this)};Y.prototype.exit=function(){C.prototype.exit.call(this);this._destroyManifest();this._oCardObserver.destroy();this._oCardObserver=null;this._oContentFactory=null;this._bFirstRendering=null;this._oIntegrationRb=null;if(this._oActionsToolbar){this._oActionsToolbar.destroy();this._oActionsToolbar=null}};Y.prototype._destroyManifest=function(){if(this._oCardManifest){this._oCardManifest.destroy();this._oCardManifest=null}if(this._oServiceManager){this._oServiceManager.destroy();this._oServiceManager=null}if(this._oDestinations){this._oDestinations.destroy();this._oDestinations=null}if(this._oIconFormatter){this._oIconFormatter.destroy();this._oIconFormatter=null}if(this._oActionsToolbar){this._oActionsToolbar.destroy();this._oActionsToolbar=null}this.destroyAggregation("_header");this.destroyAggregation("_filterBar");this.destroyAggregation("_content");this.destroyAggregation("_footer");this._cleanupOldManifest()};Y.prototype._cleanupOldManifest=function(){this._aReadyPromises=null;this.getModel("filters").setData({});this.getModel("parameters").setData({});this.getModel("paginator").setData({});this._oContextParameters=null;this._deregisterCustomModels();this.destroyAggregation("_extension");this._destroyTemporaryContent();if(this._oDataProviderFactory){this._oDataProviderFactory.destroy();this._oDataProviderFactory=null;this._oDataProvider=null}};Y.prototype._registerManifestModulePath=function(){if(!this._oCardManifest){return}this._sAppId=this._oCardManifest.get("/sap.app/id");if(this._sAppId){y.registerResourcePath(this._sAppId.replace(/\./g,"/"),this._oCardManifest.getUrl()||"/")}else{this._logFundamentalError("Card sap.app/id entry in the manifest is mandatory")}};Y.prototype.getManifest=function(){var t=this.getProperty("manifest");if(t&&typeof t==="object"){return a.extend(true,{},t)}return t};Y.prototype.getParameters=function(){var t=this.getProperty("parameters");if(t&&typeof t==="object"){return a.extend(true,{},t)}return t};Y.prototype.getCombinedParameters=function(){if(!this._isManifestReady){h.error("The manifest is not ready. Consider using the 'manifestReady' event.","sap.ui.integration.widgets.Card");return null}var t=this._oCardManifest.getProcessedParameters(this._getContextAndRuntimeParams()),e={},i;for(i in t){e[i]=t[i].value}return e};Y.prototype.getManifestEntry=function(t){if(!this._isManifestReady){h.error("The manifest is not ready. Consider using the 'manifestReady' event.","sap.ui.integration.widgets.Card");return null}return this._oCardManifest.get(t)};Y.prototype.getManifestRawJson=function(){if(!this._oCardManifest||!this._oCardManifest){h.error("The manifest is not ready. Consider using the 'manifestReady' event.","sap.ui.integration.widgets.Card");return{}}return this._oCardManifest.getInitialJson()};Y.prototype.getManifestWithMergedChanges=function(){if(!this._oCardManifest||!this._oCardManifest._oManifest){h.error("The manifest is not ready. Consider using the 'manifestReady' event.","sap.ui.integration.widgets.Card");return{}}return a.extend(true,{},this._oCardManifest._oManifest.getRawJson())};Y.prototype.resolveDestination=function(t){return this._oDestinations.getUrl(t)};Y.prototype.processDestinations=function(t){return this._oDestinations.process(t)};Y.prototype.showMessage=function(t,e){if(this._createContentPromise){this._createContentPromise.then(function(i){i.showMessage(t,e)})}else{h.error("'showMessage' cannot be used before the card instance is ready. Consider using the event 'manifestApplied' event.","sap.ui.integration.widgets.Card")}};Y.prototype.getTranslatedText=function(t,e,i){var r=this.getModel("i18n"),a;if(!r){h.warning("There are no translations available. Either the i18n configuration is missing or the method is called too early.");return null}a=r.getResourceBundle();return a.getText(t,e,i)};Y.prototype.getDataProviderFactory=function(){if(!this._oDataProviderFactory){h.error("The DataProviderFactory instance is not ready yet. Consider using the event 'manifestApplied'.","sap.ui.integration.widgets.Card");return null}return this._oDataProviderFactory};Y.prototype.getRuntimeUrl=function(t){var e=this._sAppId,i,r=t&&t.trim().replace(/^\//,"");if(e===null){h.error("The manifest is not ready so the URL can not be resolved. Consider using the 'manifestReady' event.","sap.ui.integration.widgets.Card");return null}if(!e||t.startsWith("http://")||t.startsWith("https://")||t.startsWith("//")){return t}i=e.replace(/\./g,"/");return sap.ui.require.toUrl(i)+"/"+r};Y.prototype._prepareToApplyManifestSettings=function(){var t=this._oCardManifest.get(L.APP_TYPE),e=this.getAggregation("_extension");if(t&&t!=="card"){h.error("sap.app/type entry in manifest is not 'card'")}if(this._oDataProviderFactory){this._oDataProviderFactory.destroy()}this._oDestinations=new M({host:this.getHostInstance(),card:this,manifestConfig:this._oCardManifest.get(L.DESTINATIONS)});this._oIconFormatter=new D({card:this});return this.processDestinations(this._oCardManifest.getJson()).then(function(t){this._oCardManifest.setJson(t);this._oDataProviderFactory=new p({host:this.getHostInstance(),extension:e,csrfTokensConfig:this._oCardManifest.get(L.CSRF_TOKENS),card:this});this._registerCustomModels();if(e){e.onCardReady()}}.bind(this))};Y.prototype._applyManifestSettings=function(){this._setParametersModelData();this._applyServiceManifestSettings();this._applyFilterBarManifestSettings();this._applyDataManifestSettings();this._applyHeaderManifestSettings();this._applyContentManifestSettings();this._applyFooterManifestSettings();this.fireManifestApplied()};Y.prototype._setParametersModelData=function(){var t={},e=this.getCombinedParameters(),i;for(i in e){if(N.indexOf(i)>=0){h.warning("The parameter name '"+i+"' is reserved for cards. Can not be used for creating custom parameter.")}else{t[i]={value:e[i]}}}this.getModel("parameters").setData(t)};Y.prototype._applyDataManifestSettings=function(){var t=this._oCardManifest.get(L.DATA),e;if(!t){this.fireEvent("_cardReady");return}this.bindObject(t.path||"/");if(this._oDataProvider){this._oDataProvider.destroy()}this._oDataProvider=this._oDataProviderFactory.create(t,this._oServiceManager);this.getAggregation("_loadingProvider").setDataProvider(this._oDataProvider);if(t.name){e=this.getModel(t.name)}else if(this._oDataProvider){e=new c;this.setModel(e)}if(!e){this.fireEvent("_cardReady");return}e.attachEvent("change",function(){var t=this.getAggregation("_content");if(t&&!t.isA("sap.ui.integration.cards.BaseContent")){this.destroyAggregation("_content");this._destroyTemporaryContent();this._applyContentManifestSettings()}if(this._createContentPromise){this._createContentPromise.then(function(t){t.onDataChanged();this.onDataRequestComplete()}.bind(this))}else{this.onDataRequestComplete()}}.bind(this));if(this._oDataProvider){this._oDataProvider.attachDataRequested(function(){this._showLoadingPlaceholders()}.bind(this));this._oDataProvider.attachDataChanged(function(t){e.setData(t.getParameter("data"))});this._oDataProvider.attachError(function(t){this._handleError("Data service unavailable. "+t.getParameter("message"));this.onDataRequestComplete()}.bind(this));this._oDataProvider.triggerDataUpdate()}else{this.fireEvent("_cardReady")}};Y.prototype._applyServiceManifestSettings=function(){var t=this._oCardManifest.get(L.SERVICES);if(!t){return}if(!this._oServiceManager){this._oServiceManager=new o(t,this)}};Y.prototype.getCardHeader=function(){return this.getAggregation("_header")};Y.prototype.getCardHeaderPosition=function(){if(!this._oCardManifest){return"Top"}return this._oCardManifest.get(L.HEADER_POSITION)||U.Top};Y.prototype.getCardContent=function(){return this.getAggregation("_content")};Y.prototype._getActionsToolbar=function(){if(!this._oActionsToolbar){this._oActionsToolbar=new i;this._oActionsToolbar.setCard(this)}return this._oActionsToolbar};Y.prototype._applyHeaderManifestSettings=function(){var t=this.createHeader();this.destroyAggregation("_header");if(!t){this.fireEvent("_headerReady");return}t.attachEvent("_error",function(t){this._handleError(t.getParameter("message"))}.bind(this));this.setAggregation("_header",t);if(t.isReady()){this.fireEvent("_headerReady")}else{t.attachEvent("_ready",function(){this.fireEvent("_headerReady")}.bind(this))}};Y.prototype._applyFilterBarManifestSettings=function(){var t=this.createFilterBar();this.destroyAggregation("_filterBar");if(!t){this.fireEvent("_filterBarReady");return}t.attachEventOnce("_filterBarDataReady",function(){this.fireEvent("_filterBarReady")}.bind(this));this.setAggregation("_filterBar",t)};Y.prototype._applyFooterManifestSettings=function(){var t=this.createFooter();this.destroyAggregation("_footer");if(t){this.setAggregation("_footer",t)}};Y.prototype.getHostInstance=function(){var t=this.getHost();if(!t){return null}return n.byId(t)};Y.prototype._applyContentManifestSettings=function(){var t=this._oCardManifest.get(L.TYPE),e=this.getContentManifest(),i=t+" "+this._oRb.getText("ARIA_ROLEDESCRIPTION_CARD");this._ariaText.setText(i);if(!e){this.fireEvent("_contentReady");return}this._setTemporaryContent(t,e);if(this._bIsPreviewMode){this.fireEvent("_contentReady");return}this._createContentPromise=this.createContent({cardType:t,contentManifest:e,serviceManager:this._oServiceManager,dataProviderFactory:this._oDataProviderFactory,iconFormatter:this._oIconFormatter,appId:this._sAppId}).then(function(t){this._setCardContent(t);return t}.bind(this));this._createContentPromise.catch(function(t){if(t){this._handleError(t)}}.bind(this))};Y.prototype.createHeader=function(){var t=this._oCardManifest.get(L.HEADER),e=new b(this);return e.create(t,this._getActionsToolbar())};Y.prototype.createFilterBar=function(){var t=this._oCardManifest.get(L.FILTERS),e=new E(this);return e.create(t,this.getModel("filters"))};Y.prototype.createFooter=function(){var t=this._oCardManifest.get(L.FOOTER);if(!t){return null}return e.create(this,t)};Y.prototype.getContentManifest=function(){var t=this._oCardManifest.get(L.TYPE),e=t&&t.toLowerCase()==="component",i=this._oCardManifest.get(L.CONTENT),r=!!i;if(r&&!t){this._logFundamentalError("Card type property is mandatory!");return null}if(!r&&!e){return null}if(e){i=d(i,{componentManifest:this._oCardManifest.getJson()})}return i};Y.prototype.createContent=function(t){t.cardManifest=this._oCardManifest;return this._oContentFactory.create(t)};Y.prototype._setCardContent=function(t){if(this._bShowContentLoadingPlaceholders){t.showLoadingPlaceholders();this._bShowContentLoadingPlaceholders=false}t.attachEvent("_error",function(t){this._handleError(t.getParameter("logMessage"))}.bind(this));var e=this.getAggregation("_content");if(e&&e!==this._oTemporaryContent){e.destroy()}this.setAggregation("_content",t);if(t.isReady()){this.fireEvent("_contentReady")}else{t.attachReady(function(){this.fireEvent("_contentReady")}.bind(this))}};Y.prototype._setTemporaryContent=function(t,e){var i=this._getTemporaryContent(t,e),r=this.getAggregation("_content");if(r&&r!==i){r.destroy()}this.setAggregation("_content",i)};Y.prototype._preserveMinHeightInContent=function(t){t.addEventDelegate({onAfterRendering:function(){if(!this._oCardManifest){return}var e=this._oCardManifest.get(L.TYPE),i=this._oCardManifest.get(L.CONTENT),r=this._oContentFactory.getClass(e),a;if(!r){return}a=r.getMetadata().getRenderer().getMinHeight(i,t,this);if(this.getHeight()==="auto"){t.$().css({"min-height":a})}}},this)};Y.prototype._destroyPreviousContent=function(t){if(t&&!t.hasStyleClass("sapFCardErrorContent")){t.destroy();if(t===this._oTemporaryContent){this._oTemporaryContent=null}}};Y.prototype._destroyTemporaryContent=function(){if(this._oTemporaryContent){this._oTemporaryContent.destroy();this._oTemporaryContent=null}};Y.prototype._handleError=function(t,e){if(!e){h.error(t,null,"sap.ui.integration.widgets.Card")}this.fireEvent("_error",{message:t});var i=this._oCardManifest.get(L.ERROR_MESSAGES),r=this._getIllustratedMessage(i,e),a=this._oCardManifest.get(L.CONTENT),n=d({},this.getCardContent());if(a){this._handleNoDataItems(n,r,e);this._destroyPreviousContent(this.getCardContent());this._preserveMinHeightInContent(r);this.setAggregation("_content",r);this.fireEvent("_contentReady")}else{this.getCardHeader().setAggregation("_error",r)}};Y.prototype._getIllustratedMessage=function(t,e){var i=S.UnableToLoad,r=I.Spot,a,n;if(e&&!t){switch(this._oCardManifest.get(L.TYPE)){case"List":case"Timeline":i=S.NoData;a=this._oIntegrationRb.getText("CARD_NO_ITEMS_ERROR_LISTS");break;case"Table":i=S.NoEntries;a=this._oIntegrationRb.getText("CARD_NO_ITEMS_ERROR_LISTS");break;case"Analytical":i=S.NoEntries;a=this._oIntegrationRb.getText("CARD_NO_ITEMS_ERROR_CHART");break;case"Object":i=S.NoData;a=this._oIntegrationRb.getText("CARD_NO_ITEMS_ERROR_CHART");break}}if(t&&t.noData&&e){var s=t.noData;i=S[s.type];r=I[s.size];a=s.title;n=s.description}var o=new F({illustrationType:i,illustrationSize:r,title:a,description:n?n:" "});var h=new O({renderType:V.Bare,justifyContent:W.Center,alignItems:z.Center,width:"100%",items:[o]}).addStyleClass("sapFCardErrorContent");return h};Y.prototype._handleNoDataItems=function(t,e,i){if(i){e._oCardOriginalContent=t}};Y.prototype._getTemporaryContent=function(t,e){var i=this.getAggregation("_loadingProvider");if(!this._oTemporaryContent&&i){this._oTemporaryContent=i.createContentPlaceholder(e,t,this);this._oTemporaryContent.addEventDelegate({onAfterRendering:function(){if(!this._oCardManifest){return}var i=this._oContentFactory.getClass(t).getMetadata().getRenderer().getMinHeight(e,this._oTemporaryContent,this);if(this.getHeight()==="auto"){this._oTemporaryContent.$().css({"min-height":i})}}},this)}return this._oTemporaryContent};Y.prototype.setDataMode=function(t){if(this._oDataProviderFactory&&t===j.Inactive){this._oDataProviderFactory.destroy();this._oDataProviderFactory=null}this.setProperty("dataMode",t,true);if(this.getProperty("dataMode")===j.Active){this.refresh()}if(this.getProperty("dataMode")===j.Auto){this._oCardObserver.createObserver(this);if(!this._bFirstRendering){this._oCardObserver.oObserver.observe(this.getDomRef())}}return this};Y.prototype.loadDesigntime=function(){if(this._oDesigntime){return Promise.resolve(this._oDesigntime)}if(!this._oCardManifest){return new Promise(function(t,e){this.attachManifestReady(function(){this.loadDesigntime().then(t,e)}.bind(this))}.bind(this))}var t=this._oCardManifest.get("/sap.app/id");if(!t){return Promise.reject("App id not maintained")}return new Promise(function(t,e){var i=this._oCardManifest.get("/sap.card/configuration/editor");if(i===undefined){i=this._oCardManifest.get("/sap.card/designtime")}var r=this._oCardManifest.get("/sap.app/id").replace(/\./g,"/")+"/"+i;if(r){sap.ui.require([r],function(e){e=new e;e._readyPromise(this._oLimitedInterface,this).then(function(){this._oDesigntime=e;t(e)}.bind(this))}.bind(this),function(){e({error:r+" not found"})})}else{e()}}.bind(this))};Y.prototype.showLoadingPlaceholders=function(t){var e;switch(t){case k.Header:e=this.getCardHeader();if(e){e.showLoadingPlaceholders()}break;case k.Filters:e=this.getAggregation("_filterBar");if(e){e.showLoadingPlaceholders()}break;case k.Content:if(this._createContentPromise){this._createContentPromise.then(function(t){t.showLoadingPlaceholders()})}else{this._bShowContentLoadingPlaceholders=true}break;default:this.showLoadingPlaceholders(k.Header);this.showLoadingPlaceholders(k.Filters);this.showLoadingPlaceholders(k.Content);this.getAggregation("_loadingProvider").setLoading(true)}return this};Y.prototype.hideLoadingPlaceholders=function(t){var e;switch(t){case k.Header:e=this.getCardHeader();if(e){e.hideLoadingPlaceholders()}break;case k.Filters:e=this.getAggregation("_filterBar");if(e){e.hideLoadingPlaceholders()}break;case k.Content:if(this._createContentPromise){this._createContentPromise.then(function(t){t.hideLoadingPlaceholders()})}else{this._bShowContentLoadingPlaceholders=false}break;default:this.hideLoadingPlaceholders(k.Header);this.hideLoadingPlaceholders(k.Filters);this.hideLoadingPlaceholders(k.Content);this.getAggregation("_loadingProvider").setLoading(false)}return this};Y.prototype.isLoading=function(){var t=this.getAggregation("_loadingProvider");return t?t.getLoading():false};Y.prototype.getFocusDomRef=function(){var t=this.getCardHeader();if(t&&t.getFocusDomRef()){return t.getFocusDomRef()}return this.getDomRef()};Y.prototype._showLoadingPlaceholders=function(){this.getAggregation("_loadingProvider").setLoading(true)};Y.prototype.onDataRequestComplete=function(){var t=this.getCardContent(),e=this.getAggregation("_loadingProvider");this.fireEvent("_cardReady");this.hideLoadingPlaceholders(k.Header);this.hideLoadingPlaceholders(k.Filters);if(t&&t.isA("sap.ui.integration.cards.BaseContent")&&t.isReady()){this.hideLoadingPlaceholders(k.Content)}if(e){e.setLoading(false)}this._fireContentDataChange()};Y.prototype.request=function(t){return this.processDestinations(t).then(function(t){return this._oDataProviderFactory.create({request:t}).setAllowCustomDataType(true).getData()}.bind(this))};Y.prototype.triggerAction=function(t){T.fireAction({card:this,host:this.getHostInstance(),action:t,parameters:t.parameters,source:this})};Y.prototype._setPreviewMode=function(t){this._bIsPreviewMode=t;if(t){this.addStyleClass("sapFCardPreview")}else{this.removeStyleClass("sapFCardPreview")}this._bApplyManifest=true;this.invalidate()};Y.prototype.getBindingNamespaces=function(){var t={},e=this.getAggregation("_extension");if(e){t.extension={formatters:e.getFormatters()}}return t};Y.prototype._registerCustomModels=function(){var t=this._oCardManifest.findDataSections();if(!this._aCustomModels){this._aCustomModels=[]}this._deregisterCustomModels();t.forEach(function(t){var e=t&&t.name;if(!e){return}if(B.indexOf(e)>-1){h.error("The model name (data section name) '"+e+"' is reserved for cards. Can not be used for creating a custom model.");return}if(this._aCustomModels.indexOf(e)>-1){h.error("The model name (data section name) '"+e+"' is already used.");return}this.setModel(new c,e);this._aCustomModels.push(e)}.bind(this))};Y.prototype._deregisterCustomModels=function(){if(!this._aCustomModels){return}this._aCustomModels.forEach(function(t){this.getModel(t).destroy();this.setModel(null,t)}.bind(this));this._aCustomModels=[]};Y.prototype._fireConfigurationChange=function(t){var e=this.getHostInstance();if(!this._bReady){return}this.fireConfigurationChange({changes:t});if(e){e.fireCardConfigurationChange({card:this,changes:t})}};Y.prototype._fireContentDataChange=function(){this.fireEvent("_contentDataChange")};Y.prototype.isSkeleton=function(){return false};Y.prototype.getContentPageSize=function(t){var e=parseInt(R.resolveValue(t,this).maxItems)||0,i=this.getAggregation("_footer"),r;if(!i){return e}r=i.getAggregation("paginator");if(!r){return e}if(r.getPageSize()){return r.getPageSize()}return e};Y.prototype.hasPaginator=function(){var t=this._oCardManifest.get(L.FOOTER);return t&&t.paginator};Y.prototype.showCard=function(t){var e=this._createChildCard(t);t._cardId=e.getId();this.triggerAction({type:"ShowCard",parameters:t});return Promise.resolve(e)};Y.prototype.hide=function(){this.triggerAction({type:"HideCard"})};Y.prototype.getOpener=function(){var t=n.byId(this.getAssociation("openerReference"));if(!t){return null}return t._oLimitedInterface};Y.prototype._createChildCard=function(t){var e=t.manifest,i=t.baseUrl,r=t.data,a=this._createCard({width:t.width,host:this.getHostInstance(),parameters:t.parameters});a.setAssociation("openerReference",this);if(r){g(r,function(t,e){var i=new l(e);a.setModel(i,t)})}if(typeof e==="string"){a.setManifest(this.getRuntimeUrl(e));if(i){a.setBaseUrl(i)}}else{a.setManifest(e);a.setBaseUrl(i||this.getRuntimeUrl("/"))}return a};Y.prototype._createCard=function(t){return new Y(t)};return Y});