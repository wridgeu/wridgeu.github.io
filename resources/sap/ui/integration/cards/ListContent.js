/*!
 * OpenUI5
 * (c) Copyright 2009-2022 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["./BaseListContent","./ListContentRenderer","sap/ui/util/openWindow","sap/ui/core/ResizeHandler","sap/m/library","sap/m/List","sap/m/ObjectStatus","sap/ui/integration/library","sap/ui/integration/util/BindingHelper","sap/ui/integration/util/BindingResolver","sap/ui/integration/controls/Microchart","sap/ui/integration/controls/MicrochartLegend","sap/ui/integration/controls/ListContentItem","sap/ui/integration/controls/ActionsStrip"],function(t,i,e,n,o,r,s,a,c,h,p,l,d,g){"use strict";var u=o.AvatarSize;var f=o.AvatarColor;var m=o.ListType;var y=o.ListSeparators;var _=a.CardActionArea;var v=o.EmptyIndicatorMode;var I="_legendColorsLoad";var C=t.extend("sap.ui.integration.cards.ListContent",{metadata:{library:"sap.ui.integration",aggregations:{_legend:{multiple:false,visibility:"hidden"}}},renderer:i});C.prototype.onBeforeRendering=function(){t.prototype.onBeforeRendering.apply(this,arguments);this._getList().setBackgroundDesign(this.getDesign())};C.prototype.init=function(){t.prototype.init.apply(this,arguments);var i=this._getList();var e=this;this.setAggregation("_content",i);i.attachUpdateFinished(function(){if(e._iVisibleItems){var t=i.getItems();for(var n=e._iVisibleItems+1;n<t.length;n++){t[n].setVisible(false)}}})};C.prototype.exit=function(){t.prototype.exit.apply(this,arguments);if(this._oItemTemplate){this._oItemTemplate.destroy();this._oItemTemplate=null}if(this._iMicrochartsResizeHandler){n.deregister(this._iMicrochartsResizeHandler);this._iMicrochartsResizeHandler=undefined}};C.prototype.onAfterRendering=function(){t.prototype.onAfterRendering.apply(this,arguments);this._resizeMicrocharts()};C.prototype.loadDependencies=function(t){if(!this.isSkeleton()&&t.get("/sap.card/content/item/chart")){return p.loadDependencies()}return Promise.resolve()};C.prototype.setConfiguration=function(i){t.prototype.setConfiguration.apply(this,arguments);i=this.getParsedConfiguration();if(!i){return this}if(i.items){this._setStaticItems(i.items);return this}if(i.item){this._setItem(i)}return this};C.prototype.getStaticConfiguration=function(){var t=this.getInnerList().getItems(),i=this.getParsedConfiguration(),e=t[0]&&t[0].isA("sap.m.GroupHeaderListItem"),n=[],o=[],r;t.forEach(function(t){if(t.isA("sap.m.GroupHeaderListItem")){if(r){o.push(r)}n=[];r={title:t.getTitle(),items:n}}else{n.push(h.resolveValue(i.item,this,t.getBindingContext().getPath()))}}.bind(this));if(r){o.push(r)}var s={};if(e){s.groups=o}else{s.groups=[{items:n}]}return s};C.prototype.onDataChanged=function(){this._handleNoItemsError(this.getParsedConfiguration().item);this._checkHiddenNavigationItems(this.getParsedConfiguration().item)};C.prototype._getList=function(){if(this._bIsBeingDestroyed){return null}if(!this._oList){this._oList=new r({id:this.getId()+"-list",growing:false,showNoData:false});this._oList.addEventDelegate({onfocusin:function(t){if(!(t.srcControl instanceof d)){return}var i=t.target.getBoundingClientRect().bottom;var e=this.getDomRef().getBoundingClientRect().bottom;var n=Math.abs(i-e);var o=10;if(n<o){t.srcControl.addStyleClass("sapUiIntLCIRoundedCorners")}}},this)}return this._oList};C.prototype._setItem=function(t){var i=t.item,e=this._getList(),n=this.isSkeleton(),o={iconDensityAware:false,title:i.title&&(i.title.value||i.title),description:i.description&&(i.description.value||i.description),highlight:i.highlight,info:i.info&&i.info.value,infoState:i.info&&i.info.state,attributes:[]};if(i.icon){o.icon=c.formattedProperty(i.icon.src,function(t){return this._oIconFormatter.formatSrc(t)}.bind(this));o.iconAlt=i.icon.alt;o.iconDisplayShape=i.icon.shape;o.iconInitials=i.icon.initials||i.icon.text;o.iconVisible=i.icon.visible;if(o.title&&o.description){o.iconSize=u.S}else{o.iconSize=u.XS}o.iconSize=i.icon.size||o.iconSize;o.iconBackgroundColor=i.icon.backgroundColor||(o.iconInitials?undefined:f.Transparent)}if(i.attributesLayoutType){o.attributesLayoutType=i.attributesLayoutType}if(i.attributes){i.attributes.forEach(function(t){o.attributes.push(new s({text:t.value,state:t.state,emptyIndicatorMode:v.On,visible:t.visible}))})}if(!n){if(i.chart){o.microchart=this._createChartAndAddLegend(i.chart)}if(i.actionsStrip){o.actionsStrip=g.create(this.getCardInstance(),i.actionsStrip);e.setShowSeparators(y.All)}else{e.setShowSeparators(y.None)}}this._oItemTemplate=new d(o);this._oActions.attach({area:_.ContentItem,actions:i.actions,control:this,actionControl:this._oItemTemplate,enabledPropertyName:"type",enabledPropertyValue:m.Active,disabledPropertyValue:m.Inactive});var r=t.group;if(r){this._oSorter=this._getGroupSorter(r)}var a={template:this._oItemTemplate,sorter:this._oSorter};this._bindAggregationToControl("items",e,a)};C.prototype._createChartAndAddLegend=function(t){var i=p.create(t);this.destroyAggregation("_legend");if(t.type==="StackedBar"){var e=new l({chart:i.getChart(),colorsLoad:function(){this.fireEvent(I)}.bind(this)});e.initItemsTitles(t.bars,this.getBindingContext().getPath());this.setAggregation("_legend",e);this.awaitEvent(I)}return i};C.prototype._resizeMicrocharts=function(){var t=this.$().find(".sapUiIntMicrochartChart"),i=Number.MAX_VALUE;if(t.length===0){return}t.each(function(t,e){i=Math.min(i,e.offsetWidth)});t.find(".sapUiIntMicrochartChartInner").css("max-width",i+"px");if(!this._iMicrochartsResizeHandler){this._iMicrochartsResizeHandler=n.register(this,this._resizeMicrocharts.bind(this))}};C.prototype._setStaticItems=function(t){var i=this._getList();t.forEach(function(t){var n=new d({iconDensityAware:false,title:t.title?t.title:"",description:t.description?t.description:"",icon:t.icon?t.icon:"",infoState:t.infoState?t.infoState:"None",info:t.info?t.info:"",highlight:t.highlight?t.highlight:"None"});if(t.action){n.setType("Navigation");if(t.action.url){n.attachPress(function(){e(t.action.url,t.target||"_blank")})}}i.addItem(n)});this.fireEvent("_actionContentReady")};C.prototype.getInnerList=function(){return this._getList()};return C});