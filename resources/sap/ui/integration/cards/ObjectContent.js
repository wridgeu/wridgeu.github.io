/*!
* OpenUI5
 * (c) Copyright 2009-2022 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
*/
sap.ui.define(["./BaseContent","./ObjectContentRenderer","sap/ui/integration/library","sap/m/library","sap/m/FlexItemData","sap/m/HBox","sap/m/VBox","sap/m/Text","sap/m/Title","sap/m/Avatar","sap/m/Link","sap/m/Label","sap/m/ObjectStatus","sap/m/ComboBox","sap/m/TextArea","sap/base/Log","sap/base/util/isEmptyObject","sap/ui/core/ResizeHandler","sap/ui/layout/AlignedFlowLayout","sap/ui/dom/units/Rem","sap/ui/integration/util/BindingHelper","sap/ui/integration/util/BindingResolver","sap/ui/integration/util/Utils","sap/f/AvatarGroup","sap/f/AvatarGroupItem","sap/f/cards/NumericIndicators","sap/f/cards/NumericSideIndicator","sap/f/library","sap/m/OverflowToolbar","sap/m/OverflowToolbarButton","sap/ui/core/ListItem"],function(e,t,a,r,i,n,o,s,l,u,p,c,d,f,m,h,g,v,b,y,I,C,w,_,S,x,A,B,F,G,L){"use strict";var O=r.AvatarSize;var j=r.AvatarColor;var P=r.ButtonType;var T=r.FlexRendertype;var E=r.FlexJustifyContent;var R=a.CardActionArea;var z=B.AvatarGroupType;var k=r.ToolbarStyle;var D=e.extend("sap.ui.integration.cards.ObjectContent",{metadata:{library:"sap.ui.integration"},renderer:t});D.prototype.exit=function(){e.prototype.exit.apply(this,arguments);if(this._sResizeListenerId){v.deregister(this._sResizeListenerId);this._sResizeListenerId=""}};D.prototype.onDataChanged=function(){this._handleNoItemsError(this.getParsedConfiguration().hasData)};D.prototype._handleNoItemsError=function(e){if(!e){return}var t=C.resolveValue(e,this,this.getBindingContext().getPath());if(!t||Array.isArray(t)&&!t.length||g(t)){this.getParent()._handleError("No items available",true)}};D.prototype.setConfiguration=function(t){e.prototype.setConfiguration.apply(this,arguments);t=this.getParsedConfiguration();if(!t){return this}if(t.groups){this._addGroups(t)}return this};D.prototype._getRootContainer=function(){var e=this.getAggregation("_content");if(!e){e=new o({renderType:T.Bare});this.setAggregation("_content",e);this._sResizeListenerId=v.register(e,this._onResize.bind(this))}return e};D.prototype._addGroups=function(e){var t=this._getRootContainer(),a,r=true,n=e.groups||[];n.forEach(function(e,o){var s=this._createGroup(e);if(e.alignment==="Stretch"){s.setLayoutData(new i({growFactor:1}));if(o===n.length-1){s.addStyleClass("sapFCardObjectGroupLastInColumn")}t.addItem(s);r=true}else{if(r){a=this._createAFLayout();t.addItem(a);r=false}a.addContent(s)}},this);this._oActions.attach({area:R.Content,actions:e.actions,control:this})};D.prototype._createGroup=function(e){var t;if(typeof e.visible=="string"){t=!w.hasFalsyValueAsString(e.visible)}else{t=e.visible}var a=new o({visible:t,renderType:T.Bare}).addStyleClass("sapFCardObjectGroup");if(e.title){a.addItem(new l({text:e.title}).addStyleClass("sapFCardObjectItemTitle"));a.addStyleClass("sapFCardObjectGroupWithTitle")}e.items.forEach(function(e){this._createGroupItems(e).forEach(a.addItem,a)},this);return a};D.prototype._createGroupItems=function(e){var t=e.label,a,r,i;if(typeof e.visible=="string"){r=!w.hasFalsyValueAsString(e.visible)}else{r=e.visible}if(t){t=I.formattedProperty(t,function(e){return e&&(e[e.length-1]===":"?e:e+":")});a=new c({text:t,visible:r}).addStyleClass("sapFCardObjectItemLabel");a.addEventDelegate({onBeforeRendering:function(){a.setVisible(a.getVisible()&&!!a.getText())}})}i=this._createItem(e,r,a);if(i){i.addStyleClass("sapFCardObjectItemValue")}if(e.icon){var s=new o({renderType:T.Bare,justifyContent:E.Center,items:[a,i]});var l=new n({visible:r,renderType:T.Bare,items:[this._createGroupItemAvatar(e.icon),s]}).addStyleClass("sapFCardObjectItemLabel");return[l]}else{return[a,i]}};D.prototype._createGroupItemAvatar=function(e){var t=I.formattedProperty(e.src,function(e){return this._oIconFormatter.formatSrc(e)}.bind(this));var a=new u({displaySize:e.size||O.XS,src:t,initials:e.text,displayShape:e.shape,tooltip:e.alt,backgroundColor:e.backgroundColor||(e.text?undefined:j.Transparent)}).addStyleClass("sapFCardObjectItemAvatar sapFCardIcon");return a};D.prototype._createItem=function(e,t,a){var r,i=e.value,n;switch(e.type){case"NumericData":r=this._createNumericDataItem(e,t);break;case"Status":r=this._createStatusItem(e,t);break;case"IconGroup":r=this._createIconGroupItem(e,t);break;case"ButtonGroup":r=this._createButtonGroupItem(e,t);break;case"ComboBox":r=this._createComboBoxItem(e,t,a);break;case"TextArea":r=this._createTextAreaItem(e,t,a);break;case"link":h.warning("Usage of Object Group Item property 'type' with value 'link' is deprecated. Use Card Actions for navigation instead.",null,"sap.ui.integration.widgets.Card");r=new p({href:e.url||i,text:i,target:e.target||"_blank",visible:I.reuse(t)});break;case"email":h.warning("Usage of Object Group Item property 'type' with value 'email' is deprecated. Use Card Actions for navigation instead.",null,"sap.ui.integration.widgets.Card");var o=[];if(e.value){o.push(e.value)}if(e.emailSubject){o.push(e.emailSubject)}n=I.formattedProperty(o,function(e,t){if(t){return"mailto:"+e+"?subject="+t}else{return"mailto:"+e}});r=new p({href:n,text:i,visible:I.reuse(t)});break;case"phone":h.warning("Usage of Object Group Item property 'type' with value 'phone' is deprecated. Use Card Actions for navigation instead.",null,"sap.ui.integration.widgets.Card");n=I.formattedProperty(i,function(e){return"tel:"+e});r=new p({href:n,text:i,visible:I.reuse(t)});break;default:r=this._createTextItem(e,t,a)}return r};D.prototype._createNumericDataItem=function(e,t){var a=new o({visible:I.reuse(t)});var r=new x({number:e.mainIndicator.number,numberSize:e.mainIndicator.size,scale:e.mainIndicator.unit,trend:e.mainIndicator.trend,state:e.mainIndicator.state}).addStyleClass("sapUiIntOCNumericIndicators");a.addItem(r);if(e.sideIndicators){e.sideIndicators.forEach(function(e){r.addSideIndicator(new A({title:e.title,number:e.number,unit:e.unit,state:e.state}))})}if(e.details){a.addItem(new s({text:e.details,maxLines:1}).addStyleClass("sapUiIntOCNumericIndicatorsDetails"))}return a};D.prototype._createStatusItem=function(e,t){var a=new d({text:e.value,visible:I.reuse(t),state:e.state});return a};D.prototype._createTextItem=function(e,t,a){var r=e.value,i;if(r&&e.actions){i=new p({text:r,visible:I.reuse(t)});if(a){i.addAriaLabelledBy(a)}else{h.warning("Missing label for Object group item with actions.",null,"sap.ui.integration.widgets.Card")}this._oActions.attach({area:R.ContentItemDetail,actions:e.actions,control:this,actionControl:i,enabledPropertyName:"enabled"})}else if(r){i=new s({text:r,visible:I.reuse(t),maxLines:e.maxLines})}return i};D.prototype._createButtonGroupItem=function(e,t){var a=e.template;if(!a){return null}var r=new F({visible:I.reuse(t),style:k.Clear});r.addStyleClass("sapUiIntCardObjectButtonGroup");var i=new G({icon:I.formattedProperty(a.icon,function(e){return this._oIconFormatter.formatSrc(e)}.bind(this)),text:a.text||a.tooltip,tooltip:a.tooltip||a.text,type:P.Transparent,visible:a.visible});if(a.actions){i.attachPress(function(e){this._onButtonGroupPress(e,a.actions)}.bind(this))}r.bindAggregation("content",{path:e.path||"/",template:i,templateShareable:false});return r};D.prototype._onButtonGroupPress=function(e,t){var a=e.getSource();var r=C.resolveValue(t,a,a.getBindingContext().getPath());var i=r[0];this.getActions().fireAction(this,i.type,i.parameters)};D.prototype._createIconGroupItem=function(e,t){var a=e.template;if(!a){return null}var r=new _({avatarDisplaySize:e.size||O.XS,groupType:z.Individual,visible:I.reuse(t)});r._oShowMoreButton.setType(P.Transparent);r._oShowMoreButton.setEnabled(false);if(a.actions){r.attachPress(function(e){this._onIconGroupPress(e,a.actions)}.bind(this))}else{r._setInteractive(false)}var i=new S({src:I.formattedProperty(a.icon.src,function(e){return this._oIconFormatter.formatSrc(e)}.bind(this)),initials:a.icon.text,tooltip:a.icon.alt});r.bindAggregation("items",{path:e.path||"/",template:i,templateShareable:false});return r};D.prototype._onIconGroupPress=function(e,t){if(e.getParameter("overflowButtonPressed")){}else{var a=e.getParameter("eventSource");var r=C.resolveValue(t,a,a.getBindingContext().getPath());var i=r[0];this.getActions().fireAction(this,i.type,i.parameters)}};D.prototype._createComboBoxItem=function(e,t,a){var r=this.getCardInstance(),i=r.getModel("form"),n={visible:I.reuse(t),placeholder:e.placeholder},o,s,l;if(e.selectedKey){n.selectedKey=e.selectedKey}else if(e.value){n.value=e.value}o=new f(n);if(a){a.setLabelFor(o)}if(e.item){s=new L({key:e.item.template.key,text:e.item.template.title});o.bindItems({path:e.item.path||"/",template:s,templateShareable:false})}if(!e.id){h.error("Each input element must have an ID.","sap.ui.integration.widgets.Card");return o}l=function(){i.setProperty("/"+e.id,{key:o.getSelectedKey(),value:o.getValue()})};o.attachChange(l);o.addEventDelegate({onAfterRendering:l});return o};D.prototype._createTextAreaItem=function(e,t,a){var r=this.getCardInstance(),i=r.getModel("form"),n=new m({value:e.value,visible:I.reuse(t),rows:e.rows,placeholder:e.placeholder}),o;if(a){a.setLabelFor(n)}if(!e.id){h.error("Each input element must have an ID.","sap.ui.integration.widgets.Card");return n}o=function(){i.setProperty("/"+e.id,n.getValue())};n.attachChange(o);n.addEventDelegate({onAfterRendering:o});return n};D.prototype._createAFLayout=function(){var e=new b;e.addEventDelegate({onAfterRendering:function(){this.getContent().forEach(function(e){if(!e.getVisible()){document.getElementById("sap-ui-invisible-"+e.getId()).parentElement.classList.add("sapFCardInvisibleContent")}})}},e);return e};D.prototype._onResize=function(e){if(e.size.width===e.oldSize.width){return}var t=this._getRootContainer().getItems();t.forEach(function(a,r){if(a.isA("sap.ui.layout.AlignedFlowLayout")){this._onAlignedFlowLayoutResize(a,e,r===t.length-1)}}.bind(this))};D.prototype._onAlignedFlowLayoutResize=function(e,t,a){var r=e.getMinItemWidth(),i,n=e.getContent().filter(function(e){return e.getVisible()}).length;if(r.lastIndexOf("rem")!==-1){i=y.toPx(r)}else if(r.lastIndexOf("px")!==-1){i=parseFloat(r)}var o=Math.floor(t.size.width/i);if(o>n){o=n}var s=o-1,l=Math.ceil(n/o);e.getContent().forEach(function(e,t){e.addStyleClass("sapFCardObjectSpaceBetweenGroup");if(s===t&&s<n){e.removeStyleClass("sapFCardObjectSpaceBetweenGroup");s+=o}if(a&&t+1>(l-1)*o){e.addStyleClass("sapFCardObjectGroupLastInColumn")}else{e.removeStyleClass("sapFCardObjectGroupLastInColumn")}})};return D});