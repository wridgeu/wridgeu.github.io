/*!
* OpenUI5
 * (c) Copyright 2009-2022 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
*/
sap.ui.define(["./BaseContent","./ObjectContentRenderer","sap/ui/integration/library","sap/m/library","sap/m/FlexItemData","sap/m/HBox","sap/m/VBox","sap/m/Text","sap/m/Title","sap/m/Avatar","sap/m/Link","sap/m/Label","sap/m/ObjectStatus","sap/base/Log","sap/ui/core/ResizeHandler","sap/ui/layout/AlignedFlowLayout","sap/ui/dom/units/Rem","sap/ui/integration/util/BindingHelper","sap/ui/integration/util/BindingResolver","sap/ui/integration/util/Utils","sap/f/AvatarGroup","sap/f/AvatarGroupItem","sap/f/cards/NumericIndicators","sap/f/cards/NumericSideIndicator","sap/f/library","sap/m/OverflowToolbar","sap/m/OverflowToolbarButton"],function(t,e,a,r,i,n,s,o,l,u,p,c,d,f,m,h,v,g,b,y,I,C,w,_,S,A,x){"use strict";var G=r.AvatarSize;var F=r.AvatarColor;var B=r.ButtonType;var O=r.FlexRendertype;var L=a.CardActionArea;var j=S.AvatarGroupType;var P=r.ToolbarStyle;var T=t.extend("sap.ui.integration.cards.ObjectContent",{metadata:{library:"sap.ui.integration"},renderer:e});T.prototype.exit=function(){t.prototype.exit.apply(this,arguments);if(this._sResizeListenerId){m.deregister(this._sResizeListenerId);this._sResizeListenerId=""}};T.prototype.setConfiguration=function(e){t.prototype.setConfiguration.apply(this,arguments);e=this.getParsedConfiguration();if(!e){return this}if(e.groups){this._addGroups(e)}return this};T.prototype._getRootContainer=function(){var t=this.getAggregation("_content");if(!t){t=new s({renderType:O.Bare});this.setAggregation("_content",t);this._sResizeListenerId=m.register(t,this._onResize.bind(this))}return t};T.prototype._addGroups=function(t){var e=this._getRootContainer(),a,r=true,n=t.groups||[];n.forEach(function(t,s){var o=this._createGroup(t);if(t.alignment==="Stretch"){o.setLayoutData(new i({growFactor:1}));if(s===n.length-1){o.addStyleClass("sapFCardObjectGroupLastInColumn")}e.addItem(o);r=true}else{if(r){a=this._createAFLayout();e.addItem(a);r=false}a.addContent(o)}},this);this._oActions.attach({area:L.Content,actions:t.actions,control:this})};T.prototype._createGroup=function(t){var e;if(typeof t.visible=="string"){e=!y.hasFalsyValueAsString(t.visible)}else{e=t.visible}var a=new s({visible:e,renderType:O.Bare}).addStyleClass("sapFCardObjectGroup");if(t.title){a.addItem(new l({text:t.title}).addStyleClass("sapFCardObjectItemTitle"));a.addStyleClass("sapFCardObjectGroupWithTitle")}t.items.forEach(function(t){this._createGroupItems(t).forEach(a.addItem,a)},this);return a};T.prototype._createGroupItems=function(t){var e=t.label,a,r,i;if(typeof t.visible=="string"){r=!y.hasFalsyValueAsString(t.visible)}else{r=t.visible}if(e){e=g.formattedProperty(e,function(t){return t&&t[t.length-1]===":"?t:t+":"});a=new c({text:e,visible:r}).addStyleClass("sapFCardObjectItemLabel")}i=this._createItem(t,r,a);if(i){i.addStyleClass("sapFCardObjectItemValue")}if(t.icon){var o=new s({renderType:O.Bare,items:[a,i]});var l=new n({visible:r,renderType:O.Bare,items:[this._createGroupItemAvatar(t.icon),o]}).addStyleClass("sapFCardObjectItemLabel");return[l]}else{return[a,i]}};T.prototype._createGroupItemAvatar=function(t){var e=g.formattedProperty(t.src,function(t){return this._oIconFormatter.formatSrc(t)}.bind(this));var a=new u({displaySize:t.size||G.XS,src:e,initials:t.text,displayShape:t.shape,tooltip:t.alt,backgroundColor:t.backgroundColor||(t.text?undefined:F.Transparent)}).addStyleClass("sapFCardObjectItemAvatar sapFCardIcon");return a};T.prototype._createItem=function(t,e,a){var r,i=t.value,n;switch(t.type){case"NumericData":r=this._createNumericDataItem(t,e);break;case"Status":r=this._createStatusItem(t,e);break;case"IconGroup":r=this._createIconGroupItem(t,e);break;case"ButtonGroup":r=this._createButtonGroupItem(t,e);break;case"link":f.warning("Usage of Object Group Item property 'type' with value 'link' is deprecated. Use Card Actions for navigation instead.",null,"sap.ui.integration.widgets.Card");r=new p({href:t.url||i,text:i,target:t.target||"_blank",visible:g.reuse(e)});break;case"email":f.warning("Usage of Object Group Item property 'type' with value 'email' is deprecated. Use Card Actions for navigation instead.",null,"sap.ui.integration.widgets.Card");var s=[];if(t.value){s.push(t.value)}if(t.emailSubject){s.push(t.emailSubject)}n=g.formattedProperty(s,function(t,e){if(e){return"mailto:"+t+"?subject="+e}else{return"mailto:"+t}});r=new p({href:n,text:i,visible:g.reuse(e)});break;case"phone":f.warning("Usage of Object Group Item property 'type' with value 'phone' is deprecated. Use Card Actions for navigation instead.",null,"sap.ui.integration.widgets.Card");n=g.formattedProperty(i,function(t){return"tel:"+t});r=new p({href:n,text:i,visible:g.reuse(e)});break;default:r=this._createTextItem(t,e,a)}return r};T.prototype._createNumericDataItem=function(t,e){var a=new s({visible:g.reuse(e)});var r=new w({number:t.mainIndicator.number,numberSize:t.mainIndicator.size,scale:t.mainIndicator.unit,trend:t.mainIndicator.trend,state:t.mainIndicator.state}).addStyleClass("sapUiIntOCNumericIndicators");a.addItem(r);if(t.sideIndicators){t.sideIndicators.forEach(function(t){r.addSideIndicator(new _({title:t.title,number:t.number,unit:t.unit,state:t.state}))})}if(t.details){a.addItem(new o({text:t.details,maxLines:1}).addStyleClass("sapUiIntOCNumericIndicatorsDetails"))}return a};T.prototype._createStatusItem=function(t,e){var a=new d({text:t.value,visible:g.reuse(e),state:t.state});return a};T.prototype._createTextItem=function(t,e,a){var r=t.value,i;if(r&&t.actions){i=new p({text:r,visible:g.reuse(e)});if(a){i.addAriaLabelledBy(a)}else{f.warning("Missing label for Object group item with actions.",null,"sap.ui.integration.widgets.Card")}this._oActions.attach({area:L.ContentItemDetail,actions:t.actions,control:this,actionControl:i,enabledPropertyName:"enabled"})}else if(r){i=new o({text:r,visible:g.reuse(e),maxLines:t.maxLines})}return i};T.prototype._createButtonGroupItem=function(t,e){var a=t.template;if(!a){return null}var r=new A({visible:g.reuse(e),style:P.Clear});r.addStyleClass("sapUiIntCardObjectButtonGroup");var i=new x({icon:g.formattedProperty(a.icon,function(t){return this._oIconFormatter.formatSrc(t)}.bind(this)),text:a.text||a.tooltip,tooltip:a.tooltip||a.text,type:B.Transparent,visible:a.visible});if(a.actions){i.attachPress(function(t){this._onButtonGroupPress(t,a.actions)}.bind(this))}r.bindAggregation("content",{path:t.path||"/",template:i,templateShareable:false});return r};T.prototype._onButtonGroupPress=function(t,e){var a=t.getSource();var r=b.resolveValue(e,a,a.getBindingContext().getPath());var i=r[0];this.getActions().fireAction(this,i.type,i.parameters)};T.prototype._createIconGroupItem=function(t,e){var a=t.template;if(!a){return null}var r=new I({avatarDisplaySize:t.size||G.XS,groupType:j.Individual,visible:g.reuse(e)});r._oShowMoreButton.setType(B.Transparent);r._oShowMoreButton.setEnabled(false);if(a.actions){r.attachPress(function(t){this._onIconGroupPress(t,a.actions)}.bind(this))}else{r._setInteractive(false)}var i=new C({src:g.formattedProperty(a.icon.src,function(t){return this._oIconFormatter.formatSrc(t)}.bind(this)),initials:a.icon.text,tooltip:a.icon.alt});r.bindAggregation("items",{path:t.path||"/",template:i,templateShareable:false});return r};T.prototype._onIconGroupPress=function(t,e){if(t.getParameter("overflowButtonPressed")){}else{var a=t.getParameter("eventSource");var r=b.resolveValue(e,a,a.getBindingContext().getPath());var i=r[0];this.getActions().fireAction(this,i.type,i.parameters)}};T.prototype._createAFLayout=function(){var t=new h;t.addEventDelegate({onAfterRendering:function(){this.getContent().forEach(function(t){if(!t.getVisible()){document.getElementById("sap-ui-invisible-"+t.getId()).parentElement.classList.add("sapFCardInvisibleContent")}})}},t);return t};T.prototype._onResize=function(t){if(t.size.width===t.oldSize.width){return}var e=this._getRootContainer().getItems();e.forEach(function(a,r){if(a.isA("sap.ui.layout.AlignedFlowLayout")){this._onAlignedFlowLayoutResize(a,t,r===e.length-1)}}.bind(this))};T.prototype._onAlignedFlowLayoutResize=function(t,e,a){var r=t.getMinItemWidth(),i,n=t.getContent().filter(function(t){return t.getVisible()}).length;if(r.lastIndexOf("rem")!==-1){i=v.toPx(r)}else if(r.lastIndexOf("px")!==-1){i=parseFloat(r)}var s=Math.floor(e.size.width/i);if(s>n){s=n}var o=s-1,l=Math.ceil(n/s);t.getContent().forEach(function(t,e){t.addStyleClass("sapFCardObjectSpaceBetweenGroup");if(o===e&&o<n){t.removeStyleClass("sapFCardObjectSpaceBetweenGroup");o+=s}if(a&&e+1>(l-1)*s){t.addStyleClass("sapFCardObjectGroupLastInColumn")}else{t.removeStyleClass("sapFCardObjectGroupLastInColumn")}})};return T});