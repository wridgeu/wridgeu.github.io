/*!
 * OpenUI5
 * (c) Copyright 2009-2021 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/integration/designtime/baseEditor/propertyEditor/BasePropertyEditor","sap/base/util/restricted/_omit","sap/base/util/restricted/_merge","sap/base/util/deepClone"],function(e,t,a,r){"use strict";var i=e.extend("sap.ui.integration.designtime.cardEditor.propertyEditor.complexMapEditor.ComplexMapEditor",{xmlFragment:"sap.ui.integration.designtime.cardEditor.propertyEditor.complexMapEditor.ComplexMapEditor",metadata:{library:"sap.ui.integration"},renderer:e.getMetadata().getRenderer().render});i.configMetadata=Object.assign({},e.configMetadata,{allowKeyChange:{defaultValue:true,mergeStrategy:"mostRestrictiveWins"},allowAddAndRemove:{defaultValue:true,mergeStrategy:"mostRestrictiveWins"},keyLabel:{defaultValue:"{i18n>CARD_EDITOR.COMPLEX_MAP.KEY}"}});i.prototype.getExpectedWrapperCount=function(){return 1};i.prototype.onFragmentReady=function(){this._oNestedArrayEditor=this.getContent();this._oNestedArrayEditor.attachValueChange(function(e){var i=e.getParameter("previousValue")||[];var n=r(e.getParameter("value")||[]);var o={};var s=this.getDesigntimeProperties();n=n.map(function(e,a){if(typeof e.key==="undefined"){var i="key";var u=0;var p=function(e){return e.key===i};while(n.some(p)){i="key"+ ++u}e.key=i}var l={};s.forEach(function(t){l[t]=r(e[t])});o[e.key]={__value:l};return t(e,s)});var u=this._processOutputValue(n);i.forEach(function(e){var t=e.key;if(t!==undefined&&!u.hasOwnProperty(t)){o[t]=null}});this.setValue(u);this.setDesigntimeMetadata(a({},this.getConfig().designtime,o))},this)};i.prototype._processInputValue=function(e){var t=this.getDesigntimeProperties();if(!e){e={}}var a=Object.keys(e).map(function(a){var i=r(e[a]);i.key=a;var n=this.getNestedDesigntimeMetadataValue(a);t.forEach(function(e){i[e]=n[e]});return i}.bind(this));return a};i.prototype.getDesigntimeProperties=function(){return[]};i.prototype.onBeforeConfigChange=function(e){var t={};if(e["allowKeyChange"]){t={key:{label:e["keyLabel"],type:"string",path:"key",validators:{uniqueKey:{type:"isUniqueKey",config:{keys:function(){return Object.keys(this.getValue())}.bind(this),currentKey:function(e){return e.getValue()}}}}}}}var r=a({},{template:t,allowSorting:false},e,{type:"array",path:""});this._oDefaultModel.setData(Object.assign({},this._oDefaultModel.getData(),{nestedConfig:r}));return e};i.prototype.setValue=function(t){var a=this._processInputValue(t);this._oDefaultModel.setData(Object.assign({},this._oDefaultModel.getData(),{nestedValue:a}));e.prototype.setValue.call(this,t)};i.prototype._processOutputValue=function(e){var a={};e.forEach(function(e){a[e.key]=t(e,"key")});return a};return i});