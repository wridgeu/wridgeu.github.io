/*!
 * OpenUI5
 * (c) Copyright 2009-2020 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/integration/designtime/baseEditor/propertyEditor/BasePropertyEditor","sap/ui/core/ListItem","sap/ui/core/Fragment","sap/ui/model/json/JSONModel","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/core/IconPool","sap/ui/base/BindingParser","sap/ui/integration/designtime/baseEditor/util/isValidBindingString","./IsInIconPool.validator"],function(t,e,i,o,n,a,r,s,l,d){"use strict";var g=null;var p=t.extend("sap.ui.integration.designtime.baseEditor.propertyEditor.iconEditor.IconEditor",{xmlFragment:"sap.ui.integration.designtime.baseEditor.propertyEditor.iconEditor.IconEditor",metadata:{library:"sap.ui.integration"},renderer:t.getMetadata().getRenderer().render});p.configMetadata=Object.assign({},t.configMetadata);p.prototype.onFragmentReady=function(){var t=this.getContent();this._oIconModel=this._getIconModel();t.setModel(this._oIconModel,"icons");t.bindAggregation("suggestionItems","icons>/",new e({text:"{icons>path}",additionalText:"{icons>name}"}))};p.prototype._getIconModel=function(){if(!g){g=new o(r.getIconNames().map(function(t){return{name:t,path:"sap-icon://"+t}}))}return g};p.prototype._onChange=function(t){var e=t.getParameter("value");this.setValue(e)};p.prototype._onSuggestionItemSelected=function(t){this.setValue(t.getParameter("selectedItem").getText())};p.prototype._getDefaultSearchValue=function(t){try{var e=s.complexParser(t);return e?"":t}catch(e){return t}};p.prototype._handleValueHelp=function(t){var e=t.getSource().getValue();if(!this._oDialog){return i.load({name:"sap.ui.integration.designtime.baseEditor.propertyEditor.iconEditor.IconEditorDialog",controller:this}).then(function(t){this._oDialog=t;this.addDependent(this._oDialog);this._oDialog.setModel(this._oIconModel);this._filter(e);this._oDialog.open(this._getDefaultSearchValue(e));return this._oDialog}.bind(this))}else{this._filter(e);this._oDialog.open(this._getDefaultSearchValue(e));return Promise.resolve(this._oDialog)}};p.prototype.handleSearch=function(t){var e=t.getParameter("value");this._filter(e)};p.prototype._filter=function(t){var e=new n("path",a.Contains,t);var i=this._oDialog.getBinding("items");i.filter([e])};p.prototype.handleClose=function(t){var e=t.getParameter("selectedItem");if(e){this.setValue(e.getIcon())}t.getSource().getBinding("items").filter([])};p.prototype.getDefaultValidators=function(){return Object.assign({},t.prototype.getDefaultValidators.call(this),{isValidBinding:{type:"isValidBinding"},isInIconPool:{type:"isInIconPool"}})};p.prototype.getDefaultValidatorModules=function(){return Object.assign({},t.prototype.getDefaultValidatorModules.apply(this,arguments),{isInIconPool:d})};return p});