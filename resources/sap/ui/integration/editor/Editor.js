/*!
 * OpenUI5
 * (c) Copyright 2009-2021 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["ui5loader","sap/ui/core/Control","sap/ui/core/Core","sap/ui/core/Manifest","sap/base/util/deepClone","sap/base/util/deepEqual","sap/base/util/merge","sap/ui/base/Interface","sap/ui/integration/Designtime","sap/ui/model/json/JSONModel","sap/ui/integration/util/Utils","sap/ui/integration/util/Destinations","sap/ui/integration/util/DataProviderFactory","sap/m/Label","sap/m/Title","sap/m/Panel","sap/m/HBox","sap/m/VBox","sap/ui/core/Icon","sap/m/ResponsivePopover","sap/m/Popover","sap/m/Text","sap/base/Log","sap/ui/core/Popup","sap/base/i18n/ResourceBundle","sap/ui/thirdparty/URI","sap/ui/Device","sap/ui/dom/includeStylesheet","sap/base/util/LoaderExtensions","sap/ui/core/theming/Parameters","sap/base/util/ObjectPath","sap/m/FormattedText","sap/m/MessageStrip","sap/m/ToolbarSpacer","sap/base/util/includes","sap/ui/model/resource/ResourceModel","./Manifest","./Merger","./Settings","sap/m/FlexItemData","sap/m/FlexBox","sap/m/Button"],function(e,t,i,a,n,s,r,o,l,d,f,u,g,h,p,c,_,m,v,y,b,I,T,M,D,C,x,E,P,S,w,O,A,L,R,V,F,B,U,N,j,W){"use strict";var k=b.prototype.init;b.prototype.init=function(){k.apply(this,arguments);var e=this.oPopup._applyPosition,t=this;this.oPopup._applyPosition=function(){var i=t.close;t.close=function(){};e.apply(this,arguments);t.close=i}};function H(e){if(e&&e.nodeType!==1){return 0}var t=parseInt(window.getComputedStyle(e).getPropertyValue("z-index"));if(isNaN(t)){return H(e.parentNode)}return t+1}var q=/\{\{(?!parameters.)(?!destinations.)([^\}\}]+)\}\}/g,J=/\{\{parameters\.([^\}\}]+)/g,K=5e3,X=i.getLibraryResourceBundle("sap.ui.integration"),G="__strip0";var z=t.extend("sap.ui.integration.editor.Editor",{metadata:{library:"sap.ui.integration",properties:{mode:{type:"string",defaultValue:"admin"},language:{type:"string",defaultValue:""},allowDynamicValues:{type:"boolean",defaultValue:false},allowSettings:{type:"boolean",defaultValue:false},designtime:{type:"object"},section:{type:"string",defaultValue:"sap.card"},host:{type:"string",defaultValue:""},baseUrl:{type:"sap.ui.core.URI",defaultValue:null},json:{type:"object"},previewPosition:{type:"string",defaultValue:"right"}},aggregations:{_formContent:{type:"sap.ui.core.Control",multiple:true,visibility:"hidden"},_preview:{type:"sap.ui.core.Control",multiple:false,visibility:"hidden"},_messageStrip:{type:"sap.m.MessageStrip",multiple:false,visibility:"hidden"},_extension:{type:"sap.ui.integration.editor.Extension",multiple:false,visibility:"hidden"}},events:{ready:{},manifestReady:{}}},renderer:function(e,t){var a=t.getAggregation("_preview");var n=t.getMode()!=="translation"&&t.hasPreview();var r=t.getPreviewPosition();if(n&&(r==="top"||r==="bottom")){e.openStart("div");e.writeElementData(t);e.openEnd();if(t.isReady()&&r==="top"){e.renderControl(a);e.close("div")}}e.openStart("div");e.addClass("sapUiIntegrationEditor");if(n&&r==="left"){e.writeElementData(t);e.openEnd();if(t.isReady()){e.renderControl(a);e.close("div")}}else if(n&&(r==="bottom"||r==="top")){e.openEnd()}else{e.writeElementData(t);e.openEnd()}if(t.isReady()){e.openStart("div");e.addClass("sapUiIntegrationEditorForm");if(t.getMode()!=="translation"){e.addClass("settingsButtonSpace")}e.writeClasses();e.openEnd();if(t.getMode()!=="translation"){e.renderControl(t.getAggregation("_messageStrip"))}var o=t.getAggregation("_formContent");if(o){var l;var d;var f;var u=[];var g;var h=function(){if(u.length>0){var e=2-u.length;for(var t=0;t<e;t++){u.push(new m)}l.addContent(new j({alignItems:"Start",justifyContent:"SpaceBetween",items:u}));u=[]}};for(var p=0;p<o.length;p++){var c=o[p];if(t.getMode()!=="translation"){if(c.isA("sap.m.Panel")){if(l){h();if(l.getContent().length>0){e.renderControl(l)}}l=c;l.addStyleClass("sapUiIntegrationEditorItem");if(p===o.length-1){h();if(l.getContent().length>0){e.renderControl(l)}}continue}if(c.isA("sap.m.FormattedText")){l.addContent(c.addStyleClass("sapUiIntegrationEditorHint"));if(p===o.length-1){h();if(l.getContent().length>0){e.renderControl(l)}}continue}var v=c._layout;if(c.isA("sap.m.Label")){c.addStyleClass("sapUiIntegrationEditorItemLabel");if(v&&!s(v,{})){if(v.alignment&&v.alignment.label==="end"){c.setTextAlign("End")}f=c}else{if(c._cols===2||c._cols===1&&u.length===2){h()}l.addContent(c)}}else if(c.isA("sap.m.ToolbarSpacer")){h();if(c._hasLine){c.addStyleClass("sapUiIntegrationEditorSpacerWithLine")}else{c.addStyleClass("sapUiIntegrationEditorSpacerWithoutLine")}l.addContent(c)}else{var y=c.getConfiguration(),b=new _,I=.1,T=0,M;if(c._descriptionIcon){b.addItem(c._descriptionIcon);I+=.9}var D=i.byId(c.getAssociation("_messageIcon"));if(c.getAssociation("_messageIcon")&&D){b.addItem(D);I+=1.2}if(c._settingsButton){c._settingsButton.addStyleClass("sapUiIntegrationEditorSettingsButton");T=2}var C=new N({growFactor:10,maxWidth:"calc(100% - "+T+"rem)"});var x=new N({maxWidth:"calc(100% - "+I+"rem)"});if(f){var E,P,S="50%";if(v&&v["label-width"]){S=v["label-width"]}var w=parseInt(S);var O=100-w;if(c._cols===2){w=w-.5;O=O-.5}if(v.alignment&&v.alignment.field==="end"){c.addStyleClass("sapUiIntegrationEditorFieldAlignEnd")}if(v.alignment&&v.alignment.label==="end"){f.setLayoutData(new N({maxWidth:"calc(100% - "+I+"rem)",minWidth:"calc(100% - "+I+"rem)"}))}else{f.setLayoutData(x)}if(b.getItems().length>0){f.addStyleClass("sapUiIntegrationEditorItemLabelWithInfo");M=new _({items:[f,b]})}else{M=f}if(v&&v.position&&v.position==="field-label"){M.setLayoutData(C);P=new _({alignItems:"Start",justifyContent:"SpaceBetween",items:[M,c._settingsButton]});P.setLayoutData(new N({growFactor:w,maxWidth:w+"%"}));c.setLayoutData(new N({growFactor:O,maxWidth:O+"%"}));E=new _({alignItems:"Start",justifyContent:"SpaceBetween",items:[c,P]})}else{c.setLayoutData(C);P=new _({alignItems:"Start",justifyContent:"SpaceBetween",items:[c,c._settingsButton]});M.setLayoutData(new N({growFactor:w,maxWidth:w+"%"}));P.setLayoutData(new N({growFactor:O,maxWidth:O+"%"}));E=new _({alignItems:"Start",justifyContent:"SpaceBetween",items:[M,P]})}if(c._cols===1){if(u.length===2){h()}if(y.hint){var A=t._createHint(y.hint);var L=new m({items:[E,A.addStyleClass("sapUiIntegrationEditorHint")]});L.addStyleClass("col1");u.push(L)}else{E.addStyleClass("col1");u.push(E)}}else{h();l.addContent(E)}f=null}else{var R=l.getContent().pop();R.setLayoutData(x);if(b.getItems().length>0){R.addStyleClass("sapUiIntegrationEditorItemLabelWithInfo");M=new _({items:[R,b]})}else{M=R}M.setLayoutData(C);var V=new j({alignItems:"Start",justifyContent:"SpaceBetween",items:[M,c._settingsButton]});if(c._cols===1){var L=new m({items:[V,c]});if(y.hint){var A=t._createHint(y.hint);L.addItem(A.addStyleClass("sapUiIntegrationEditorHint"))}L.addStyleClass("col1");u.push(L)}else{l.addContent(V);l.addContent(c)}}}if(p===o.length-1){h();if(l.getContent().length>0){e.renderControl(l)}}}else{if(p===0){d=c;e.renderControl(d);d.addStyleClass("sapUiIntegrationEditorTranslationPanel");continue}if(c.isA("sap.m.Panel")){if(l&&l.getContent().length>0){d.addContent(l)}l=c;l.addStyleClass("sapUiIntegrationEditorTranslationSubPanel");continue}if(c.isA("sap.m.ToolbarSpacer")){continue}if(c.isA("sap.m.FormattedText")){continue}if(c.isA("sap.m.Label")){l.addContent(c);continue}if(c.isOrigLangField){g=c;continue}g.addStyleClass("sapUiIntegrationFieldTranslationText");var E=new _({items:[g,c]}).addStyleClass("notWrappingRow");l.addContent(E);if(p===o.length-1){d.addContent(l)}}}}e.close("div");if(n&&r==="right"){e.renderControl(a)}}e.close("div");if(t.isReady()&&n&&r==="bottom"){e.renderControl(a);e.close("div")}}});z.prototype.init=function(){this._ready=false;this._aFieldReadyPromise=[];this._oResourceBundle=i.getLibraryResourceBundle("sap.ui.integration");this._appliedLayerManifestChanges=[];this._currentLayerManifestChanges={};this._mDestinationDataProviders={};this.setAggregation("_messageStrip",new A({showIcon:false}));this._oLimitedInterface=new o(this,["getParameters","resolveDestination","request","getModel"])};z.prototype.getParameters=function(){if(!this._isManifestReady){T.error("The manifest is not ready. Consider using the 'manifestReady' event.","sap.ui.integration.editor.Editor");return null}var e=this._oEditorManifest.getProcessedParameters(),t={},i;for(i in e){t[i]=e[i].value}return t};z.prototype.resolveDestination=function(e){return this._oDestinations.getUrl(e)};z.prototype.isReady=function(){return this._ready};z.prototype.hasPreview=function(){var e=this.getAggregation("_preview");if(e&&e.visible!==false){return true}return false};z.prototype.flattenData=function(e,t,i,a){a=a||"";i=i||[];if(typeof e==="object"){if(!e[t]){for(var n in e){this.flattenData(e[n],t,i,a+"/"+n)}}else{if(e.type){i.push({path:e.pathvalue||a.substring(1),value:e.pathvalue||"{context>"+a.substring(1)+"/value}",object:e})}else{i.push({path:a.substring(1),object:e});for(var n in e){this.flattenData(e[n],t,i,a+"/"+n)}}}}return i};z.prototype.setJson=function(e,t){this._ready=false;if(s(e,this._preIdOrSettings)){return this}this._preIdOrSettings=n(e,500);if(typeof e==="string"){try{e=JSON.parse(e)}catch(e){}}if(typeof e==="object"){if(e.manifestChanges){this._filterManifestChangesByLayer(e)}if(this._manifestModel){return}if(this._oDesigntimeInstance){this._oDesigntimeInstance.destroy()}if(e.host){this.setProperty("host",e.host)}if(e.baseUrl){this.setProperty("baseUrl",e.baseUrl)}this._appliedLayerManifestChanges=e.manifestChanges;this.createManifest(e,t)}};z.prototype.createManifest=function(e,t){var i=this.getBaseUrl();var a={},n=e.manifest;this._isManifestReady=false;if(typeof n==="string"){a.manifestUrl=n;n=null}if(this._oEditorManifest){this._oEditorManifest.destroy()}this.destroyAggregation("_extension");var s=B.layers[this.getMode()];this._oEditorManifest=new F(this.getSection(),n,i,e.manifestChanges);this._oEditorManifest.load(a).then(function(){this._registerManifestModulePath();this._oInitialManifestModel=new d(this._oEditorManifest._oInitialJson);this.setProperty("json",this._oEditorManifest._oInitialJson,t);var e=this._oEditorManifest._oManifest.getRawJson();var i=r({},e);this._beforeManifestModel=new d(i);if(s<B.layers["translation"]&&this._currentLayerManifestChanges){e=B.mergeDelta(e,[this._currentLayerManifestChanges])}this._manifestModel=new d(e);this._isManifestReady=true;this.fireManifestReady();this._loadDefaultTranslations();this._createContextModel();if(this._oEditorManifest.getResourceBundle()){this._enhanceI18nModel(this._oEditorManifest.getResourceBundle())}return this._loadExtension().then(function(){this._initInternal()}.bind(this))}.bind(this))};z.prototype._registerManifestModulePath=function(){if(!this._oEditorManifest){return}this._sAppId=this._oEditorManifest.get("/sap.app/id");if(this._sAppId){P.registerResourcePath(this._sAppId.replace(/\./g,"/"),this._oEditorManifest.getUrl()||"/")}else{T.error("sap.app/id entry in the manifest is mandatory")}};z.prototype._loadDefaultTranslations=function(){if(this._defaultTranslationsLoaded){return}var e=i.getLibraryResourceBundle("sap.ui.integration");this._enhanceI18nModel(e);this._defaultTranslationsLoaded=true};z.prototype._enhanceI18nModel=function(e){var t=this.getModel("i18n");if(t){if(t.getResourceBundle().oUrlInfo.url!==e.oUrlInfo.url){t.enhance(e);this._oResourceBundle=t.getResourceBundle()}return}t=new V({bundle:e});this.setModel(t,"i18n");this._oResourceBundle=e};z.prototype._loadExtension=function(){var e=this._oEditorManifest.get(this.getConfigurationPath()+"/extension")||this._oEditorManifest.get("/"+this.getSection()+"/extension");if(!e){T.info("Extension is not defined in manifest, do not load it.");return new Promise(function(e,t){e()})}var t=this._sAppId.replace(/\./g,"/")+"/"+e;return new Promise(function(i,a){sap.ui.require([t],function(e){var t=new e;t._setEditor(this,this._oLimitedInterface);this.setAggregation("_extension",t);i()}.bind(this),function(t){T.error("Failed to load "+e+". Check if the path is correct. Reason: "+t);a(t)})}.bind(this))};z.prototype.request=function(e){return this._oDataProviderFactory.create({request:e}).setAllowCustomDataType(true).getData()};z.prototype.initDestinations=function(e){var t=this.getHostInstance();if(e&&!t){T.error("Host with id '"+e+"' is not available during editor initialization. It must be available for host specific features to work.","Make sure that the host already exists, before assigning it to the editor.","sap.ui.integration.editor.Editor")}if(this._oDestinations){this._oDestinations.setHost(t)}else{var i=this.getConfigurationPath();this._oDestinations=new u(t,this._manifestModel.getProperty(i+"/destinations"))}};z.prototype.initDataProviderFactory=function(){if(this._oDataProviderFactory){this._oDataProviderFactory.destroy()}var e=this.getAggregation("_extension");this._oDataProviderFactory=new g(this._oDestinations,e,undefined,this)};z.prototype.getRuntimeUrl=function(e){var t=this._sAppId,i,a=e&&e.trim().replace(/^\//,"");if(t===null){T.error("The manifest is not ready so the URL can not be resolved. Consider using the 'manifestReady' event.","sap.ui.integration.editor.Editor");return null}if(!t||e.startsWith("http://")||e.startsWith("https://")||e.startsWith("//")){return e}i=t.replace(/\./g,"/");return sap.ui.require.toUrl(i)+"/"+a};z.prototype.getBindingNamespaces=function(){var e={},t=this.getAggregation("_extension");if(t){e.extension={formatters:t.getFormatters()}}return e};z.prototype.getHostInstance=function(){var e=this.getHost();if(!e){return null}return i.byId(e)};z.prototype.setLanguage=function(e,t){if(!e||typeof e!=="string"){return this}this._language=e.replaceAll("_","-");if(this.getLanguage()!=e){var a=i.getLibraryResourceBundle("sap.ui.integration");this._enhanceI18nModel(a)}this.setProperty("language",e,t);if(!z._languages[this._language]){this._language=this._language.split("-")[0]}if(!z._languages[this._language]){T.warning("The language: "+e+" is currently unknown, some UI controls might show "+e+" instead of the language name.")}return this};z.prototype.onAfterRendering=function(){if(this.getDomRef()){this._iZIndex=H(this.getDomRef());M.setInitialZIndex(this._iZIndex)}};z.prototype._filterManifestChangesByLayer=function(e){var t=[],i={":layer":B.layers[this.getMode()]},a=B.layers[this.getMode()];e.manifestChanges.forEach(function(e){var n=e.hasOwnProperty(":layer")?e[":layer"]:1e3;if(n<a){t.push(e)}else if(n===a){i=e}});e.manifestChanges=t;this._currentLayerManifestChanges=i};z.prototype._initInternal=function(){var e=this;var t=e.getConfigurationPath();var i=e._oEditorManifest.get(t+"/editor");if(!i){i=e._oEditorManifest.get("/"+e.getSection()+"/designtime")}var a=e._manifestModel.getProperty(t),n,s=e.getDesigntime();if(s){if(typeof s==="function"){n=new Promise(function(t,i){var a=new s;e._applyDesigntimeDefaults(a.getSettings());t(a)})}else if(typeof s==="object"){n=new Promise(function(t,i){sap.ui.require(["sap/ui/integration/Designtime"],function(i){var a=i.extend("test.Designtime");a.prototype.create=function(){return s};var n=new a;e._applyDesigntimeDefaults(n.getSettings());t(n)})})}}else if(i){n=e.loadDesigntime().then(function(t){e._applyDesigntimeDefaults(t.getSettings());return t})}else{n=Promise.resolve(e._createParameterDesigntime(a))}n.then(function(t){e._oDesigntimeInstance=t;e.initDestinations();e.initDataProviderFactory();if(e.getMode()==="admin"||e.getMode()==="all"){e._addDestinationSettings(a,e._oDesigntimeInstance)}e._settingsModel=new d(e._oDesigntimeInstance.getSettings());e.setModel(e._settingsModel,"currentSettings");e.setModel(e._settingsModel,"items");return e._loadValueContextInDesigntime()}).then(function(){e._applyDesigntimeLayers();return e._requestExtensionData()}).then(function(){e._requireFields().then(function(){e._startEditor()})})};z.prototype.loadDesigntime=function(){if(this._oDesigntime){return Promise.resolve(this._oDesigntime)}if(!this._oEditorManifest){return new Promise(function(e,t){this.attachManifestReady(function(){this.loadDesigntime().then(e,t)}.bind(this))}.bind(this))}if(!this._sAppId){return Promise.reject("App id not maintained")}return new Promise(function(e,t){var i=this._oEditorManifest.get(this.getConfigurationPath()+"/editor");if(!i){i=this._oEditorManifest.get("/"+this.getSection()+"/designtime")}var a=this._sAppId.replace(/\./g,"/")+"/"+i;if(a){sap.ui.require([a],function(t){t=new t;t._readyPromise(this._oLimitedInterface,this).then(function(){this._oDesigntime=t;e(t)}.bind(this))}.bind(this),function(){t({error:a+" not found"})})}else{t()}}.bind(this))};z.prototype.getConfigurationPath=function(){return"/"+this.getSection()+"/configuration"};z.prototype.getCurrentSettings=function(){var e=this._settingsModel.getProperty("/"),t={},i;if(e&&e.form&&e.form.items){for(var a in e.form.items){var n=e.form.items[a];if(n.editable&&n.visible){var s="";if(n.manifestpath){s=n.manifestpath.substring(0,n.manifestpath.lastIndexOf("/"))+"/valueTranslations"}if(this.getMode()!=="translation"){if(n.translatable&&!n._changed&&n._translatedPlaceholder&&!this._currentLayerManifestChanges[n.manifestpath]&&!this._currentLayerManifestChanges[s]){continue}else{t[n.manifestpath]=n.value;if(n.valueItems){t[n.manifestpath.substring(0,n.manifestpath.lastIndexOf("/"))+"/valueItems"]=n.valueItems}}}else if(n.translatable&&n.value){t[n.manifestpath]=n.value}if(n._next&&this.getAllowSettings()){var r=typeof n.visibleToUser==="undefined"?true:n.visibleToUser;var o=typeof n.editableToUser==="undefined"?true:n.editableToUser;if(n._next.visible===!r){i=i||{};i[n._settingspath+"/visible"]=n._next.visible}if(n._next.editable===!o){i=i||{};i[n._settingspath+"/editable"]=n._next.editable}if(n._next.pageAdminValues){i=i||{};i[n._settingspath+"/pageAdminValues"]=n._next.pageAdminValues}if(typeof n._next.allowDynamicValues==="boolean"&&this.getAllowDynamicValues()){i=i||{};i[n._settingspath+"/allowDynamicValues"]=n._next.allowDynamicValues}}}}}if(this.getMode()!=="translation"){t[":multipleLanguage"]=true}t[":layer"]=B.layers[this.getMode()];t[":errors"]=this.checkCurrentSettings()[":errors"];if(i){t[":designtime"]=i}return t};z.prototype.checkCurrentSettings=function(){var e=this._settingsModel.getProperty("/"),t={};if(e&&e.form&&e.form.items){for(var i in e.form.items){var a=e.form.items[i];if(a.editable){if((a.isValid||a.required)&&!(this.getMode()==="translation"&&a.translatable)){if(a.isValid){t[a.manifestpath]=a.isValid(a)}t[a.manifestpath]=true;var n=a.value;var s=a.type;if(s==="string"&&n===""){t[a.manifestpath]=n}if((s==="date"||s==="datetime")&&isNaN(Date.parse(n))){t[a.manifestpath]=n}if(s==="integer"){if(isNaN(parseInt(n))){t[a.manifestpath]=n}else if(n<a.min||n>a.max){t[a.manifestpath]=n}}if(s==="number"){if(isNaN(parseFloat(n))){t[a.manifestpath]=n}else if(n<a.min||n>a.max){t[a.manifestpath]=n}}}}}t[":layer"]=B.layers[this.getMode()]}t[":errors"]=Object.values(t).indexOf(false)>-1;return t};z.prototype._createContextModel=function(){var e=this.getHostInstance(),t=new d({}),i=new d([]);this.setModel(t,"context");this.setModel(i,"contextflat");t._aPendingPromises=[];i._getPathObject=function(e){var t=this.getData().filter(function(t){if(t.path===e){return true}});return t.length?t[0]:null};i._getValueObject=function(e){var t=this.getData()||[];t=t.filter(function(t){if(t.value===e||t.object.value===e){return true}});return t.length?t[0]:null};var a=new Promise(function(t,i){if(e&&e.getContext){var a=false;setTimeout(function(){if(a){return}T.error("Editor context could not be determined with "+K+".");a=true;t({})},K);e.getContext().then(function(e){if(a){T.error("Editor context returned after more than "+K+". Context is ignored.")}a=true;t(e||{})})}else{t({})}});a.then(function(e){var a=this._mergeContextData(e);t.setData(a);i.setData(this.flattenData(a,"label"))}.bind(this));t.getProperty=function(t,i){if(t&&!t.startsWith("/")&&!i){t="/"+t}var a=this.resolve(t,i),n;if(a.endsWith("/value")){this._mValues=this._mValues||{};if(this._mValues.hasOwnProperty(a)){return this._mValues[a]}this._mValues[a]=undefined;n=f.timeoutPromise(e.getContextValue(a.substring(1)));n=n.then(function(e){this._mValues[a]=e;this.checkUpdate()}.bind(this)).catch(function(e){this._mValues[a]=null;this.checkUpdate();T.error("Path "+a+" could not be resolved. Reason: "+e)}.bind(this));this._aPendingPromises.push(n);return undefined}else{return d.prototype.getProperty.apply(this,arguments)}}};z.prototype._mergeContextData=function(e){var t={};t["empty"]=z._contextEntries.empty;for(var i in e){t[i]=e[i]}t["editor.internal"]=z._contextEntries["editor.internal"];return t};z.prototype._loadValueContextInDesigntime=function(){var e=this.getModel("context");var t=this._oDesigntimeInstance.getSettings();var i;if(t&&t.form&&t.form.items){i=JSON.stringify(t.form.items)}if(i){var a=/\{context\>[\/?\w+.]+\}/g;var n=i.match(a);var s;if(n&&n.length>0){n=n.filter(function(e){return e.endsWith("value}")});s=n.map(function(e){return e.substring("{context>".length,e.length-1)});s.forEach(function(t){e.getProperty(t)});return Promise.all(e._aPendingPromises).then(function(){e._aPendingPromises=[]})}}return Promise.resolve()};z.fieldMap={string:"sap/ui/integration/editor/fields/StringField",integer:"sap/ui/integration/editor/fields/IntegerField",number:"sap/ui/integration/editor/fields/NumberField",boolean:"sap/ui/integration/editor/fields/BooleanField",date:"sap/ui/integration/editor/fields/DateField",datetime:"sap/ui/integration/editor/fields/DateTimeField","string[]":"sap/ui/integration/editor/fields/ListField",destination:"sap/ui/integration/editor/fields/DestinationField"};z.Fields=null;z.prototype._requireFields=function(){if(z.Fields){return Promise.resolve()}return new Promise(function(e){sap.ui.require(Object.values(z.fieldMap),function(){z.Fields={};for(var t in z.fieldMap){z.Fields[t]=arguments[Object.keys(z.fieldMap).indexOf(t)]}e()})})};z.prototype._createDescription=function(e){var t=new v({src:"sap-icon://message-information",color:"Marker",size:"12px",useIconTooltip:false,visible:e.visible,objectBindings:{currentSettings:{path:"currentSettings>"+e._settingspath},items:{path:"items>/form/items"},context:{path:"context>/"}}});t.addStyleClass("sapUiIntegrationEditorDescriptionIcon");t.onmouseover=function(t){this._getPopover().getContent()[0].applySettings({text:e.description});this._getPopover().openBy(t);t.addDependent(this._getPopover())}.bind(this,t);t.onmouseout=function(e){this._getPopover().close();e.removeDependent(this._getPopover())}.bind(this,t);return t};z.prototype._createMessageIcon=function(e){var t=e.getConfiguration();var i=new v({src:"sap-icon://message-information",size:"12px",visible:t.visible,useIconTooltip:false,objectBindings:{currentSettings:{path:"currentSettings>"+t._settingspath},items:{path:"items>/form/items"},context:{path:"context>/"}}});i.onmouseover=function(e){e._showMessage()}.bind(this,e);i.onmouseout=function(e){e._hideMessage()}.bind(this,e);i.addStyleClass("sapUiIntegrationEditorMessageIcon");return i};z.prototype._createLabel=function(e){var t=new h({text:e.label,tooltip:e.tooltip||e.label,required:e.required&&e.editable||false,visible:e.visible,objectBindings:{currentSettings:{path:"currentSettings>"+e._settingspath},items:{path:"items>/form/items"},context:{path:"context>/"}}});t._cols=e.cols||2;if(e.layout){t._layout=e.layout}t._sOriginalType=e.type;return t};z.prototype._createSettingsButton=function(e){var t=e.getConfiguration();var i=new W({icon:"{= ${currentSettings>_hasDynamicValue} ? 'sap-icon://display-more' : 'sap-icon://enter-more'}",type:"Transparent",tooltip:this._oResourceBundle.getText("EDITOR_FIELD_MORE_SETTINGS"),press:function(t){this._openSettingsDialog(200,t.oSource,e)}.bind(this),visible:t.visible,objectBindings:{currentSettings:{path:"currentSettings>"+t._settingspath},items:{path:"items>/form/items"},context:{path:"context>/"}}});return i};z.prototype._getSettingsPanel=function(e){if(!e._oSettingsPanel){e._oSettingsPanel=new U}return e._oSettingsPanel};z.prototype._openSettingsDialog=function(e,t,i){var a=this._getSettingsPanel(i);window.setTimeout(function(){a.setConfiguration(i.getConfiguration());var e=this.getAggregation("_preview");a.open(t,t,e,i.getHost(),i,i._applySettings.bind(i),i._cancelSettings.bind(i))}.bind(this),e||600)};z.prototype._getPopover=function(){if(this._oPopover){return this._oPopover}var e=new I({text:""});e.addStyleClass("sapUiTinyMargin sapUiIntegrationEditorDescriptionText");this._oPopover=new y({showHeader:false,content:[e]});this._oPopover.addStyleClass("sapUiIntegrationEditorPopover");return this._oPopover};z.prototype._createField=function(e){var t=new z.Fields[e.type]({configuration:e,mode:this.getMode(),host:this.getHostInstance(),objectBindings:{currentSettings:{path:"currentSettings>"+e._settingspath},items:{path:"items>/form/items"},context:{path:"context>/"}},visible:e.visible});this._aFieldReadyPromise.push(t._readyPromise.then(function(){if(e.require||e.validation||e.validations&&e.validations.length>0||e.values&&e.values.data&&!e.values.data.json){var i=this._createMessageIcon(t);t.setAssociation("_messageIcon",i)}if(e.description&&this.getMode()!=="translation"){t._descriptionIcon=this._createDescription(e)}if(e._changeDynamicValues){t._settingsButton=this._createSettingsButton(t);t._applyButtonStyles()}}.bind(this)));var i=this._settingsModel.bindProperty(e._settingspath+"/value");i.attachChange(function(){if(!this._bIgnoreUpdates){e._changed=true;if(e._dependentFields&&e._dependentFields.length>0){this._updateEditor(e._dependentFields)}this._updatePreview()}}.bind(this));if(t.isFilterBackend()){var a=this._settingsModel.bindProperty(e._settingspath+"/suggestValue");a.attachChange(function(){var i=r({},e);i._cancel=false;this._addValueListModel(i,t,true)}.bind(this))}this._addValueListModel(e,t);t._cols=e.cols||2;if(e.layout){t._layout=e.layout}t._oDataProviderFactory=this._oDataProviderFactory;t.setAssociation("_messageStrip",this.getAggregation("_messageStrip"));return t};z.prototype._updateEditor=function(e){if(this._ready){if(e.length===0){return}for(var t=0;t<e.length;t++){var i=e[t];i.config._cancel=true}if(!this._oDataProviderFactory){return}this._bIgnoreUpdates=true;for(var t=0;t<e.length;t++){var i=e[t];i.config._cancel=false;this._addValueListModel(i.config,i.field,true,500*t)}this._bIgnoreUpdates=false}};z.prototype._updatePreview=function(){var e=this.getAggregation("_preview");if(e&&e.update){e.update()}};z.prototype._requestData=function(e,t){var i=this._oDataProviderFactory.create(e.values.data);i.bindObject({path:"items>/form/items"});i.bindObject({path:"currentSettings>"+e._settingspath});i.bindObject({path:"context>/"});var a=i.getData();a.then(function(i){if(e._cancel){e._values=[];this._settingsModel.setProperty(e._settingspath+"/_loading",false);return}var a=e.values.data.path,n,s=[];if(a&&a!=="/"){if(a.startsWith("/")){a=a.substring(1)}if(a.endsWith("/")){a=a.substring(0,a.length-1)}n=a.split("/");s=w.get(n,i)}else{s=i}if(this.getMode()==="content"&&e.pageAdminValues&&e.pageAdminValues.length>0){var r=e.pageAdminValues,o=e.value,l=e.valueItems,d=[],f=[],u=[];this.prepareFieldsInKey(e);if(r.length>0){for(var g=0;g<r.length;g++){for(var h=0;h<s.length;h++){var p=this.getKeyFromItem(s[h]);if(r[g]===p){d.push(s[h])}}if(Array.isArray(o)){for(var c=0;c<o.length;c++){if(r[g]===o[c]){f.push(o[c])}}for(var _=0;_<l.length;_++){var m=this.getKeyFromItem(l[_]);if(r[g]===m){u.push(l[_])}}}}if(f.length>0){e.value=[];e.value=f}if(u.length>0){e.valueItems=[];e.valueItems=u}}if(e.values.data.path&&e.values.data.path!=="/"){delete i[n];w.set(n,d,i)}else{i=[];i=d}}var v=t.getConfiguration();if(e.type==="string[]"){var y=e.values.data.path;if(y&&y!=="/"){if(y.startsWith("/")){y=y.substring(1)}if(y.endsWith("/")){y=y.substring(0,y.length-1)}var n=y.split("/");var b=w.get(n,i);if(Array.isArray(b)){for(var I in b){var T=t.getKeyFromItem(b[I]);if(Array.isArray(v.value)&&v.value.length>0&&R(v.value,T)){b[I].Selected=this._oResourceBundle.getText("EDITOR_ITEM_SELECTED")}else{b[I].Selected=this._oResourceBundle.getText("EDITOR_ITEM_UNSELECTED")}}w.set(n,b,i)}}else if(Array.isArray(i)){for(var I in i){var T=t.getKeyFromItem(i[I]);if(Array.isArray(v.value)&&v.value.length>0&&R(v.value,T)){i[I].Selected=this._oResourceBundle.getText("EDITOR_ITEM_SELECTED")}else{i[I].Selected=this._oResourceBundle.getText("EDITOR_ITEM_UNSELECTED")}}}}e._values=i;var M=t.getModel();M.setData(i);M.checkUpdate(true);M.firePropertyChange();this._settingsModel.setProperty(e._settingspath+"/_loading",false);t._hideValueState(true,true)}.bind(this)).catch(function(i){this._settingsModel.setProperty(e._settingspath+"/_loading",false);var a=this._oResourceBundle.getText("EDITOR_BAD_REQUEST");if(Array.isArray(i)&&i.length>0){a=i[0];var n=i[1];if(n){var s;if(n.responseJSON){s=n.responseJSON.error}else if(n.responseText){if(f.isJson(n.responseText)){s=JSON.parse(n.responseText).error}else{a=n.responseText}}if(s){a=(s.code||s.errorCode||n.status)+": "+s.message}}}else if(typeof i==="string"){a=i}var r=t.getModel();r.firePropertyChange();t._showValueState("error",a,true)}.bind(this))};z.prototype._requestExtensionData=function(){var e=this.getAggregation("_extension");if(!e){T.info("Extension is not defined or created, do not load data of it.");return new Promise(function(e,t){e()})}var t=false;var i={};var a=this._oEditorManifest.get(this.getConfigurationPath()+"/data/extension");var n;if(a){t=true;n=this._oEditorManifest.get(this.getConfigurationPath()+"/data/path");i={extension:a};if(n){i.path=n}}else{a=this._oEditorManifest.get("/"+this.getSection()+"/data/extension");if(a){t=true;n=this._oEditorManifest.get("/"+this.getSection()+"/data/path");i={extension:a};if(n){i.path=n}}}if(!t){T.info("Extension data is not defined in manifest, do not load data of it.");return new Promise(function(e,t){e()})}var s=this._oDataProviderFactory.create(i);var r=s.getData();return r.then(function(t){var i=e.getModel();if(!i){i=new d(t||{});e.setModel(i,undefined)}else{i.setData(t)}i.checkUpdate(true)}).catch(function(e){var t=this._oResourceBundle.getText("EDITOR_BAD_REQUEST");if(Array.isArray(e)&&e.length>0){t=e[0];var i=e[1];if(i){var a;if(i.responseJSON){a=i.responseJSON.error}else if(i.responseText){if(f.isJson(i.responseText)){a=JSON.parse(i.responseText).error}else{t=i.responseText}}if(a){t=(a.code||a.errorCode||i.status)+": "+a.message}}}else if(typeof e==="string"){t=e}T.error("Request extension data failed, "+t)}.bind(this))};z.prototype._addValueListModel=function(e,t,i,a){if(e.values){var n;if(e.values.data){if(this._oDataProviderFactory){n=t.getModel();if(!n){n=new d({});t.setModel(n,undefined)}this._settingsModel.setProperty(e._settingspath+"/_loading",true);if(!a){this._requestData(e,t)}else{setTimeout(function(){this._requestData(e,t)}.bind(this),a)}}t.bindObject({path:e.values.data.path||"/"})}else if(this.getAggregation("_extension")){n=this.getAggregation("_extension").getModel();if(n&&this.getMode()==="content"&&e.pageAdminValues&&e.pageAdminValues.length>0){this.prepareFieldsInKey(e);var s=e.values.path;if(s.length>1){s=s.substring(1)}var o=w.get([s],n.getData()),l=e.pageAdminValues,f=[];for(var u=0;u<l.length;u++){for(var g=0;g<o.length;g++){var h=this.getKeyFromItem(o[g]);if(l[u]===h){f.push(o[g])}}}delete o[s];w.set(s,f,o);n.setData(o)}t.bindObject({path:e.values.path||"/"});t.setModel(n,undefined)}if(!i){var p=JSON.stringify(e.values.data);if(p){var c=/parameters\.([^\}\}]+)|destinations\.([^\}\}]+)|\{items\>[\/?\w+]+\}/g,_=p.match(c);if(_){for(var m=0;m<_.length;m++){var v="/value";var y=this.getConfigurationPath();if(_[m].indexOf("destinations.")===0||_[m].indexOf("parameters.")===0){if(_[m].indexOf("destinations.")===0){v="/name"}y=y+_[m].replace(".","/")+"/"+v}else if(_[m].indexOf("{items>")===0){y=y+"/parameters/"+_[m].slice(7,-1)}var b=this._mItemsByPaths[y];if(b){if(b._settingspath===e._settingspath){e=r({},e)}b._dependentFields=b._dependentFields||[];b._dependentFields.push({field:t,config:e})}}}}}}};z.prototype._addItem=function(e){var t=this.getMode();if(this.getAllowDynamicValues()===false||!e.allowDynamicValues){e.allowDynamicValues=false}if(this.getAllowSettings()===false){e.allowSettings=false}e.__cols=e.cols||2;if(e.visible===false||!e.translatable&&t==="translation"&&e.type!=="group"){return}if(e.type==="group"){var a=new c({headerText:e.label,visible:e.visible,expandable:e.expandable!==false,expanded:e.expanded!==false,width:"auto",backgroundDesign:"Transparent",objectBindings:{currentSettings:{path:"currentSettings>"+e._settingspath},items:{path:"items>/form/items"},context:{path:"context>/"}},expand:function(e){var t=e.getSource();if(!e.mParameters.expand&&t.getParent().getAggregation("_messageStrip")!==null){G=t.getParent().getAggregation("_messageStrip").getId()}if(e.mParameters.expand){var a=i.byId(G);t.addContent(a);t.focus()}}});this.addAggregation("_formContent",a);a._cols=e.cols||2;if(e.hint){this._addHint(e.hint)}return}if(e.type==="separator"){var s=new L;this.addAggregation("_formContent",s);return}var r=null;if(t==="translation"){if(typeof e.value==="string"&&e.value.indexOf("{")===0||typeof e.values!=="undefined"){return}e._language={value:e.value};e.cols=1;delete e.values;var o=n(e,500);o._settingspath+="/_language";o.editable=false;o.required=false;if(!o.value){o.value="-"}var l=this._createLabel(o);this.addAggregation("_formContent",l);var d=this._createField(o);d.isOrigLangField=true;this.addAggregation("_formContent",d);e.value=e._translatedValue||"";e.editable=e.visible=e.translatable;if(this._currentLayerManifestChanges){e.value=this._currentLayerManifestChanges[e.manifestpath]||e.value}e.label=e._translatedLabel||"";e.required=false;var d=this._createField(e);this.addAggregation("_formContent",d)}else{r=this._createLabel(e);this.addAggregation("_formContent",r);if(this._currentLayerManifestChanges){e.value=this._currentLayerManifestChanges[e.manifestpath]||e.value}var d=this._createField(e);this.addAggregation("_formContent",d)}if(e.hint&&(!e.cols||e.cols===2)){this._addHint(e.hint)}e.cols=e.__cols;delete e.__cols};z.prototype._createHint=function(e){e=e.replace(/<a href/g,"<a target='blank' href");var t=new O({htmlText:e});return t};z.prototype._addHint=function(e){var t=this._createHint(e);this.addAggregation("_formContent",t)};z.prototype._getCurrentLanguageSpecificText=function(e){var t=this._language;if(this._oTranslationBundle){var i=this._oTranslationBundle.getText(e,[],true);if(i===undefined){return""}return i}if(!t){return""}var a=this._oEditorManifest.get("/sap.app/i18n");if(!a){return""}if(typeof a==="string"){var n=[t];if(t.indexOf("-")>-1){n.push(t.substring(0,t.indexOf("-")))}if(!R(n,"en")){n.push("en")}this._oTranslationBundle=D.create({url:this.getBaseUrl()+a,async:false,locale:t,supportedLocales:n,fallbackLocale:"en"});return this._getCurrentLanguageSpecificText(e)}};z.prototype._startEditor=function(){var e=this.getAggregation("_formContent");if(e&&e.length>0){this.destroyAggregation("_formContent")}var t=this._settingsModel.getProperty("/");var a;if(t.form&&t.form.items){a=t.form.items;var n=this._language||this.getLanguage()||i.getConfiguration().getLanguage().replaceAll("_","-");if(this.getMode()==="translation"){this._addItem({type:"group",translatable:true,expandable:false,label:this._oResourceBundle.getText("EDITOR_ORIGINALLANG")+": "+z._languages[n]})}var s=false;for(var r in a){var o=a[r];if(o.type==="group"){break}else if(o.visible){s=true;break}}if(s){this._addItem({type:"group",translatable:true,label:this._oResourceBundle.getText("EDITOR_PARAMETERS_GENERALSETTINGS")})}this._mItemsByPaths={};for(var l in a){var o=a[l];if(o){o.label=o.label||l;var d;if(o.manifestpath){this._mItemsByPaths[o.manifestpath]=o;d=this._currentLayerManifestChanges[o.manifestpath]}o._changed=d!==undefined&&this.getMode()!=="translation";if(o.values){o.translatable=false}o._beforeValue=this._getManifestBeforelValue(o.manifestpath);if(o.type==="string"){o._translatedDefaultPlaceholder=this._getManifestDefaultValue(o.manifestpath);var f=null,u=o._translatedDefaultPlaceholder;if(u){if(this._isValueWithParameterSyntax(u)){o.translatable=false}if(this._isValueWithHandlebarsTranslation(u)){f=u.substring(2,u.length-2)}else if(u.startsWith("{i18n>")){f=u.substring(6,u.length-1)}if(f){o.translatable=true}}o._translatedPlaceholder=o._beforeValue;f=null;u=o._translatedPlaceholder;if(u){if(this._isValueWithParameterSyntax(u)){o.translatable=false}if(this._isValueWithHandlebarsTranslation(u)){f=u.substring(2,u.length-2)}else if(u.startsWith("{i18n>")){f=u.substring(6,u.length-1)}if(f){o._translatedValue=this.getModel("i18n").getResourceBundle().getText(f);if(o._changed){o.value=d}else{o.value=o._translatedValue}if(o.valueTranslations&&o.valueTranslations[n]){o.value=o.valueTranslations[n]}if(this.getMode()==="translation"){o._translatedValue=this._getCurrentLanguageSpecificText(f)}}else if(o.translatable&&this.getMode()==="translation"){o._translatedValue=o._translatedPlaceholder;o.value=o._beforeValue}else{o.value=o._beforeValue}}if(this.getMode()==="translation"){if(o.valueTranslations&&o.valueTranslations[n]){o._translatedValue=o.valueTranslations[n]}if(this._isValueWithHandlebarsTranslation(o.label)){o._translatedLabel=this._getCurrentLanguageSpecificText(o.label.substring(2,o.label.length-2),true)}else if(o.label&&o.label.startsWith("{i18n>")){o._translatedLabel=this._getCurrentLanguageSpecificText(o.label.substring(6,o.label.length-1),true)}}}else if(o.type==="string[]"){var g=o.manifestpath.substring(0,o.manifestpath.lastIndexOf("/"))+"/valueItems";var h=this._manifestModel.getProperty(g);if(h){o.valueItems=h}}if(o.label&&this._isValueWithHandlebarsTranslation(o.label)){var p=o.label.substring(2,o.label.length-2);if(p){o.label=this.getModel("i18n").getResourceBundle().getText(p)}}}}}for(var l in a){var o=a[l];this._addItem(o)}if(this.getMode()!=="translation"){Promise.resolve(this._initPreview()).then(function(){Promise.all(this._aFieldReadyPromise).then(function(){this._ready=true;this.fireReady()}.bind(this))}.bind(this))}else{Promise.all(this._aFieldReadyPromise).then(function(){this._ready=true;this.fireReady()}.bind(this))}};z.prototype.destroy=function(){if(this._oPopover){this._oPopover.destroy()}if(this._oDesigntimeInstance){this._oDesigntimeInstance.destroy()}var e=this.getAggregation("_preview");if(e&&e.destroy){e.destroy()}var a=i.byId(G);if(a){a.destroy()}this._manifestModel=null;this._beforeManifestModel=null;this._oInitialManifestModel=null;this._settingsModel=null;t.prototype.destroy.apply(this,arguments)};z.prototype._initPreview=function(){return new Promise(function(e,t){e()})};z.prototype._applyDesigntimeDefaults=function(e){e=e||{};e.form=e.form||{};e.form.items=e.form.items||{};var t=e.form.items||e.form.items;for(var i in t){var a=t[i];if(a.manifestpath){a.value=this._manifestModel.getProperty(a.manifestpath)}if(a.visible===undefined||a.visible===null){a.visible=true}if(a.editable===undefined||a.editable===null){a.editable=true}if(this.getMode()!=="admin"){if(a.visibleToUser!==undefined){a.visible=a.visibleToUser}if(a.editableToUser!==undefined){a.editable=a.editableToUser}}if(typeof a.translatable!=="boolean"){a.translatable=false}if(!a.label){a.label=i}if(!a.type||a.type==="enum"){a.type="string"}if(a.value===undefined||a.value===null){switch(a.type){case"boolean":a.value=false;break;case"integer":case"number":a.value=0;break;case"string[]":a.value=[];break;default:a.value=""}}if(a.type==="group"){if(a.visible===undefined||a.value===null){a.visible=true}}a._settingspath="/form/items/"+i}};z.prototype._applyDesigntimeLayers=function(e){if(this._appliedLayerManifestChanges&&Array.isArray(this._appliedLayerManifestChanges)){for(var t=0;t<this._appliedLayerManifestChanges.length;t++){var i=this._appliedLayerManifestChanges[t][":designtime"];if(i){var a=Object.keys(i);for(var n=0;n<a.length;n++){this._settingsModel.setProperty(a[n],i[a[n]])}}}}if(this._currentLayerManifestChanges){var i=this._currentLayerManifestChanges[":designtime"];if(i){var a=Object.keys(i);for(var n=0;n<a.length;n++){var s=a[n],r=s.substring(0,s.lastIndexOf("/")+1)+"_next";if(!this._settingsModel.getProperty(r)){this._settingsModel.setProperty(r,{})}var r=s.substring(0,s.lastIndexOf("/")+1)+"_next",o=s.substring(s.lastIndexOf("/")+1);this._settingsModel.setProperty(r+"/"+o,i[a[n]])}}}};z.prototype._createParameterDesigntime=function(e){var t={},i=this.getConfigurationPath()+"/parameters",a=this.getMode();if(e&&e.parameters){t.form=t.form||{};t.form.items=t.form.items||{};var n=t.form.items;Object.keys(e.parameters).forEach(function(t){n[t]=r({manifestpath:i+t+"/value",editable:a!=="translation",_settingspath:"/form/items/"+t},e.parameters[t]);var s=n[t];if(!s.type){s.type="string"}if(!s.hasOwnProperty("visible")){s.visible=true}})}return new l(t)};z.prototype._addDestinationSettings=function(e){var t=this._oDesigntimeInstance.getSettings(),i=this.getConfigurationPath()+"/destinations";t.form=t.form||{};t.form.items=t.form.items||{};if(t&&e&&e.destinations){if(!t.form.items["destination.group"]){t.form.items["destination.group"]={label:this._oResourceBundle.getText("EDITOR_DESTINATIONS")||"Destinations",type:"group",visible:true}}var a=t.form.items,n=this.getHostInstance();Object.keys(e.destinations).forEach(function(t){a[t+".destinaton"]=r({manifestpath:i+"/"+t+"/name",visible:true,type:"destination",editable:true,allowDynamicValues:false,allowSettings:false,value:e.destinations[t].name,defaultValue:e.destinations[t].defaultUrl,_settingspath:"/form/items/"+[t+".destinaton"],_values:[],_destinationName:t},e.destinations[t]);if(typeof a[t+".destinaton"].label==="undefined"){a[t+".destinaton"].label=t}if(n){a[t+".destinaton"]._loading=true}});var s=false;if(n){this.getHostInstance().getDestinations().then(function(t){s=true;Object.keys(e.destinations).forEach(function(e){a[e+".destinaton"]._values=t;a[e+".destinaton"]._loading=false;this._settingsModel.checkUpdate(true)}.bind(this))}.bind(this)).catch(function(){return this.getHostInstance().getDestinations()}.bind(this)).then(function(t){if(s){return}Object.keys(e.destinations).forEach(function(e){a[e+".destinaton"]._values=t;a[e+".destinaton"]._loading=false;this._settingsModel.checkUpdate(true)}.bind(this))}.bind(this)).catch(function(t){Object.keys(e.destinations).forEach(function(e){a[e+".destinaton"]._loading=false;this._settingsModel.checkUpdate(true)}.bind(this));T.error("Can not get destinations list from '"+n.getId()+"'.")}.bind(this))}}};z.prototype._getManifestDefaultValue=function(e){return this._oInitialManifestModel.getProperty(e)};z.prototype._getManifestBeforelValue=function(e){return this._beforeManifestModel.getProperty(e)};z.prototype._isValueWithHandlebarsTranslation=function(e){if(typeof e==="string"){return!!e.match(q)}return false};z.prototype._isValueWithParameterSyntax=function(e){if(typeof e==="string"){return!!e.match(J)}return false};z._contextEntries={empty:{label:X.getText("EDITOR_CONTEXT_EMPTY_VAL"),type:"string",description:X.getText("EDITOR_CONTEXT_EMPTY_DESC"),placeholder:"",value:""},"editor.internal":{label:X.getText("EDITOR_CONTEXT_EDITOR_INTERNAL_VAL"),todayIso:{type:"string",label:X.getText("EDITOR_CONTEXT_EDITOR_TODAY_VAL"),description:X.getText("EDITOR_CONTEXT_EDITOR_TODAY_DESC"),tags:[],placeholder:X.getText("EDITOR_CONTEXT_EDITOR_TODAY_VAL"),customize:["format.dataTime"],value:"{{parameters.TODAY_ISO}}"},nowIso:{type:"string",label:X.getText("EDITOR_CONTEXT_EDITOR_NOW_VAL"),description:X.getText("EDITOR_CONTEXT_EDITOR_NOW_DESC"),tags:[],placeholder:X.getText("EDITOR_CONTEXT_EDITOR_NOW_VAL"),customize:["dateFormatters"],value:"{{parameters.NOW_ISO}}"},currentLanguage:{type:"string",label:X.getText("EDITOR_CONTEXT_EDITOR_LANG_VAL"),description:X.getText("EDITOR_CONTEXT_EDITOR_LANG_VAL"),tags:["technical"],customize:["languageFormatters"],placeholder:X.getText("EDITOR_CONTEXT_EDITOR_LANG_VAL"),value:"{{parameters.LOCALE}}"}}};z._languages={};z._appendThemeVars=function(){var e=["sapUiButtonHoverBackground","sapUiBaseBG","sapUiContentLabelColor","sapUiTileSeparatorColor","sapUiHighlight","sapUiListSelectionBackgroundColor","sapUiNegativeText","sapUiCriticalText","sapUiPositiveText","sapUiChartScrollbarBorderColor"];var t=S.get({name:e,callback:function(e){}});if(t){for(var i in t){document.body.style.setProperty("--"+i,t[i])}}};z.prototype.prepareFieldsInKey=function(e){this._sKeySeparator=e.values.keySeparator;if(!this._sKeySeparator){this._sKeySeparator="#"}var t=e.values.item.key;this._aFields=t.split(this._sKeySeparator);for(var i in this._aFields){if(this._aFields[i].startsWith("{")){this._aFields[i]=this._aFields[i].substring(1)}if(this._aFields[i].endsWith("}")){this._aFields[i]=this._aFields[i].substring(0,this._aFields[i].length-1)}}};z.prototype.getKeyFromItem=function(e){var t="";this._aFields.forEach(function(i){t+=e[i].toString()+this._sKeySeparator}.bind(this));if(t.endsWith(this._sKeySeparator)){t=t.substring(0,t.length-this._sKeySeparator.length)}return t};z.init=function(){this.init=function(){};z._appendThemeVars();i.attachThemeChanged(function(){z._appendThemeVars()});if(x.browser.firefox){document.body.style.setProperty("--sapUiIntegrationEditorPopupHeight","-moz-fit-content")}var e=sap.ui.require.toUrl("sap.ui.integration.editor.css.Editor".replace(/\./g,"/")+".css");E(e);P.loadResource("sap/ui/integration/editor/languages.json",{dataType:"json",failOnError:false,async:true}).then(function(e){z._languages=e})};z.init();return z});