/*!
 * OpenUI5
 * (c) Copyright 2009-2022 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/integration/editor/fields/BaseField","sap/m/Text","sap/m/TextArea","sap/m/Input","sap/m/NavContainer","sap/m/Page","sap/m/Popover","sap/m/OverflowToolbar","sap/m/ToolbarSpacer","sap/m/Button","sap/ui/model/json/JSONModel","sap/ui/table/Table","sap/ui/table/Column","sap/m/Label","sap/m/VBox","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/base/util/deepEqual","sap/ui/core/Icon","sap/m/Switch","sap/m/CheckBox","sap/m/MessageBox","sap/m/MessageToast","sap/base/util/deepClone","sap/m/Link","sap/ui/layout/form/SimpleForm","sap/base/util/merge","sap/m/List","sap/m/CustomListItem","sap/ui/model/Sorter","sap/ui/core/CustomData","sap/ui/integration/editor/EditorResourceBundles","sap/base/util/includes","sap/ui/integration/util/Utils"],function(e,t,a,r,n,i,o,l,s,u,d,p,g,_,f,c,v,T,b,h,O,y,E,P,m,D,I,L,S,C,V,x,w,A){"use strict";var B=/\{\{(?!parameters.)(?!destinations.)([^\}\}]+)\}\}/g;var R=e.extend("sap.ui.integration.editor.fields.ObjectField",{metadata:{library:"sap.ui.integration"},renderer:e.getMetadata().getRenderer()});R.prototype.initVisualization=function(e){var t=this;t._newObjectTemplate={_dt:{_selected:true,_uuid:""}};var a=e.visualization;if(!a){if(e.value&&!e.properties&&(!e.values||e.values&&!e.values.metadata)){t.parseValueProperties()}if(e.values){a=t.createTableVisualization(e)}else if(e.properties){a=t.createSimpleFormVisualization(e)}else{a=t.createTextAreaVisualization(e)}e.withLabel=true}this._visualization=a;this.attachAfterInit(this._afterInit)};R.prototype._afterInit=function(){var e=this;var t=this.getAggregation("_field");if(t instanceof D){t.addStyleClass("sapUiIntegrationEditorItemObjectFieldForm");var a=P(e.getConfiguration().value,500)||{};t.setModel(new d({value:a,editMode:"Properties"}))}else if(t instanceof p){t.addStyleClass("sapUiIntegrationEditorItemObjectFieldTable")}};R.prototype.parseValueProperties=function(){var e=this;var t=e.getConfiguration();if(typeof t.value==="object"&&!T(t.value,{})&&!Array.isArray(t.value)&&!t.properties){var a={};for(var r in t.value){if(r!=="_dt"){var n=typeof t.value[r];var i=n==="string"?{}:{type:n};a[r]=i}}if(!T(a,{})){t.properties=a;t._propertiesParsedFromValue=true}}};R.prototype.createTableVisualization=function(e){var t=this;var a=t.createTableToolbar(e);var r=[];var n=e.values?e.values.data.path||"/":"/value";if(e.values&&e.values.metadata){r={path:"meta>/"+e.values.metadata.namespace+"."+e.values.metadata.entityTypeName,filters:new c({path:"$kind",operator:v.EQ,value1:"Property"}),factory:t.columnFactory.bind(t)}}else{r=t.buildTableColumns()}var i={type:p,settings:{rows:"{"+n+"}",visibleRowCount:5,busy:"{currentSettings>_loading}",columns:r,selectionBehavior:"RowOnly",rowSelectionChange:t.onTableSelectionChange.bind(t),toolbar:a,filter:t.onFilter.bind(t)}};return i};R.prototype.createSimpleFormVisualization=function(e){var t=this;var a=t.getResourceBundle();var r=function(){var e=this.getAggregation("_field").getModel();e.checkUpdate(true);var t=e.getProperty("/value");if(!t._dt){t._dt={_uuid:A.generateUuidV4()}}else if(!t._dt._uuid){t._dt._uuid=A.generateUuidV4()}t=P(t,500);this.setValue(t)}.bind(t);var n=t.createFormContents(r,"/value/",false,t.openTranslationPopup);var i=new u({icon:{path:"/editMode",formatter:function(e){if(e==="Properties"){return"sap-icon://syntax"}else{return"sap-icon://form"}}},tooltip:{path:"/editMode",formatter:function(e){if(e==="Properties"){return a.getText("EDITOR_FIELD_OBJECT_FORM_EDITMODE_JSON")}else{return a.getText("EDITOR_FIELD_OBJECT_FORM_EDITMODE_PROPERTIES")}}},press:function(){var e=t.getAggregation("_field").getModel();var a=e.getProperty("/editMode");if(a==="Properties"){e.setProperty("/editMode","Json")}else{e.setProperty("/editMode","Properties")}}});var o=new u({icon:"sap-icon://delete",tooltip:a.getText("EDITOR_FIELD_OBJECT_DELETE"),visible:e.enabled,enabled:{path:"currentSettings>value",formatter:function(e){if(!e||e===""){return false}return true}},press:function(e){t.setValue(undefined);var a=t.getAggregation("_field").getModel();var r=a.getProperty("/value");if(r&&r._dt&&r._dt._uuid){t.deleteTranslationValueInTexts(undefined,r._dt._uuid)}a.setProperty("/value",{});a.checkUpdate(true)}});var d={type:D,settings:{layout:"ResponsiveGridLayout",visible:e.visible,labelSpanXL:2,labelSpanL:2,labelSpanM:2,labelSpanS:12,emptySpanXL:1,emptySpanL:1,emptySpanM:1,emptySpanS:0,columnsXL:1,columnsL:1,columnsM:1,toolbar:new l({content:[new s,i,o]}).addStyleClass("sapMTB"),content:n}};return d};R.prototype.createTextAreaVisualization=function(e){var t=this;var r={type:a,settings:{value:{path:"currentSettings>value",formatter:function(e){if(!e||e===""){return undefined}e=JSON.stringify(e,null,"\t");if(typeof e==="object"&&!e.length){e=e.replace(/\"\$\$([a-zA-Z]*)\$\$\"/g,function(e){return e.substring(3,e.length-3)})}return e}},editable:"{config/editable}",width:"100%",enabled:"{config/enabled}",placeholder:"{config/placeholder}",visible:e.visible,change:this.onChangeOfTextArea.bind(t),rows:7}};return r};R.prototype.buildSelectionColumnLables=function(){var e=this;var t=e.getConfiguration();var a=e.getResourceBundle();return new u({icon:"sap-icon://clear-all",type:"Transparent",enabled:typeof t.values==="undefined"?false:"{/_hasSelected}",tooltip:a.getText("EDITOR_FIELD_OBJECT_TABLE_COLUMN_SELECTION_TOOLTIP_REMOVE"),press:e.onUnSelectAll.bind(e)})};R.prototype.buildTableColumns=function(){var e=this;var a=e.getConfiguration();var r=[];var n=Object.keys(a.properties);if(n.length>0){var i=e.getResourceBundle();var o=e.buildSelectionColumnLables();var l=new g({width:"3.2rem",hAlign:"Center",multiLabels:[o],template:new O({selected:"{_dt/_selected}",enabled:typeof a.values==="undefined"?false:true,tooltip:{path:"_dt/_selected",formatter:function(e){if(e){if(a.type==="object"){return i.getText("EDITOR_FIELD_OBJECT_TABLE_COLUMN_SELECTION_CELL_TOOLTIP_UNSELECT")}else{return i.getText("EDITOR_FIELD_OBJECT_LIST_TABLE_COLUMN_SELECTION_CELL_TOOLTIP_REMOVE")}}else if(a.type==="object"){return i.getText("EDITOR_FIELD_OBJECT_TABLE_COLUMN_SELECTION_CELL_TOOLTIP_SELECT")}else{return i.getText("EDITOR_FIELD_OBJECT_LIST_TABLE_COLUMN_SELECTION_CELL_TOOLTIP_ADD")}}},select:e.onSelectionChange.bind(e)})});r.push(l);for(var s in a.properties){var u=a.properties[s];var p=u.label||s;var _="{"+s+"}";if(u.defaultValue){e._newObjectTemplate[s]=u.defaultValue}var f={width:"7rem",label:p};if(u.column){f=I(f,u.column)}if(f.label.match(B)){f.label="{i18n>"+f.label.substring(2,f.label.length-1)}f.tooltip=f.label;var c=u.cell&&u.cell.type?u.cell.type:u.type||"Text";var v;var T;var y=P(u.cell)||{};delete y.type;switch(c){case"int":case"number":T={text:_,wrapping:false};T=I(T,y);v=new t(T);break;case"string":case"Text":T={text:_,wrapping:false};T=I(T,y);var E=T.text;var D=new d({translatable:u.translatable||false,property:s});if(typeof E==="string"){var L=e.getTranslationKey(E);if(L){T.text=i.getText(L)}else if(E.startsWith("{")&&E.endsWith("}")){T.text={path:E.substring(1,E.length-1),formatter:function(t){var a=this.getBindingContext(),r,n=this.getModel("settings").getData(),o=e.getTranslationKey(t);if(n.translatable||o){if(a&&a.getObject()&&a.getObject()._dt){r=e.getTranslationValueInTexts(i.sLocale.replaceAll("_","-"),a.getObject()._dt._uuid,n.property);if(r){return r}}if(o){t=i.getText(o);return t}}return t}}}}T.tooltip=y.tooltip||T.text;v=new t(T);v.setModel(D,"settings");break;case"Icon":T={src:_};T=I(T,y);v=new b(T);break;case"boolean":T={selected:_,enabled:false};T=I(T,y);v=new O(T);break;case"Switch":T={state:_,enabled:false};T=I(T,y);v=new h(T);break;case"Link":T={text:_,target:"_blank",href:_};T=I(T,y);v=new m(T);break;default:v=new t({text:_,wrapping:false});break}f.template=v;var S=new g(f);r.push(S)}}return r};R.prototype.checkHasFilterDefined=function(e){var t=true;if(e._propertiesParsedFromValue===true){t=false}else{var a=JSON.stringify(e.properties,null,"\t");t=a.indexOf("filterProperty")>-1?true:false}return t};R.prototype.createTableToolbar=function(e){var t=this;var a=t.getResourceBundle();var r=t.checkHasFilterDefined(e);var n=e.enabled!==false;var i=e.addButtonText||a.getText("EDITOR_FIELD_OBJECT_TABLE_BUTTON_ADD_TOOLTIP");if(n&&e.values){n=e.values.allowAdd===true}return new l({content:[new s,new u({icon:"sap-icon://add",visible:n,tooltip:i,press:t.addNewObject.bind(t)}),new u({icon:"sap-icon://edit",tooltip:a.getText("EDITOR_FIELD_OBJECT_TABLE_BUTTON_EDIT_TOOLTIP"),enabled:"{= !!${/_hasTableSelected}}",press:t.onEditOrViewDetail.bind(t)}),new u({icon:"sap-icon://delete",tooltip:a.getText("EDITOR_FIELD_OBJECT_DELETE"),enabled:"{= !!${/_canDelete}}",press:t.onDelete.bind(t)}),new b({src:"sap-icon://vertical-grip"}),new u({icon:"sap-icon://clear-filter",visible:r,enabled:"{= !!${/_hasFilter}}",tooltip:a.getText("EDITOR_FIELD_OBJECT_TABLE_BUTTON_CLEAR_ALL_FILTERS_TOOLTIP"),press:t.clearAllFilters.bind(t)}),new u({icon:"sap-icon://multiselect-all",enabled:"{= !${/_hasTableAllSelected}}",tooltip:a.getText("EDITOR_FIELD_OBJECT_TABLE_BUTTON_SELECT_ALL_SELETIONS_TOOLTIP"),press:t.selectAllTableSelections.bind(t)}),new u({icon:"sap-icon://multiselect-none",enabled:"{= !!${/_hasTableSelected}}",tooltip:a.getText("EDITOR_FIELD_OBJECT_TABLE_BUTTON_CLEAR_ALL_SELETIONS_TOOLTIP"),press:t.clearAllTableSelections.bind(t)})]})};R.prototype.onUnSelectAll=function(e){var t=this;var a=t.getAggregation("_field");var r=a.getBindingContext().getPath();var n=a.getModel();var i=n.getProperty(r);i.forEach(function(e){e._dt=e._dt||{};e._dt._selected=false});n.setProperty("/_hasSelected",false);n.checkUpdate(true);t.setValue(undefined)};R.prototype.onEditOrViewDetail=function(e){var t=this;var a=t.getAggregation("_field");var r=a.getSelectedIndex();var n=a.getBinding("rows").getContexts();var i=n[r].getObject();var o=a.getFirstVisibleRow();var l=a.getRows()[r-o];var s=l.getCells()[0];t.openObjectDetailsPopover(i,s,!i._dt||i._dt._editable!==false?"update":"view")};R.prototype.onFilter=function(e){var t=this;var a=t.getAggregation("_field");a.detachEvent("rowsUpdated",t.updateTable,t);a.attachEventOnce("rowsUpdated",t.updateTable,t)};R.prototype.updateTable=function(e){var t=this;t.updateSelectionColumn();t.updateToolbar()};R.prototype.updateSelectionColumn=function(){var e=this;var t=e.getAggregation("_field");var a=t.getBinding("rows").getContexts();var r=false;for(var n=0;n<a.length;n++){var i=a[n].getObject();if(i._dt&&i._dt._selected){r=true;break}}t.getModel().setProperty("/_hasSelected",r)};R.prototype.updateToolbar=function(){var e=this;var t=e.getAggregation("_field");var a=t.getColumns();var r=false;for(var n=0;n<a.length;n++){var i=a[n].getMenu();var o=i.getItems();if(o.length>0){var l=o[0];var s=l.getValue();if(s&&s!==""){r=true;break}}}t.getModel().setProperty("/_hasFilter",r)};R.prototype.columnFactory=function(e,a){var r=a.getPath();var n=r.substring(a.getPath().lastIndexOf("/")+1);var i=a.getProperty("$Type");var o=a.getProperty("$MaxLength");var l="7rem";o=o?parseInt(o):10;o=o<7?7:o;if(o>50){l="15rem"}else if(o>9){l="10rem"}return new g(e,{visible:true,filterProperty:i&&i.indexOf("String")>=0?n:null,width:l,label:new _({text:n}),hAlign:i&&i.indexOf("Decimal")>=0?"End":"Begin",template:new t({text:{path:n},wrapping:false})})};R.prototype.onTableSelectionChange=function(e){var t=this;var a=t.getAggregation("_field");var r=a.getModel();var n=a.getSelectedIndices();if(n.length>0){r.setProperty("/_hasTableSelected",true)}else{r.setProperty("/_hasTableSelected",false);r.setProperty("/_canDelete",false);return}if(n.length===a.getBinding("rows").getContexts().length){r.setProperty("/_hasTableAllSelected",true)}else{r.setProperty("/_hasTableAllSelected",false)}var i=[];var o=a.getBinding("rows").getContexts();n.forEach(function(e){var t=o[e].getObject();if(t._dt&&t._dt._editable!==false){var a=o[e].getPath();i.push(a)}});if(i.length===0){r.setProperty("/_canDelete",false)}else{r.setProperty("/_canDelete",true)}};R.prototype.selectAllTableSelections=function(e){var t=this;var a=t.getAggregation("_field");a.selectAll();a.getModel().setProperty("/_hasTableAllSelected",true)};R.prototype.clearAllTableSelections=function(e){var t=this;var a=t.getAggregation("_field");var r=a.getModel();a.clearSelection();r.setProperty("/_hasTableSelected",false);r.setProperty("/_canDelete",false);r.setProperty("/_hasTableAllSelected",false)};R.prototype.onSelectionChange=function(e){var t=this;var a=e.getSource();var r=e.getParameter("selected");var n=t.getAggregation("_field");var i=n.getBindingContext().getPath();var o=n.getModel();if(r){var l=o.getProperty(i);l.forEach(function(e){e._dt=e._dt||{};e._dt._selected=false});var s=a.getBindingContext().getObject();s._dt._selected=true;var u=P(s);o.setProperty("/_hasSelected",true);t.setValue(u)}else{o.setProperty("/_hasSelected",false);t.setValue(undefined)}};R.prototype.addNewObject=function(e){var t=this;var a=e.getSource();t._newObjectTemplate._dt._uuid=A.generateUuidV4();t.openObjectDetailsPopover(t._newObjectTemplate,a,"add")};R.prototype.mergeValueWithRequestResult=function(e){var t=this;var a=t.getConfiguration();var r=t.getAggregation("_field");var n=r.getModel();if(a.value&&typeof a.value==="object"&&!T(a.value,{})){var i=P(a.value,500),o=r.getBinding("rows").getPath();if(Array.isArray(e)&&e.length>0){if(i._dt&&i._dt._editable===false){var l=i._dt._uuid||A.generateUuidV4();delete i._dt._uuid;e.forEach(function(e){if(T(e,i)){e._dt._selected=true;e._dt._uuid=l}else{e._dt._uuid=A.generateUuidV4()}})}else{e.forEach(function(e){e._dt._uuid=A.generateUuidV4()});i._dt=i._dt||{};i._dt._selected=true;i._dt._uuid=i._dt._uuid||A.generateUuidV4();e.unshift(i)}}else{i._dt=i._dt||{};i._dt._selected=true;i._dt._uuid=i._dt._uuid||A.generateUuidV4();e=[i]}n.setProperty("/_hasSelected",true);n.setProperty(o,e)}else{if(Array.isArray(e)&&e.length>0){e.forEach(function(e){e._dt._uuid=A.generateUuidV4()})}n.setProperty("/_hasSelected",false)}n.checkUpdate()};R.prototype.onChangeOfTextArea=function(e){var t=this;var a=t.getResourceBundle();var r=e.getSource();var n=r.getValue();if(!n||n===""){t.saveValue(undefined,r)}else{try{var i=JSON.parse(n);if(i instanceof Array){r.setValueState("Error");r.setValueStateText(a.getText("EDITOR_VAL_NOT_A_SINGLE_JSONOBJECT"));return}t.saveValue(i,r)}catch(e){r.setValueState("Error");r.setValueStateText(a.getText("EDITOR_VAL_NOT_A_JSONOBJECT"))}}};R.prototype.onChangeOfTextAreaInPopover=function(e){var t=this;var a=t.getResourceBundle();var r=e.getSource();var n=r.getValue();if(!n||n===""){t.saveValue(undefined,r,true)}else{try{var i=JSON.parse(n);if(i instanceof Array){r.setValueState("Error");r.setValueStateText(a.getText("EDITOR_VAL_NOT_A_SINGLE_JSONOBJECT"));return}t.saveValue(i,r,true)}catch(e){r.setValueState("Error");r.setValueStateText(a.getText("EDITOR_VAL_NOT_A_JSONOBJECT"))}}};R.prototype.createFormContents=function(e,t,r,n){var i=this;var o=i.getConfiguration();var l=i.createPropertyContents(e,t,n);l.push(new _({visible:false}).addStyleClass("sapFormLabel"));l.push(new a({value:{path:t,formatter:function(e){if(!e||e===""){return undefined}if(T(e,{})&&!r&&!i._getCurrentProperty("value")){return undefined}e=JSON.stringify(e,null,"\t");if(typeof e==="object"&&!e.length){e=e.replace(/\"\$\$([a-zA-Z]*)\$\$\"/g,function(e){return e.substring(3,e.length-3)})}return e}},editable:o.editable===false?false:"{= ${"+t+"_dt/_editable} !== false}",width:"100%",placeholder:"{config/placeholder}",visible:"{= ${/editMode} === 'Json'}",change:r===true?this.onChangeOfTextAreaInPopover.bind(i):this.onChangeOfTextArea.bind(i),rows:r===true?11:7}));return l};R.prototype.createPropertyContents=function(e,t,n){var i=this;var o=i.getConfiguration();var l=[];if(!t){t="currentSettings>value/"}var s={};if(o.values&&o.values.metadata){var u=i.getModel("meta");var p="/"+o.values.metadata.namespace+"."+o.values.metadata.entityTypeName;var g=u.getProperty(p);for(var f in g){var c=g[f];var v=c["$Type"];if(c["$kind"]==="Property"&&v){if(v.indexOf("Int")>=0){s[f]={type:"int"}}else if(v.indexOf("Boolean")>=0){s[f]={type:"boolean"}}else if(v.indexOf("Decimal")>=0){s[f]={type:"number"}}else{s[f]={type:"string"}}}}}if(T(s,{})){s=o.properties}for(var b in s){var y=s[b];var E=y.label||b;if(E.match(B)){var m=E.substring(2,E.length-2);E="{i18n>"+m+"}"}var D=new _({text:E,visible:"{= ${/editMode} === 'Properties'}",required:y.required||false});l.push(D);var L;var S=P(y,500);delete S.type;delete S.label;delete S.translatable;delete S.defaultValue;delete S.formatter;delete S.column;delete S.cell;var C;switch(y.type){case"boolean":if(y.cell&&y.cell.type==="Switch"){C={state:"{"+t+b+"}",visible:"{= ${/editMode} === 'Properties'}",enabled:o.editable===false?false:"{= ${"+t+"_dt/_editable} !== false}",change:e};if(y.cell.customTextOn){C.customTextOn=y.cell.customTextOn}if(y.cell.customTextOff){C.customTextOff=y.cell.customTextOff}C=I(C,S);L=new h(C)}else{C={selected:"{"+t+b+"}",visible:"{= ${/editMode} === 'Properties'}",enabled:o.editable===false?false:"{= ${"+t+"_dt/_editable} !== false}",select:e};C=I(C,S);L=new O(C)}break;case"int":case"integer":C={value:{path:t+b,type:"sap.ui.model.type.Integer",formatOptions:y.formatter},visible:"{= ${/editMode} === 'Properties'}",editable:o.editable===false?false:"{= ${"+t+"_dt/_editable} !== false}",type:"Number",change:e};C=I(C,S);L=new r(C);break;case"number":C={value:{path:t+b,type:"sap.ui.model.type.Float",formatOptions:y.formatter},visible:"{= ${/editMode} === 'Properties'}",editable:o.editable===false?false:"{= ${"+t+"_dt/_editable} !== false}",type:"Number",change:e};C=I(C,S);L=new r(C);break;case"object":C={value:{path:t+b,formatter:function(e){if(!e||e===""){return undefined}e=JSON.stringify(e,null,"\t");if(typeof e==="object"&&!e.length){e=e.replace(/\"\$\$([a-zA-Z]*)\$\$\"/g,function(e){return e.substring(3,e.length-3)})}return e}},visible:"{= ${/editMode} === 'Properties'}",editable:o.editable===false?false:"{= ${"+t+"_dt/_editable} !== false}",change:e,rows:3};C=I(C,S);L=new a(C);break;default:var V=new d({translatable:y.translatable||false,uuidPath:t+"_dt/_uuid",property:b});C={value:"{"+t+b+"}",visible:"{= ${/editMode} === 'Properties'}",editable:o.editable===false?false:"{= ${"+t+"_dt/_editable} !== false}",change:function(t){var a=t.getSource();var r=t.getParameter("value");if(r&&r.match(B)){var n=r.substring(2,r.length-2);r="{i18n>"+n+"}";a.setValue(r);a.fireChange()}else if(e){e(t)}}};C=I(C,S);if(n){C.valueHelpIconSrc="sap-icon://translate";C.valueHelpRequest=n.bind(i,b);if(y.translatable){C.showValueHelp=true}else{C.showValueHelp={path:t+b,formatter:function(e){var t=this.getModel("settings").getData();var a=this.getModel().getProperty(t.uuidPath);var r="translatable";if(i.getTranslationKey(e)){if(!this.getShowValueHelp()&&i.getObjectPropertyConfigValueInDesigntime(a,t.property,r)===false){i.setObjectPropertyConfigValueInDesigntime(a,t.property,r,true)}return true}if(this.getShowValueHelp()){i.deleteTranslationValueInTexts(undefined,a,t.property);i.setObjectPropertyConfigValueInDesigntime(a,t.property,r,false);i._oUpdatedTranslations={}}return false}}}}L=new r(C);L.setModel(V,"settings")}l.push(L)}return l};R.prototype.saveValue=function(e,t,a){var r=this;var n;if(!a){r.setValue(e);n=r.getAggregation("_field").getModel();if(n){e=P(e,500);n.setProperty("/value",e||{})}t.setValueState("None");t.setValueStateText("");if(r.getConfiguration()._propertiesParsedFromValue){r.refreshSimpleForm()}}else{n=t.getModel();n.setProperty("/value",e);t.setValueState("None");t.setValueStateText("")}};R.prototype.refreshSimpleForm=function(){var e=this;var t=e.getConfiguration();var a=e.getAggregation("_field");var r=a.removeAllContent().slice(-2);delete t.properties;e.parseValueProperties();var n=function(){var t=a.getModel();t.checkUpdate(true);var r=t.getProperty("/value");r=P(r,500);e.setValue(r)};var i=e.createPropertyContents(n,"/value/");i=i.concat(r);i.forEach(function(e){a.addContent(e)})};R.prototype.getOriginTranslatedValues=function(e){var t=[];var a=x.getInstance();for(var r in a){var n=a[r];var i="";var o="";if(e&&n){var l=n.resourceBundle&&n.resourceBundle.getText(e);i=l;o=l}else{i="";o=""}var s={key:r,desription:n.language,value:i,originValue:o,editable:true};t.push(s)}return t};R.prototype.buildPropertyTranslationValues=function(e){var t=[];var a=x.getInstance();for(var r in a){t.push({key:r,desription:a[r].language,value:e,originValue:e,editable:true})}return t};R.prototype.openObjectDetailsPopover=function(e,t,a){var r=this;var p=r.getResourceBundle();var g=P(e,500);var _;var f=a==="add"&&r._previewPosition!=="right"?"Left":"Right";if(!r._oObjectDetailsPopover){var c=new u({text:p.getText("EDITOR_FIELD_OBJECT_DETAILS_POPOVER_BUTTON_ADD"),visible:a==="add",enabled:{path:"/value",formatter:function(e){if(typeof e!=="object"||T(e,{})){return false}else{var t=P(e);delete t._dt;if(T(t,{})){return false}}return true}},press:r.onAdd.bind(r)});var v=new u({text:p.getText("EDITOR_FIELD_OBJECT_DETAILS_POPOVER_BUTTON_UPDATE"),visible:a==="update",enabled:{path:"/value",formatter:function(e){if(!e||e===""||T(e,{})){return false}return true}},press:r.onUpdate.bind(r)});var b=new u({text:p.getText("EDITOR_FIELD_OBJECT_DETAILS_POPOVER_BUTTON_CANCEL"),visible:a!=="view",press:function(){if(a==="add"){var e=r._oObjectDetailsPopover.getModel().getProperty("/value");r.deleteTranslationValueInTexts(undefined,e._dt._uuid)}r._oObjectDetailsPopover.close()}});var h=new u({text:p.getText("EDITOR_FIELD_OBJECT_DETAILS_POPOVER_BUTTON_CLOSE"),visible:a==="view",press:function(){r._oObjectDetailsPopover.close()}});var O=new u({icon:{path:"/editMode",formatter:function(e){if(e==="Properties"){return"sap-icon://syntax"}else{return"sap-icon://form"}}},tooltip:{path:"/editMode",formatter:function(e){if(e==="Properties"){return p.getText("EDITOR_FIELD_OBJECT_FORM_EDITMODE_JSON")}else{return p.getText("EDITOR_FIELD_OBJECT_FORM_EDITMODE_PROPERTIES")}}},press:function(e){var t=e.getSource();var a=t.getModel();var r=a.getProperty("/editMode");if(r==="Properties"){a.setProperty("/editMode","Json")}else{a.setProperty("/editMode","Properties")}}});var y;r._oNavContainer=new n;r._oObjectDetailsPage=new i({title:p.getText("EDITOR_FIELD_OBJECT_DETAILS_POPOVER_TITLE"),headerContent:O,footer:new l({content:[new s,c,v,b,h]})});var E=function(e){r._oNavContainer.back();r._oObjectDetailsPage.focus()};var m=r.buildTranslationsList();var I=r.buildTranslationsFooter(m,false);r._oTranslationListPage=new i({title:p.getText("EDITOR_FIELD_OBJECT_TRANSLATION_LIST_TITLE","{languages>/property}"),showNavButton:true,navButtonPress:E,content:m,footer:I});var L=function(e){var t=r._oObjectDetailsPopover.getModel();t.checkUpdate(true);var a=t.getProperty("/value");if(a&&a!==""&&typeof a==="object"&&!T(a,{})){c.setEnabled(true)}else{c.setEnabled(false)}};var S=function(){};if(e._dt&&e._dt._editable===false){y=r.createFormContents(S,"/value/",true,r.navToTranslationPage)}else{y=r.createFormContents(L,"/value/",true,r.navToTranslationPage)}var C=new D({layout:"ResponsiveGridLayout",labelSpanXL:4,labelSpanL:4,labelSpanM:4,labelSpanS:12,emptySpanXL:1,emptySpanL:1,emptySpanM:1,emptySpanS:0,columnsXL:1,columnsL:1,columnsM:1,content:y});r._oObjectDetailsPage.addContent(C);r._oNavContainer.addPage(r._oObjectDetailsPage);r._oNavContainer.addPage(r._oTranslationListPage);r._oObjectDetailsPopover=new o({placement:f,showHeader:false,contentWidth:"300px",contentHeight:"345px",modal:true,content:r._oNavContainer}).addStyleClass("sapUiIntegrationEditorItemObjectFieldDetailsPopover");_=new d({value:g,editMode:"Properties"});r._oObjectDetailsPopover.setModel(_);r._oObjectDetailsPopover.setModel(r.getModel("i18n"),"i18n");r._oObjectDetailsPopover._oAddButton=c;r._oObjectDetailsPopover._oUpdateButton=v;r._oObjectDetailsPopover._oCancelButton=b;r._oObjectDetailsPopover._oCloseButton=h;r._oObjectDetailsPopover._openBy=t}else{_=r._oObjectDetailsPopover.getModel();_.setProperty("/value",g);_.checkUpdate(true);if(a==="add"){r._oObjectDetailsPopover._oAddButton.setVisible(true);r._oObjectDetailsPopover._oUpdateButton.setVisible(false);r._oObjectDetailsPopover._oCancelButton.setVisible(true);r._oObjectDetailsPopover._oCloseButton.setVisible(false)}else if(a==="update"){r._oObjectDetailsPopover._oAddButton.setVisible(false);r._oObjectDetailsPopover._oUpdateButton.setVisible(true);r._oObjectDetailsPopover._oCancelButton.setVisible(true);r._oObjectDetailsPopover._oCloseButton.setVisible(false)}else{r._oObjectDetailsPopover._oAddButton.setVisible(false);r._oObjectDetailsPopover._oUpdateButton.setVisible(false);r._oObjectDetailsPopover._oCancelButton.setVisible(false);r._oObjectDetailsPopover._oCloseButton.setVisible(true)}r._oObjectDetailsPopover._openBy=t;r._oObjectDetailsPopover.setPlacement(f);r._oNavContainer.back()}r._oObjectDetailsPopover.openBy(t)};R.prototype.buildTranslationsData=function(e,t,a,r){var n=this;var i=n.getResourceBundle();n._oOriginTranslatedValues=n._oOriginTranslatedValues||{};n._oUpdatedTranslations=n._oUpdatedTranslations||{};var o=a+"_"+r;var l=e;if(t==="key"){if(!n._oOriginTranslatedValues[e]){n._oOriginTranslatedValues[e]=n.getOriginTranslatedValues(e)}}else if(t==="property"){l=o;n._oOriginTranslatedValues[l]=n.buildPropertyTranslationValues(e)}var s=[];n._oOriginTranslatedValues[l].forEach(function(e){var t=P(e,500);t.status=i.getText("EDITOR_FIELD_TRANSLATION_LIST_POPOVER_LISTITEM_GROUP_NOTUPDATED");var o=n.getTranslationValueInTexts(t.key,a,r);if(o){t.value=o;if(w(n._oUpdatedTranslations[l],t.key)){t.value=n.getTranslationValueInTexts(t.key,a,r);t.status=i.getText("EDITOR_FIELD_TRANSLATION_LIST_POPOVER_LISTITEM_GROUP_UPDATED")}else{t.originValue=t.value}}if(t.key===i.sLocale.replaceAll("_","-")){t.desription+=" ("+i.getText("EDITOR_FIELD_TRANSLATION_LIST_POPOVER_CURRENTLANGUAGE")+")";s.unshift(t)}else{s.push(t)}});var u={isUpdated:false,key:e,translationKey:l,translationType:t,uuid:a,property:r,translatedLanguages:s};return u};R.prototype.getTranslationKey=function(e){var t;if(e&&e.match(B)){t=e.substring(2,e.length-2)}else if(e&&e.startsWith("{i18n>")&&e.endsWith("}")){t=e.substring(6,e.length-1)}return t};R.prototype.buildTranslationsModel=function(e){var t=this;var a=t.getResourceBundle();var r=new d(e);r.attachPropertyChange(function(e){var t=r.getData();var n=a.getText("EDITOR_FIELD_TRANSLATION_LIST_POPOVER_LISTITEM_GROUP_UPDATED");var i=a.getText("EDITOR_FIELD_TRANSLATION_LIST_POPOVER_LISTITEM_GROUP_NOTUPDATED");var o=false;t.translatedLanguages.forEach(function(e){if(e.value!==e.originValue){e.status=n;o=true}else{e.status=i}});t.isUpdated=o;r.setData(t);r.checkUpdate(true)});return r};R.prototype.buildTranslationsList=function(){return new L({items:{path:"languages>/translatedLanguages",template:new S({content:[new f({items:[new t({text:"{languages>desription}"}),new r({value:"{languages>value}",editable:"{languages>editable}"})]})],customData:[new V({key:"{languages>key}",value:"{languages>desription}"})]}),sorter:[new C({path:"status",descending:true,group:true})]}})};R.prototype.buildTranslationsFooter=function(e,t){var a=this;var r=a.getResourceBundle();var n=r.sLocale.replaceAll("_","-");var i=new u({type:"Emphasized",text:r.getText("EDITOR_FIELD_TRANSLATION_LIST_POPOVER_BUTTON_SAVE"),enabled:"{languages>/isUpdated}",press:function(){var t=e.getModel("languages");var r=t.getData();var i=[];var o=r.key;var l=r.translationKey;var s=r.translationType;var u=r.uuid;var d=r.property;r.translatedLanguages.forEach(function(e){if(e.value!==e.originValue){a.setTranslationValueInTexts(e.key,u,d,e.value);i.push(e.key)}});var p=false;if(i.length>0){a._oUpdatedTranslations=a._oUpdatedTranslations||{};a._oUpdatedTranslations[l]=i;if(w(i,n)){p=true}}r=a.buildTranslationsData(o,s,u,d);t.setData(r);t.checkUpdate(true);if(a.getModel()){a.getModel().checkUpdate(true)}if(p&&a._oValueBinding){a._oValueBinding.fireEvent("change")}}});var o=new u({text:r.getText("EDITOR_FIELD_OBJECT_DETAILS_POPOVER_BUTTON_RESET"),enabled:"{languages>/isUpdated}",press:function(t){var a=e.getModel("languages");var n=a.getData();n.translatedLanguages.forEach(function(e){e.value=e.originValue;e.status=r.getText("EDITOR_FIELD_TRANSLATION_LIST_POPOVER_LISTITEM_GROUP_NOTUPDATED")});n.isUpdated=false;a.setData(n);a.checkUpdate(true)}});var d=new u({text:r.getText("EDITOR_FIELD_TRANSLATION_LIST_POPOVER_BUTTON_CANCEL"),visible:t,press:function(){a._oTranslationPopover.close()}});return new l({content:[new s,i,o,d]})};R.prototype.openTranslationPopup=function(e,t){var a=this;var r=t.getSource();var n=a.getResourceBundle();var i=r.getModel().getProperty("/value");if(!i._dt){i._dt={_uuid:A.generateUuidV4()}}else if(!i._dt._uuid){i._dt._uuid=A.generateUuidV4()}var l=r.getValue();var s=a.getTranslationKey(l);var u="property";if(s&&s!==""){u="key"}else{s=l}var d=a.buildTranslationsData(s,u,i._dt._uuid,e);var p;if(!a._oTranslationPopover){var g=a.buildTranslationsList();var _=a.buildTranslationsFooter(g,true);var f=a._previewPosition==="right"?"Right":"Left";a._oTranslationPopover=new o({placement:f,contentWidth:"300px",contentHeight:"345px",title:n.getText("EDITOR_FIELD_OBJECT_TRANSLATION_LIST_TITLE","{languages>/property}"),content:g,footer:_}).addStyleClass("sapUiIntegrationFieldTranslation");p=a.buildTranslationsModel(d);a._oTranslationPopover.setModel(p,"languages")}else{p=a._oTranslationPopover.getModel("languages");p.setData(d);p.checkUpdate(true)}a._oTranslationPopover.openBy(r._oValueHelpIcon)};R.prototype.navToTranslationPage=function(e,t){var a=this;var r=a._oObjectDetailsPopover.getModel().getProperty("/value");var n=r[e];var i=a.getTranslationKey(n);var o="property";if(i&&i!==""){o="key"}else{i=n}var l=a.buildTranslationsData(i,o,r._dt._uuid,e);var s=a._oTranslationListPage.getModel("languages");if(!s){s=a.buildTranslationsModel(l);a._oTranslationListPage.setModel(s,"languages")}else{s.setData(l)}a._oNavContainer.to(a._oTranslationListPage);a._oTranslationListPage.focus()};R.prototype.onAdd=function(e){var t=this;var a=t.getAggregation("_field");var r=a.getModel();var n=t._oObjectDetailsPopover.getModel().getProperty("/value");var i=a.getBinding("rows").getPath();var o=r.getProperty(i);o.forEach(function(e){if(e._dt._selected){e._dt._selected=false}});o.push(n);r.setProperty("/_hasSelected",true);r.setProperty("/_hasTableAllSelected",false);r.setProperty("/_hasTableSelected",false);r.checkUpdate();t.refreshValue();t.updateTable();t._oObjectDetailsPopover.close()};R.prototype.onUpdate=function(e){var t=this;var a=t.getAggregation("_field");var r=t._oObjectDetailsPopover.getModel().getProperty("/value");var n=a.getModel();var i=t._oObjectDetailsPopover._openBy.getParent();var o=i.getIndex();var l=a.getBinding("rows").getContexts();var s=l[o].getPath();n.setProperty(s,P(r,500));n.checkUpdate();if(r._dt&&r._dt._selected){t.refreshValue()}t.updateTable();t._oObjectDetailsPopover.close()};R.prototype.onDelete=function(e){var t=this;var a=t.getAggregation("_field");var r=t.getResourceBundle();var n=a.getSelectedIndices();var i=[];var o=a.getBinding("rows").getContexts();n.forEach(function(e){var t=o[e].getObject();if(t._dt&&t._dt._editable!==false){var a=o[e].getPath();var r=a.substring(a.lastIndexOf("/")+1);i.push(r)}});if(i.length===0){y.error(r.getText("EDITOR_FIELD_OBJECT_DELETE_ERROR_MSG"));return}y.confirm(r.getText("EDITOR_FIELD_OBJECT_DELETE_CONFIRM_MSG"),{title:r.getText("EDITOR_FIELD_OBJECT_DELETE_CONFIRM_TITLE"),onClose:function(e){if(e===y.Action.OK){var n=a.getBindingContext().getPath();var o=a.getModel();var l=o.getProperty(n);var s=[];for(var u=0;u<l.length;u++){if(w(i,u+"")){t.deleteTranslationValueInTexts(undefined,l[u]._dt._uuid)}else{s.push(l[u])}}o.setProperty(n,s);o.checkUpdate(true);t.refreshValue();t.updateTable()}else{E.show(r.getText("EDITOR_FIELD_OBJECT_DELETE_CONFIRM_CANCLE"))}}})};R.prototype.refreshValue=function(){var e=this;var t=e.getAggregation("_field");var a=t.getModel();var r=t.getBinding("rows").getPath();var n=a.getProperty(r);var i;for(var o=0;o<n.length;o++){var l=n[o];if(l._dt._selected){i=P(l);break}}e.setValue(i)};R.prototype.clearAllFilters=function(e){var t=this;var a=t.getAggregation("_field");var r=a.getColumns();for(var n=0;n<r.length;n++){var i=r[n];if(n<r.length-1){i._applySelection=false}a.filter(i,undefined)}};R.prototype.setValue=function(e){var t=this;t.cleanDT(e);t._setCurrentProperty("value",e)};R.prototype.cleanDT=function(e){if(e&&e._dt&&e._dt._selected){delete e._dt._selected}if(e&&e._dt&&T(e._dt,{})){delete e._dt}};R.prototype.getTranslationValueInTexts=function(e,t,a){var r=this;var n=r.getConfiguration();var i="/texts/"+e;var o=this._settingsModel.getProperty(i)||{};var l=o[n.manifestpath];var s;if(l&&l[t]){s=l[t][a]}return s};R.prototype.setObjectPropertyConfigValueInDesigntime=function(e,t,a,r){var n=this;var i=n.getConfiguration();var o="/:designtime";var l=this._settingsModel.getData();if(!l){return}var s;if(!l.hasOwnProperty(":designtime")){s={}}else{s=P(l[":designtime"],500)}if(!s.hasOwnProperty(i.manifestpath)){s[i.manifestpath]={}}if(!s[i.manifestpath].hasOwnProperty(e)){s[i.manifestpath][e]={}}if(!s[i.manifestpath][e].hasOwnProperty(t)){s[i.manifestpath][e][t]={}}s[i.manifestpath][e][t][a]=r;this._settingsModel.setProperty(o,s)};R.prototype.getObjectPropertyConfigValueInDesigntime=function(e,t,a){var r=this;var n;var i=r.getConfiguration();var o=this._settingsModel.getData();if(o&&o[":designtime"]&&o[":designtime"][i.manifestpath]&&o[":designtime"][i.manifestpath][e]&&o[":designtime"][i.manifestpath][e][t]&&o[":designtime"][i.manifestpath][e][t].hasOwnProperty(a)){n=o[":designtime"][i.manifestpath][e][t][a]}return n};R.prototype.setTranslationValueInTexts=function(e,t,a,r){var n=this;var i=n.getConfiguration();var o="/texts";var l=this._settingsModel.getData();if(!l){return}var s;if(!l.hasOwnProperty("texts")){s={}}else{s=P(l.texts,500)}if(!s.hasOwnProperty(e)){s[e]={}}if(!s[e].hasOwnProperty(i.manifestpath)){s[e][i.manifestpath]={}}if(!s[e][i.manifestpath].hasOwnProperty(t)){s[e][i.manifestpath][t]={}}s[e][i.manifestpath][t][a]=r;this._settingsModel.setProperty(o,s)};R.prototype.deleteTranslationValueInTexts=function(e,t,a){var r=this;var n=r._settingsModel.getData();if(!n||!n.texts||!t){return}var i=r.getConfiguration();var o="/texts";var l=P(n.texts,500);if(e){if(l[e]&&l[e][i.manifestpath]&&l[e][i.manifestpath][t]){if(a){if(l[e][i.manifestpath][t].hasOwnProperty(a)){delete l[e][i.manifestpath][t][a];if(T(l[e][i.manifestpath][t],{})){delete l[e][i.manifestpath][t]}this._settingsModel.setProperty(o,l)}}else{delete l[e][i.manifestpath][t];if(T(l[e][i.manifestpath],{})){delete l[e][i.manifestpath];if(T(l[e],{})){delete l[e]}}this._settingsModel.setProperty(o,l)}}}else{for(var s in l){r.deleteTranslationValueInTexts(s,t,a)}}};return R});