/*!
 * OpenUI5
 * (c) Copyright 2009-2022 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/integration/editor/fields/BaseField","sap/m/Text","sap/m/TextArea","sap/m/Title","sap/m/Input","sap/m/Popover","sap/m/OverflowToolbar","sap/m/ToolbarSpacer","sap/m/Button","sap/ui/core/Core","sap/ui/model/json/JSONModel","sap/ui/table/Table","sap/ui/table/Column","sap/m/Label","sap/m/HBox","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/base/util/deepEqual","sap/ui/core/Icon","sap/m/Switch","sap/m/CheckBox","sap/base/util/deepClone","sap/m/Link","sap/ui/layout/form/SimpleForm","sap/base/util/merge"],function(e,t,a,r,i,o,n,l,s,u,p,d,c,f,v,g,b,_,O,h,T,y,P,m,S){"use strict";var x=/\{\{(?!parameters.)(?!destinations.)([^\}\}]+)\}\}/g;var I=e.extend("sap.ui.integration.editor.fields.ObjectField",{metadata:{library:"sap.ui.integration"},renderer:e.getMetadata().getRenderer()});I.prototype.initVisualization=function(e){var t=this;t._newObjectTemplate={};var a=e.visualization;if(!a){if(e.value&&!e.properties&&(!e.values||e.values&&!e.values.metadata)){t.parseValueProperties()}if(e.values){a=t.createTableVisualization(e)}else if(e.properties){a=t.createSimpleFormVisualization(e)}else{a=t.createTextAreaVisualization(e)}e.withLabel=true}this._visualization=a;this.attachAfterInit(this._afterInit)};I.prototype._afterInit=function(){var e=this;var t=this.getAggregation("_field");if(t instanceof m){t.addStyleClass("sapUiIntegrationEditorItemObjectFieldForm");var a=y(e.getConfiguration().value,500)||{};t.setModel(new p({value:a,editMode:"Properties"}))}else if(t instanceof d){t.addStyleClass("sapUiIntegrationEditorItemObjectFieldTable")}};I.prototype.parseValueProperties=function(){var e=this;var t=e.getConfiguration();if(typeof t.value==="object"&&!_(t.value,{})&&!Array.isArray(t.value)&&!t.properties){var a={};for(var r in t.value){var i=typeof t.value[r];var o=i==="string"?{}:{type:i};a[r]=o}if(!_(a,{})){t.properties=a;t._propertiesParsedFromValue=true}}};I.prototype.createTableVisualization=function(e){var t=this;var a=t.createTableToolbar(e);var r=[];var i=e.values?e.values.data.path||"/":"/value";if(e.values&&e.values.metadata){r={path:"meta>/"+e.values.metadata.namespace+"."+e.values.metadata.entityTypeName,filters:new g({path:"$kind",operator:b.EQ,value1:"Property"}),factory:t.columnFactory.bind(t)}}else{r=t.buildTableColumns()}var o={type:d,settings:{rows:"{"+i+"}",selectionMode:"MultiToggle",enableSelectAll:t._bIsEnableSelectAllInTable===true,visibleRowCount:5,busy:"{currentSettings>_loading}",columns:r,rowSelectionChange:t.onSelectionChange.bind(t),toolbar:a,filter:t.onFilter.bind(t)}};return o};I.prototype.createSimpleFormVisualization=function(e){var t=this;var a=t.getResourceBundle();var r=function(){var e=this.getAggregation("_field").getModel();e.checkUpdate(true);var t=e.getProperty("/value");t=y(t,500);this._setCurrentProperty("value",t)}.bind(t);var i=t.createFormContents(r,"/value/");var o=new s({icon:{path:"/editMode",formatter:function(e){if(e==="Properties"){return"sap-icon://syntax"}else{return"sap-icon://form"}}},tooltip:{path:"/editMode",formatter:function(e){if(e==="Properties"){return a.getText("EDITOR_FIELD_OBJECT_FORM_EDITMODE_JSON")}else{return a.getText("EDITOR_FIELD_OBJECT_FORM_EDITMODE_PROPERTIES")}}},press:function(){var e=t.getAggregation("_field").getModel();var a=e.getProperty("/editMode");if(a==="Properties"){e.setProperty("/editMode","Json")}else{e.setProperty("/editMode","Properties")}}});var u=new s({icon:"sap-icon://delete",tooltip:a.getText("EDITOR_FIELD_OBJECT_DELETE"),visible:e.enabled,enabled:{path:"currentSettings>value",formatter:function(e){if(!e||e===""){return false}return true}},press:function(e){t._setCurrentProperty("value",undefined);var a=t.getAggregation("_field").getModel();a.setProperty("/value",{});a.checkUpdate(true)}});var p={type:m,settings:{layout:"ResponsiveGridLayout",visible:e.visible,labelSpanXL:2,labelSpanL:2,labelSpanM:2,labelSpanS:12,emptySpanXL:1,emptySpanL:1,emptySpanM:1,emptySpanS:0,columnsXL:1,columnsL:1,columnsM:1,toolbar:new n({content:[new l,o,u]}).addStyleClass("sapMTB"),content:i}};return p};I.prototype.createTextAreaVisualization=function(e){var t=this;var r={type:a,settings:{value:{path:"currentSettings>value",formatter:function(e){if(!e||e===""){return undefined}e=JSON.stringify(e,null,"\t");if(typeof e==="object"&&!e.length){e=e.replace(/\"\$\$([a-zA-Z]*)\$\$\"/g,function(e){return e.substring(3,e.length-3)})}return e}},editable:"{config/editable}",width:"100%",enabled:"{config/enabled}",placeholder:"{config/placeholder}",visible:e.visible,change:this.onChangeOfTextArea.bind(t),rows:7}};return r};I.prototype.buildTableColumns=function(){var e=this;var a=e.getConfiguration();var r=[];var i=e.getModel("i18n").getResourceBundle();for(var o in a.properties){var n=a.properties[o];var l=n.label||o;var s="{"+o+"}";if(n.defaultValue){e._newObjectTemplate[o]=n.defaultValue}var u={width:"7rem",label:l};if(n.column){u=S(u,n.column)}if(u.label.match(x)){u.label="{i18n>"+u.label.substring(2,u.label.length-1)}u.tooltip=u.label;var p=n.cell&&n.cell.type?n.cell.type:n.type||"Text";var d;var f;var v=y(n.cell)||{};delete v.type;switch(p){case"int":case"number":f={text:s,wrapping:false};f=S(f,v);d=new t(f);break;case"string":case"Text":f={text:s,wrapping:false};f=S(f,v);var g=f.text;if(typeof g==="string"){if(g.match(x)){f.text=i.getText(g.substring(2,g.length-2))}else if(g.startsWith("{i18n>")&&g.endsWith("}")){f.text=i.getText(g.substring(6,g.length-1))}else if(g.startsWith("{")&&g.endsWith("}")){f.text={path:g.substring(1,g.length-1),formatter:function(e){if(!e){return undefined}else if(e.match(x)){return i.getText(e.substring(2,e.length-2))}else if(e.startsWith("{i18n>")&&e.endsWith("}")){return i.getText(e.substring(6,e.length-1))}return e}}}}f.tooltip=v.tooltip||f.text;d=new t(f);break;case"Icon":f={src:s};f=S(f,v);d=new O(f);break;case"boolean":f={selected:s,enabled:false};f=S(f,v);d=new T(f);break;case"Switch":f={state:s,enabled:false};f=S(f,v);d=new h(f);break;case"Link":f={text:s,target:"_blank",href:s};f=S(f,v);d=new P(f);break;default:d=new t({text:s,wrapping:false});break}u.template=d;var b=new c(u);r.push(b)}var _=e.createActionColumn();r.push(_);return r};I.prototype.checkHasFilter=function(e){var t=true;if(e._propertiesParsedFromValue===true){t=false}else{var a=JSON.stringify(e.properties,null,"\t");t=a.indexOf("filterProperty")>-1?true:false}return t};I.prototype.createTableToolbar=function(e){var t=this;var a=t.getResourceBundle();var r=t.checkHasFilter(e);var i=e.enabled!==false;var o=e.addButtonTooltip||a.getText("EDITOR_FIELD_OBJECT_TABLE_BUTTON_ADD_TOOLTIP");if(i&&e.values){i=e.values.allowAdd===true}return new n({content:[new l,new s({icon:"sap-icon://add",visible:i,tooltip:o,press:t.createNewObject.bind(t)}),new s({icon:"sap-icon://clear-filter",visible:r,tooltip:a.getText("EDITOR_FIELD_OBJECT_TABLE_BUTTON_CLEAR_ALL_FILTERS_TOOLTIP"),press:t.clearAllFilters.bind(t)})]})};I.prototype.onDelete=function(e){var t=this;var a=e.getSource();var r=a.getParent().getParent();var i=r.getParent();var o=r.getIndex();var n=i.getBinding("rows").getContexts();var l=n[o].getPath();var s=l.substring(l.lastIndexOf("/")+1);var u;var p=t.checkHasValue();u={selectedIndex:i.getSelectedIndex(),selectedIndices:i.getSelectedIndices(),rowIndex:o,realIndex:s};var d=i.getModel();var c=i.getBinding("rows").getPath();var f=d.getProperty(c);f.splice(s,1);d.checkUpdate(true);if(p){t.applyBeforeValueAndSelections("delete",u)}};I.prototype.onEditOrViewDetail=function(e){var t=this;var a=e.getSource();var r=a.getBindingContext().getObject();t.openObjectDetailsPopover(r,a,r._editable!==false?"update":"view")};I.prototype.onFilter=function(e){var t=this;var a=e.getSource();if(t.checkHasValue()){var r={selectedIndex:a.getSelectedIndex(),selectedIndices:a.getSelectedIndices(),column:e.getParameter("column")};t.applyBeforeValueAndSelections("filter",r)}};I.prototype.createActionColumn=function(){var e=this;var t=e.getConfiguration();var a=e.getResourceBundle();return new c({width:"5rem",hAlign:"Center",label:new f({text:"Actions",tooltip:"Actions"}),template:new v({items:[new s({type:"Transparent",icon:{path:"_editable",formatter:function(e){if(e===false){return"sap-icon://display"}else{return"sap-icon://edit"}}},tooltip:{path:"_editable",formatter:function(e){if(e===false){return a.getText("EDITOR_FIELD_OBJECT_TABLE_BUTTON_DISPLAY_TOOLTIP")}else{return a.getText("EDITOR_FIELD_OBJECT_TABLE_BUTTON_EDIT_TOOLTIP")}}},press:e.onEditOrViewDetail.bind(e)}),new s({type:"Transparent",icon:"sap-icon://delete",visible:t.editable===false?false:"{= ${_editable} !== false}",tooltip:a.getText("EDITOR_FIELD_OBJECT_DELETE"),press:e.onDelete.bind(e)})]})})};I.prototype.columnFactory=function(e,a){var r=this;var i=a.getPath();var o=i.substring(a.getPath().lastIndexOf("/")+1);var n=a.getProperty("$Type");if(n==="Actions"){return r.createActionColumn()}var l=a.getProperty("$MaxLength");var s="7rem";l=l?parseInt(l):10;l=l<7?7:l;if(l>50){s="15rem"}else if(l>9){s="10rem"}return new c(e,{visible:true,filterProperty:n&&n.indexOf("String")>=0?o:null,width:s,label:new f({text:o}),hAlign:n&&n.indexOf("Decimal")>=0?"End":"Begin",template:new t({text:{path:o},wrapping:false})})};I.prototype.onSelectionChange=function(e){var t=this;var a=e.getSource();var r=e.getParameter("userInteraction")||false;if(r){var i,o;var n=a.getSelectedIndex();var l=a.getSelectedIndices();if(l.length>=1){a.setSelectedIndex(n);o=a.getContextByIndex(n);i=o.getObject();a._sPathOfFilteredOut=null}else if(a._sPathOfFilteredOut){i=a.getModel().getProperty(a._sPathOfFilteredOut)}t._setCurrentProperty("value",i)}};I.prototype.createNewObject=function(e){var t=this;var a=e.getSource();t.openObjectDetailsPopover(t._newObjectTemplate,a,"add")};I.prototype.mergeValueWithRequestResult=function(e){var t=this;var a=t.getConfiguration();var r=t.getAggregation("_field");if(a.value&&typeof a.value==="object"&&!_(a.value,{})){var i;if(Array.isArray(e)&&e.length>0){if(a.value._editable===false){var o=-1;for(var n=0;n<e.length;n++){i=e[n];if(_(i,a.value)){o=n;break}}r.setSelectedIndex(o)}else{e.unshift(a.value);r.getModel().checkUpdate();r.setSelectedIndex(0)}}else{i=y(a.value,500);e=[i];r.getModel().checkUpdate();r.setSelectedIndex(0)}}return e};I.prototype.onChangeOfTextArea=function(e){var t=this;var a=t.getResourceBundle();var r=e.getSource();var i=r.getValue();if(!i||i===""){t.saveValue(undefined,r)}else{try{var o=JSON.parse(i);if(o instanceof Array){r.setValueState("Error");r.setValueStateText(a.getText("EDITOR_VAL_NOT_A_SINGLE_JSONOBJECT"));return}t.saveValue(o,r)}catch(e){r.setValueState("Error");r.setValueStateText(a.getText("EDITOR_VAL_NOT_A_JSONOBJECT"))}}};I.prototype.onChangeOfTextAreaInPopover=function(e){var t=this;var a=t.getResourceBundle();var r=e.getSource();var i=r.getValue();if(!i||i===""){t.saveValue(undefined,r,true)}else{try{var o=JSON.parse(i);if(o instanceof Array){r.setValueState("Error");r.setValueStateText(a.getText("EDITOR_VAL_NOT_A_SINGLE_JSONOBJECT"));return}t.saveValue(o,r,true)}catch(e){r.setValueState("Error");r.setValueStateText(a.getText("EDITOR_VAL_NOT_A_JSONOBJECT"))}}};I.prototype.createFormContents=function(e,t,r){var i=this;var o=i.getConfiguration();var n=i.createPropertyContents(e,t);n.push(new f({visible:false}).addStyleClass("sapFormLabel"));n.push(new a({value:{path:t,formatter:function(e){if(!e||e===""){return undefined}if(_(e,{})&&!r&&!i._getCurrentProperty("value")){return undefined}e=JSON.stringify(e,null,"\t");if(typeof e==="object"&&!e.length){e=e.replace(/\"\$\$([a-zA-Z]*)\$\$\"/g,function(e){return e.substring(3,e.length-3)})}return e}},editable:o.editable===false?false:"{= ${"+t+"_editable} !== false}",width:"100%",placeholder:"{config/placeholder}",visible:"{= ${/editMode} === 'Json'}",change:r===true?this.onChangeOfTextAreaInPopover.bind(i):this.onChangeOfTextArea.bind(i),rows:r===true?15:7}));return n};I.prototype.createPropertyContents=function(e,t){var r=this;var o=r.getConfiguration();var n=[];if(!t){t="currentSettings>value/"}var l={};if(o.values&&o.values.metadata){var s=r.getModel("meta");var u="/"+o.values.metadata.namespace+"."+o.values.metadata.entityTypeName;var p=s.getProperty(u);for(var d in p){var c=p[d];var v=c["$Type"];if(c["$kind"]==="Property"&&v){if(v.indexOf("Int")>=0){l[d]={type:"int"}}else if(v.indexOf("Boolean")>=0){l[d]={type:"boolean"}}else if(v.indexOf("Decimal")>=0){l[d]={type:"number"}}else if(v!=="Actions"){l[d]={type:"string"}}}}}if(_(l,{})){l=o.properties}for(var g in l){var b=l[g];var O=b.label||g;if(O.match(x)){var y=O.substring(2,O.length-2);O="{i18n>"+y+"}"}var P=new f({text:O,visible:"{= ${/editMode} === 'Properties'}",required:b.required||false});n.push(P);var m;switch(b.type){case"boolean":if(b.cell&&b.cell.type==="Switch"){var S={state:"{"+t+g+"}",visible:"{= ${/editMode} === 'Properties'}",enabled:o.editable===false?false:"{= ${"+t+"_editable} !== false}",change:e};if(b.cell.customTextOn){S.customTextOn=b.cell.customTextOn}if(b.cell.customTextOff){S.customTextOff=b.cell.customTextOff}m=new h(S)}else{m=new T({selected:"{"+t+g+"}",visible:"{= ${/editMode} === 'Properties'}",enabled:o.editable===false?false:"{= ${"+t+"_editable} !== false}",select:e})}break;case"int":case"integer":m=new i({value:{path:t+g,type:"sap.ui.model.type.Integer",formatOptions:b.formatter},visible:"{= ${/editMode} === 'Properties'}",editable:o.editable===false?false:"{= ${"+t+"_editable} !== false}",type:"Number",change:e});break;case"number":m=new i({value:{path:t+g,type:"sap.ui.model.type.Float",formatOptions:b.formatter},visible:"{= ${/editMode} === 'Properties'}",editable:o.editable===false?false:"{= ${"+t+"_editable} !== false}",type:"Number",change:e});break;case"object":m=new a({value:{path:t+g,formatter:function(e){if(!e||e===""){return undefined}e=JSON.stringify(e,null,"\t");if(typeof e==="object"&&!e.length){e=e.replace(/\"\$\$([a-zA-Z]*)\$\$\"/g,function(e){return e.substring(3,e.length-3)})}return e}},visible:"{= ${/editMode} === 'Properties'}",editable:o.editable===false?false:"{= ${"+t+"_editable} !== false}",change:e,rows:3});break;default:m=new i({value:"{"+t+g+"}",visible:"{= ${/editMode} === 'Properties'}",editable:o.editable===false?false:"{= ${"+t+"_editable} !== false}",change:e})}n.push(m)}return n};I.prototype.saveValue=function(e,t,a){var r=this;var i;if(!a){r._setCurrentProperty("value",e);i=r.getAggregation("_field").getModel();if(i){e=y(e,500);i.setProperty("/value",e||{})}t.setValueState("None");t.setValueStateText("");if(r.getConfiguration()._propertiesParsedFromValue){r.refreshSimpleForm()}}else{i=t.getModel();i.setProperty("/value",e);t.setValueState("None");t.setValueStateText("")}};I.prototype.refreshSimpleForm=function(){var e=this;var t=e.getConfiguration();var a=e.getAggregation("_field");var r=a.removeAllContent().slice(-2);delete t.properties;e.parseValueProperties();var i=function(){var t=a.getModel();t.checkUpdate(true);var r=t.getProperty("/value");r=y(r,500);e._setCurrentProperty("value",r)};var o=e.createPropertyContents(i,"/value/");o=o.concat(r);o.forEach(function(e){a.addContent(e)})};I.prototype.openObjectDetailsPopover=function(e,t,a){var i=this;var u=i.getAggregation("_field");var d=i.getResourceBundle();var c=y(e,500);var f;if(!i._oObjectDetailsPopover){var v=new s({text:d.getText("EDITOR_FIELD_OBJECT_DETAILS_POPOVER_BUTTON_ADD"),visible:a==="add",enabled:{path:"/value",formatter:function(e){if(!e||e===""||_(e,{})){return false}return true}},press:i.onCreate.bind(i)});var g=new s({text:d.getText("EDITOR_FIELD_OBJECT_DETAILS_POPOVER_BUTTON_UPDATE"),visible:a==="update",enabled:{path:"/value",formatter:function(e){if(!e||e===""||_(e,{})){return false}return true}},press:i.onUpdate.bind(i)});var b=new s({text:d.getText("EDITOR_FIELD_OBJECT_DETAILS_POPOVER_BUTTON_CANCEL"),visible:a!=="view",press:function(){i._oObjectDetailsPopover.close()}});var O=new s({text:d.getText("EDITOR_FIELD_OBJECT_DETAILS_POPOVER_BUTTON_CLOSE"),visible:a==="view",press:function(){i._oObjectDetailsPopover.close()}});f=new p({value:c,editMode:"Properties"});var h;var T=function(e){var t=i._oObjectDetailsPopover.getModel();t.checkUpdate(true);var a=t.getProperty("/value");if(a&&a!==""&&typeof a==="object"&&!_(a,{})){v.setEnabled(true)}else{v.setEnabled(false)}};var P=function(){};if(e._editable!==false){h=i.createFormContents(T,"/value/",true)}else{h=i.createFormContents(P,"/value/",true)}var S=new s({icon:{path:"/editMode",formatter:function(e){if(e==="Properties"){return"sap-icon://syntax"}else{return"sap-icon://form"}}},tooltip:{path:"/editMode",formatter:function(e){if(e==="Properties"){return d.getText("EDITOR_FIELD_OBJECT_FORM_EDITMODE_JSON")}else{return d.getText("EDITOR_FIELD_OBJECT_FORM_EDITMODE_PROPERTIES")}}},press:function(e){var t=e.getSource();var a=t.getModel();var r=a.getProperty("/editMode");if(r==="Properties"){a.setProperty("/editMode","Json")}else{a.setProperty("/editMode","Properties")}}});var x=new m({layout:"ResponsiveGridLayout",labelSpanXL:4,labelSpanL:4,labelSpanM:4,labelSpanS:12,emptySpanXL:1,emptySpanL:1,emptySpanM:1,emptySpanS:0,columnsXL:1,columnsL:1,columnsM:1,content:h});var I=u._previewPostion==="right"?"Right":"Left";i._oObjectDetailsPopover=new o({placement:I,contentWidth:"300px",contentHeight:"345px",content:x,customHeader:new n({content:[new r({text:d.getText("EDITOR_FIELD_OBJECT_DETAILS_POPOVER_TITLE")}),new l,S]}),footer:new n({content:[new l,v,g,b,O]})}).addStyleClass("sapUiIntegrationEditorItemObjectFieldDetailsPopover");i._oObjectDetailsPopover.setModel(f);i._oObjectDetailsPopover.setModel(i.getModel("i18n"),"i18n");i._oObjectDetailsPopover._oAddButton=v;i._oObjectDetailsPopover._oUpdateButton=g;i._oObjectDetailsPopover._oCancelButton=b;i._oObjectDetailsPopover._oCloseButton=O;i._oObjectDetailsPopover._openBy=t}else{f=i._oObjectDetailsPopover.getModel();f.setProperty("/value",c);if(a==="add"){i._oObjectDetailsPopover._oAddButton.setVisible(true);i._oObjectDetailsPopover._oUpdateButton.setVisible(false);i._oObjectDetailsPopover._oCancelButton.setVisible(true);i._oObjectDetailsPopover._oCloseButton.setVisible(false)}else if(a==="update"){i._oObjectDetailsPopover._oAddButton.setVisible(false);i._oObjectDetailsPopover._oUpdateButton.setVisible(true);i._oObjectDetailsPopover._oCancelButton.setVisible(true);i._oObjectDetailsPopover._oCloseButton.setVisible(false)}else{i._oObjectDetailsPopover._oAddButton.setVisible(false);i._oObjectDetailsPopover._oUpdateButton.setVisible(false);i._oObjectDetailsPopover._oCancelButton.setVisible(false);i._oObjectDetailsPopover._oCloseButton.setVisible(true)}i._oObjectDetailsPopover._openBy=t}i._oObjectDetailsPopover.openBy(t)};I.prototype.onCreate=function(e){var t=this;var a=t.getAggregation("_field");var r;var i=t.checkHasValue();if(i){r={selectedIndex:a.getSelectedIndex(),selectedIndices:a.getSelectedIndices()}}var o=t._oObjectDetailsPopover.getModel().getProperty("/value");var n=a.getBinding("rows").getPath();var l=a.getModel().getProperty(n);l.push(o);a.getModel().checkUpdate();t._oObjectDetailsPopover.close();if(i){t.applyBeforeValueAndSelections("add",r)}};I.prototype.onUpdate=function(e){var t=this;var a=t.getAggregation("_field");var r=t._oObjectDetailsPopover.getModel().getProperty("/value");var i=a.getModel();var o=t._oObjectDetailsPopover._openBy.getParent().getParent();var n=o.getIndex();var l=a.getBinding("rows").getContexts();var s=l[n].getPath();var u;var p=t.checkHasValue();if(p){var d=a.getBinding("rows").getContexts();u={updatedObject:r,rowIndex:n,path:s,selectedIndex:a.getSelectedIndex(),selectedIndices:a.getSelectedIndices(),rowNumber:d?d.length:0}}i.setProperty(s,y(r,500));i.checkUpdate();t._oObjectDetailsPopover.close();if(p){t.applyBeforeValueAndSelections("update",u)}};I.prototype.clearAllFilters=function(e){var t=this;var a=t.getAggregation("_field");var r=a.getColumns();for(var i=0;i<r.length;i++){var o=r[i];if(i<r.length-1){o._applySelection=false}a.filter(o,undefined)}};I.prototype.checkHasValue=function(){var e=this;var t=e._getCurrentProperty("value");if(typeof t==="object"&&!_(t,{})){return true}return false};I.prototype.applyBeforeValueAndSelections=function(e,t){var a=this;var r=a.getAggregation("_field");var i=t.selectedIndex;var o=t.rowNumber;var n=r.getBinding("rows").getContexts();var l=n.length;var s=t.rowIndex;var u=r.getBinding("rows").getPath();var p;switch(e){case"add":if(i>-1){r.setSelectedIndex(i);r._sPathOfFilteredOut=null}break;case"update":if(s===i){a._setCurrentProperty("value",t.updatedObject);if(o!==l){r._sPathOfFilteredOut=t.path}}else if(o!==l){if(i>s){i--}r.setSelectedIndex(i)}break;case"delete":if(i===s){a._setCurrentProperty("value",undefined)}else if(i>s){r.setSelectedIndex(i-1)}else{r.setSelectedIndex(i)}if(r._sPathOfFilteredOut){p=r._sPathOfFilteredOut.substring(r._sPathOfFilteredOut.lastIndexOf("/")+1);if(p>t.realIndex){p--;r._sPathOfFilteredOut=u+"/"+p}}break;case"filter":var d=t.column;if(i>-1){r._sPathOfFilteredOut=n&&n[i].getPath()}if(d._applySelection!==false&&r._sPathOfFilteredOut){r.attachEventOnce("rowsUpdated",function(){var e=r.getBinding("rows").getContexts()||[];var t=-1;if(e.length>0&&r._sPathOfFilteredOut){for(var a=0;a<e.length;a++){var i=e[a];if(i.getPath()===r._sPathOfFilteredOut){t=a;r._sPathOfFilteredOut=undefined;break}}}if(t>-1){r.setSelectedIndex(t)}})}delete d._applySelection;break;default:}};return I});