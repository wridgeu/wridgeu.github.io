/*!
 * OpenUI5
 * (c) Copyright 2009-2023 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/core/Control","sap/m/Popover","sap/ui/model/json/JSONModel","sap/m/Button","sap/m/SegmentedButton","sap/m/SegmentedButtonItem","sap/m/OverflowToolbar","sap/m/ToolbarSpacer","sap/m/VBox","sap/m/HBox","sap/m/Select","sap/ui/core/ListItem","sap/m/Label","sap/m/Text","sap/m/Title","sap/m/CheckBox","sap/m/Menu","sap/m/MenuItem","sap/m/Input","sap/ui/integration/util/ParameterMap","sap/base/util/merge","sap/ui/core/Core","sap/m/Table","sap/m/Column","sap/m/ColumnListItem","sap/m/ScrollContainer","sap/base/util/ObjectPath","sap/ui/integration/util/BindingHelper"],function(e,t,a,s,n,r,l,i,o,d,u,p,_,g,c,m,f,y,v,b,h,S,T,I,x,w,P,E){"use strict";var D=e.extend("sap.ui.integration.editor.Settings",{metadata:{library:"sap.ui.integration"},renderer:null});var C=S.getLibraryResourceBundle("sap.ui.integration"),V,M,O=null,R,A,L,N,U,$,j,B,F,H,K,k;D.prototype.setConfiguration=function(e){this._originalConfig=e;e=h({},e);var t=new a(e);this.setModel(t,"currentSettings");this.bindElement({path:"currentSettings>/"})};D.prototype.open=function(e,t,a,s,n,r,l){var i=this.getModel("currentSettings").getData(),o=n.getParameterId();if(i.values){this.prepareFieldsInKey(i)}O=this;k=G(i,n);this.addDependent(k);this.oHost=s;this.fnApply=r;this.fnCancel=l;this._oOpener=n;M=true;e.addDependent(this);if(!i.allowDynamicValues&&i.values){S.byId(o+"_settings_popover_scroll_container").setHeight("155px")}this.getModel("currentSettings").checkUpdate(true,true);ie(C.getText("EDITOR_SELECT_FROM_LIST"),[]);if(t){var d=!a||a.getDomRef()===null||a.getDomRef().offsetWidth===0?270:a.getDomRef().offsetWidth;var u=!a||a.getDomRef()===null||a.getDomRef().offsetHeight===0?350:a.getDomRef().offsetHeight;k.setContentWidth(d+"px");k.setContentHeight(u-50+"px");var p="Right";var _=e.getDomRef().getBoundingClientRect().x;var g=document.body.offsetWidth;if(2*_>g){p="Left"}k.setPlacement(p);N.setValue(e._label);k.openBy(e)}else{k.open()}V=this.getModel("currentSettings");if(V.getProperty("/_hasDynamicValue")){J(o)}else if(V.getProperty("/_hasSettings")){q(o)}else if(V.getProperty("/allowDynamicValues")){J(o)}else if(V.getProperty("/allowSettings")){q(o)}};D.prototype._applyCurrentSettings=function(){this.fnApply(V.getData())};D.prototype._cancelCurrentSettings=function(){this.fnCancel(this._originalConfig)};D.prototype.destroy=function(){this.removeDependent(k);return e.prototype.destroy.apply(this,arguments)};function G(e,a){var n=a.getParameterId(),r=Y(n),o=Z(e,n),d=te(n),u=ae(n),p=se(e,a),_=new t({id:n+"_settings_popover",showArrow:true,contentWidth:"400px",showHeader:false,horizontalScrolling:false,verticalScrolling:false,modal:false,footer:new l({content:[o,new i,new s(n+"_settings_popover_ok_btn",{text:C.getText("EDITOR_MORE_OK"),type:"Emphasized",press:function(){if(e.values){var t=S.byId(n+"_settings_popover_pav_table"),a=t.getSelectedContexts(),s=[];if(V.getProperty("/selectedValues")==="Partion"){for(var r=0;r<a.length;r++){var l=O.getKeyFromItem(a[r].getObject());s.push(l)}Q("pageAdminValues",s)}else{Q("pageAdminValues",[])}}O._applyCurrentSettings();M=false;_.close()}}),new s(n+"_settings_popover_cancel_btn",{text:C.getText("EDITOR_MORE_CANCEL"),press:function(){_.close()}})]}),afterClose:function(){if(M){O._cancelCurrentSettings()}M=true;_.destroy()},afterOpen:function(){window.requestAnimationFrame(function(){_.getDomRef()&&(_.getDomRef().style.opacity="1")});if(e.values){var t=S.byId(n+"_settings_popover_pav_table"),a=V.getProperty("/_next/pageAdminValues");if(a!==undefined&&a.length>0){t.removeSelections();V.setProperty("/selectedValues","None");var s=V.getProperty("/_next/pageAdminValues"),r=t.getItems();for(var l=0;l<s.length;l++){for(var i=0;i<r.length;i++){var o=O.getKeyFromItem(r[i].getBindingContext().getObject());if(s[l]===o){t.setSelectedItem(r[i])}}}V.setProperty("/selectedValues","Partion")}else{t.selectAll();V.setProperty("/selectedValues","All")}}}});_.setCustomHeader(r);_.addContent(d);_.addContent(u);_.addContent(p);_.addStyleClass("sapUiIntegrationFieldSettings");return _}function W(e){F=new r({text:C.getText("EDITOR_MORE_SETTINGS"),tooltip:C.getText("EDITOR_MORE_SETTINGS"),key:"settings",icon:"sap-icon://action-settings",width:"50%",press:function(t){q(e)}}).addStyleClass("setbtn");return F}function z(e){F=W(e);H=new n(e+"_settings_popover_segmented_btn",{width:"100%",visible:"{= ${currentSettings>allowDynamicValues} && ${currentSettings>allowSettings}}",items:[new r({text:C.getText("EDITOR_MORE_DYNAMICVALUES"),tooltip:C.getText("EDITOR_MORE_DYNAMICVALUES"),key:"dynamic",icon:"{= ${currentSettings>_hasDynamicValue} ? 'sap-icon://display-more' : 'sap-icon://enter-more'}",width:"50%",press:function(t){J(e)}}).addStyleClass("dynbtn sel"),F]});return H}function Y(e){H=z(e);var t=new g(e+"_settings_popover_dynamicvalue_txt",{text:C.getText("EDITOR_MORE_DYNAMICVALUES"),tooltip:C.getText("EDITOR_MORE_DYNAMICVALUES"),visible:"{= ${currentSettings>allowDynamicValues} && !${currentSettings>allowSettings}}"}).addStyleClass("sapUiTinyMagin");var a=new g(e+"_settings_popover_settings_txt",{text:C.getText("EDITOR_MORE_SETTINGS"),visible:"{= !${currentSettings>allowDynamicValues} && ${currentSettings>allowSettings}}"}).addStyleClass("sapUiTinyMagin");var s=new l({content:[H,t,a]}).addStyleClass("headertitle");return s}function Z(e,t){K=new s(t+"_settings_popover_reset_btn",{type:"Transparent",text:C.getText("EDITOR_MORE_RESET"),enabled:"{= ${currentSettings>_next/visible} === (typeof(${currentSettings>visibleToUser}) === 'undefined' ? false : !${currentSettings>visibleToUser}) || ${currentSettings>_next/editable} === (typeof(${currentSettings>editableToUser}) === 'undefined' ? false : !${currentSettings>editableToUser}) || ${currentSettings>_next/allowDynamicValues} === (typeof(${currentSettings>allowDynamicValues}) === 'undefined' ? false : !${currentSettings>allowDynamicValues}) || ${currentSettings>_beforeValue} !== ${currentSettings>value}}",tooltip:C.getText("EDITOR_MORE_SETTINGS_P_ADMIN_RESET"),press:function(){var a=typeof V.getProperty("/visibleToUser")==="undefined"?true:V.getProperty("/visibleToUser");var s=typeof V.getProperty("/editableToUser")==="undefined"?true:V.getProperty("/editableToUser");var n=typeof V.getProperty("/allowDynamicValues")==="undefined"?true:V.getProperty("/allowDynamicValues");var r=S.byId(t+"_settings_popover");Q("visible",a);Q("editable",s);Q("allowDynamicValues",n);if(V.getProperty("/translatable")){if(V.getProperty("/_translatedDefaultValue")&&V.getProperty("/_translatedDefaultValue")!==""){V.setProperty("/value",V.getProperty("/_translatedDefaultValue"))}else if(V.getProperty("/_translatedDefaultPlaceholder")&&V.getProperty("/_translatedDefaultPlaceholder")!==""){V.setProperty("/value",V.getProperty("/_translatedDefaultPlaceholder"))}V.setProperty("/_changed",false)}else{V.setProperty("/value",V.getProperty("/_beforeValue"))}if(e.values){var l=S.byId(t+"_settings_popover_pav_table"),i=V.getProperty("/_next/pageAdminValues"),o=l.getItems();if(i!==undefined&&i.length>0&&i.length<o.length){l.removeSelections();for(var d=0;d<i.length;d++){for(var u=0;u<o.length;u++){var p=O.getKeyFromItem(o[u].getBindingContext().getObject());if(i[d]===p){l.setSelectedItem(o[u])}}}V.setProperty("/selectedValues","Partion")}else{l.selectAll();V.setProperty("/selectedValues","All")}}r.getFooter().getContent()[2].firePress()}}).addStyleClass("resetbutton");return K}function q(e){A.setVisible(true);R.setVisible(false);S.byId(e+"_settings_popover_segmented_btn").setSelectedKey("settings");var t=S.byId(e+"_settings_popover_currentvalue");t.setVisible(false)}function J(e){A.setVisible(false);R.setVisible(true);S.byId(e+"_settings_popover_segmented_btn").setSelectedKey("dynamic");var t=O.getModel("contextflat"),a=t._getValueObject(V.getProperty("/value"));if(a&&a.object.label){N.setValue(a.object.label);ie(a.object.description,a.object.tags);if(a.path==="empty"){N.setValue(a.object.label)}de(a)}var s=S.byId(e+"_settings_popover_currentvalue");s.setVisible(true)}function Q(e,t){if(!V.getProperty("/_next")){V.setProperty("/_next",{})}V.setProperty("/_next/"+e,t)}function X(e,t){var a=[];for(var s in e){if(e[s]&&e[s].label){var n=new y({text:e[s].label});n.__data=e[s];e[s].pathvalue=(t+"/"+s).substring(1);a.push(n);var r=X(e[s],t+"/"+s);for(var l=0;l<r.length;l++){n.addItem(r[l])}}}return a}var ee=[{formatMethod:"format.DateTime",sourceTypes:["datetime","date"],label:"Relative date/datetime text of the value",description:"Should be applied to dynamic values of type date or datetime or string values that represent a datetime in the format 'yyyy-MM-ddZhh:mm:ss'",example:"4 weeks ago",syntax:"handlebars",binding:"{= format.dateTime('__|VALUE|__',{relative:true})}"},{formatMethod:"format.DateTime",sourceTypes:["datetime","date"],label:"Short date/datetime text of the value",description:"Should be applied to dynamic values of type date, date-time or text values that represent a datetime in the format 'yyyy-MM-ddZhh:mm:ss.sss'",example:"9/18/20, 2:09 PM",binding:"{= format.dateTime('__|VALUE|__',{style:'short'})}"},{formatMethod:"format.DateTime",sourceTypes:["datetime","date"],label:"Medium date/datetime text of the value",description:"Should be applied to dynamic values of type date, date-time or text values that represent a datetime in the format 'yyyy-MM-ddThh:mm:ss.sssZ'",example:"Sep 18, 2020, 2:09:04 PM",binding:"{= format.dateTime('__|VALUE|__',{style:'medium'})}"},{formatMethod:"format.DateTime",sourceTypes:["datetime","date"],label:"Long date, date-time text of the value",description:"Should be applied to dynamic values of type date or date-time or string values that represent a datetime in the format 'yyyy-MM-ddThh:mm:ss.sssZ'",example:"Sep 18, 2020, 2:09:04 PM",binding:"{= format.dateTime('__|VALUE|__',{style:'long'})}"}];function te(e){R=new o({visible:true});R.addStyleClass("sapUiSmallMargin");N=new v(e+"_settings_popover_dynamicvalue_input",{width:"100%",showValueHelp:true,valueHelpOnly:true,valueHelpRequest:function(){if(U){U.destroy()}U=new f({});$=X(R.getModel("context").getData(),"");for(var e=0;e<$.length;e++){U.addItem($[e])}U.attachItemSelected(function(e){var t=e.getParameter("item").__data;ie(t.description||"",t.tags||[]);N.setValue(t.placeholder||t.label);var a=O.getModel("contextflat");de(a._getPathObject(t.pathvalue))});N.addDependent(U);U.addStyleClass("sapUiIntegrationFieldSettingsMenu");U.openBy(N,false,null,null,"1 0")}});N.addStyleClass("selectvariable");var t=new _(e+"_settings_popover_dynamicvalue_label",{text:"Select a dynamic value"});N.addAriaLabelledBy(t);var a=new o({items:[t,N]});R.addItem(a);L=new g(e+"_settings_popover_dynamicvalue_desc_txt",{text:"",maxLines:6,renderWhitespace:true});a=new o({width:"100%",items:[L]});L.addStyleClass("description");R.addItem(a);if(ee.length===-1){j=new u(e+"_settings_popover_dynamicvalue_format_select",{width:"100%",enabled:true,change:function(){B.setText(j.getSelectedItem()._data.description)}});a=new o({visible:false,items:[new _({text:"Customize the value..."}),j]});R.addItem(a);B=new g(e+"_settings_popover_dynamicvalue_format_label",{text:"",maxLines:4,renderWhitespace:true});B.addStyleClass("description");a=new o({width:"100%",items:[B]});R.addItem(a);R.getItems()[2].getItems()[0].addStyleClass("sapUiTinyMarginTop")}R.getItems()[0].getItems()[0].addStyleClass("sapUiTinyMarginTop");return R}function ae(e){var t=new g(e+"_settings_popover_actualvalue_label",{text:C.getText("EDITOR_ACTUAL_VALUE")});var a=new v(e+"_settings_popover_actualvalue_input",{value:{path:"currentSettings>_currentContextValue"},editable:false});a.addAriaLabelledBy(t);var s=new o(e+"_settings_popover_currentvalue",{width:"100%",items:[t,a]});s.addStyleClass("currentval");return s}function se(e,t){var n=t.getParameterId();A=new o({visible:false});var r=(new o).addStyleClass("commonSettings");A.addItem(r);r.addItem(new c({text:C.getText("EDITOR_MORE_SETTINGS_P_ADMIN"),wrapping:true}).addStyleClass("stitle"));var l=new _(n+"_settings_popover_adminvisible_label",{text:C.getText("EDITOR_MORE_SETTINGS_P_ADMIN_VISIBLE"),wrapping:true});var i=new m(n+"_settings_popover_adminvisible_checkbox",{selected:"{= ${currentSettings>_next/visible} !== false}",select:function(e){Q("visible",e.getParameter("selected"))}});i.addAriaLabelledBy(l);r.addItem(new d({items:[l,i]}).addStyleClass("cbrow"));var u=new _(n+"_settings_popover_admineditable_label",{text:C.getText("EDITOR_MORE_SETTINGS_P_ADMIN_EDIT"),wrapping:true});var p=new m(n+"_settings_popover_admineditable_checkbox",{selected:"{= ${currentSettings>_next/editable} !== false}",enabled:"{= ${currentSettings>_next/visible} !== false}",select:function(e){Q("editable",e.getParameter("selected"))}});p.addAriaLabelledBy(u);r.addItem(new d({items:[u,p]}).addStyleClass("cbrow"));var f=new _(n+"_settings_popover_allowdynamicvalues_label",{text:C.getText("EDITOR_MORE_SETTINGS_P_ADMIN_DYN"),wrapping:true});var y=new m(n+"_settings_popover_allowdynamicvalues_checkbox",{selected:"{= ${currentSettings>_next/allowDynamicValues} !== false}",enabled:"{= ${currentSettings>_next/visible} !== false && ${currentSettings>_next/editable} !== false}",select:function(e){Q("allowDynamicValues",e.getParameter("selected"))}});y.addAriaLabelledBy(f);r.addItem(new d({visible:"{= ${currentSettings>allowDynamicValues}!== false}",items:[f,y]}).addStyleClass("cbrow"));if(e.values){var v;if(e.values.data){var b=e.values.data.path,h;if(b&&b!=="/"){if(b.startsWith("/")){b=b.substring(1)}if(b.endsWith("/")){b=b.substring(0,b.length-1)}h=b.split("/");v=P.get(["_values",h],e)}else{v=P.get(["_values"],e)}}else if(t.getParent().getParent().getAggregation("_extension")){var S=e.values.path;if(S.length>1){S=S.substring(1)}v=P.get([S],t.getModel().getData())}r.addItem(new d({visible:"{= ${currentSettings>_next/visible} !== false && ${currentSettings>_next/editable} !== false}",items:[new _(n+"_settings_popover_allowselectedvalues_label",{text:C.getText("EDITOR_MORE_SETTINGS_P_ADMIN_VALUES_LIST"),tooltip:C.getText("EDITOR_MORE_SETTINGS_P_ADMIN_VALUES_LIST_TOOLTIPS"),wrapping:false}),new s(n+"_settings_popover_allowselectedvalues_all_btn",{type:"Transparent",enabled:v!==undefined,icon:{path:"currentSettings>selectedValues",formatter:function(e){if(e==="All"){return"sap-icon://multiselect-all"}else if(e==="Partion"){return"sap-icon://multi-select"}else if(e==="None"){return"sap-icon://multiselect-none"}}},tooltip:{path:"currentSettings>selectedValues",formatter:function(e){if(e==="All"){return C.getText("EDITOR_MORE_SETTINGS_P_ADMIN_DESELECT_ALL")}else{return C.getText("EDITOR_MORE_SETTINGS_P_ADMIN_SELECT_ALL")}}},press:function(){ne(n)}})]}).addStyleClass("cbrow"));var D=new T({id:n+"_settings_popover_pav_table",mode:"MultiSelect",width:"84%",select:function(e){re(e,n)},columns:[new I]}).addStyleClass("tableHdr");var V=e.values.item.text,M=new a(v);D.setModel(M);var O=(new x).addStyleClass("pavlistItem");if(v){for(var R=0;R<v.length;R++){O.addCell(new d({items:[new g({text:E.createBindingInfos(V)}).addStyleClass("pavTblCellText")]})).addStyleClass("pavlistItem")}}D.bindItems("/",O);var L=new w({id:n+"_settings_popover_scroll_container",height:"125px",width:"94%",vertical:true,horizontal:false,visible:"{= ${currentSettings>_next/visible} !== false && ${currentSettings>_next/editable} !== false}",content:[D]}).addStyleClass("SettingsPAVTable");A.addItem(L)}return A}function ne(e){var t=S.byId(e+"_settings_popover_pav_table"),a=S.byId(e+"_settings_popover_reset_btn"),s=V.getProperty("/selectedValues");if(s==="All"){t.removeSelections();V.setProperty("/selectedValues","None")}else{t.selectAll();V.setProperty("/selectedValues","All")}if(!a.getEnabled()){a.setEnabled(true)}}function re(e,t){var a=e.getSource(),s=a.getSelectedItems(),n=a.getItems(),r=S.byId(t+"_settings_popover_reset_btn");if(s.length===n.length){V.setProperty("/selectedValues","All")}else if(s.length<n.length&&s.length>0){V.setProperty("/selectedValues","Partion")}else{V.setProperty("/selectedValues","None")}if(!r.getEnabled()){r.setEnabled(true)}}function le(e,t){e=e||[];j.removeAllItems();var a=[];j.addItem(new p({text:"No customizing needed",key:""}));for(var s=0;s<ee.length;s++){var n=ee[s],r=new p({text:n.label,key:"key"+s});r._data=n;if(n.sourceTypes.indexOf(t)>-1||e.indexOf(n.formatMethod)>-1){j.addItem(r)}else{a.push(r)}}for(var s=0;s<a.length;s++){j.addItem(a[s])}}function ie(e,t){t=t||[];if(t.indexOf("technical")>-1){e=e+"\n"+C.getText("EDITOR_MORE_DYNAMICVALUES_TECHHINT")}L.setText(e)}function oe(e){if(ee.length===-1){if(!e){j.removeAllItems();j.addItem(new p({text:"No customizing available for this value"}));B.setText("");j.setEnabled(false)}else{le(e.customize,e.type);j.setEnabled(true)}}}function de(e){if(e){V.setProperty("/_hasDynamicValue",true);var t=e.value;V.setProperty("/value",t);V.setProperty("/_contextpath",e.path);if(e.object&&e.object.value&&e.object.value.indexOf("{{")===0){V.setProperty("/_currentContextValue",b.processPredefinedParameter(e.object.value));oe(e.object)}else{if(e.path==="empty"){V.setProperty("/value","");V.setProperty("/_currentContextValue","");V.setProperty("/_hasDynamicValue",false);oe()}else{oe(e.object);if(e.object&&e.object.hasOwnProperty("value")){V.setProperty("/_currentContextValue",e.object.value)}else{O.oHost.getContextValue(e.path+"/value").then(function(t){if(t===null){V.setProperty("/_currentContextValue","(not available)")}else{V.setProperty("/_currentContextValue",t)}e.object&&(e.object.value=t)})}}}}}D._private=function(){return{oPopover:k,oSegmentedButton:H,oSettingsButton:F,oDynamicPanel:R,oSettingsPanel:A,oCurrentModel:V,updateCurrentValue:de,oCurrentInstance:O,oDynamicValueField:N,oResetToDefaultButton:K,getMenuItems:function(){return $},getMenu:function(){return U}}};D.prototype.prepareFieldsInKey=function(e){this._sKeySeparator=e.values.keySeparator;if(!this._sKeySeparator){this._sKeySeparator="#"}var t=e.values.item.key;this._aFields=t.split(this._sKeySeparator);for(var a in this._aFields){if(this._aFields[a].startsWith("{")){this._aFields[a]=this._aFields[a].substring(1)}if(this._aFields[a].endsWith("}")){this._aFields[a]=this._aFields[a].substring(0,this._aFields[a].length-1)}}};D.prototype.getKeyFromItem=function(e){var t="";this._aFields.forEach(function(a){t+=e[a].toString()+this._sKeySeparator}.bind(this));if(t.endsWith(this._sKeySeparator)){t=t.substring(0,t.length-this._sKeySeparator.length)}return t};return D});
//# sourceMappingURL=Settings.js.map