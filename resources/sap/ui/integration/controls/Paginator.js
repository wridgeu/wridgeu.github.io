/*!
* OpenUI5
 * (c) Copyright 2009-2022 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
*/
sap.ui.define(["../library","sap/m/library","sap/ui/base/EventProvider","sap/ui/core/Core","sap/ui/core/Control","sap/ui/core/Configuration","sap/ui/core/Icon","./PaginatorRenderer"],function(t,e,i,n,a,s,r){"use strict";var o=n.getConfiguration().getAnimationMode(),d=o!==s.AnimationMode.none&&o!==s.AnimationMode.minimal,g=200;var h=a.extend("sap.ui.integration.controls.Paginator",{metadata:{library:"sap.ui.integration",properties:{card:{type:"object"},pageNumber:{type:"int",defaultValue:0},pageCount:{type:"int",defaultValue:0},pageSize:{type:"int",defaultValue:0},totalCount:{type:"int"},skip:{type:"int"}},aggregations:{_prevIcon:{type:"sap.ui.core.Icon",multiple:false,visibility:"hidden"},_nextIcon:{type:"sap.ui.core.Icon",multiple:false,visibility:"hidden"}}}});h.create=function(t,e){if(!e){return null}return new h({card:t,totalCount:e.totalCount,pageSize:e.pageSize,skip:e.skip})};h.prototype.init=function(){this._listUpdateFinishedHandler=this._listUpdateFinished.bind(this);this.setAggregation("_prevIcon",new r({src:"sap-icon://slim-arrow-left",useIconTooltip:false,decorative:false,press:this._previous.bind(this)}));this.setAggregation("_nextIcon",new r({src:"sap-icon://slim-arrow-right",useIconTooltip:false,decorative:false,press:this._next.bind(this)}))};h.prototype.exit=function(){var t=this.getCard(),e,n;if(t){if(this._dataChangedHandler){t.detachEvent("_contentDataChange",this._dataChangedHandler)}e=t.getCardContent();if(e){n=e.getAggregation("_content");if(n&&i.hasListener(n,"updateFinished",this._listUpdateFinishedHandler)){n.detachEvent("updateFinished",this._listUpdateFinishedHandler)}}}delete this._listUpdateFinishedHandler;delete this._iPreviousStartIndex;delete this._oClonedContent};h.prototype.isServerSide=function(){return this.getTotalCount()};h.prototype._dataChanged=function(){var t=this.getCard(),e=t.getCardContent(),n,a,s;if(!e||!e.isA("sap.ui.integration.cards.BaseContent")){this.setPageCount(0);return}this.setModel(e.getModel());n=e.getAggregation("_content");s=i.hasListener(n,"updateFinished",this._listUpdateFinishedHandler);if(this._hasAnimation()&&!s){n.attachEvent("updateFinished",this._listUpdateFinishedHandler);if(this.isServerSide()){e.getAggregation("_loadingProvider")._oContentPlaceholder.addDelegate({onAfterRendering:this.onPlaceholderAfterRendering.bind(this)})}}if(s){this._clearAnimation(this)}a=this.getTotalCount()||e.getDataLength();this.setPageCount(Math.ceil(a/this.getPageSize()));this.setPageNumber(Math.min(Math.max(0,this.getPageNumber()),this.getPageCount()-1));this.sliceData()};h.prototype.setCard=function(t){this.setProperty("card",t,true);this._dataChangedHandler=this._dataChanged.bind(this);if(t){t.attachEvent("_contentDataChange",this._dataChangedHandler)}return this};h.prototype.sliceData=function(){var t=this.getCard(),e,i,n;if(!t){return}e=t.getCardContent();i=this.getPageNumber()*this.getPageSize();n=this._iPreviousStartIndex!==undefined&&this._iPreviousStartIndex!==i;if(n){this._prepareAnimation(i)}if(this.isServerSide()){if(n){this.getModel("paginator").setData({skip:i,size:this.getPageSize(),pageIndex:this.getPageNumber()});if(this._hasAnimation()){e.getAggregation("_loadingProvider")._bAwaitPagination=true;t.getAggregation("_loadingProvider")._bAwaitPagination=true}}}else{e.sliceData(i,i+this.getPageSize())}this._iPreviousStartIndex=i};h.prototype._prepareAnimation=function(t){if(!this._hasAnimation()){return}var e=this.getCard().getCardContent().getDomRef(),i=e.cloneNode(true);this._bActiveAnimation=true;this._bReverseAnimation=this._iPreviousStartIndex>t;i.removeAttribute("id");i.querySelectorAll("*[id]").forEach(function(t){t.removeAttribute("id")});i.classList.add("sapFCardContentCloned");if(this._bReverseAnimation){i.classList.add("sapFCardContentReverseAnim")}if(this.isServerSide()){this._oClonedContent=i}else{e.classList.add("sapFCardContentOriginal");if(this._bReverseAnimation){e.classList.add("sapFCardContentReverseAnim")}e.parentElement.insertBefore(i,e)}};h.prototype._clearAnimation=function(){if(!this._hasAnimation()){return}var t=this.getCard(),e=t.getCardContent(),i=e.getDomRef(),n=i.previousSibling,a,s;a=t.getAggregation("_loadingProvider");s=e.getAggregation("_loadingProvider");if(s._bAwaitPagination){s._bAwaitPagination=false;a._bAwaitPagination=false}else{n.parentNode.removeChild(n);i.classList.remove("sapFCardContentOriginal");i.classList.remove("sapFCardContentTransition");i.classList.remove("sapFCardContentReverseAnim");e.hideLoadingPlaceholders();a.setLoading(false);this._bActiveAnimation=false}};h.prototype._listUpdateFinished=function(){if(!this._bActiveAnimation||this.isServerSide()){return}var t=this.getCard().getCardContent(),e=t.getDomRef(),i=e.previousSibling;i.addEventListener("transitionend",function(){i.parentNode.removeChild(i);e.classList.remove("sapFCardContentOriginal");e.classList.remove("sapFCardContentTransition");e.classList.remove("sapFCardContentReverseAnim");this._bActiveAnimation=false}.bind(this));e.classList.add("sapFCardContentTransition");i.classList.add("sapFCardContentTransition")};h.prototype.onPlaceholderAfterRendering=function(){if(!this._oClonedContent){return}var t=this.getCard(),e=t.getCardContent(),i=e.getDomRef(),n=this._oClonedContent;i.classList.add("sapFCardContentOriginal");i.parentElement.insertBefore(n,i);if(this._bReverseAnimation){i.classList.add("sapFCardContentReverseAnim")}this._oClonedContent.addEventListener("transitionend",function(){setTimeout(this._clearAnimation.bind(this),g)}.bind(this));this._oClonedContent=null;setTimeout(function(){n.classList.add("sapFCardContentTransition");i.classList.add("sapFCardContentTransition")},30)};h.prototype._getNavigationArrow=function(t){return this.getAggregation("_"+t+"Icon")};h.prototype._hasAnimation=function(){return d&&this.getCard().getCardContent().isA("sap.ui.integration.cards.ListContent")};h.prototype._previous=function(){if(this._bActiveAnimation){return}this.setPageNumber(Math.max(0,this.getPageNumber()-1));this.sliceData()};h.prototype._next=function(){if(this._bActiveAnimation){return}this.setPageNumber(Math.min(this.getPageCount()-1,this.getPageNumber()+1));this.sliceData()};h.prototype.onmousedown=function(t){var e=t.target,i=e.getAttribute("data-slide");if(i&&!e.classList.contains("sapMCrslActive")){this.setPageNumber(parseInt(i)-1);this.sliceData()}};return h});