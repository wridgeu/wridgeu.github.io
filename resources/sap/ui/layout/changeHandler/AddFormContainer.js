/*!
 * OpenUI5
 * (c) Copyright 2009-2022 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/fl/changeHandler/Base","sap/ui/core/util/reflection/JsControlTreeModifier"],function(e,r){"use strict";var t={};t.applyChange=function(r,t,o){var n=o.modifier;var a=o.appComponent;var i=o.view;var u=r.getContent();var l=r.getTexts();if(l&&l.groupLabel&&l.groupLabel.value&&u&&u.group&&(u.group.selector||u.group.id)){var s=l.groupLabel.value;var p=u.group.index;var c=u.group.selector||{id:u.group.id};var g=Object.assign({},c);g.id=g.id+"--title";r.setRevertData({newGroupSelector:c});if(n.bySelector(g,a)){return e.markAsNotApplicable("Control to be created already exists:"+g)}else if(n.bySelector(c,a)){return e.markAsNotApplicable("Control to be created already exists:"+c)}return Promise.resolve().then(function(){return Promise.all([n.createControl("sap.ui.core.Title",a,i,g),n.createControl("sap.ui.layout.form.FormContainer",a,i,c)])}).then(function(e){var r=e[0];var o=e[1];n.setProperty(r,"text",s);return Promise.resolve().then(n.insertAggregation.bind(n,o,"title",r,0,i)).then(n.insertAggregation.bind(n,t,"formContainers",o,p,i))})}else{return Promise.resolve()}};t.completeChangeContent=function(e,t,o){var n=o.appComponent;if(t.newLabel){e.setText("groupLabel",t.newLabel,"XFLD")}else{throw new Error("Cannot create a new group: oSpecificChangeInfo.groupLabel attribute required")}var a={group:{}};if(t.index===undefined){throw new Error("Cannot create a new group: oSpecificChangeInfo.index attribute required")}else{a.group.index=t.index}if(t.newControlId){a.group.selector=r.getSelector(t.newControlId,n)}else{throw new Error("Cannot create a new group: oSpecificChangeInfo.newControlId attribute required")}e.setContent(a)};t.revertChange=function(e,r,t){var o=t.appComponent;var n=t.view;var a=t.modifier;var i=e.getRevertData().newGroupSelector;var u=a.bySelector(i,o,n);return Promise.resolve().then(function(){return a.removeAggregation(r,"formContainers",u)}).then(function(){a.destroy(u);e.resetRevertData()})};return t},true);