/*!
 * OpenUI5
 * (c) Copyright 2009-2021 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/base/Log","sap/base/util/ObjectPath","sap/ui/core/mvc/View","sap/ui/core/Component"],function(e,n,i,t){"use strict";sap.ui.extensionpoint=function(n,i,t,a,r){e.warning("Do not use deprecated factory function 'sap.ui.extensionpoint'. Use 'sap.ui.core.ExtensionPoint.load' instead","sap.ui.extensionpoint",null,function(){return{type:"sap.ui.extensionpoint",name:i}});return o._factory(n,i,t,a,r)};var o=sap.ui.extensionpoint;o._factory=function(a,r,s,f,u){var g,c,l,m,p;if(a){if(a.isA("sap.ui.core.mvc.View")){m=a.sViewName;c=a}else if(a.isA("sap.ui.core.Fragment")){m=a.getFragmentName();c=a._oContainingView}if(!sap.ui.getCore().getConfiguration().getDisableCustomizing()){p=t.getOwnerComponentFor(a);if(p){if(p.getExtensionComponent){p=p.getExtensionComponent();if(!p){throw new Error("getExtensionComponent() must return an instance.")}}g=p._getManifestEntry("/sap.ui5/extends/extensions/sap.ui.viewExtensions/"+m+"/"+r,true)}}}if(g){if(g.className){var d=sap.ui.requireSync(g.className.replace(/\./g,"/"));d=d||n.get(g.className);var x=c&&g.id?c.createId(g.id):g.id;e.info("Customizing: View extension found for extension point '"+r+"' in View '"+c.sViewName+"': "+g.className+": "+(g.viewName||g.fragmentName));if(g.className==="sap.ui.core.Fragment"){var w=new d({id:x,type:g.type,fragmentName:g.fragmentName,containingView:c});l=Array.isArray(w)?w:[w]}else if(g.className==="sap.ui.core.mvc.View"){c=i._legacyCreate({type:g.type,viewName:g.viewName,id:x});l=[c]}else{e.warning("Customizing: Unknown extension className configured (and ignored) in Component.js for extension point '"+r+"' in View '"+c.sViewName+"': "+g.className)}}else{e.warning("Customizing: no extension className configured in Component.js for extension point '"+r+"' in View '"+c.sViewName+"': "+g.className)}}else if(o._fnExtensionProvider){var v=o._fnExtensionProvider(c);var N;if(c.isA("sap.ui.core.Fragment")){N=c._sExplicitId;var y=c.getController();c=y&&typeof y.isA==="function"&&y.isA("sap.ui.core.mvc.Controller")&&y.getView();if(c){N=c.getLocalId(N)||N}}if(v){if(!c){e.warning("View instance could not be passed to ExtensionPoint Provider for extension point '"+r+"' "+"in fragment '"+N+"'.")}return[{providerClass:v,view:c,fragmentId:N,name:r,createDefault:s,targetControl:undefined,aggregationName:undefined,index:undefined,ready:function(e){var n=this._nextSibling;while(n!=null){n.index+=e.length;n=n._nextSibling}},_isExtensionPoint:true,_nextSibling:null}]}}if(!l&&typeof s==="function"){l=s()}var C=function(n){if(n&&!Array.isArray(n)){n=[n]}if(n&&f){var i=f.getMetadata().getAggregation(u);if(i){for(var t=0,o=n.length;t<o;t++){f[i._sMutator](n[t])}}else{e.error("Creating extension point failed - Tried to add extension point with name "+r+" to an aggregation of "+f.getId()+" in view "+c.sViewName+", but sAggregationName was not provided correctly and I could not find a default aggregation")}}return n||[]};if(l&&typeof l.then==="function"){return l.then(C)}else{return C(l)}};o.registerExtensionProvider=function(n){if(n==null){delete o._fnExtensionProvider}else if(typeof n=="function"){o._fnExtensionProvider=n}else{e.error("ExtensionPoint provider must be a function!")}};o.load=function(e){return Promise.resolve(o._factory(e.container,e.name,e.createDefaultContent))};return o});