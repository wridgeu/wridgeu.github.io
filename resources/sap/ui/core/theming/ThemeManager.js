/*!
 * OpenUI5
 * (c) Copyright 2009-2023 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/base/assert","sap/base/Eventing","sap/base/Log","sap/base/config","sap/base/i18n/Localization","sap/base/util/each","sap/base/util/LoaderExtensions","sap/ui/Device","sap/ui/Global","sap/ui/core/Lib","sap/ui/core/Theming","sap/ui/core/theming/ThemeHelper","sap/ui/dom/includeStylesheet"],function(e,t,a,r,i,s,n,u,o,m,c,l,h){"use strict";var f=150;var d={};var g=/\.sapUiThemeDesignerCustomCss/i;var p=0;var v="sap-ui-core-customcss";var T=false;var b=null;var y=null;var C={};var L;var k={themeLoaded:true,checkThemeChanged:function(){k.reset();x(true);if(!L){k.fireThemeChanged()}},reset:function(){k.themeLoaded=false;if(L){clearTimeout(L);L=null;p=0;y=null;C={}}},_includeLibraryThemeAndEnsureThemeRoot:function(e){var t=e.name;_(t,c.getTheme());_(t,"base");d[t]=e;if(!e.preloadedCss){k.includeLibraryTheme(t,e.variant,e)}},includeLibraryTheme:function(t,s,n){e(typeof t==="string","sLibName must be a string");e(s===undefined||typeof s==="string","sVariant must be a string or undefined");var u=n;if(typeof u==="object"){u=w(n)}if(t!="sap.ui.legacy"&&t!="sap.ui.classic"){var o={name:"sapUiXxCssVariables",type:r.Type.Boolean};if(!s){s=""}var m=r.get(o)?"_skeleton":"";var l=i.getRTL()?"-RTL":"";var f,d=t+(s.length>0?"-["+s+"]":s);if(t&&t.indexOf(":")==-1){f="library"+s+m+l}else{f=t.substring(t.indexOf(":")+1)+s;t=t.substring(0,t.indexOf(":"))}var g="sap-ui-theme-"+d;var p=document.getElementById(g)&&document.getElementById(g).href;var v=new URL(k._getThemePath(t,c.getTheme()),document.baseURI).toString();var T=document.createElement("link");T.href=v+f+".css"+(u?u:"");var b=T.href;T.href=v+"css_variables.css"+(u?u:"");var y=T.href;if(!(b===p||y===p)){U(g);o.type=r.Type.String;if(/^(true|x|additional)$/i.test(r.get(o))){a.info("Including "+y+" -  sap.ui.core.theming.ThemeManager.includeLibraryTheme()");h(y,g);g="sap-ui-themeskeleton-"+d;U(g)}a.info("Including "+b+" -  sap.ui.core.theming.ThemeManager.includeLibraryTheme()");h(b,g);var C=sap.ui.require("sap/ui/core/theming/Parameters");if(C){C._addLibraryTheme(d)}k.checkThemeChanged()}}},_getThemePath:function(e,t){_(e,t);return sap.ui.require.toUrl((e+".themes."+t).replace(/\./g,"/")+"/")},_updateThemeUrls:function(e,t){var a=document.querySelectorAll("link[id^=sap-ui-theme-],link[id^=sap-ui-themeskeleton-]");Array.prototype.forEach.call(a,function(a){I(a,e,t)})},fireThemeChanged:function(){var e=sap.ui.require("sap/ui/core/theming/Parameters");if(e){e._reset(true)}k.fireEvent("ThemeChanged",{theme:c.getTheme()})}};function E(){var e=c.getTheme();var t=k._getThemePath("sap.ui.core",e)+"custom.css";var r=e.indexOf("sap_")===0||e==="base";var i=true;var n=[];if(T&&b===e){d[v]={}}function u(s){var u="sap-ui-theme-"+s;var o=l.checkAndRemoveStyle({prefix:"sap-ui-theme-",id:s});if(o&&document.getElementById("sap-ui-themeskeleton-"+s)){o=l.checkAndRemoveStyle({prefix:"sap-ui-themeskeleton-",id:s})}i=i&&o;if(i){if(!T||b!=e){if(!r&&S(s)){var m=t;var c=w(d["sap.ui.core"]);if(c){m+=c}h(m,v);T=true;a.debug("ThemeManager: delivered custom CSS needs to be loaded, Theme not yet applied");b=e;i=false;return false}else if(T){var f=document.querySelector("LINK[id='"+v+"']");if(f){f.remove();a.debug("ThemeManager: Custom CSS removed")}T=false}}}if(!r&&o&&!C[s]){var g=document.getElementById(u);if(g&&g.getAttribute("data-sap-ui-ready")==="false"&&!(g.sheet&&l.hasSheetCssRules(g.sheet))){n.push(s)}}}s(d,u);if(n.length>0){if(!y){for(var o in d){var m=l.getMetadata(o);if(m&&m.Extends&&m.Extends[0]){y=m.Extends[0];break}}}if(y){n.forEach(function(t){var r="sap-ui-theme-"+t;var i=document.getElementById(r);a.warning("ThemeManager: Custom theme '"+e+"' could not be loaded for library '"+t+"'. "+"Falling back to its base theme '"+y+"'.");I(i,y);C[t]=true});i=false}}if(!i){a.debug("ThemeManager: Theme not yet applied.")}else{b=e}return i}function S(e){var t=window.document.getElementById("sap-ui-theme-"+e);if(!t){return false}var r=window.getComputedStyle(t,":after");var i=r?r.getPropertyValue("content"):null;if(!i&&u.browser.safari){var s=document.documentElement;s.classList.add("sapUiThemeDesignerCustomCss");i=window.getComputedStyle(s,":after").getPropertyValue("content");s.classList.remove("sapUiThemeDesignerCustomCss")}if(i&&i!=="none"){try{if(i[0]==="'"||i[0]==='"'){i=i.substring(1,i.length-1)}return i==="true"}catch(e){a.error("Custom check: Error parsing JSON string for custom.css indication.",e)}}var n=t.sheet?l.safeAccessSheetCssRules(t.sheet):null;if(!n||n.length===0){a.warning("Custom check: Failed retrieving a CSS rule from stylesheet "+e);return false}for(var o=0;o<2&&o<n.length;o++){if(g.test(n[o].selectorText)){return true}}return false}function x(e){p++;var t=p>f;if(!E()&&!t){var r;if(p<=100){r=2}else if(p<=110){r=500}else{r=1e3}L=setTimeout(x,r)}else if(!e){k.reset();k.themeLoaded=true;k.fireThemeChanged();if(t){a.error("ThemeManager: max. check cycles reached.")}}else{k.themeLoaded=true}}function U(e){var t=document.getElementById(e);if(t){t.dataset.sapUiFoucmarker=e}}function R(e){var t=document.documentElement;var a=e.new;k._updateThemeUrls(a,true);t.classList.remove("sapUiTheme-"+e.old);t.classList.add("sapUiTheme-"+a);k.checkThemeChanged()}function _(e,t){var a=c.getThemeRoot(t,e);if(a){a=a+(a.slice(-1)=="/"?"":"/")+e.replace(/\./g,"/")+"/themes/"+t+"/";n.registerResourcePath((e+".themes."+t).replace(/\./g,"/"),a)}}function I(e,t,a){var r,s=e.href.search(/[?#]/),n,u,o="library",m=i.getRTL()?"-RTL":"",c,l;var f=/^sap-ui-theme(?:skeleton)?-(.*)$/i.exec(e.id);if(Array.isArray(f)){r=f[1]}else{r=e.id.slice(13)}d[r]=d[r]||{};if(s>-1){n=e.href.substring(0,s);u=e.href.substring(s)}else{n=e.href;u=""}n=n.substring(n.lastIndexOf("/")+1);if((l=r.indexOf("-["))>0){o+=r.slice(l+2,-1);r=r.slice(0,l)}if(n===o+".css"||n===o+"-RTL.css"){n=o+m+".css"}c=k._getThemePath(r,t)+n+u;if(c!=e.href){if(a){e.dataset.sapUiFoucmarker=e.id}h(c,e.id)}}function w(e){var t;if(m.getVersionedLibCss()&&e){t="?version="+e.version;if(o.versioninfo){t+="&sap-ui-dist-version="+o.versioninfo.version}}return t}t.apply(k);document.documentElement.classList.add("sapUiTheme-"+c.getTheme());a.info("Declared theme "+c.getTheme(),null);c.attachChange(function(e){var t=e.themeRoots;var a=e.theme;if(t&&t.forceUpdate){k._updateThemeUrls(c.getTheme())}if(a){R(a)}});c.registerThemeManager(k);return k});
//# sourceMappingURL=ThemeManager.js.map