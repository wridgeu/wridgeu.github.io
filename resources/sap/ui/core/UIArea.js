/*!
 * OpenUI5
 * (c) Copyright 2009-2022 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/base/ManagedObject","./Element","./RenderManager","./FocusHandler","sap/ui/performance/trace/Interaction","sap/ui/util/ActivityDetection","sap/ui/events/KeyCodes","sap/base/Log","sap/base/assert","sap/ui/performance/Measurement","sap/ui/events/jquery/EventExtension","sap/ui/events/ControlEvents","sap/ui/events/F6Navigation","sap/ui/thirdparty/jquery","sap/ui/dom/jquery/control"],function(e,t,n,o,r,i,a,s,d,u,l,f,g,p){"use strict";l.apply();p(document).on("keydown",function(e){g.handleF6GroupNavigation(e,null)});var c=s.getLogger("sap.ui.Rendering",window["sap-ui-config"]&&(window["sap-ui-config"]["xx-debugRendering"]||window["sap-ui-config"]["xx-debugrendering"])||/sap-ui-xx-debug(R|-r)endering=(true|x|X)/.test(document.location.search)?s.Level.DEBUG:Math.min(s.Level.INFO,s.getLevel())),h=function(e){return e},v=function(){},y=function(){};if(c.isLoggable()){h=function(e){var t;try{throw new Error}catch(e){t=e.stack||e.stacktrace||(e.sourceURL?e.sourceURL+":"+e.line:null);t=t?t.split(/\n\s*/g).slice(2):undefined}return{obj:e,location:t}};v=function(e,t){var n=sap.ui.getCore(),o={},r,i;for(r in t){i=n.byId(r);o[r]={type:i?i.getMetadata().getName():t[r].obj===e?"UIArea":"(no such control)",location:t[r].location,reason:t[r].reason}}c.debug("  UIArea '"+e.getId()+"', pending updates: "+JSON.stringify(o,null,"\t"))};y=function(e,t){var n;for(n in t){if(e[n]!=null){if(e[n].obj!==t[n].obj){t[n].reason="replaced during rendering"}else{t[n].reason="invalidated again during rendering"}}else{t[n].reason="invalidated during rendering"}}}}var m=e.extend("sap.ui.core.UIArea",{constructor:function(t,n){if(arguments.length===0){return}e.apply(this);this.oCore=t;this.bLocked=false;this.bInitial=true;this.aContentToRemove=[];this.bNeedsRerendering=false;if(n!=null){this.setRootNode(n);this.bNeedsRerendering=this.bNeedsRerendering&&!document.getElementById(n.id+"-Init")}this.mInvalidatedControls={};if(!this.bNeedsRerendering){this.bRenderSelf=false}else{this.oCore.addInvalidatedUIArea(this)}},metadata:{publicMethods:["setRootNode","getRootNode","setRootControl","getRootControl","lock","unlock","isLocked","_handleEvent"],aggregations:{content:{name:"content",type:"sap.ui.core.Control",multiple:true,singularName:"content"},dependents:{name:"dependents",type:"sap.ui.core.Control",multiple:true}}},insertDependent:function(e,t){return this.insertAggregation("dependents",e,t,true)},addDependent:function(e){return this.addAggregation("dependents",e,true)},removeDependent:function(e){return this.removeAggregation("dependents",e,true)},removeAllDependents:function(){return this.removeAllAggregation("dependents",true)},destroyDependents:function(){return this.destroyAggregation("dependents",true)}});m.prototype.isInvalidateSuppressed=function(){return this.iSuppressInvalidate>0};m.prototype.getId=function(){return this.oRootNode?this.oRootNode.id:null};m.prototype.getUIArea=function(){return this};m.prototype.setRootNode=function(e){if(this.oRootNode===e){return}d(!e||e.nodeType===1&&!p(e).attr("data-sap-ui-area"),"UIArea root node must be a DOMElement");if(this.oRootNode){this._ondetach()}this.oRootNode=e;if(this.getContent().length>0){this.invalidate()}if(this.oRootNode){this._onattach()}};m.prototype.getRootNode=function(){return this.oRootNode};m.prototype.setRootControl=function(e){this.removeAllContent();this.addContent(e)};m.prototype.getRootControl=function(e){var t=this.getContent();if(t.length>0){if(e>=0&&e<t.length){return t[e]}return t[0]}return null};m.prototype._addRemovedContent=function(e){if(this.oRootNode&&e){this.aContentToRemove.push(e)}};m.prototype.addContent=function(e,t){this.addAggregation("content",e,t);if(t!==true){this.invalidate()}return this};m.prototype.removeContent=function(e,t){var n=this.removeAggregation("content",e,t);if(!t){var o;if(n&&n.getDomRef){o=n.getDomRef()}this._addRemovedContent(o)}return n};m.prototype.removeAllContent=function(){var e=this.removeAllAggregation("content");for(var t=0;t<e.length;t++){var n;var o=e[t];if(o&&o.getDomRef){n=o.getDomRef()}this._addRemovedContent(n)}return e};m.prototype.destroyContent=function(){var e=this.getContent();for(var t=0;t<e.length;t++){var n;var o=e[t];if(o&&o.getDomRef){n=o.getDomRef()}this._addRemovedContent(n)}this.destroyAggregation("content");return this};m.prototype.lock=function(){this.bLocked=true};m.prototype.unlock=function(){if(this.bLocked&&this.bNeedsRerendering){this.oCore.addInvalidatedUIArea(this)}this.bLocked=false};m.prototype.isLocked=function(){return this.bLocked};m.prototype.getBindingContext=function(){return null};m.prototype.getEventingParent=function(){return this.oCore._getEventProvider()};m.prototype.isActive=function(){return!!this.getId()&&document.getElementById(this.getId())!=null};m.prototype.invalidate=function(){this.addInvalidatedControl(this)};m.prototype.addInvalidatedControl=function(e){if(this.bRenderSelf){return}if(!this.bNeedsRerendering){this.oCore.addInvalidatedUIArea(this)}var t=e.getId();if(e===this){this.bRenderSelf=true;this.bNeedsRerendering=true;this.mInvalidatedControls={};this.mInvalidatedControls[t]=h(this);return}if(this.mInvalidatedControls[t]){return}if(!this.bRenderSelf){this.mInvalidatedControls[t]=h(e);this.bNeedsRerendering=true}};m.prototype.rerender=function(e){var t=this;function r(){t.bRenderSelf=false;t.aContentToRemove=[];t.mInvalidatedControls={};t.bNeedsRerendering=false}if(e){this.bNeedsRerendering=true}if(this.bLocked||!this.bNeedsRerendering){return false}var i=this.bRenderSelf,a=this.aContentToRemove,d=this.mInvalidatedControls,l=false;r();u.pause("renderPendingUIUpdates");u.start(this.getId()+"---rerender","Rerendering of "+this.getMetadata().getName());v(this,d);if(i){if(this.oRootNode){c.debug("Full Rendering of UIArea '"+this.getId()+"'");n.preserveContent(this.oRootNode,false,this.bInitial);this.bInitial=false;var f=function(e,o){var r=e.length;var i;for(var a=0;a<r;a++){i=o?e[a].getDomRef():e[a];if(i&&!n.isPreservedContent(i)&&t.oRootNode===i.parentNode){p(i).remove()}}return r};var g=document.activeElement;var h=o.getControlFocusInfo();f(a);var m=this.getContent();var C=f(m,true);var R=document.activeElement;for(var I=0;I<C;I++){if(m[I]&&m[I].getParent()===this){this.oCore.oRenderManager.render(m[I],this.oRootNode,true)}}l=true;if(g&&g!=R&&R===document.activeElement){try{o.restoreFocus(h)}catch(e){s.warning("Problems while restoring the focus after full UIArea rendering: "+e,null,this)}}}else{c.debug("Full Rendering of UIArea '"+this.getId()+"' postponed, no root node")}}else{var b=function(e){for(;;){if(e.getMetadata&&e.getMetadata().isInstanceOf("sap.ui.core.PopupInterface")){break}e=e.getParent();if(!e||e===t){return false}if(d.hasOwnProperty(e.getId())){return true}}};for(var N in d){var A=this.oCore.byId(N);if(A&&!b(A)){A.rerender();l=true}}}y(d,this.mInvalidatedControls);u.end(this.getId()+"---rerender");u.resume("renderPendingUIUpdates");return l};m.prototype._onControlRendered=function(e){var t=e.getId();if(this.mInvalidatedControls[t]){delete this.mInvalidatedControls[t]}};m.rerenderControl=function(e){var t=null;if(e){t=e.getDomRef();if(!t||n.isPreservedContent(t)){t=document.getElementById(n.RenderPrefixes.Invisible+e.getId())}}var o=t&&t.parentNode;if(o){var r=e.getUIArea();var i=r?r.oCore.oRenderManager:sap.ui.getCore().createRenderManager();c.debug("Rerender Control '"+e.getId()+"'"+(r?"":" (using a temp. RenderManager)"));n.preserveContent(t,true,false,e);i.render(e,o)}else{var r=e.getUIArea();r&&r._onControlRendered(e);c.warning("Couldn't rerender '"+e.getId()+"', as its DOM location couldn't be determined")}};var C=/^(mousedown|mouseup|click|keydown|keyup|keypress|touchstart|touchend|tap)$/;var R=[],I=[];var b={mousemove:1,mouseover:1,mouseout:1,scroll:1,dragover:1,dragenter:1,dragleave:1};m.addEventPreprocessor=function(e){R.push(e)};m.getEventPreprocessors=function(){return R};m.addEventPostprocessor=function(e){I.push(e)};m.getEventPostprocessors=function(){return I};m.configureEventLogging=function(e){Object.assign(b,e);return Object.assign({},b)};m.prototype._handleEvent=function(e){var n,o,a;n=o=p(e.target).control(0);i.refresh();if(n==null){return}if(e.isMarked("delayedMouseEvent")){return}var d=e.getMark("handledByUIArea"),u=this.getId();if(d&&d!==u){e.setMark("firstUIArea",false);return}e.setMarked("firstUIArea");e.srcControl=n;if(e.type==="contextmenu"&&e.shiftKey&&e.altKey&&(e.metaKey||e.ctrlKey)){s.info("Suppressed forwarding the contextmenu event as control event because CTRL+SHIFT+ALT is pressed!");return}R.forEach(function(t){t(e)});this.oCore._handleControlEvent(e,u);if(this.bLocked||this.oCore.isLocked()){return}if(r.getActive()){a=e.type.match(C);if(a){r.notifyEventStart(e)}}var l=[];if(e.getPseudoTypes){l=e.getPseudoTypes()}l.push(e.type);var f=false;while(o instanceof t&&o.isActive()&&!e.isPropagationStopped()){var g=e.getMark("scopeCheckId"),c=g&&window.document.getElementById(g),h=o.getDomRef();if(!c||h&&h.contains(c)){for(var v=0,y=l.length;v<y;v++){var m=l[v];e.type=m;e.currentTarget=o.getDomRef();o._handleEvent(e);if(e.isImmediatePropagationStopped()){break}}if(!f&&!e.isMarked("enterKeyConsumedAsContent")){f=this._handleGroupChange(e,o)}if(e.isPropagationStopped()){break}if(o.bStopEventBubbling){break}h=o.getDomRef();if(!h){break}}h=h.parentNode;o=null;if(e.isMarked("fromMouseout")&&(h&&h.contains(e.relatedTarget))){break}while(h&&h!==this.getRootNode()){if(h.id){o=p(h).control(0);if(o){break}}h=h.parentNode}}I.forEach(function(t){t(e)});if(a){r.notifyEventEnd(e)}e.currentTarget=this.getRootNode();e.setMark("handledByUIArea",u);if(e.isPropagationStopped()){s.debug("'"+e.type+"' propagation has been stopped")}var N=e.type;if(!b[N]){if(n){s.debug("Event fired: '"+N+"' on "+n,"","sap.ui.core.UIArea")}else{s.debug("Event fired: '"+N+"'","","sap.ui.core.UIArea")}}};m.prototype._onattach=function(){var e=this.getRootNode();if(e==null){return}p(e).attr("data-sap-ui-area",e.id).on(f.events.join(" "),this._handleEvent.bind(this))};m.prototype._ondetach=function(){var e=this.getRootNode();if(e==null){return}p(e).removeAttr("data-sap-ui-area").off()};m.prototype.clone=function(){throw new Error("UIArea can't be cloned")};m.prototype._handleGroupChange=function(e,t){var n=m._oFieldGroupValidationKey;if(e.type==="focusin"||e.type==="focusout"){if(e.type==="focusout"){t=p(document.activeElement).control(0)}if(m._iFieldGroupDelayTimer){clearTimeout(m._iFieldGroupDelayTimer);m._iFieldGroupDelayTimer=null}m._iFieldGroupDelayTimer=setTimeout(this.setFieldGroupControl.bind(this,t),0);return true}else if(this.getFieldGroupControl()&&e.type==="keyup"&&e.keyCode===n.keyCode&&e.shiftKey===n.shiftKey&&e.altKey===n.altKey&&e.ctrlKey===n.ctrlKey){if(m._iFieldGroupTriggerDelay){clearTimeout(m._iFieldGroupTriggerDelay)}var o=this.getFieldGroupControl(),r=o?o._getFieldGroupIds():[];if(r.length>0){o.triggerValidateFieldGroup(r)}return true}return false};m.prototype.setFieldGroupControl=function(e){var n=e;while(n&&!(n instanceof t&&n.isA("sap.ui.core.Control"))){n=n.getParent()}var o=this.getFieldGroupControl();if(n!=o){var r=o?o._getFieldGroupIds():[],i=n?n._getFieldGroupIds():[],a=r.filter(function(e){return i.indexOf(e)<0});if(a.length>0){o.triggerValidateFieldGroup(a)}m._oFieldGroupControl=n}return this};m.prototype.getFieldGroupControl=function(){if(m._oFieldGroupControl&&!m._oFieldGroupControl.bIsDestroyed){return m._oFieldGroupControl}return null};m._oFieldGroupControl=null;m._iFieldGroupDelayTimer=null;m._oFieldGroupValidationKey={keyCode:a.ENTER,shiftKey:false,altKey:false,ctrlKey:false};m._oRenderLog=c;return m});