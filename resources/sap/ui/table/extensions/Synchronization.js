/*!
 * OpenUI5
 * (c) Copyright 2009-2021 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["./ExtensionBase","../Table","../utils/TableUtils","../library","sap/base/Log"],function(e,t,r,n,o){"use strict";var l={setRowSelection:function(e,t){var n=this.getTable();var o=n.getRows()[e];if(o&&t!=null){r.toggleRowSelection(n,o.getIndex(),t)}},setRowHover:function(e,t){var r=this.getTable();var n=r.getRows()[e];if(n&&t!=null){n._setHovered(t)}},addVerticalScrollingListener:function(e){var t=this.getTable();var r=t._getScrollExtension();var n=r.constructor.ScrollDirection;if(e){r.registerForMouseWheel(e.wheelAreas,{scrollDirection:n.VERTICAL});r.registerForTouch(e.touchAreas,{scrollDirection:n.VERTICAL})}},placeVerticalScrollbarAt:function(e){var t=this.getTable();var r=t._getScrollExtension();if(!e){throw new Error("The HTMLElement in which the vertical scrollbar should be placed must be specified.")}if(!r.isVerticalScrollbarExternal()){var o=sap.ui.getCore().createRenderManager();t.getRenderer().renderVSbExternal(o,t);o.flush(e);var l=e.querySelector("#"+t.getId()+"-"+n.SharedDomRef.VerticalScrollBar);r.markVerticalScrollbarAsExternal(l);t.invalidate()}else{e.appendChild(r.getVerticalScrollbar());r.restoreVerticalScrollPosition()}},renderHorizontalScrollbar:function(e,t,r){var n=this.getTable();if(t==null){throw new Error("The id must be specified.")}n.getRenderer().renderHSbExternal(e,n,t,r)}};var i={onBeforeRendering:function(e){var t=this._getSyncExtension();var r=e&&e.isMarked("renderRows");var n=this.getDomRef("tableCCnt");if(!r&&n&&t._onTableContainerScrollEventHandler){n.removeEventListener("scroll",t._onTableContainerScrollEventHandler);delete t._onTableContainerScrollEventHandler}},onAfterRendering:function(e){var t=this._getScrollExtension();var r=e&&e.isMarked("renderRows");var n=this.getDomRef("tableCCnt");if(t.isVerticalScrollbarExternal()&&!r){t.updateVerticalScrollbarHeight();t.updateVerticalScrollHeight()}if(!r){var o=this._getSyncExtension();o.syncInnerVerticalScrollPosition(n.scrollTop);if(!o._onTableContainerScrollEventHandler){o._onTableContainerScrollEventHandler=function(e){o.syncInnerVerticalScrollPosition(e.target.scrollTop)}}n.addEventListener("scroll",o._onTableContainerScrollEventHandler)}}};var a=e.extend("sap.ui.table.extensions.Synchronization",{_init:function(e,t,n){this._delegate=i;this._oPublicInterface={syncRowSelection:l.setRowSelection.bind(this),syncRowHover:l.setRowHover.bind(this),registerVerticalScrolling:l.addVerticalScrollingListener.bind(this),placeVerticalScrollbarAt:l.placeVerticalScrollbarAt.bind(this),renderHorizontalScrollbar:l.renderHorizontalScrollbar.bind(this)};r.addDelegate(e,this._delegate,e);return"SyncExtension"},destroy:function(){var t=this.getTable();if(t){t.removeEventDelegate(this._delegate)}this._delegate=null;this._oPublicInterface=null;e.prototype.destroy.apply(this,arguments)}});a.prototype.syncRowCount=function(e){this.callInterfaceHook("rowCount",arguments)};a.prototype.syncRowSelection=function(e,t){this.callInterfaceHook("rowSelection",arguments)};a.prototype.syncRowHover=function(e,t){this.callInterfaceHook("rowHover",arguments)};a.prototype.syncRowHeights=function(e){return this.callInterfaceHook("rowHeights",arguments)};a.prototype.syncInnerVerticalScrollPosition=function(e){this.callInterfaceHook("innerVerticalScrollPosition",arguments)};a.prototype.syncLayout=function(e){this.callInterfaceHook("layout",arguments)};a.prototype.callInterfaceHook=function(e,t){var n={};n[e]=Array.prototype.slice.call(t);o.debug("sap.ui.table.extensions.Synchronization","Sync "+e+"("+n[e]+")",this.getTable());return r.dynamicCall(this._oPublicInterface,n)};a.prototype.getInterface=function(){return this._oPublicInterface};return a});