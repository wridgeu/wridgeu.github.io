/*!
 * OpenUI5
 * (c) Copyright 2009-2021 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["./ExtensionBase","../utils/TableUtils"],function(t,e){"use strict";var r={onAfterRendering:function(){var t=this._getScrollIOSExtension();t.attachScrollbar();t.updateVerticalScrollbar()}};var i=t.extend("sap.ui.table.extensions.ScrollingIOS",{_init:function(t){e.addDelegate(t,r,t);t.addStyleClass("sapUiTableVSbIOSActive");if(this.attachScrollbar()){this.updateVerticalScrollbar()}return"ScrollIOSExtension"},destroy:function(){var i=this.getTable();e.removeDelegate(i,r);i.removeStyleClass("sapUiTableVSbIOSActive");clearTimeout(this._iUpdateDefaultScrollbarPositionTimeoutId);t.prototype.destroy.apply(this,arguments)},_attachEvents:function(){var t=this.getTable();e.Hook.register(t,e.Hook.Keys.Table.TotalRowCountChanged,this.onTotalRowCountChanged,this);e.Hook.register(t,e.Hook.Keys.Table.UpdateSizes,this.onUpdateTableSizes,this)},_detachEvents:function(){var t=this.getTable();var r=t._getScrollExtension().getVerticalScrollbar();if(r){r.removeEventListener("scroll",this._onVerticalScrollEventHandler)}delete this._onVerticalScrollEventHandler;var i=this.getVerticalScrollbar();if(i){i.removeEventListener("pointerdown",this._onPointerDownEventHandler)}delete this._onPointerDownEventHandler;var l=this.getVerticalScrollbarThumb();if(l){l.removeEventListener("touchmove",this._onTouchMoveEventHandler)}delete this._onTouchMoveEventHandler;e.Hook.deregister(t,e.Hook.Keys.Table.TotalRowCountChanged,this.onTotalRowCountChanged,this);e.Hook.deregister(t,e.Hook.Keys.Table.UpdateSizes,this.onUpdateTableSizes,this)}});i.prototype.onUpdateTableSizes=function(){this.updateVerticalScrollbarVisibility();this.updateVerticalScrollbarThumbHeight();this.updateVerticalScrollbarThumbPosition()};i.prototype.onTotalRowCountChanged=function(){this.updateVerticalScrollbarVisibility();this.updateVerticalScrollbarThumbHeight()};i.prototype.attachScrollbar=function(){var t=this.getTable();var e=t._getScrollExtension().getVerticalScrollbar();var r=this.getVerticalScrollbar();var i=this.getVerticalScrollbarThumb();if(!e){return false}if(!r){r=document.createElement("div");r.setAttribute("id",t.getId()+"-vsb-ios");r.classList.add("sapUiTableVSbIOS");i=document.createElement("div");i.classList.add("sapUiTableVSbIOSThumb");r.append(i);e.after(r)}if(!this._onPointerDownEventHandler){this._onPointerDownEventHandler=this.onPointerDown.bind(this);r.addEventListener("pointerdown",this._onPointerDownEventHandler);this._onTouchMoveEventHandler=this.onTouchMove.bind(this);i.addEventListener("touchmove",this._onTouchMoveEventHandler);this._onVerticalScrollEventHandler=this.updateVerticalScrollbarThumbPosition.bind(this);e.addEventListener("scroll",this._onVerticalScrollEventHandler)}return true};i.prototype.getVerticalScrollbar=function(){var t=this.getTable();return t?t.getDomRef("vsb-ios"):null};i.prototype.getVerticalScrollbarThumb=function(){var t=this.getVerticalScrollbar();return t?t.firstElementChild:null};i.prototype.isVerticalScrollbarVisible=function(){var t=this.getVerticalScrollbar();return t?!t.classList.contains("sapUiTableHidden"):false};i.prototype.updateVerticalScrollbar=function(){var t=this.getTable();var e=t.getDomRef("tableCCnt");var r=t._getScrollExtension();var i=this.getVerticalScrollbar();var l=r.isVerticalScrollbarExternal()?0:e.offsetTop;if(t._getRowCounts().fixedTop>0){l+=t._iVsbTop}i.style.height=r.getVerticalScrollbarHeight()+"px";i.style.top=l+"px";this.updateVerticalScrollbarVisibility();this.updateVerticalScrollbarThumbHeight();this.updateVerticalScrollbarThumbPosition()};i.prototype.updateVerticalScrollbarVisibility=function(){var t=this.getTable();var e=t._getScrollExtension();var r=this.getVerticalScrollbar();if(!r){return}if(e.isVerticalScrollbarRequired()&&!this.isVerticalScrollbarVisible()){r.classList.remove("sapUiTableHidden")}else if(!e.isVerticalScrollbarRequired()&&this.isVerticalScrollbarVisible()){r.classList.add("sapUiTableHidden")}};i.prototype.updateVerticalScrollbarThumbPosition=function(){var t=this.getVerticalScrollbarThumb();if(t){t.style.top=this.getCalculateThumbOffset()+"px"}};i.prototype.updateVerticalScrollbarThumbHeight=function(){var t=this.getTable();var e=t._getScrollExtension();var r=this.getVerticalScrollbarThumb();if(r){if(e.isVerticalScrollbarRequired()){r.style.height=this.getCalculateThumbHeight()+"px"}else{r.style.height="0"}}};i.prototype.getCalculateThumbHeight=function(){var t=this.getTable();var e=t._getScrollExtension();var r=e.getVerticalScrollbarHeight();var i=e.getVerticalScrollHeight();return Math.round(Math.pow(r,2)/i)};i.prototype.getCalculateThumbOffset=function(){var t=this.getTable();var e=t._getScrollExtension();var r=e.getVerticalScrollbarHeight();var i=e.getVerticalScrollHeight();var l=e.getVerticalScrollbar();var a=l?e.getVerticalScrollbar().scrollTop:0;return Math.round(a*r/i)};i.prototype.onTouchMove=function(t){var e=this.getTable();var r=e._getScrollExtension();var i=this.getVerticalScrollbarThumb();var l=i.getBoundingClientRect().y;var a=this.getCalculateThumbHeight();var o=i.offsetTop+t.touches[0].pageY-l-a/2;var n=Math.min(r.getVerticalScrollbarHeight()-a,Math.max(0,o));t.preventDefault();i.style.top=n+"px";clearTimeout(this._iUpdateDefaultScrollbarPositionTimeoutId);this._iUpdateDefaultScrollbarPositionTimeoutId=setTimeout(function(){this.updateDefaultScrollbarPosition(n,a);delete this._iUpdateDefaultScrollbarPositionTimeoutId}.bind(this),30)};i.prototype.onPointerDown=function(t){var e=this.getTable();var r=e._getScrollExtension();var i=this.getVerticalScrollbarThumb();var l=i.getBoundingClientRect().y;var a=this.getCalculateThumbHeight();var o=i.offsetTop+t.clientY-l-a/2;var n=Math.min(r.getVerticalScrollbarHeight()-a,Math.max(0,o));i.style.top=n+"px";this.updateDefaultScrollbarPosition(n,a)};i.prototype.updateDefaultScrollbarPosition=function(t,e){var r=this.getTable();if(!r){return}var i=r._getScrollExtension();var l=i.getVerticalScrollbarHeight();if(t+e>=l){i.scrollVerticallyMax(true)}else{var a=t*i.getVerticalScrollHeight()/l;var o=i.getVerticalScrollbar();o.scrollTop=a}};return i});