/*!
 * OpenUI5
 * (c) Copyright 2009-2021 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/Device","sap/ui/unified/Menu","sap/ui/unified/MenuItem","sap/ui/core/Popup"],function(e,n,t,l){"use strict";l.setInitialZIndex(10);function o(e,n){var t=n.getRowBindingContext();var l=e.getFilterProperty();var o=t.getProperty(l);if(o!=null&&typeof o!=="string"){o=o.toString()}if(this.getEnableCustomFilter()){this.fireCustomFilter({column:e,value:o})}else{this.filter(e,o)}}var u={TableUtils:null,openContextMenu:function(n,t,l){if(!n||!t){return false}var o=u.TableUtils.getCell(n,t);var r=o?o[0]:null;var C=u.TableUtils.getCellInfo(r);var a=C.columnIndex;var i=C.rowIndex;var s=true;if(C.isOfType(u.TableUtils.CELLTYPE.COLUMNHEADER)){var f=r.querySelector(".sapUiTableColDropDown")!==null;if(e.system.desktop||f){u._removeColumnHeaderCellMenu(n);s=n.fireColumnSelect({column:n.getColumns()[a]});if(s){return u._openColumnContextMenu(n,r)}else{return true}}else{return u._applyColumnHeaderCellMenu(n,r)}}else if(C.isOfType(u.TableUtils.CELLTYPE.ANYCONTENTCELL)){var c=u.TableUtils.getRowColCell(n,i,a,a>=0);var m=c.row;var x;var d=n.getBindingInfo("rows");if(d){x=m.getBindingContext(d.model)}if(a>=0){s=n.fireCellContextmenu({rowIndex:m.getIndex(),columnIndex:a,columnId:c.column.getId(),cellControl:c.cell,rowBindingContext:x,cellDomRef:r})}if(s){var p=n.getContextMenu();if(p&&d){p.setBindingContext(x,d.model)}s=n.fireBeforeOpenContextMenu({rowIndex:m.getIndex(),columnIndex:c.column?a:null,contextMenu:p})}if(s){return u._openContentCellContextMenu(n,r,l)}else{return true}}return false},_openColumnContextMenu:function(e,n){var t=u.TableUtils.getCellInfo(n);var l=e.getColumns();var o=l[t.columnIndex];for(var r=0;r<l.length;r++){if(l[r]!==o){u._closeColumnContextMenu(e,r)}}u._closeContentCellContextMenu(e);var C=n.getAttribute("colspan");if(C&&C!=="1"){return false}return o._openMenu(n)},_closeColumnContextMenu:function(e,n){e.getColumns()[n]._closeMenu()},_openContentCellContextMenu:function(e,n,t){var l=u.TableUtils.getCellInfo(n);if(l.rowIndex>=u.TableUtils.getNonEmptyRowCount(e)){return false}if(u.hasCustomContextMenu(e)){return u._openCustomContentCellContextMenu(e,n,t)}else{return u._openDefaultContentCellContextMenu(e,n,t)}},_openCustomContentCellContextMenu:function(e,n,t){var o=u.TableUtils.getCellInfo(n);var r=e.getRows()[o.rowIndex];if(r.isGroupHeader()||r.isSummary()){return false}var C=e.getContextMenu();var a=e.getColumns();for(var i=0;i<a.length;i++){u._closeColumnContextMenu(e,i)}u._closeDefaultContentCellContextMenu(e);if(t){C.openAsContextMenu(t,n)}else if(typeof C.openBy==="function"){C.openBy(n)}else{C.open(null,n,l.Dock.BeginTop,l.Dock.BeginBottom,n)}return true},_openDefaultContentCellContextMenu:function(e,r,C){var a=u.TableUtils.getCellInfo(r);var i=a.rowIndex;var s=e.getRows()[i];var f=a.columnIndex;var c=e.getColumns();var m=c[f];if(!e._oCellContextMenu){e._oCellContextMenu=new n(e.getId()+"-cellcontextmenu")}var x=e._oCellContextMenu.getId()+"-cellfilter";var d=sap.ui.getCore().byId(x);if(e.getEnableCellFilter()&&m&&m.isFilterableByMenu()&&!s.isGroupHeader()){if(!d){d=new t({id:x,text:u.TableUtils.getResourceText("TBL_FILTER")});d._onSelect=o.bind(e,m,s);d.attachSelect(d._onSelect)}else{d.detachSelect(d._onSelect);d._onSelect=o.bind(e,m,s);d.attachSelect(d._onSelect)}e._oCellContextMenu.insertItem(d,0)}else{e._oCellContextMenu.removeItem(d)}u.TableUtils.Hook.call(e,u.TableUtils.Hook.Keys.Table.OpenMenu,a,e._oCellContextMenu);if(e._oCellContextMenu.getItems().length===0){return false}for(var p=0;p<c.length;p++){u._closeColumnContextMenu(e,p)}u._closeCustomContentCellContextMenu(e);if(C){e._oCellContextMenu.openAsContextMenu(C,r)}else{e._oCellContextMenu.open(null,r,l.Dock.BeginTop,l.Dock.BeginBottom,r)}return true},_closeContentCellContextMenu:function(e){u._closeCustomContentCellContextMenu(e);u._closeDefaultContentCellContextMenu(e)},_closeCustomContentCellContextMenu:function(e){var n=e.getContextMenu();var t=n?n.bOpen:false;if(t){n.close()}},_closeDefaultContentCellContextMenu:function(e){var n=e._oCellContextMenu;var t=n?n.bOpen:false;if(t){n.close()}},cleanupDefaultContentCellContextMenu:function(e){if(!e||!e._oCellContextMenu){return}var n=e._oCellContextMenu.getId()+"-cellfilter";var t=sap.ui.getCore().byId(n);e._oCellContextMenu.removeAllItems();e._oCellContextMenu.destroy();e._oCellContextMenu=null;if(t){t.destroy()}},_applyColumnHeaderCellMenu:function(e,n){var t=u.TableUtils.getCellInfo(n);var l=e.getColumns()[t.columnIndex];var o=n.getAttribute("colspan");var r=n.querySelector(".sapUiTableCellInner");var C=n.querySelector(".sapUiTableCellTouchMenu")!==null;if(o&&o!=="1"||C||!l.getResizable()&&!l._menuHasItems()){return false}var a=document.createElement("div");u._removeColumnHeaderCellMenu(e);r.style.display="none";if(l._menuHasItems()){var i;i=document.createElement("div");i.classList.add("sapUiTableColDropDown");i.textContent="";a.appendChild(i)}if(l.getResizable()){var s;s=document.createElement("div");s.classList.add("sapUiTableColResizer");s.textContent="";a.appendChild(s)}a.classList.add("sapUiTableCellTouchMenu");n.appendChild(a);var f=function(){u._removeColumnHeaderCellMenu(e);n.removeEventListener("focusout",f)};n.addEventListener("focusout",f);return true},_removeColumnHeaderCellMenu:function(e){var n=e&&e.$().find(".sapUiTableCHT .sapUiTableCellTouchMenu");if(n.length){n.parent().find(".sapUiTableCellInner").show();n.remove()}},hasCustomContextMenu:function(e){return e!=null&&e.getContextMenu()!=null}};return u},true);