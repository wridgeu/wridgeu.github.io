/*!
 * OpenUI5
 * (c) Copyright 2009-2021 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/model/Sorter","sap/ui/Device","sap/ui/thirdparty/jquery"],function(e,r,a){"use strict";var t=new window.WeakMap;var o={TableUtils:null,HierarchyMode:{Flat:"Flat",Group:"Group",Tree:"Tree",GroupedTree:"GroupedTree"},setHierarchyMode:function(e,r){if(!o.TableUtils.isA(e,"sap.ui.table.Table")||!(r in o.HierarchyMode)){return}var a=o.getHierarchyMode(e);if(a!==r){t.set(e,r);e.invalidate()}},getHierarchyMode:function(e){return o.TableUtils.isA(e,"sap.ui.table.Table")?t.get(e)||o.HierarchyMode.Flat:null},setToDefaultFlatMode:function(e){o.setHierarchyMode(e,o.HierarchyMode.Flat)},setToDefaultGroupMode:function(e){o.setHierarchyMode(e,o.HierarchyMode.Group)},setToDefaultTreeMode:function(e){o.setHierarchyMode(e,o.HierarchyMode.Tree)},isInFlatMode:function(e){return o.getHierarchyMode(e)===o.HierarchyMode.Flat},isInGroupMode:function(e){var r=o.getHierarchyMode(e);return r===o.HierarchyMode.Group||r===o.HierarchyMode.GroupedTree},isInTreeMode:function(e){return o.getHierarchyMode(e)===o.HierarchyMode.Tree},getModeCssClass:function(e){switch(o.getHierarchyMode(e)){case o.HierarchyMode.Group:case o.HierarchyMode.GroupedTree:return"sapUiTableGroupMode";case o.HierarchyMode.Tree:return"sapUiTableTreeMode";default:return null}},showGroupMenuButton:function(e){return!r.system.desktop&&o.TableUtils.isA(e,"sap.ui.table.AnalyticalTable")},isInGroupHeaderRow:function(e){var r=o.TableUtils.getCellInfo(e);if(r.isOfType(o.TableUtils.CELLTYPE.ANYCONTENTCELL)){return r.cell.parent().hasClass("sapUiTableGroupHeaderRow")}return false},isInSummaryRow:function(e){var r=o.TableUtils.getCellInfo(e);if(r.isOfType(o.TableUtils.CELLTYPE.ANYCONTENTCELL)){return r.cell.parent().hasClass("sapUiTableSummaryRow")}return false},calcGroupIndent:function(e){var r=o.getHierarchyMode(e.getTable())===o.HierarchyMode.GroupedTree;var a=!r&&!e.isGroupHeader()&&!e.isTotalSummary();var t=e.getLevel()-(a?1:0);var n=0;for(var i=1;i<t;i++){if(i===1){n=24}else if(i===2){n+=12}else{n+=8}}return n},calcTreeIndent:function(e){return(e.getLevel()-1)*17},setGroupIndent:function(e,r){var a=e.getDomRefs(true);var t=a.row;var o=a.rowHeaderPart;var n=e.getTable()._bRtlMode;var i=t.find("td.sapUiTableCellFirst > .sapUiTableCellInner");var l=o.find(".sapUiTableGroupShield");if(r<=0){o.css(n?"right":"left","");l.css("width","").css(n?"margin-right":"margin-left","");i.css(n?"padding-right":"padding-left","");t.css("--CalculatedGroupIndent","0")}else{o.css(n?"right":"left",r+"px");l.css("width",r+"px").css(n?"margin-right":"margin-left",-1*r+"px");i.css(n?"padding-right":"padding-left",r+8+"px");t.css("--CalculatedGroupIndent",r+"px")}},setTreeIndent:function(e,r){var a=e.getDomRefs(true);var t=a.row;var o=e.getTable()._bRtlMode;var n=t.find(".sapUiTableTreeIcon");n.css(o?"margin-right":"margin-left",r>0?r+"px":"")},updateTableRowForGrouping:function(e){var r=e.getTable();var a=e.getDomRefs(true);var t=a.row;var n=e.isExpanded();var i=e.isExpandable();t.toggleClass("sapUiTableSummaryRow",e.isSummary());if(o.isInGroupMode(r)){var l=e.getTitle();var s=o.calcGroupIndent(e);e.$("groupHeader").toggleClass("sapUiTableGroupIconOpen",i&&n).toggleClass("sapUiTableGroupIconClosed",i&&!n).attr("title",r._getShowStandardTooltips()&&l?l:null).text(l);o.setGroupIndent(e,s);t.toggleClass("sapUiTableRowIndented",s>0).toggleClass("sapUiTableGroupHeaderRow",e.isGroupHeader());if(o.showGroupMenuButton(r)){var p=r.$();var u=p.hasClass("sapUiTableVScr")?p.find(".sapUiTableVSb").width():0;var d=a.rowHeaderPart.find(".sapUiTableGroupMenuButton");var g=p.width()-d.width()-u-5-s;d.css(r._bRtlMode?"right":"left",g+"px")}}if(o.isInTreeMode(r)){var c=t.find(".sapUiTableTreeIcon");if(!i&&document.activeElement===c[0]){o.TableUtils.getParentCell(r,c[0]).focus()}c.toggleClass("sapUiTableTreeIconLeaf",!i).toggleClass("sapUiTableTreeIconNodeOpen",i&&n).toggleClass("sapUiTableTreeIconNodeClosed",i&&!n);o.setTreeIndent(e,o.calcTreeIndent(e))}if(!o.isInFlatMode(r)){r._getAccExtension().updateAriaExpandAndLevelState(e)}},cleanupTableRowForGrouping:function(e){var r=e.getTable();var a=e.getDomRefs(true);if(o.isInGroupMode(r)){a.row.removeClass("sapUiTableGroupHeaderRow sapUiTableSummaryRow sapUiTableRowIndented");e.$("groupHeader").removeClass("sapUiTableGroupIconOpen","sapUiTableGroupIconClosed").attr("title","").text("");o.setGroupIndent(e,0)}if(o.isInTreeMode(r)){a.row.find(".sapUiTableTreeIcon").removeClass("sapUiTableTreeIconLeaf").removeClass("sapUiTableTreeIconNodeOpen").removeClass("sapUiTableTreeIconNodeClosed");o.setTreeIndent(e,0)}r._getAccExtension().updateAriaExpandAndLevelState(e)},updateGroups:function(e){if(e.getBinding()){e.getRows().forEach(function(e){o.updateTableRowForGrouping(e)})}else{e.getRows().forEach(function(e){o.cleanupTableRowForGrouping(e)})}},setupExperimentalGrouping:function(r){if(!r.getEnableGrouping()){return}var t=r.getBinding();var n=sap.ui.getCore().byId(r.getGroupBy());var i=n&&n.getGrouped()&&o.TableUtils.isA(t,"sap.ui.model.ClientListBinding");if(!i||t._modified){return}t._modified=true;o.setToDefaultGroupMode(r);var l=n.getSortProperty();t.sort(new e(l));var s=r._getTotalRowCount(),p=t.getContexts(0,s);var u;var d=0;for(var g=s-1;g>=0;g--){var c=p[g].getProperty(l);if(!u){u=c}if(u!==c){var f=p[g+1].getModel().getContext("/sap.ui.table.GroupInfo"+g);f.__groupInfo={oContext:p[g+1],name:u,count:d,groupHeader:true,expanded:true};p.splice(g+1,0,f);u=c;d=0}d++}var f=p[0].getModel().getContext("/sap.ui.table.GroupInfo");f.__groupInfo={oContext:p[0],name:u,count:d,groupHeader:true,expanded:true};p.splice(0,0,f);a.extend(t,{getLength:function(){return p.length},getContexts:function(e,r){return p.slice(e,e+r)}});function T(e){var r=p[e];return(r&&r.__groupInfo&&r.__groupInfo.groupHeader)===true}r._experimentalGroupingRowState=function(e){var r=e.context;if((r&&r.__groupInfo&&r.__groupInfo.groupHeader)===true){e.type=e.Type.GroupHeader}e.title=r&&r.__groupInfo&&r.__groupInfo.name+" - "+r.__groupInfo.count;e.expandable=e.type===e.Type.GroupHeader;e.expanded=e.expandable&&r.__groupInfo&&r.__groupInfo.expanded;e.level=e.expandable?1:2;e.contentHidden=e.expandable};r._experimentalGroupingExpand=function(e){var r=e.getIndex();if(T(r)&&!p[r].__groupInfo.expanded){for(var a=0;a<p[r].__childs.length;a++){p.splice(r+1+a,0,p[r].__childs[a])}delete p[r].__childs;p[r].__groupInfo.expanded=true;t._fireChange()}};r._experimentalGroupingCollapse=function(e){var r=e.getIndex();if(T(r)&&p[r].__groupInfo.expanded){p[r].__childs=p.splice(r+1,p[r].__groupInfo.count);p[r].__groupInfo.expanded=false;t._fireChange()}};var b=o.TableUtils.Hook;b.register(r,b.Keys.Row.UpdateState,r._experimentalGroupingRowState);b.register(r,b.Keys.Row.Expand,r._experimentalGroupingExpand);b.register(r,b.Keys.Row.Collapse,r._experimentalGroupingCollapse);r._mTimeouts.groupingFireBindingChange=r._mTimeouts.groupingFireBindingChange||window.setTimeout(function(){t._fireChange()},0)},resetExperimentalGrouping:function(e){var r=e.getBinding();var a=o.TableUtils.Hook;if(r&&r._modified){o.setToDefaultFlatMode(e);e.bindRows(e.getBindingInfo("rows"))}a.deregister(e,a.Keys.Row.UpdateState,e._experimentalGroupingRowState);a.deregister(e,a.Keys.Row.Expand,e._experimentalGroupingExpand);a.deregister(e,a.Keys.Row.Collapse,e._experimentalGroupingCollapse);delete e._experimentalGroupingRowState;delete e._experimentalGroupingExpand;delete e._experimentalGroupingCollapse}};return o},true);