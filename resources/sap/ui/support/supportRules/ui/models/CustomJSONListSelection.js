/*
 * ! OpenUI5
 * (c) Copyright 2009-2021 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["./CustomListSelection","sap/ui/support/supportRules/Storage","sap/ui/support/supportRules/ui/models/SelectionUtils","sap/ui/support/supportRules/Constants"],function(e,t,i,n){"use strict";var o=e.extend("sap.ui.support.supportRules.ui.models.CustomJSONListSelection",{constructor:function(t,i,n){e.call(this,t,n);this._dependent=i},_updateModelAfterSelectionChange:function(e){var o=this._getBinding();var s=o.getModel();var r=e.getParameter("rowIndices")||[];var l=this._getSelectionModel();var a=this;function u(e,t,i){var n=s.getProperty(e+"/nodes");if(a._isTree()&&a._dependent){if(n&&n.length){for(var o=0;o<n.length;o++){u(e+"/nodes/"+o+"",t,true);a.updateModelAfterChangedSelection(s,e,t)}}else{if(!t&&!i){var r=e.split("/");r.pop();r.pop();var l=r.join("/");a._setSelectionForContext(s,s.createBindingContext(l),t)}}}a.updateModelAfterChangedSelection(s,e,t);a._setSelectionForContext(s,s.createBindingContext(e),t)}for(var d=0;d<r.length;d++){var p=this._getContextByIndex(r[d]);if(p){u(p.getPath(),l.isSelectedIndex(r[d]))}}this.syncParentNodeSelectionWithChildren(o.getModel("ruleSets"));this._finalizeSelectionUpdate();i.getSelectedRules();if(t.readPersistenceCookie(n.COOKIE_NAME)){i.persistSelection();var c=t.getRules();i.getRulesSelectionState().forEach(function(e){if(e.libName==="temporary"){c.forEach(function(t){if(e.ruleId===t.id){t.selected=e.selected}})}});t.setRules(c)}}});return o});