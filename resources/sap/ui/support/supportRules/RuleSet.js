/*!
 * OpenUI5
 * (c) Copyright 2009-2021 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["jquery.sap.global","sap/ui/support/library","sap/ui/support/supportRules/Storage","sap/ui/support/supportRules/Constants"],function(e,r,t,i){"use strict";var s={};var o=function(r){r=r||{};if(!r.name){e.sap.log.error("Please provide a name for the RuleSet.")}if(s[r.name]){return s[r.name]}this._oSettings=r;this._mRules={};s[r.name]=this};o.clearAllRuleSets=function(){s={}};o.prototype.getRules=function(){return this._mRules};o.prototype.updateRule=function(e,r){var t=this._verifySettingsObject(r,true);if(t==="success"){delete this._mRules[e];this._mRules[r.id]=r}return t};o.prototype._verifySettingsObject=function(t,i){if(!t.id){e.sap.log.error("Support rule needs an id.");return"Support rule needs an unique id."}if(!i&&this._mRules[t.id]){e.sap.log.error("Support rule with the id "+t.id+" already exists.");return"Support rule with the id "+t.id+" already exists."}if(!t.check){e.sap.log.error("Support rule with the id "+t.id+" needs a check function.");return"Support rule with the id "+t.id+" needs a check function."}if(!t.title){e.sap.log.error("Support rule with the id "+t.id+" needs a title.");return"Support rule with the id "+t.id+" needs a title."}if(!t.description){e.sap.log.error("Support rule with the id "+t.id+" needs a description.");return"Support rule with the id "+t.id+" needs a description."}if(!t.resolution&&(!t.resolutionurls||!t.resolutionurls.length>0)){e.sap.log.error("Support rule with the id "+t.id+" needs either a resolution or resolutionurls or should have a ticket handler function");return"Support rule with the id "+t.id+" needs either a resolution or resolutionurls or should have a ticket handler function"}if(!t.audiences||t.audiences.length===0){e.sap.log.error("Support rule with the id "+t.id+" should have an audience. Applying audience ['Control']");t.audiences=[r.Audiences.Control]}if(t.audiences&&t.audiences.forEach){var s=false,o="";t.audiences.forEach(function(e){if(!r.Audiences[e]){s=true;o=e}});if(s){e.sap.log.error("Audience "+o+" does not exist. Please use the audiences from sap.ui.support.Audiences");return"Audience "+o+" does not exist. Please use the audiences from sap.ui.support.Audiences"}}if(!t.categories||t.categories.length===0){e.sap.log.error("Support rule with the id "+t.id+" should have a category. Applying category ['Performance']");t.categories=["Performance"]}if(t.categories&&t.categories.forEach){var u=false,n="";t.categories.forEach(function(e){if(!r.Categories[e]){u=true;n=e}});if(u){e.sap.log.error("Category "+n+" does not exist. Please use the categories from sap.ui.support.Categories");return"Category "+n+" does not exist. Please use the categories from sap.ui.support.Categories"}}return"success"};o.prototype.addRule=function(r,t){var i=o.versionInfo?o.versionInfo.version:t.version;var s=r.minversion?r.minversion:"";if(s==="-"){s=""}if(s&&e.sap.Version(i).compareTo(s)<0){return"Rule "+r.id+" should be used with a version >= "+r.minversion}var u=this._verifySettingsObject(r);if(u==="success"){this._mRules[r.id]=r;r.libName=this._oSettings.name}return u};o.prototype.removeRule=function(e){if(this._mRules[e.id]){delete this._mRules[e.id]}};o.storeSelectionOfRules=function(e){var r=o._extractRulesSettingsToSave(e);t.setSelectedRules(r)};o.loadSelectionOfRules=function(e){var r=t.getSelectedRules();if(!r){return}for(var i=0;i<e.length;i+=1){var s=e[i].rules;var o=e[i].title;for(var u=0;u<s.length;u+=1){if(r[o]&&r[o].hasOwnProperty(s[u].id)){s[u].selected=r[o][s[u].id].selected}}}};o._extractRulesSettingsToSave=function(e){var r={};var t;var i=e.length;var s;var o;var u;for(var n=0;n<i;n+=1){o=e[n].title;r[o]={};t=e[n].rules;s=t.length;for(var a=0;a<s;a+=1){u={};u.id=t[a].id;u.selected=t[a].selected;r[o][u.id]=u}}return r};return o},true);