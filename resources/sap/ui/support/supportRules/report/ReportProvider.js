/*!
 * OpenUI5
 * (c) Copyright 2009-2022 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/thirdparty/jquery","sap/base/Log","sap/base/security/encodeXML","sap/base/util/isEmptyObject","sap/base/util/isPlainObject","sap/ui/support/supportRules/report/Archiver","sap/ui/support/supportRules/report/IssueRenderer"],function(e,t,a,n,s,i,r){"use strict";var o=sap.ui.require.toUrl("sap/ui/support/supportRules/report/resources");var p={line:function(e,t,n,s,i){e.push("<tr><td ",t?"align='right' ":"","valign='top'>","<label class='sapUiSupportLabel'>",a(s||""),"</label></td><td",n?" class='sapUiSupportTechInfoBorder'":"",">");var r=i;if(typeof i==="function"){r=i(e)}e.push(a(r||""));e.push("</td></tr>")},multiline:function(t,a,n,i,r){var o=this;o.line(t,a,n,i,function(t){t.push("<table border='0' cellspacing='0' cellpadding='3'>");e.each(r,function(e,a){var n="";if(a){if(typeof a==="string"||typeof a==="string"||typeof a==="boolean"){n=a}else if(Array.isArray(a)||s(a)){n=JSON.stringify(a)}}o.line(t,false,false,e,""+n)});t.push("</table>")})},subheader:function(e,t){e.push("<tr class='sapUiSupportTitle'><td valign='top' colspan='2'>","<label class='sapUiSupportLabel'>",a(t||""),"</label></td></tr>")}};function l(t){return e.ajax({type:"GET",url:o+"/"+t,dataType:"text"}).then(function(e){return e})}function u(s){var i="";if(!s){return i}try{s.modules.sort();var r=["<div class='sapUiSupportToolbar'>","<div><div class='sapUiSupportTechInfoCntnt'>","<table border='0' cellpadding='3'>"];p.subheader(r,"Support Assistant Information");p.line(r,true,true,"Location",s.supportAssistant.location);p.line(r,true,true,"Version",s.supportAssistant.versionAsString);p.subheader(r,"Application Information");p.line(r,true,true,"SAPUI5 Version",function(e){var t=s.sapUi5Version;if(t&&t.version){var n=t.version;var i=a(n.version||"");e.push(i," (built at ",a(n.buildTimestamp||""),", last change ",a(n.scmRevision||""),")")}else{e.push("not available")}});p.line(r,true,true,"Core Version",function(e){return s.version+" (built at "+s.build+", last change "+s.change+")"});p.line(r,true,true,"Loaded jQuery Version",function(e){return s.jquery});p.line(r,true,true,"User Agent",function(e){return s.useragent+(s.docmode?", Document Mode '"+s.docmode+"'":"")});p.line(r,true,true,"Application",s.appurl);p.multiline(r,true,true,"Configuration (bootstrap)",s.bootconfig);p.multiline(r,true,true,"Configuration (computed)",s.config);if(!n(s.libraries)){p.multiline(r,true,true,"Libraries",s.libraries)}p.multiline(r,true,true,"Loaded Libraries",s.loadedLibraries);p.line(r,true,true,"Loaded Modules",function(t){e.each(s.modules,function(e,n){if(n.indexOf("sap.ui.core.support")<0){t.push("<span>",a(n||""),"</span>");if(e<s.modules.length-1){t.push(", ")}}})});p.multiline(r,true,true,"URI Parameters",s.uriparams);r.push("</table></div>");i=r.join("")}catch(e){t.warning("There was a problem extracting technical info.")}return i}function c(e){var t="<td>";if(e){t+=a(e)}t+="</td>";return t}function d(e){var a="";if(!e){return a}a+='<table class="sapUiTable"><tr><th>Component ID</th><th>Type</th><th>Title</th><th>Subtitle</th><th>Application version</th><th>Description</th><th>BCP Component</th></tr>';try{for(var n=0;n<e.length;n++){var s=e[n];a+="<tr>";a+=c(s.id);a+=c(s.type);a+=c(s.title);a+=c(s.subTitle);if(s.applicationVersion){a+=c(s.applicationVersion.version)}else{a+="<td></td>"}a+=c(s.description);a+=c(s.ach);a+="</tr>"}a+="</table>"}catch(e){t.warning("There was a problem extracting app info.");a=""}return a}function f(e){var t="";t+='<div><span class="sapUiSupportLabel">'+e.displayName+"</span>";t+="<span> ("+e.description+")</span></div>";return t}function h(e,t){var a="";a+='<div><span class="sapUiSupportLabel">'+t.displayName+" with id:</span> "+e;a+="<span> ("+t.description+")</span></div>";return a}function v(e,t){var a="";if(e.length>5){a+='<div class="expandable-control collapsed-content" data-expandableElement="execution-scope-components">';a+='<span class="expandable-title"><span class="sapUiSupportLabel">'+t.displayName+"</span>";a+="<span> ("+t.description+")</span></span></div>"}else{a+='<div><span class="sapUiSupportLabel">'+t.displayName+"</span>";a+="<span> ("+t.description+")</span></div>"}a+='<ol id="execution-scope-components" class="top-margin-xsmall">';for(var n=0;n<e.length;n++){a+="<li>"+e[n]+"</li>"}a+="</ol>";return a}function b(e){var a="";try{var n=e.executionScope.getType();var s=e.scopeDisplaySettings.executionScopes[n];var i=e.scopeDisplaySettings.executionScopeTitle;a+='<div class="sapUiSupportLabel">'+i+": </div>";switch(n){case"global":a+=f(s);break;case"subtree":a+=h(e.executionScope._getContext().parentId,s);break;case"components":a+=v(e.executionScope._getContext().components,s);break}}catch(e){t.warning("There was a problem extracting scope info.");a=""}return a}function m(e){var a="";if(!e){return a}try{var n=1;a+='<table class="sapUiTable"><tbody><tr><th>Name</th><th>Description</th><th>Categories</th><th>Audiences</th></tr></tbody>';for(var s in e){var i=e[s];var r="collapsed-content";if(n===1){r="expanded-content"}var o=e[s].selected?" ("+e[s].issueCount+" issues)":"";var p='<span class="'+(e[s].selected?"checked":"unchecked")+'"></span>';a+='<tbody><tr><td colspan="100" ';a+='class="expandable-control '+r+'" data-expandableElement="section-selected-rules-group'+n+'">'+p;a+='<span class="sapUiSupportLabel expandable-title">'+s+o+"</span>";a+="</td></tr></tbody>";var l="";for(var u in i){var c=i[u].selected?" ("+i[u].issueCount+" issues)":"";var d='<span class="'+(i[u].selected?"checked":"unchecked")+'"></span>';l+="<tr>";l+="<td>"+d+i[u].title+c+"</td>";l+="<td>"+i[u].description+"</td>";l+="<td>"+i[u].categories.join(", ")+"</td>";l+="<td>"+i[u].audiences.join(", ")+"</td>";l+="</tr>"}a+='<tbody id="section-selected-rules-group'+n+'">'+l+"</tbody>";n++}a+="</table>"}catch(e){t.warning("There was a problem extracting selected rules info.");a=""}return a}function g(e){return r.render(e,true)}function y(e){if(!e){return"none"}return"<strong>"+e.title+"/"+e.id+"</strong>"}function T(e,t){if(!t){t=o+"/"}return l("ReportTemplate.html").then(function(a){var n={baseUrl:t,technicalInfo:u(e.technical),issues:g(e.issues),appInfo:d(e.application),rules:m(e.rules),rulePreset:y(e.rulePreset),metadataTitle:e.name+" Analysis Results",metadataTitleTechnicalInfo:"Technical Information",metadataTitleIssues:"Issues",metadataTitleAppInfo:"Application Information",metadataTitleSelectedRules:'Available and (<span class="checked"></span>) Selected Rules',metadataTimestamp:new Date,metadataScope:b(e.scope),metadataAnalysisDuration:e.analysisDuration,metadataAnalysisDurationTitle:e.analysisDurationTitle};return x(a,n)})}function x(e,t){var a,n;for(a in t){n=t[a];e=e.replace(new RegExp("{{"+a+"}}","ig"),n)}return e}function S(e){var t=[this.getReportHtml(e,"./"),l("styles.css"),l("index.js"),l("images/checked.svg"),l("images/collapsed.svg"),l("images/expanded.svg"),l("images/unchecked.svg")];Promise.all(t).then(function(t){var a={issues:e.issues},n={appInfos:e.application},s={technicalInfo:e.technical},r=new i;r.add("technicalInfo.json",s,"json");r.add("issues.json",a,"json");r.add("appInfos.json",n,"json");r.add("report.html",t[0]);r.add("abap.json",e.abap,"json");r.add("styles.css",t[1],"css");r.add("index.js",t[2],"js");r.add("images/checked.svg",t[3],"svg");r.add("images/collapsed.svg",t[4],"svg");r.add("images/expanded.svg",t[5],"svg");r.add("images/unchecked.svg",t[6],"svg");r.download("SupportAssistantReport");r.clear()})}function I(t){var a="";var n=e('<a class="sapUiHidden"></a>');n.on("click",function(){var t=window.open("","_blank");t.opener=null;e(t.document).ready(function(){t.document.documentElement.innerHTML="";t.document.write(a)})});e("body").append(n);this.getReportHtml(t).then(function(e){a=e;n[0].click();n.remove()})}return{getReportHtml:T,downloadReportZip:S,openReport:I}},true);