/*!
 * OpenUI5
 * (c) Copyright 2009-2021 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["jquery.sap.global","sap/ui/support/supportRules/report/Archiver","sap/ui/support/supportRules/report/IssueRenderer"],function(e,t,a){"use strict";var s=e.sap.getResourcePath("sap/ui/support/supportRules/report/resources");var n={line:function(t,a,s,n,i){t.push("<tr><td ",a?"align='right' ":"","valign='top'>","<label class='sapUiSupportLabel'>",e.sap.escapeHTML(n||""),"</label></td><td",s?" class='sapUiSupportTechInfoBorder'":"",">");var r=i;if(typeof i==="function"){r=i(t)}t.push(e.sap.escapeHTML(r||""));t.push("</td></tr>")},multiline:function(t,a,s,n,i){var r=this;r.line(t,a,s,n,function(t){t.push("<table border='0' cellspacing='0' cellpadding='3'>");e.each(i,function(a,s){var n="";if(s){if(typeof s==="string"||typeof s==="string"||typeof s==="boolean"){n=s}else if(Array.isArray(s)||e.isPlainObject(s)){n=JSON.stringify(s)}}r.line(t,false,false,a,""+n)});t.push("</table>")})},subheader:function(t,a){t.push("<tr class='sapUiSupportTitle'><td valign='top' colspan='2'>","<label class='sapUiSupportLabel'>",e.sap.escapeHTML(a||""),"</label></td></tr>")}};function i(t){return e.ajax({type:"GET",url:s+"/"+t,dataType:"text"}).then(function(e){return e})}function r(t){var a="";if(!t){return a}try{t.modules.sort();var s=["<div class='sapUiSupportToolbar'>","<div><div class='sapUiSupportTechInfoCntnt'>","<table border='0' cellpadding='3'>"];n.subheader(s,"Support Assistant Information");n.line(s,true,true,"Location",t.supportAssistant.location);n.line(s,true,true,"Version",t.supportAssistant.versionAsString);n.subheader(s,"Application Information");n.line(s,true,true,"SAPUI5 Version",function(a){var s=t.sapUi5Version;if(s&&s.version){var n=s.version;var i=e.sap.escapeHTML(n.version||"");a.push(i," (built at ",e.sap.escapeHTML(n.buildTimestamp||""),", last change ",e.sap.escapeHTML(n.scmRevision||""),")")}else{a.push("not available")}});n.line(s,true,true,"Core Version",function(e){return t.version+" (built at "+t.build+", last change "+t.change+")"});n.line(s,true,true,"Loaded jQuery Version",function(e){return t.jquery});n.line(s,true,true,"User Agent",function(e){return t.useragent+(t.docmode?", Document Mode '"+t.docmode+"'":"")});n.line(s,true,true,"Application",t.appurl);n.multiline(s,true,true,"Configuration (bootstrap)",t.bootconfig);n.multiline(s,true,true,"Configuration (computed)",t.config);if(!e.isEmptyObject(t.libraries)){n.multiline(s,true,true,"Libraries",t.libraries)}n.multiline(s,true,true,"Loaded Libraries",t.loadedLibraries);n.line(s,true,true,"Loaded Modules",function(a){e.each(t.modules,function(s,n){if(n.indexOf("sap.ui.core.support")<0){a.push("<span>",e.sap.escapeHTML(n||""),"</span>");if(s<t.modules.length-1){a.push(", ")}}})});n.multiline(s,true,true,"URI Parameters",t.uriparams);s.push("</table></div>");a=s.join("")}catch(t){e.sap.log.warning("There was a problem extracting technical info.")}return a}function o(t){var a="<td>";if(t){a+=e.sap.escapeHTML(t)}a+="</td>";return a}function p(t){var a="";if(!t){return a}a+='<table class="sapUiTable"><tr><th>Component ID</th><th>Type</th><th>Title</th><th>Subtitle</th><th>Application version</th><th>Description</th><th>BCP Component</th></tr>';try{for(var s=0;s<t.length;s++){var n=t[s];a+="<tr>";a+=o(n.id);a+=o(n.type);a+=o(n.title);a+=o(n.subTitle);if(n.applicationVersion){a+=o(n.applicationVersion.version)}else{a+="<td></td>"}a+=o(n.description);a+=o(n.ach);a+="</tr>"}a+="</table>"}catch(t){e.sap.log.warning("There was a problem extracting app info.");a=""}return a}function l(e){var t="";t+='<div><span class="sapUiSupportLabel">'+e.displayName+"</span>";t+="<span> ("+e.description+")</span></div>";return t}function c(e,t){var a="";a+='<div><span class="sapUiSupportLabel">'+t.displayName+" with id:</span> "+e;a+="<span> ("+t.description+")</span></div>";return a}function u(e,t){var a="";if(e.length>5){a+='<div class="expandable-control collapsed-content" data-expandableElement="execution-scope-components">';a+='<span class="expandable-title"><span class="sapUiSupportLabel">'+t.displayName+"</span>";a+="<span> ("+t.description+")</span></span></div>"}else{a+='<div><span class="sapUiSupportLabel">'+t.displayName+"</span>";a+="<span> ("+t.description+")</span></div>"}a+='<ol id="execution-scope-components" class="top-margin-xsmall">';for(var s=0;s<e.length;s++){a+="<li>"+e[s]+"</li>"}a+="</ol>";return a}function d(t){var a="";try{var s=t.executionScope.getType();var n=t.scopeDisplaySettings.executionScopes[s];var i=t.scopeDisplaySettings.executionScopeTitle;a+='<div class="sapUiSupportLabel">'+i+": </div>";switch(s){case"global":a+=l(n);break;case"subtree":a+=c(t.executionScope._getContext().parentId,n);break;case"components":a+=u(t.executionScope._getContext().components,n);break}}catch(t){e.sap.log.warning("There was a problem extracting scope info.");a=""}return a}function f(t){var a="";if(!t){return a}try{var s=1;a+='<table class="sapUiTable"><tbody><tr><th>Name</th><th>Description</th><th>Categories</th><th>Audiences</th></tr></tbody>';for(var n in t){var i=t[n];var r="collapsed-content";if(s===1){r="expanded-content"}var o=t[n].selected?" ("+t[n].issueCount+" issues)":"";var p='<span class="'+(t[n].selected?"checked":"unchecked")+'"></span>';a+='<tbody><tr><td colspan="100" ';a+='class="expandable-control '+r+'" data-expandableElement="section-selected-rules-group'+s+'">'+p;a+='<span class="sapUiSupportLabel expandable-title">'+n+o+"</span>";a+="</td></tr></tbody>";var l="";for(var c in i){var u=i[c].selected?" ("+i[c].issueCount+" issues)":"";var d='<span class="'+(i[c].selected?"checked":"unchecked")+'"></span>';l+="<tr>";l+="<td>"+d+i[c].title+u+"</td>";l+="<td>"+i[c].description+"</td>";l+="<td>"+i[c].categories.join(", ")+"</td>";l+="<td>"+i[c].audiences.join(", ")+"</td>";l+="</tr>"}a+='<tbody id="section-selected-rules-group'+s+'">'+l+"</tbody>";s++}a+="</table>"}catch(t){e.sap.log.warning("There was a problem extracting selected rules info.");a=""}return a}function h(e){return a.render(e,true)}function v(e){if(!e){return"none"}return"<strong>"+e.title+"/"+e.id+"</strong>"}function g(e,t){if(!t){t=s+"/"}return i("ReportTemplate.html").then(function(a){var s={baseUrl:t,technicalInfo:r(e.technical),issues:h(e.issues),appInfo:p(e.application),rules:f(e.rules),rulePreset:v(e.rulePreset),metadataTitle:e.name+" Analysis Results",metadataTitleTechnicalInfo:"Technical Information",metadataTitleIssues:"Issues",metadataTitleAppInfo:"Application Information",metadataTitleSelectedRules:'Available and (<span class="checked"></span>) Selected Rules',metadataTimestamp:new Date,metadataScope:d(e.scope),metadataAnalysisDuration:e.analysisDuration,metadataAnalysisDurationTitle:e.analysisDurationTitle};return m(a,s)})}function m(e,t){var a,s;for(a in t){s=t[a];e=e.replace(new RegExp("{{"+a+"}}","ig"),s)}return e}function b(e){var a=[this.getReportHtml(e,"./"),i("styles.css"),i("index.js"),i("images/checked.svg"),i("images/collapsed.svg"),i("images/expanded.svg"),i("images/unchecked.svg")];Promise.all(a).then(function(a){var s={issues:e.issues},n={appInfos:e.application},i={technicalInfo:e.technical},r=new t;r.add("technicalInfo.json",i,"json");r.add("issues.json",s,"json");r.add("appInfos.json",n,"json");r.add("report.html",a[0]);r.add("abap.json",e.abap,"json");r.add("styles.css",a[1],"css");r.add("index.js",a[2],"js");r.add("images/checked.svg",a[3],"svg");r.add("images/collapsed.svg",a[4],"svg");r.add("images/expanded.svg",a[5],"svg");r.add("images/unchecked.svg",a[6],"svg");r.download("SupportAssistantReport");r.clear()})}function y(t){var a="";var s=e('<a class="sapUiHidden"></a>');s.on("click",function(){var t=window.open("","_blank");t.opener=null;e(t.document).ready(function(){t.document.documentElement.innerHTML="";t.document.write(a)})});e("body").append(s);this.getReportHtml(t).then(function(e){a=e;s[0].click();s.remove()})}return{getReportHtml:g,downloadReportZip:b,openReport:y}},true);