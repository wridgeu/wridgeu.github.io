/*!
 * OpenUI5
 * (c) Copyright 2009-2021 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["jquery.sap.global","sap/ui/thirdparty/handlebars","sap/ui/support/supportRules/report/Archiver","sap/ui/support/supportRules/report/IssueRenderer"],function(e,t,n,s){"use strict";var a=e.sap.getResourcePath("sap/ui/support/supportRules/report/resources");var r=[{url:a+"/ReportTemplate.html",type:"template"},{url:a+"/styles.css",type:"css"},{url:a+"/filter.css",type:"css"},{url:a+"/collapseExpand.css",type:"css"},{url:a+"/filter.js",type:"js"},{url:a+"/collapseExpand.js",type:"js"}];var i={line:function(t,n,s,a,r){t.push("<tr><td ",n?"align='right' ":"","valign='top'>","<label class='sapUiSupportLabel'>",e.sap.escapeHTML(a||""),"</label></td><td",s?" class='sapUiSupportTechInfoBorder'":"",">");var i=r;if(typeof r==="function"){i=r(t)}t.push(e.sap.escapeHTML(i||""));t.push("</td></tr>")},multiline:function(t,n,s,a,r){var i=this;i.line(t,n,s,a,function(t){t.push("<table border='0' cellspacing='0' cellpadding='3'>");e.each(r,function(n,s){var a="";if(s){if(typeof s==="string"||typeof s==="string"||typeof s==="boolean"){a=s}else if(Array.isArray(s)||e.isPlainObject(s)){a=JSON.stringify(s)}}i.line(t,false,false,n,""+a)});t.push("</table>")})},subheader:function(t,n){t.push("<tr class='sapUiSupportTitle'><td valign='top' colspan='2'>","<label class='sapUiSupportLabel'>",e.sap.escapeHTML(n||""),"</label></td></tr>")}};function o(t){return e.ajax({type:"GET",url:t.url,dataType:"text"}).then(function(e){return{content:e,type:t.type}})}function p(){var t=[];for(var n=0;n<r.length;n++){t.push(o(r[n]))}return e.when.apply(e,t)}function l(n){var s="";if(!n){return new t.SafeString(s)}try{n.modules.sort();var a=["<div class='sapUiSupportToolbar'>","<div><div class='sapUiSupportTechInfoCntnt'>","<table border='0' cellpadding='3'>"];i.subheader(a,"Support Assistant Information");i.line(a,true,true,"Location",n.supportAssistant.location);i.line(a,true,true,"Version",n.supportAssistant.versionAsString);i.subheader(a,"Application Information");i.line(a,true,true,"SAPUI5 Version",function(t){var s=n.sapUi5Version;if(s&&s.version){var a=s.version;var r=e.sap.escapeHTML(a.version||"");t.push(r," (built at ",e.sap.escapeHTML(a.buildTimestamp||""),", last change ",e.sap.escapeHTML(a.scmRevision||""),")")}else{t.push("not available")}});i.line(a,true,true,"Core Version",function(e){return n.version+" (built at "+n.build+", last change "+n.change+")"});i.line(a,true,true,"Loaded jQuery Version",function(e){return n.jquery});i.line(a,true,true,"User Agent",function(e){return n.useragent+(n.docmode?", Document Mode '"+n.docmode+"'":"")});i.line(a,true,true,"Application",n.appurl);i.multiline(a,true,true,"Configuration (bootstrap)",n.bootconfig);i.multiline(a,true,true,"Configuration (computed)",n.config);if(!e.isEmptyObject(n.libraries)){i.multiline(a,true,true,"Libraries",n.libraries)}i.multiline(a,true,true,"Loaded Libraries",n.loadedLibraries);i.line(a,true,true,"Loaded Modules",function(t){e.each(n.modules,function(s,a){if(a.indexOf("sap.ui.core.support")<0){t.push("<span>",e.sap.escapeHTML(a||""),"</span>");if(s<n.modules.length-1){t.push(", ")}}})});i.multiline(a,true,true,"URI Parameters",n.uriparams);a.push("</table></div>");s=a.join("")}catch(t){e.sap.log.warning("There was a problem extracting technical info.")}return new t.SafeString(s)}function c(t){var n="<td>";if(t){n+=e.sap.escapeHTML(t)}n+="</td>";return n}function u(n){var s="";if(!n){return new t.SafeString(s)}s+='<table class="sapUiTable"><tr><th>Component ID</th><th>Type</th><th>Title</th><th>Subtitle</th><th>Application version</th><th>Description</th><th>BCP Component</th></tr>';try{for(var a=0;a<n.length;a++){var r=n[a];s+="<tr>";s+=c(r.id);s+=c(r.type);s+=c(r.title);s+=c(r.subTitle);if(r.applicationVersion){s+=c(r.applicationVersion.version)}else{s+="<td></td>"}s+=c(r.description);s+=c(r.ach);s+="</tr>"}s+="</table>"}catch(t){e.sap.log.warning("There was a problem extracting app info.");s=""}return new t.SafeString(s)}function d(e){var t="";t+='<div><span class="sapUiSupportLabel">'+e.displayName+"</span>";t+="<span> ("+e.description+")</span></div>";return t}function f(e,t){var n="";n+='<div><span class="sapUiSupportLabel">'+t.displayName+" with id:</span> "+e;n+="<span> ("+t.description+")</span></div>";return n}function h(e,t){var n="";if(e.length>5){n+='<div class="expandable-control collapsed-content" data-expandableElement="execution-scope-components">';n+='<span class="expandable-title"><span class="sapUiSupportLabel">'+t.displayName+"</span>";n+="<span> ("+t.description+")</span></span></div>"}else{n+='<div><span class="sapUiSupportLabel">'+t.displayName+"</span>";n+="<span> ("+t.description+")</span></div>"}n+='<ol id="execution-scope-components" class="top-margin-xsmall">';for(var s=0;s<e.length;s++){n+="<li>"+e[s]+"</li>"}n+="</ol>";return n}function b(n){var s="";try{var a=n.executionScope.getType();var r=n.scopeDisplaySettings.executionScopes[a];var i=n.scopeDisplaySettings.executionScopeTitle;s+='<div class="sapUiSupportLabel">'+i+": </div>";switch(a){case"global":s+=d(r);break;case"subtree":s+=f(n.executionScope._getContext().parentId,r);break;case"components":s+=h(n.executionScope._getContext().components,r);break}}catch(t){e.sap.log.warning("There was a problem extracting scope info.");s=""}return new t.SafeString(s)}function g(n){var s="";if(!n){return new t.SafeString(s)}try{var a=1;s+='<table class="sapUiTable"><tbody><tr><th>Name</th><th>Description</th><th>Categories</th><th>Audiences</th></tr></tbody>';for(var r in n){var i=n[r];var o="collapsed-content";if(a===1){o="expanded-content"}var p=n[r].selected?" ("+n[r].issueCount+" issues)":"";var l='<span class="'+(n[r].selected?"checked":"unchecked")+'"></span>';s+='<tbody><tr><td colspan="100" ';s+='class="expandable-control '+o+'" data-expandableElement="section-selected-rules-group'+a+'">'+l;s+='<span class="sapUiSupportLabel expandable-title">'+r+p+"</span>";s+="</td></tr></tbody>";var c="";for(var u in i){var d=i[u].selected?" ("+i[u].issueCount+" issues)":"";var f='<span class="'+(i[u].selected?"checked":"unchecked")+'"></span>';c+="<tr>";c+="<td>"+f+i[u].title+d+"</td>";c+="<td>"+i[u].description+"</td>";c+="<td>"+i[u].categories.join(", ")+"</td>";c+="<td>"+i[u].audiences.join(", ")+"</td>";c+="</tr>"}s+='<tbody id="section-selected-rules-group'+a+'">'+c+"</tbody>";a++}s+="</table>"}catch(t){e.sap.log.warning("There was a problem extracting selected rules info.");s=""}return new t.SafeString(s)}function v(e,n){var s="";if(n!=="script"&&n!=="style"){return s}for(var a=0;a<e.length;a++){switch(n){case"script":s+="<script>"+e[a]+"<\/script>\n";break;case"style":s+='<style type="text/css">'+e[a]+"</style>\n";break}}return new t.SafeString(s)}t.registerHelper("getTechnicalInformation",function(e){return l(e)});t.registerHelper("getRules",function(e){return g(e)});t.registerHelper("getIssues",function(e){return new t.SafeString(s.render(e,true))});t.registerHelper("getAppInfo",function(e){return u(e)});t.registerHelper("getScope",function(e){return b(e)});t.registerHelper("getScripts",function(e){return v(e,"script")});t.registerHelper("getStyles",function(e){return v(e,"style")});function m(e){return p().then(function(){var n=[],s=[],a="",r,i={},o={};for(r=0;r<arguments.length;r++){switch(arguments[r].type){case"template":a=arguments[r].content;break;case"css":n.push(arguments[r].content);break;case"js":s.push(arguments[r].content);break}}i=t.compile(a);o={technicalInfo:e.technical,issues:e.issues,appInfo:e.application,rules:e.rules,rulePreset:e.rulePreset,metadata:{title:e.name+" Analysis Results",title_TechnicalInfo:"Technical Information",title_Issues:"Issues",title_AppInfo:"Application Information",title_SelectedRules:'Available and (<span class="checked"></span>) Selected Rules',timestamp:new Date,scope:e.scope,analysisDuration:e.analysisDuration,analysisDurationTitle:e.analysisDurationTitle,styles:n,scripts:s}};return i(o)})}function y(e){this.getReportHtml(e).done(function(t){var s='<!DOCTYPE HTML><html><head><title>Report</title></head><body><div id="sap-report-content">'+t+"</div></body></html>";var a={issues:e.issues};var r={appInfos:e.application};var i={technicalInfo:e.technical};var o=new n;o.add("technicalInfo.json",i,"json");o.add("issues.json",a,"json");o.add("appInfos.json",r,"json");o.add("report.html",s);o.add("abap.json",e.abap,"json");o.download("SupportAssistantReport");o.clear()})}function S(t){var n="";var s=e('<a style="display: none;"></a>');s.on("click",function(){var t=window.open("","_blank");t.opener=null;e(t.document).ready(function(){if(t.document.getElementById("sap-report-content")){t.document.getElementById("sap-report-content").innerHtml=n}else{t.document.write('<div id="sap-report-content">'+n+"</div>")}t.document.title="Report"})});e("body").append(s);this.getReportHtml(t).then(function(e){n=e;s[0].click();s.remove()})}return{getReportHtml:m,downloadReportZip:y,openReport:S}},true);